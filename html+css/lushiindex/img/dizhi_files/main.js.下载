function toArrayBuffer(e){for(var t=e.length,n=new DataView(new ArrayBuffer(t),0,t),i=0,r=t;i<r;i++)n.setUint8(i,e[i],!1);return n.buffer}function toBuffer(e){if(Array.isArray(e))return new Buffer(e);else for(var t=e.byteLength,n=new DataView(e,0,t),i=new Buffer(t),r=0,o=t;r<o;r++)i[r]=n.getUint8(r,!1);return i}if(define("fonteditor-core/common/lang",["require"],function(require){function e(e){return null!=e&&"Array"===h.call(e).slice(8,-1)}function t(e){return null!=e&&"Object"===h.call(e).slice(8,-1)}function n(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function i(e){var t=[].slice.call(arguments,1);return function(){var n=t.concat([].slice.call(arguments));return e.apply(this,n)}}function r(e){return function(){return Function.call.apply(e,arguments)}}function o(e,t){var n=Array.prototype.slice.call(arguments,2);return function(){return e.apply(t,n.concat(Array.prototype.slice.call(arguments)))}}function a(e,t){var n=function(){};n.prototype=t.prototype;var i=e.prototype,r=e.prototype=new n;return Object.keys(i).forEach(function(e){r[e]=i[e]}),e.prototype.constructor=e,e}function s(e,t){for(var n=1,i=arguments.length;n<i;n++)if(t=arguments[n])for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r];return e}function l(e,t,n){if(!t)return e;else return n=n||Object.keys(t),n.forEach(function(n){if(e[n]&&"object"==typeof e[n]&&t[n]&&"object"==typeof t[n])l(e[n],t[n]);else e[n]=t[n]}),e}function u(n){if(!n||"object"!=typeof n)return n;var i=n;if(e(n))i=n.slice().map(u);else if(t(n)&&"isPrototypeOf"in n){i={};for(var r in n)if(p.call(n,r))i[r]=u(n[r])}return i}function f(e,t){var n,i,r,o,a=0,s=function(){a=new Date,r=null,o=e.apply(n,i)};return function(){var l=new Date,u=t-(l-a);if(n=this,i=arguments,u<=0)clearTimeout(r),r=null,a=l,o=e.apply(n,i);else if(!r)r=setTimeout(s,u);return o}}function c(e,t,n){var i,r;return function(){var o=this,a=arguments,s=function(){if(i=null,!n)r=e.apply(o,a)},l=n&&!i;if(clearTimeout(i),i=setTimeout(s,t),l)r=e.apply(o,a);return r}}function d(e,t,n){if(e===t)return!0;if(null==e&&null==t)return!0;if(null==e&&null!=t||null!=e&&null==t)return!1;if(n=n||("object"==typeof e?Object.keys(e):[]),!n.length)return e===t;for(var i,r=!0,o=0,a=n.length;r&&o<a;o++)if(i=n[o],e[i]&&"object"==typeof e[i]&&t[i]&&"object"==typeof t[i])r=r&&d(e[i],t[i]);else r=r&&e[i]===t[i];return r}var h=Object.prototype.toString,p=Object.prototype.hasOwnProperty,exports={extend:s,overwrite:l,equals:d,bind:o,inherits:a,curry:i,uncurry:r,clone:u,throttle:f,debounce:c,isEmptyObject:n};return["String","Function","Date"].forEach(function(e){exports["is"+e]=function(t){return null!=t&&h.call(t).slice(8,-1)===e}}),exports}),define("fonteditor-core/common/I18n",["require","./lang"],function(require){function e(e,t){return t.forEach(function(t){var i=t[0];e[i]=n.extend(e[i]||{},t[1])}),e}function t(t,n){this.store=e({},t),this.setLanguage(n||"undefined"!=typeof navigator&&navigator.language&&navigator.language.toLowerCase()||"en-us")}var n=require("./lang");return t.prototype.setLanguage=function(e){if(!this.store[e])e="en-us";return this.lang=this.store[this.language=e],this},t.prototype.addLanguage=function(t,n){return e(this.store,[[t,n]]),this},t.prototype.get=function(e){for(var t,n=e.split("."),i=this.lang;null!=i&&(t=n.shift());)i=i[t];return null!=i?i:""},t}),define("common/I18n",["require","fonteditor-core/common/I18n"],function(require){return require("fonteditor-core/common/I18n")}),define("fonteditor/i18n/zh-cn/editor",["require"],function(require){return{glyph_name:"命名",left_side_bearing:"左边距",right_side_bearing:"右边距",baseline_offset:"基线偏移",flip:"翻转",mirror:"镜像",scale:"按比例缩放",findglyf:"查找字形",downloadglyf:"导出字形",setunicode:"设置代码点",del:"删除",edit:"编辑",resume:"恢复",prevpage:"上一页",nextpage:"下一页",gotopage:"转到",saveas:"另存为",sync:"同步",syncfont:"同步字体",cancelsync:"取消同步",autosync:"自动同步",fonttype:"字体类型",remoteurl:"远程地址",fontname:"字体名称",fontinfo:"字体信息",ascent:"上升",descent:"下降",linegap:"行间距",usWinAscent:"win上升",usWinDescent:"win下降",calc:"计算",sTypoAscender:"typo上升",sTypoDescender:"typo下降",sTypoLineGap:"typo间距",sxHeight:"x高度",sCapHeight:"大写H高度",yStrikeoutPosition:"删除线位置",yStrikeoutSize:"删除线厚度",underlinePosition:"下划线位置",underlineThickness:"下划线厚度",ySubscriptXSize:"下标水平",ySubscriptYSize:"下标垂直",ySubscriptXOffset:"下标X偏移",ySubscriptYOffset:"下标Y偏移",ySuperscriptXSize:"上标水平",ySuperscriptYSize:"上标垂直",ySuperscriptXOffset:"上标X偏移",ySuperscriptYOffset:"上标Y偏移",achVendID:"供应商ID",usWeightClass:"粗细",usWidthClass:"宽度",panose:"panose",fontFamily:"字体家族",fontSubFamily:"子字体家族",fullName:"完整字体名",uniqueSubFamily:"唯一字体识别名",version:"版本",postScriptName:"PostScript名称",unitsPerEm:"em框大小",lowestRecPPEM:"最小可读尺寸",created:"创建日期",modified:"修改日期",setting:"设置",help:"帮助",confirm:"确定",cancel:"取消",pushurl:"推送地址"}}),define("fonteditor/i18n/en-us/editor",["require"],function(require){return{glyph_name:"Glyph Name",left_side_bearing:"Left Side Bearing",right_side_bearing:"Right Side Bearing",baseline_offset:"Baseline Offset",flip:"Flip",mirror:"Mirror",scale:"Scale By Percent",findglyf:"Find Glyph",downloadglyf:"Download Glyf",setunicode:"Set Unicode",del:"Delete",edit:"Edit",resume:"Resume",prevpage:"Prev Page",nextpage:"Next Page",gotopage:"Go To",saveas:"Save As",sync:"Sync",syncfont:"Sync Font",cancelsync:"Cancel Sync",autosync:"Auto Sync",fonttype:"Font Type",remoteurl:"Remote Url",fontname:"Font Name",fontinfo:"Font Info",ascent:"Ascent",descent:"Descent",linegap:"Linegap",usWinAscent:"win Ascent",usWinDescent:"win Descent",calc:"Calc",sTypoAscender:"typo Ascender",sTypoDescender:"typo Descender",sTypoLineGap:"typo LineGap",sxHeight:"`x` Height",sCapHeight:"`H` Height",yStrikeoutPosition:"Strikeout Position",yStrikeoutSize:"Strikeout Size",underlinePosition:"Underline Position",underlineThickness:"Underline Thickness",ySubscriptXSize:"Subscript x Size",ySubscriptYSize:"Subscript y Size",ySubscriptXOffset:"Subscript x Offset",ySubscriptYOffset:"Subscript y Offset",ySuperscriptXSize:"Superscript x Size",ySuperscriptYSize:"Superscript y Size",ySuperscriptXOffset:"Superscript x Offset",ySuperscriptYOffset:"Superscript y Offset",achVendID:"Vendor ID",usWeightClass:"Weight Class",usWidthClass:"Width Class",panose:"Panose",fontFamily:"Font Family",fontSubFamily:"Font Sub Family",fullName:"Full Name",uniqueSubFamily:"Unique Sub Family",version:"Version",postScriptName:"PostScript Name",unitsPerEm:"EM Size",lowestRecPPEM:"Lowest Recognized PPEM",created:"Created Time",modified:"Modified Time",setting:"Setting",help:"Help",confirm:"Confirm",cancel:"Cancel",pushurl:"Push Url"}}),define("fonteditor/i18n/zh-cn/message",["require"],function(require){return{msg_not_support_file_type:"不支持的文件类型！",msg_loading_pic:"正在加载图片...",msg_read_pic_error:"读取图片失败...",msg_processing:"正在处理...",msg_input_pic_url:"请输入图片URL!",msg_no_glyph_to_import:"没有找到可导入的字形！",msg_error_read_file:"读取文件出错!",msg_loading:"正在加载...",msg_confirm_del_proj:"是否删除项目?",msg_not_set_sync_info:"没有设置同步信息!",msg_no_sync_font:"没有要同步的字体!",msg_repeat_unicode:"重复的unicode代码点，字形序号：",msg_confirm_del_glyph:"确定删除字形么？",msg_read_file_error:"加载文件错误!",msg_syncing:"正在同步...",msg_sync_success:"同步成功...",msg_sync_failed:"同步失败：",msg_confirm_save_proj:"是否放弃保存当前编辑的项目?",msg_save_success:"保存成功...",msg_save_failed:"保存失败...",msg_input_proj_name:"请输入项目名称：",msg_confirm_gen_names:"生成的字形名称会覆盖原来的名称，确定生成？",msg_not_support_compound_glyf:"暂不支持复合字形!",msg_transform_compound_glyf:"是否转换复合字形为简单字形？",msg_confirm_save_glyph:"是否放弃保存当前编辑的字形?",msg_no_related_glhph:"未找到相关字形!",msg_error_open_proj:"打开项目失败，是否删除项目?",msg_error_del_proj:"删除项目失败，请刷新页面后删除!",msg_no_sort_glyf:"没有要排序的字形!",msg_has_compound_glyf_sort:"包含复合字形,无法进行排序",preview_title:"预览{%=fontFormat%}格式字体",preview_first_step:"第一步：使用font-face声明字体",preview_second_step:"第二步：定义使用{%=fontFamily%}的样式",preview_third_step:"第三步：挑选相应图标并获取字体编码，应用于页面",msg_error_sync_font:"无法获取同步字体！",msg_error_sync_font_address:"字体同步地址不可用！",msg_has_new_font_version:"字体`${fontName}`有新版本，是否同步新版本？",msg_error_sync_font_version:"同步新版本出错！"}}),define("fonteditor/i18n/en-us/message",["require"],function(require){return{msg_not_support_file_type:"Not support this file type!",msg_loading_pic:"Loading pic...",msg_read_pic_error:"Error reading pic...",msg_processing:"Processing...",msg_input_pic_url:"Please input pic url!",msg_no_glyph_to_import:"No glyph to import",msg_error_read_file:"Read error  file",msg_loading:"Loading...",msg_confirm_del_proj:"Do you want to delete project?",msg_not_set_sync_info:"Not set sync config!",msg_no_sync_font:"No sync font!",msg_repeat_unicode:"Repeat unicode, glyph index are:",msg_confirm_del_glyph:"Do you want to delete glyph？",msg_read_file_error:"Error read file!",msg_syncing:"Synchronizing...",msg_sync_success:"Sync success...",msg_sync_failed:"Sync failed：",msg_confirm_save_proj:"Do you want to save current project before leave?",msg_save_success:"Save success...",msg_save_failed:"Save failed...",msg_input_proj_name:"Please input project name：",msg_confirm_gen_names:"Glyph name will be rewrite by generated name, do you really want to regenerate?",msg_not_support_compound_glyf:"Not support compound glyph currently!",msg_transform_compound_glyf:"Do you want to transform compound glyf to simple glyf?",msg_confirm_save_glyph:"Do you want to cancel save current editing glyph?",msg_no_related_glhph:"Find no related glyph!",msg_error_open_proj:"Open project error, do you want to delete this project?",msg_error_del_proj:"Delete project error, please refresh this page and try delete again!",msg_no_sort_glyf:"No glyph to sort!",msg_has_compound_glyf_sort:"Can't sort glyphs while contains compound glyph.",preview_title:"Preview {%=fontFormat%} Format Font",preview_first_step:"Step 1: Use `{%=fontFamily%}` as font-face.",preview_second_step:"Step 2：Define css styles with `{%=fontFamily%}`.",preview_third_step:"Step 3：Set font unicode to icons on web page.",msg_error_sync_font:"Get sync font error!",msg_error_sync_font_address:"Font sync address not available!",msg_has_new_font_version:"Font `${fontName}` has new version, update now?",msg_error_sync_font_version:"Sync new font version error!"}}),define("fonteditor/i18n/zh-cn/dialog",["require"],function(require){return{dialog_savesetting:"保存设置",dialog_resetsetting:"重置为默认设置",dialog_no_input:"没有设置项目!",dialog_adjust_glyph:"调整字形",dialog_glyph_info:"字形信息",dialog_adjust_pos:"调整字形位置",dialog_scale_to_bound:"缩放字形到上下边界",dialog_set_unicode:"请设置查找内容!",dialog_top_bottom_padding:"顶部和底部留白",dialog_find_glyf_by_unicode:"按代码点查找字形",dialog_find_glyf_by_name:"按名字查找字形",dialog_find_glyf_by_index:"按字形序号查找字形",dialog_find_glyf_example:'<b>查找内容：</b> （代码点："$21"，名字： "uniE001"，序号："5"）',dialog_editor_setting:"编辑器设置",dialog_editor_viewercolor:"字体列表颜色",dialog_editor_fontsize:"字体列表大小",dialog_editor_fontsize_xlarge:"特大",dialog_editor_fontsize_large:"大",dialog_editor_fontsize_normal:"中",dialog_editor_fontsize_small:"小",dialog_editor_pageSize:"分页个数",dialog_editor_gridsorption:"吸附到网格线",dialog_editor_shapesorption:"吸附到轮廓",dialog_editor_showgrid:"显示网格",dialog_editor_fillcontour:"填充轮廓",dialog_editor_contourstrokecolor:"轮廓颜色",dialog_editor_contourfillcolor:"轮廓填充颜色",dialog_editor_gapcolor:"网格线颜色",dialog_editor_gap:"网格线间距",dialog_editor_metricscolor:"度量线颜色",dialog_glyf_unicode_example:' &nbsp;&nbsp;可以设置多个unicode，例如："$21,$22,$23"',dialog_unicode_set:"设置代码点",dialog_unicode_start:"起始代码点",dialog_generage_name:"是否生成字形名称",dialog_metrics:"字体度量",dialog_import_and_export:"导入和导出",dialog_combine_svg_single_glyph:"导入svg文件时合并成单个字形",dialog_save_with_glyf_name:"保存字体时同时保存字形命名",dialog_onlinefont:"在线字体",dialog_import_pic:"导入字形图片",dialog_fonturl:"字体URL",dialog_picurl:"图片URL",dialog_picurl_load_title:"指定图片URL加载图片",dialog_picurl_load:"从URL导入图片",dialog_adjustwindow:"适应窗口",dialog_showorigin:"查看原图",dialog_showcontour:"查看轮廓",dialog_choosepic:"选择图片",dialog_choosepic_tip:"请选择字形图片，支持jpg、gif、png、bmp、svg。",dialog_preprocess:"预处理",dialog_reverse:"反转",dialog_gaussblur:"高斯模糊",dialog_contrast:"对比度",dialog_contour:"轮　廓",dialog_binarize_threshold:"二值化阈值",dialog_threshold_default:"预设",dialog_threshold_mean:"均值",dialog_threshold_minimum:"谷底最小值",dialog_threshold_intermodes:"双峰平均",dialog_threshold_ostu:"大津法",dialog_threshold_isodata:"ISODATA法",dialog_pic_smooth:"平滑",dialog_pic_open:"消除杂点",dialog_pic_close:"消除孔洞",dialog_pic_dilate:"膨胀",dialog_pic_enrode:"腐蚀",dialog_export_glyf:"导出字形",dialog_glyf_name:"图标名称",dialog_color:"颜色",dialog_size:"大小",dialog_download_svg:"下载SVG",dialog_download_png:"下载PNG",dialog_alert_set_sync_name:"请设置同步文件名称!",dialog_alert_set_url_or_syncurl:"需要设置远程地址或者推送地址至少一项!",dialog_alert_set_sync_url:"需要设置远程同步地址!",dialog_alert_set_filetype:"请设置文件类型!"}}),define("fonteditor/i18n/en-us/dialog",["require"],function(require){return{dialog_savesetting:"Save Setting",dialog_resetsetting:"Reset to Default Setting",dialog_no_input:"No Input!",dialog_adjust_glyph:"Adjust Glyph",dialog_glyph_info:"Glyph Info",dialog_adjust_pos:"Adjust Glyph Position",dialog_scale_to_bound:"Scale to Ascent and Descent",dialog_set_unicode:"Please Input Unicode!",dialog_top_bottom_padding:"Top and Bottom Padding",dialog_find_glyf_by_unicode:"Find Glyph by Unicode",dialog_find_glyf_by_name:"Find Glyph by Name",dialog_find_glyf_by_index:"Find Glyph by Index",dialog_find_glyf_example:'example: Unicode："$21", Glyph Name： "uniE001", Index："5"',dialog_editor_setting:"Editor Setting",dialog_editor_viewercolor:"Glhph Viewer Color",dialog_editor_fontsize:"Font Size",dialog_editor_fontsize_xlarge:"xLarge",dialog_editor_fontsize_large:"Large",dialog_editor_fontsize_normal:"Normal",dialog_editor_fontsize_small:"Small",dialog_editor_pageSize:"Page Size",dialog_editor_gridsorption:"Adsorb to Grid",dialog_editor_shapesorption:"Adsorb to Contour",dialog_editor_showgrid:"Show Grid",dialog_editor_fillcontour:"Fill Contour",dialog_editor_contourstrokecolor:"Contour Stroke Color",dialog_editor_contourfillcolor:"Contour Fill Color",dialog_editor_gapcolor:"Gap Color",dialog_editor_gap:"Gap Size",dialog_editor_metricscolor:"Metrics Color",dialog_glyf_unicode_example:' &nbsp;&nbsp; Support Multi Unicodes, Example："$21,$22,$23"',dialog_unicode_set:"Set Unicode",dialog_unicode_start:"Start Unicode Code",dialog_generage_name:"Generate Glyph Name",dialog_metrics:"Metrics",dialog_import_and_export:"Import and Export",dialog_combine_svg_single_glyph:"Combine svg to Single Glyph",dialog_save_with_glyf_name:"save glyph name when exporting font",dialog_onlinefont:"Online Font",dialog_import_pic:"Import Pic",dialog_fonturl:"Font URL",dialog_picurl:"Pic URL",dialog_picurl_load_title:"Set Pic Url to Load from",dialog_picurl_load:"Imort Pic From Url",dialog_adjustwindow:"Adjust To Window",dialog_showorigin:"Show Origin",dialog_showcontour:"Show Contour",dialog_choosepic:"Choose Pic",dialog_choosepic_tip:"Please Choose A Pic,eg. jpg,gif,png,bmp,svg.",dialog_preprocess:"Pre Process",dialog_reverse:"Reverse",dialog_gaussblur:"Gauss Blur",dialog_contrast:"Contrast",dialog_contour:"Contour",dialog_binarize_threshold:"Binarize Threshold",dialog_threshold_default:"Default",dialog_threshold_mean:"Mean",dialog_threshold_minimum:"Minimum",dialog_threshold_intermodes:"Intermodes",dialog_threshold_ostu:"Ostu",dialog_threshold_isodata:"ISODATA",dialog_pic_smooth:"Smooth",dialog_pic_open:"Open",dialog_pic_close:"Close",dialog_pic_dilate:"Dilate",dialog_pic_enrode:"Enrode",dialog_export_glyf:"Export Glyf",dialog_glyf_name:"Glyf Name",dialog_color:"Color",dialog_size:"Size",dialog_download_svg:"Download SVG",dialog_download_png:"Download PNG",dialog_alert_set_sync_name:"Please set sync name!",dialog_alert_set_url_or_syncurl:"Please set sync url or pushurl!",dialog_alert_set_sync_url:"Please set sync url!",dialog_alert_set_filetype:"Please set at lease one fonttype!"}}),define("fonteditor/i18n/i18n",["require","common/I18n","./zh-cn/editor","./en-us/editor","./zh-cn/message","./en-us/message","./zh-cn/dialog","./en-us/dialog"],function(require){return new(require("common/I18n"))([["zh-cn",require("./zh-cn/editor")],["en-us",require("./en-us/editor")],["zh-cn",require("./zh-cn/message")],["en-us",require("./en-us/message")],["zh-cn",require("./zh-cn/dialog")],["en-us",require("./en-us/dialog")]],window.language)}),define("common/lang",["require","fonteditor-core/common/lang"],function(require){var e=require("fonteditor-core/common/lang");return e.parseQuery=function(e){return e.split("&").map(function(e){return e=e.split("="),[e[0],decodeURIComponent(e[1])]}).reduce(function(e,t){return e[t[0]]=t[1],e},{})},e}),define("common/observable",["require","./lang"],function(require){var e=require("./lang").extend,t={on:function(e,t){if("function"==typeof e)t=e,e="*";this._listeners=this._listeners||{};var n=this._listeners[e]||[];if(n.indexOf(t)<0)t.$type=e,n.push(t);return this._listeners[e]=n,this},once:function(e,t){var n=function(n){t.call(this,n),this.un(e,t)};return this.on(e,n),this},un:function(e,t){if("function"==typeof e)t=e,e="*";else if(void 0===e)return delete this._listeners,this._listeners={},this;this._listeners=this._listeners||{};var n=this._listeners[e];if(n)if(t){var i=n.indexOf(t);if(~i)delete n[i]}else n.length=0,delete this._listeners[e];return this},fire:function(e,t){this._listeners=this._listeners||{};var n=this._listeners[e];if(n){var i=this;n.forEach(function(n){t=t||{},t.type=e,n.call(i,t)})}if("*"!==e)this.fire("*",t);return this}};return{mixin:function(n){if(void 0===n)return n;else return e(n,t)}}}),define("fonteditor/widget/loading",["require","../i18n/i18n"],function(require){var e=require("../i18n/i18n");return{show:function(t,n,i){clearTimeout(this.showtimer);var r=$("#loading");if(r.attr("data-status",i||"").find("span").html(t||e.lang.msg_loading),r.show(),n)this.showtimer=setTimeout(this.hide,n);return this},error:function(e,t){return this.show(e,t,"error"),this},warn:function(e,t){return this.show(e,t,"warn"),this},hide:function(){$("#loading").hide()}}}),define("fonteditor/widget/program",["require","common/observable","./loading"],function(require){function e(e){var t=this;document.body.addEventListener("click",function(n){if(t.listening){if(e.viewer===n.target||e.viewer.contains(n.target))t.viewer.focus();else t.viewer.blur();if(e.editor)if(e.editor===n.target||e.editor.contains(n.target))t.editor.focus();else t.editor.blur()}})}function t(){var e=this;document.body.addEventListener("keydown",function(t){if(e.listening){if(t.ctrl=t.ctrlKey||t.metaKey,65===t.keyCode&&t.ctrl)t.preventDefault(),t.stopPropagation();if(t.keyCode>=112&&t.keyCode<=119&&116!==t.keyCode)t.preventDefault(),t.stopPropagation(),e.fire("function",{keyCode:t.keyCode});else if(83===t.keyCode&&t.ctrl)if(t.preventDefault(),t.stopPropagation(),t.shiftKey)e.fire("save",{saveType:"force"});else e.fire("save");else if(86===t.keyCode&&t.ctrl)t.preventDefault(),t.stopPropagation(),e.fire("paste")}})}var n=require("common/observable"),i={init:function(n){e.call(this,n),t.call(this,n)},data:{},setting:{},listening:!0,loading:require("./loading")};return n.mixin(i),i}),define("fonteditor-core/common/string",["require"],function(require){return{decodeHTML:function(e){return String(e).replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&#([\d]+);/g,function(e,t){return String.fromCharCode(parseInt(t,10))})},encodeHTML:function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")},getLength:function(e){return String(e).replace(/[^\x00-\xff]/g,"11").length},format:function(e,t){return e.replace(/\$\{([\w.]+)\}/g,function(e,n){for(var i,r=n.split("."),o=t;null!=o&&(i=r.shift());)o=o[i];return null!=o?o:""})},pad:function(e,t,n){if(e=String(e),e.length>t)return e.slice(e.length-t);else return new Array(t-e.length+1).join(n||"0")+e},hashcode:function(e){if(!e)return 0;for(var t=0,n=0,i=e.length;n<i;n++)t=34359738367&31*t+e.charCodeAt(n);return t}}}),define("common/string",["require","fonteditor-core/common/string"],function(require){return require("fonteditor-core/common/string")}),define("fonteditor/dialog/setting",["require","common/string","../i18n/i18n","common/lang","../widget/program"],function(require){function e(e,t){var n=t.split(".");if(1===n.length)return e[t];for(var i,r=e;null!=r&&(i=n.shift());)r=r[i];return r}function t(e,t,n){var i=t.split(".");if(1===i.length)e[t]=n;else{for(var r,o=i.pop(),a=e;null!=a&&(r=i.shift());)a=a[r];if(null!=a)a[o]=n}return e}function n(e){this.options=e||{};var t=$("#model-dialog");t.find(".modal-title").html(this.title||"");var n=i.format(this.getTpl(),r);if(t.find(".modal-body").html(n),this.nofooter)t.find(".modal-footer").hide();else t.find(".modal-footer").show();t.on("hidden.bs.modal",o.bind(function(e){if(s.listening=!0,t)this.onDispose&&this.onDispose(),this.style&&t.removeClass(this.style),t.off("hidden.bs.modal"),t.find(".btn-confirm").off("click"),t.find(".modal-body").html(""),delete this.options,delete this.setting,delete this.oldSetting,t=null},this)),t.find(".btn-confirm").on("click",o.bind(function(){var e=this.validate();if(!1!==e){if(!o.equals(e,this.oldSetting))this.options.onChange&&this.options.onChange.call(this,e);t.modal("hide")}},this))}var i=require("common/string"),r=require("../i18n/i18n"),o=require("common/lang"),a=require("common/string").pad,s=require("../widget/program");return n.prototype.getTpl=function(){return""},n.prototype.getDialog=function(){return $("#model-dialog")},n.prototype.validate=function(){return!0},n.prototype.setFields=function(t){return this.getDialog().find("[data-field]").each(function(n,i){var r=i.getAttribute("data-field"),o=i.getAttribute("data-type")||i.type,s=e(t,r);if(void 0!==s)if("checkbox"===o)i.checked=s?"checked":"";else if("unicode"===o)i.value=(s||[]).map(function(e){return"$"+e.toString(16).toUpperCase()}).join(",");else if("datetime-local"===o){var l;if("string"==typeof s)l=new Date(Date.parse(s));else if(/^\d+$/.test(s))l=new Date(+s);else l=s;i.value=l.getFullYear()+"-"+a(l.getMonth()+1,2)+"-"+a(l.getDate(),2)+"T"+a(l.getHours(),2)+":"+a(l.getMinutes(),2)}else i=$(i),i.val(s)}),this.oldSetting=t,this},n.prototype.getFields=function(e){e=e||{};var n=/^(?:\$[A-F0-9]+)(?:\,\$[A-F0-9]+)*$/gi;return this.getDialog().find("[data-field]").each(function(i,r){var o,a=r.getAttribute("data-field"),s=r.getAttribute("data-type")||r.type,l=r.value.trim();if("checkbox"===s)o=!!r.checked;else if("unicode"===s)if(!l)o=[];else if(n.test(l))o=l.split(",").map(function(e){return Number("0x"+e.slice(1))});else o=l.split("").map(function(e){return e.charCodeAt(0)});else if("datetime-local"===s)if(l)o=Date.parse(l.replace("T"," "));else o=0;else if("number"===s)if(l){if(l=+l,r.getAttribute("data-ceil"))l=Math.floor(l);o=l}else o=null;else o=l;if(void 0!==o)t(e,a,o)}),e},n.prototype.show=function(e){s.listening=!1;var t=$("#model-dialog");if(this.style)t.addClass(this.style);return t.modal("show"),this.set(e),this},n.prototype.hide=function(e){if(void 0!==e)this.options.onChange&&this.options.onChange.call(this,e);$("#model-dialog").modal("hide")},n.prototype.set=function(e){return this.setting=e,this},n.prototype.get=function(){return this.setting},n.prototype.dispose=function(){$("#model-dialog").modal("hide")},n.derive=function(e){function t(){n.apply(this,arguments)}return t.prototype=e,o.inherits(t,n),t},n}),define("fonteditor/dialog/setting-unicode",["require","../i18n/i18n","./setting"],function(require){var e=require("../i18n/i18n"),t='<div class="input-group"><div class="input-group-btn"><button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">'+e.lang.dialog_unicode_start+' <span class="caret"></span></button><ul class="dropdown-menu" role="menu"><li><a href="javascript:$(\'#setting-text-unicode\').val(\'$21\')">ascii</a></li><li><a href="javascript:$(\'#setting-text-unicode\').val(\'$E001\')">unicode private data</a></li></ul></div><input id="setting-text-unicode" type="text" class="form-control" value="$E001"></div><div class="form-inline"><div class="input-group input-group-sm"><span class="input-group-addon">${lang.dialog_generage_name}</span><span class="form-control"><input id="setting-text-unicode-name" type="checkbox" checked="checked"></span></div></div>';return require("./setting").derive({title:e.lang.dialog_unicode_set,getTpl:function(){return t},validate:function(){var e=$("#setting-text-unicode").val();if(e.match(/^\$[A-F0-9]+$/i))return this.setting={unicode:e,isGenerateName:$("#setting-text-unicode-name").is(":checked")};else return alert("代码点设置不正确"),!1}})}),define("fonteditor/template/dialog/setting-name.tpl",[],function(){return'<div class="input-group input-group-sm">\n      <span class="input-group-addon">${lang.fontFamily}</span>\n      <input data-field="fontFamily" type="text" class="form-control">\n</div>\n<div class="input-group input-group-sm">\n      <span class="input-group-addon">${lang.fontSubFamily}</span>\n      <input data-field="fontSubFamily" type="text" class="form-control">\n</div>\n<div class="input-group input-group-sm">\n      <span class="input-group-addon">${lang.fullName}</span>\n      <input data-field="fullName" type="text" class="form-control">\n</div>\n<div class="input-group input-group-sm">\n      <span class="input-group-addon">${lang.uniqueSubFamily}</span>\n      <input data-field="uniqueSubFamily" type="text" class="form-control">\n</div>\n<div class="input-group input-group-sm">\n      <span class="input-group-addon">${lang.version}</span>\n      <input data-field="version" type="text" class="form-control">\n</div>\n<div class="input-group input-group-sm">\n      <span class="input-group-addon">${lang.postScriptName}</span>\n      <input data-field="postScriptName" type="text" class="form-control">\n</div>\n<div class="input-group input-group-sm">\n      <span class="input-group-addon">${lang.unitsPerEm}</span>\n      <input data-field="unitsPerEm" type="number" min="64" max="16384" class="form-control" placeholder="1024~16384">\n</div>\n<div class="input-group input-group-sm">\n      <span class="input-group-addon">${lang.lowestRecPPEM}</span>\n      <input data-field="lowestRecPPEM" type="number" min="8" max="16384" class="form-control" placeholder="8~16384">\n</div>\n<div class="input-group input-group-sm">\n      <span class="input-group-addon">${lang.created}</span>\n      <input data-field="created" type="datetime-local" class="form-control">\n</div>\n<div class="input-group input-group-sm">\n      <span class="input-group-addon">${lang.modified}</span>\n      <input data-field="modified" type="datetime-local" class="form-control">\n</div>\n'}),define("fonteditor/dialog/setting-name",["require","../i18n/i18n","../template/dialog/setting-name.tpl","./setting"],function(require){var e=require("../i18n/i18n"),t=require("../template/dialog/setting-name.tpl");return require("./setting").derive({title:e.lang.fontinfo,getTpl:function(){return t},set:function(e){this.setFields(e)},validate:function(){return this.getFields()}})}),define("fonteditor/template/dialog/setting-adjust-pos.tpl",[],function(){return'<div class="form-inline">\n    <div class="input-group input-group-sm">\n        <span class="input-group-addon">${lang.left_side_bearing}</span>\n        <input data-field="leftSideBearing" type="number" min="-16384" max="16384" step="1" class="form-control">\n    </div>\n</div>\n<div class="form-inline">\n    <div class="input-group input-group-sm">\n        <span class="input-group-addon">${lang.right_side_bearing}</span>\n        <input data-field="rightSideBearing" type="number" min="-16384" max="16384" step="1" class="form-control">\n    </div>\n</div>\n<div class="form-inline">\n    <div class="input-group input-group-sm">\n        <span class="input-group-addon">${lang.baseline_offset}</span>\n        <input data-field="verticalAlign" type="number" min="-16384" max="16384" step="1" class="form-control">\n    </div>\n</div>\n'}),define("fonteditor/dialog/setting-adjust-pos",["require","../i18n/i18n","../template/dialog/setting-adjust-pos.tpl","./setting"],function(require){var e=require("../i18n/i18n"),t=require("../template/dialog/setting-adjust-pos.tpl");return require("./setting").derive({title:e.lang.dialog_adjust_pos,getTpl:function(){return t},set:function(e){this.setFields(e||{})},validate:function(){var t=this.getFields();if(void 0===t.leftSideBearing&&void 0===t.rightSideBearing&&void 0===t.verticalAlign)return alert(e.lang.dialog_no_input),!1;else return t}})}),define("fonteditor/template/dialog/setting-adjust-glyf.tpl",[],function(){return'<div class="form-inline">\n  <div class="input-group input-group-sm">\n    <span class="input-group-addon">${lang.flip}</span>\n    <span class="form-control">\n      <input data-field="reverse" type="checkbox">\n    </span>\n  </div>\n</div>\n<div class="form-inline">\n  <div class="input-group input-group-sm">\n    <span class="input-group-addon">${lang.mirror}</span>\n    <span class="form-control">\n      <input data-field="mirror" type="checkbox">\n    </span>\n  </div>\n</div>\n<div class="form-inline">\n  <div class="input-group input-group-sm">\n    <span class="input-group-addon">${lang.scale}</span>\n    <input data-field="scale" type="number" min="0" max="1" step="0.1" class="form-control">\n  </div>\n</div>\n<div class="form-inline">\n  <div class="form-group">\n    <div class="input-group input-group-sm">\n      <span class="input-group-addon">${lang.dialog_scale_to_bound}</span>\n      <span class="form-control">\n        <input data-field="ajdustToEmBox" type="checkbox" onclick="$(\'#setting-ajdustToEmPadding\')[this.checked ? \'removeClass\' : \'addClass\'](\'hide\')">\n      </span>\n    </div>\n  </div>\n  <div id="setting-ajdustToEmPadding" class="form-group hide">\n    <div class="input-group input-group-sm">\n      <span class="input-group-addon">${lang.dialog_top_bottom_padding}</span>\n      <input data-field="ajdustToEmPadding" data-ceil="true" type="number" min="-16384" max="16384" step="1" class="form-control">\n    </div>\n  </div>\n</div>\n'}),define("fonteditor/dialog/setting-adjust-glyf",["require","../i18n/i18n","../template/dialog/setting-adjust-glyf.tpl","./setting"],function(require){var e=require("../i18n/i18n"),t=require("../template/dialog/setting-adjust-glyf.tpl");return require("./setting").derive({title:e.lang.dialog_adjust_glyph,getTpl:function(){return t},set:function(e){this.setFields(e||{})},validate:function(){var t=this.getFields();if(void 0===t.reverse&&void 0===t.mirror&&void 0===t.scale&&void 0===t.ajdustToEmBox)return alert(e.lang.dialog_no_input),!1;else return t}})}),define("fonteditor/template/dialog/setting-metrics.tpl",[],function(){return'<div class="form-inline column-3">\n  <div class="form-group">\n    <div class="input-group input-group-sm">\n      <span class="input-group-addon">${lang.ascent}</span>\n      <input data-field="ascent" type="number" class="form-control">\n    </div>\n  </div>\n  <div class="form-group">\n    <div class="input-group input-group-sm">\n      <span class="input-group-addon">${lang.descent}</span>\n      <input data-field="descent" type="number" class="form-control">\n    </div>\n  </div>\n  <div class="form-group">\n    <div class="input-group input-group-sm">\n      <span class="input-group-addon">${lang.linegap}</span>\n      <input data-field="lineGap" type="number" class="form-control">\n    </div>\n  </div>\n</div>\n\n\n<div class="form-inline column-3">\n  <div class="form-group">\n    <div class="input-group input-group-sm">\n      <span class="input-group-addon">${lang.usWinAscent}</span>\n      <input data-field="usWinAscent" type="number" class="form-control">\n    </div>\n  </div>\n  <div class="form-group">\n    <div class="input-group input-group-sm">\n      <span class="input-group-addon">${lang.usWinDescent}</span>\n      <input data-field="usWinDescent" type="number" class="form-control">\n    </div>\n  </div>\n  <a href="#" id="setting-calc-metrics" class="form-group">${lang.calc}</a>\n</div>\n<div class="form-inline">\n  <div class="form-group">\n    <div class="input-group input-group-sm">\n      <span class="input-group-addon">${lang.sTypoAscender}</span>\n      <input data-field="sTypoAscender" type="number" class="form-control">\n    </div>\n  </div>\n  <div class="form-group">\n    <div class="input-group input-group-sm">\n      <span class="input-group-addon">${lang.sTypoDescender}</span>\n      <input data-field="sTypoDescender" type="number" class="form-control">\n    </div>\n  </div>\n  <div class="form-group">\n    <div class="input-group input-group-sm">\n      <span class="input-group-addon">${lang.sTypoLineGap}</span>\n      <input data-field="sTypoLineGap" type="number" class="form-control">\n    </div>\n  </div>\n</div>\n\n\n\n<div class="form-inline column-3">\n  <div class="form-group">\n    <div class="input-group input-group-sm">\n      <span class="input-group-addon">${lang.sxHeight}</span>\n      <input data-field="sxHeight" type="number" class="form-control">\n    </div>\n  </div>\n  <div class="form-group">\n    <div class="input-group input-group-sm">\n      <span class="input-group-addon">${lang.sCapHeight}</span>\n      <input data-field="sCapHeight" type="number" class="form-control">\n    </div>\n  </div>\n  <div class="form-group">\n    <div class="input-group input-group-sm">\n      <span class="input-group-addon">${lang.yStrikeoutPosition}</span>\n      <input data-field="yStrikeoutPosition" type="number" class="form-control">\n    </div>\n  </div>\n  <div class="form-group">\n    <div class="input-group input-group-sm">\n      <span class="input-group-addon">${lang.yStrikeoutSize}</span>\n      <input data-field="yStrikeoutSize" type="number" class="form-control">\n    </div>\n  </div>\n  <div class="form-group">\n    <div class="input-group input-group-sm">\n      <span class="input-group-addon">${lang.underlinePosition}</span>\n      <input data-field="underlinePosition" type="number" class="form-control">\n    </div>\n  </div>\n  <div class="form-group">\n    <div class="input-group input-group-sm">\n      <span class="input-group-addon">${lang.underlineThickness}</span>\n      <input data-field="underlineThickness" type="number" class="form-control">\n    </div>\n  </div>\n</div>\n<hr>\n\n\n<div class="form-inline column-4">\n  <div class="form-group">\n    <div class="input-group input-group-sm">\n      <span class="input-group-addon">${lang.ySubscriptXSize}</span>\n      <input data-field="ySubscriptXSize" type="number" class="form-control">\n    </div>\n  </div>\n  <div class="form-group">\n    <div class="input-group input-group-sm">\n      <span class="input-group-addon">${lang.ySubscriptYSize}</span>\n      <input data-field="ySubscriptYSize" type="number" class="form-control">\n    </div>\n  </div>\n  <div class="form-group">\n    <div class="input-group input-group-sm">\n      <span class="input-group-addon">${lang.ySubscriptXOffset}</span>\n      <input data-field="ySubscriptXOffset" type="number" class="form-control">\n    </div>\n  </div>\n  <div class="form-group">\n    <div class="input-group input-group-sm">\n      <span class="input-group-addon">${lang.ySubscriptYOffset}</span>\n      <input data-field="ySubscriptYOffset" type="number" class="form-control">\n    </div>\n  </div>\n</div>\n\n\n<div class="form-inline column-4">\n  <div class="form-group">\n    <div class="input-group input-group-sm">\n      <span class="input-group-addon">${lang.ySuperscriptXSize}</span>\n      <input data-field="ySuperscriptXSize" type="number" class="form-control">\n    </div>\n  </div>\n  <div class="form-group">\n    <div class="input-group input-group-sm">\n      <span class="input-group-addon">${lang.ySuperscriptYSize}</span>\n      <input data-field="ySuperscriptYSize" type="number" class="form-control">\n    </div>\n  </div>\n  <div class="form-group">\n    <div class="input-group input-group-sm">\n      <span class="input-group-addon">${lang.ySuperscriptXOffset}</span>\n      <input data-field="ySuperscriptXOffset" type="number" class="form-control">\n    </div>\n  </div>\n  <div class="form-group">\n    <div class="input-group input-group-sm">\n      <span class="input-group-addon">${lang.ySuperscriptYOffset}</span>\n      <input data-field="ySuperscriptYOffset" type="number" class="form-control">\n    </div>\n  </div>\n</div>\n<hr>\n\n<div class="form-inline column-3">\n  <div class="form-group">\n    <div class="input-group input-group-sm">\n      <span class="input-group-addon">${lang.achVendID}</span>\n      <input data-field="achVendID" type="text" class="form-control">\n    </div>\n  </div>\n  <div class="form-group">\n    <div class="input-group input-group-sm">\n      <span class="input-group-addon">${lang.usWeightClass}</span>\n      <select id="setting-weight" data-field="usWeightClass" data-type="number" class="form-control">${weightOptions}</select>\n    </div>\n  </div>\n  <div class="form-group">\n    <div class="input-group input-group-sm">\n      <span class="input-group-addon">${lang.usWidthClass}</span>\n      <select id="setting-width" data-field="usWidthClass" data-type="number" class="form-control">${widthOptions}</select>\n    </div>\n  </div>\n</div>\n\n<label for="panose-bFamilyType">panose</label>\n<div class="form-inline  column-3 panose-inline">${panoseOptions}</div>\n</div>\n'}),define("fonteditor-core/ttf/enum/weightClass",["require"],function(require){return{100:"Ultra-light",200:"Extra-light",300:"Light",400:"Semi-light",500:"Medium (normal)",600:"Semi-bold",700:"Bold",800:"Extra-Bold",900:"Ultra-bold"}}),define("fonteditor-core/ttf/enum/widthClass",["require"],function(require){return{1:"Ultra-condensed",2:"Extra-condensed",3:"Condensed",4:"Semi-condensed",5:"Medium (normal)",6:"Semi-expanded",7:"Expanded",8:"Extra-expanded",9:"Ultra-expanded"}}),define("fonteditor-core/ttf/enum/panose",["require"],function(require){return{bFamilyType:["Any","No Fit","Text and Display","Script","Decorative","Pictorial"],bSerifStyle:["Any","No Fit","Cove","Obtuse Cove","Square Cove","Obtuse Square Cove","Square","Thin","Bone","Exaggerated","Triangle","Normal Sans","Obtuse Sans","Perp Sans","Flared","Rounded"],bWeight:["Any","No Fit","Very Light","Light","Thin","Book","Medium","Demi","Bold","Heavy","Black","Nord"],bProportion:["Any","No Fit","Old Style","Modern","Even Width","Expanded","Condensed","Very Expanded","Very Condensed","Monospaced"],bContrast:["Any","No Fit","None","Very Low","Low","Medium Low","Medium","Medium High","High","Very High"],bStrokeVariation:["Any","No Fit","Gradual/Diagonal","Gradual/Transitional","Gradual/Vertical","Gradual/Horizontal","Rapid/Vertical","Rapid/Horizontal","Instant/Vertical"],bArmStyle:["Any","No Fit","Straight Arms/Horizontal","Straight Arms/Wedge","Straight Arms/Vertical","Straight Arms/Single Serif","Straight Arms/Double Serif","Non-Straight Arms/Horizontal","Non-Straight Arms/Wedge","Non-Straight Arms/Vertical","Non-Straight Arms/Single Serif","Non-Straight Arms/Double Serif"],bLetterform:["Any","No Fit","Normal/Contact","Normal/Weighted","Normal/Boxed","Normal/Flattened","Normal/Rounded","Normal/Off Center","Normal/Square","Oblique/Contact","Oblique/Weighted","Oblique/Boxed","Oblique/Flattened","Oblique/Rounded","Oblique/Off Center","Oblique/Square"],bMidline:["Any","No Fit","Standard/Trimmed","Standard/Pointed","Standard/Serifed","High/Trimmed","High/Pointed","High/Serifed","Constant/Trimmed","Constant/Pointed","Constant/Serifed","Low/Trimmed","Low/Pointed","Low/Serifed"],bXHeight:["Any","No Fit","Constant/Small","Constant/Standard","Constant/Large","Ducking/Small","Ducking/Standard","Ducking/Large"]}}),define("fonteditor/dialog/setting-metrics",["require","../i18n/i18n","../template/dialog/setting-metrics.tpl","common/string","../widget/program","fonteditor-core/ttf/enum/weightClass","fonteditor-core/ttf/enum/widthClass","fonteditor-core/ttf/enum/panose","./setting"],function(require){var e=require("../i18n/i18n"),t=require("../template/dialog/setting-metrics.tpl"),n=require("common/string"),i=require("../widget/program"),r=require("fonteditor-core/ttf/enum/weightClass"),o=require("fonteditor-core/ttf/enum/widthClass"),a=require("fonteditor-core/ttf/enum/panose");return require("./setting").derive({title:e.lang.dialog_metrics,style:"setting-metrics",getTpl:function(){var i={lang:e.lang};return i.weightOptions=Object.keys(r).map(function(e){return'<option value="'+e+'">'+r[e]+"</option>"}).join(""),i.widthOptions=Object.keys(o).map(function(e){return'<option value="'+e+'">'+o[e]+"</option>"}).join(""),i.panoseOptions=Object.keys(a).map(function(e,t){return'<div class="form-group"><div class="input-group input-group-sm"><span class="input-group-addon">'+(t+1)+"-"+e+'</span><select data-field="'+e+'" data-type="number" class="form-control">'+a[e].map(function(e,t){return'<option value="'+t+'">'+e+"</option>"}).join("")+"</select></div></div>"}).join(""),n.format(t,i)},set:function(e){this.setFields(e);var t=this;$("#setting-calc-metrics").on("click",function(e){e.preventDefault(),e.stopPropagation();var n=i.ttfManager.calcMetrics();t.setFields(n)})},onDispose:function(){$("#setting-calc-metrics").off("click")},validate:function(){return this.getFields()}})}),define("fonteditor/data/online-font",["require"],function(require){return[{name:"fonteditor",url:"./font/fonteditor.ttf",from:"fonteditor图标"},{name:"fontawesome图标",url:"http://www.bootcss.com/p/font-awesome/assets/font/fontawesome-webfont.woff",from:"fontawesome"},{name:"百度移动图标",url:"http://m.baidu.com/static/index/iconfont/iconfont_78d9aaf6.woff",from:"baidu"},{name:"百度健康图标",url:"http://vs-static.baidu.com/m-health/new-composite/asset/common/css/font/baiduHealth.woff",from:"baidu"},{name:"百度健康医药馆图标",url:"http://vs-static.baidu.com/m-health/med-detail/201412301413/asset/common/css/fonts/fonteditor.woff",from:"baidu"},{name:"百度教育图标",url:"http://vs-static.baidu.com/edu/m/asset/common/css/font/i-edu.woff",from:"baidu"},{name:"阿里妈妈图标",url:"http://mkwiser.sinaapp.com/font/font_1438789372_0128245.ttf",from:"iconfont"},{name:"淘宝图标",url:"http://mkwiser.sinaapp.com/font/font_1438789398_3645205.ttf",from:"iconfont"},{name:"天猫图标",url:"http://mkwiser.sinaapp.com/font/font_1438789427_2512155.ttf",from:"iconfont"},{name:"1688 图标",url:"http://mkwiser.sinaapp.com/font/font_1438789809_9884617.ttf",from:"iconfont"},{name:"手机淘宝图标",url:"http://mkwiser.sinaapp.com/font/font_1438789803_2537308.ttf",from:"iconfont"},{name:"阿里通信图标",url:"http://mkwiser.sinaapp.com/font/font_1438789794_5659146.ttf",from:"iconfont"},{name:"Alibaba国际站图标",url:"http://mkwiser.sinaapp.com/font/font_1438789716_42745.ttf",from:"iconfont"},{name:"支付宝钱包图标",url:"http://mkwiser.sinaapp.com/font/font_1438789709_7418613.ttf",from:"iconfont"},{name:"商家产品图标",url:"http://mkwiser.sinaapp.com/font/font_1438789702_183668.ttf",from:"iconfont"}]}),define("fonteditor/dialog/font-online",["require","../i18n/i18n","common/string","../data/online-font","./setting"],function(require){var e=require("../i18n/i18n"),t=require("common/string"),n=require("../data/online-font");return require("./setting").derive({title:e.lang.dialog_onlinefont,nofooter:!0,getTpl:function(){var e='<div class="list-group list-font-online">';return n.forEach(function(n,i){e+='<a data-url="'+n.url+'" href="'+n.url+'" class="list-group-item"><span class="from">'+t.encodeHTML(n.from)+"</span>"+(i+1)+". "+t.encodeHTML(n.name)+"</a>"}),e+="</div>"},set:function(){var e=this,t=this.getDialog();t.find(".list-group").on("click",".list-group-item",function(n){n.preventDefault(),n.stopPropagation();var i=$(this).attr("data-url");t.find(".list-group").off("click",".list-group-item"),e.options.onChange&&e.options.onChange.call(this,decodeURIComponent(i)),$("#model-dialog").modal("hide")})}})}),define("fonteditor/dialog/font-url",["require","../i18n/i18n","./setting"],function(require){var e=require("../i18n/i18n"),t='<div class="input-group input-group-sm"><span class="input-group-addon">'+e.lang.dialog_fonturl+'</span><input data-field="url" type="text" class="form-control"></div>';return require("./setting").derive({title:e.lang.dialog_fonturl,getTpl:function(){return t},validate:function(){var e=this.getFields();if(e.url)return e.url}})}),define("fonteditor/template/dialog/setting-glyf.tpl",[],function(){return'<div class="form-inline">\n  <div class="input-group input-group-sm">\n    <span class="input-group-addon">unicode</span>\n    <input data-field="unicode" data-type="unicode" id="setting-glyf-unicode" class="form-control">\n  </div>\n  <span>${lang.dialog_glyf_unicode_example}</span>\n</div>\n<div class="form-inline">\n  <div class="input-group input-group-sm">\n    <span class="input-group-addon">${lang.glyph_name}</span>\n    <input data-field="name" id="setting-glyf-name" class="form-control">\n  </div>\n</div>\n<div class="form-inline">\n  <div class="input-group input-group-sm">\n    <span class="input-group-addon">${lang.left_side_bearing}</span>\n    <input data-field="leftSideBearing" type="number" min="-16384" max="16384" step="1" class="form-control">\n  </div>\n</div>\n<div class="form-inline">\n  <div class="input-group input-group-sm">\n    <span class="input-group-addon">${lang.right_side_bearing}</span>\n    <input data-field="rightSideBearing" type="number" min="-16384" max="16384" step="1" class="form-control">\n  </div>\n</div>\n'}),define("fonteditor-core/ttf/enum/unicodeName",["require"],function(require){return{0:1,1:1,2:1,3:1,4:1,5:1,6:1,7:1,8:1,9:2,10:1,11:1,12:1,13:2,14:1,15:1,16:1,17:1,18:1,19:1,20:1,21:1,22:1,23:1,24:1,25:1,26:1,27:1,28:1,29:1,30:1,31:1,32:3,33:4,34:5,35:6,36:7,37:8,38:9,39:10,40:11,41:12,42:13,43:14,44:15,45:16,46:17,47:18,48:19,49:20,50:21,51:22,52:23,53:24,54:25,55:26,56:27,57:28,58:29,59:30,60:31,61:32,62:33,63:34,64:35,65:36,66:37,67:38,68:39,69:40,70:41,71:42,72:43,73:44,74:45,75:46,76:47,77:48,78:49,79:50,80:51,81:52,82:53,83:54,84:55,85:56,86:57,87:58,88:59,89:60,90:61,91:62,92:63,93:64,94:65,95:66,96:67,97:68,98:69,99:70,100:71,101:72,102:73,103:74,104:75,105:76,106:77,107:78,108:79,109:80,110:81,111:82,112:83,113:84,114:85,115:86,116:87,117:88,118:89,119:90,120:91,121:92,122:93,123:94,124:95,125:96,126:97,160:172,161:163,162:132,163:133,164:189,165:150,166:232,167:134,168:142,169:139,170:157,171:169,172:164,174:138,175:218,176:131,177:147,178:242,179:243,180:141,181:151,182:136,184:222,185:241,186:158,187:170,188:245,189:244,190:246,191:162,192:173,193:201,194:199,195:174,196:98,197:99,198:144,199:100,200:203,201:101,202:200,203:202,204:207,205:204,206:205,207:206,208:233,209:102,210:211,211:208,212:209,213:175,214:103,215:240,216:145,217:214,218:212,219:213,220:104,221:235,222:237,223:137,224:106,225:105,226:107,227:109,228:108,229:110,230:160,231:111,232:113,233:112,234:114,235:115,236:117,237:116,238:118,239:119,240:234,241:120,242:122,243:121,244:123,245:125,246:124,247:184,248:161,249:127,250:126,251:128,252:129,253:236,254:238,255:186,262:253,263:254,268:255,269:256,273:257,286:248,287:249,304:250,305:215,321:226,322:227,338:176,339:177,350:251,351:252,352:228,353:229,376:187,381:230,382:231,402:166,710:216,711:225,728:219,729:220,730:221,731:224,733:223,960:155,8211:178,8212:179,8216:182,8217:183,8218:196,8220:180,8221:181,8222:197,8224:130,8225:194,8226:135,8230:171,8240:198,8249:190,8250:191,8355:247,8482:140,8486:159,8706:152,8710:168,8719:154,8721:153,8722:239,8725:188,8729:195,8730:165,8734:146,8747:156,8776:167,8800:143,8804:148,8805:149,9674:185,61441:192,61442:193,64257:192,64258:193,65535:0}}),define("fonteditor-core/ttf/enum/postName",["require"],function(require){return{0:".notdef",1:".null",2:"nonmarkingreturn",3:"space",4:"exclam",5:"quotedbl",6:"numbersign",7:"dollar",8:"percent",9:"ampersand",10:"quotesingle",11:"parenleft",12:"parenright",13:"asterisk",14:"plus",15:"comma",16:"hyphen",17:"period",18:"slash",19:"zero",20:"one",21:"two",22:"three",23:"four",24:"five",25:"six",26:"seven",27:"eight",28:"nine",29:"colon",30:"semicolon",31:"less",32:"equal",33:"greater",34:"question",35:"at",36:"A",37:"B",38:"C",39:"D",40:"E",41:"F",42:"G",43:"H",44:"I",45:"J",46:"K",47:"L",48:"M",49:"N",50:"O",51:"P",52:"Q",53:"R",54:"S",55:"T",56:"U",57:"V",58:"W",59:"X",60:"Y",61:"Z",62:"bracketleft",63:"backslash",64:"bracketright",65:"asciicircum",66:"underscore",67:"grave",68:"a",69:"b",70:"c",71:"d",72:"e",73:"f",74:"g",75:"h",76:"i",77:"j",78:"k",79:"l",80:"m",81:"n",82:"o",83:"p",84:"q",85:"r",86:"s",87:"t",88:"u",89:"v",90:"w",91:"x",92:"y",93:"z",94:"braceleft",95:"bar",96:"braceright",97:"asciitilde",98:"Adieresis",99:"Aring",100:"Ccedilla",101:"Eacute",102:"Ntilde",103:"Odieresis",104:"Udieresis",105:"aacute",106:"agrave",107:"acircumflex",108:"adieresis",109:"atilde",110:"aring",111:"ccedilla",112:"eacute",113:"egrave",114:"ecircumflex",115:"edieresis",116:"iacute",117:"igrave",118:"icircumflex",119:"idieresis",120:"ntilde",121:"oacute",122:"ograve",123:"ocircumflex",124:"odieresis",125:"otilde",126:"uacute",127:"ugrave",128:"ucircumflex",129:"udieresis",130:"dagger",131:"degree",132:"cent",133:"sterling",134:"section",135:"bullet",136:"paragraph",137:"germandbls",138:"registered",139:"copyright",140:"trademark",141:"acute",142:"dieresis",143:"notequal",144:"AE",145:"Oslash",146:"infinity",147:"plusminus",148:"lessequal",149:"greaterequal",150:"yen",151:"mu",152:"partialdiff",153:"summation",154:"product",155:"pi",156:"integral",157:"ordfeminine",158:"ordmasculine",159:"Omega",160:"ae",161:"oslash",162:"questiondown",163:"exclamdown",164:"logicalnot",165:"radical",166:"florin",167:"approxequal",168:"Delta",169:"guillemotleft",170:"guillemotright",171:"ellipsis",172:"nonbreakingspace",173:"Agrave",174:"Atilde",175:"Otilde",176:"OE",177:"oe",178:"endash",179:"emdash",180:"quotedblleft",181:"quotedblright",182:"quoteleft",183:"quoteright",184:"divide",185:"lozenge",186:"ydieresis",187:"Ydieresis",188:"fraction",189:"currency",190:"guilsinglleft",191:"guilsinglright",192:"fi",193:"fl",194:"daggerdbl",195:"periodcentered",196:"quotesinglbase",197:"quotedblbase",198:"perthousand",199:"Acircumflex",200:"Ecircumflex",201:"Aacute",202:"Edieresis",203:"Egrave",204:"Iacute",205:"Icircumflex",206:"Idieresis",207:"Igrave",208:"Oacute",209:"Ocircumflex",210:"apple",211:"Ograve",212:"Uacute",213:"Ucircumflex",214:"Ugrave",215:"dotlessi",216:"circumflex",217:"tilde",218:"macron",219:"breve",220:"dotaccent",221:"ring",222:"cedilla",223:"hungarumlaut",224:"ogonek",225:"caron",226:"Lslash",227:"lslash",228:"Scaron",229:"scaron",230:"Zcaron",231:"zcaron",232:"brokenbar",233:"Eth",234:"eth",235:"Yacute",236:"yacute",237:"Thorn",238:"thorn",239:"minus",240:"multiply",241:"onesuperior",242:"twosuperior",243:"threesuperior",244:"onehalf",245:"onequarter",246:"threequarters",247:"franc",248:"Gbreve",249:"gbreve",250:"Idotaccent",251:"Scedilla",252:"scedilla",253:"Cacute",254:"cacute",255:"Ccaron",256:"ccaron",257:"dcroat"}}),define("fonteditor-core/ttf/util/string",["require","../enum/unicodeName","../enum/postName"],function(require){function e(e){if(!e)return e;for(var t,n="",i=0,r=e.length;i<r;i++)if(0!==(t=e.charCodeAt(i)))n+=String.fromCharCode(t);return n}var t=require("../enum/unicodeName"),n=require("../enum/postName");return{stringify:e,escape:function(e){if(!e)return e;else return String(e).replace(/[\uff-\uffff]/g,function(e){return escape(e).replace("%","\\")})},getString:function(e){for(var t="",n=0,i=e.length;n<i;n++)t+=String.fromCharCode(e[n]);return t},getUnicodeName:function(e){var i=t[e];if(void 0!==i)return n[i];else return"uni"+e.toString(16).toUpperCase()},toUTF8Bytes:function(t){t=e(t);for(var n=[],i=0,r=t.length;i<r;i++)if(t.charCodeAt(i)<=127)n.push(t.charCodeAt(i));else for(var o=encodeURIComponent(t.charAt(i)).slice(1).split("%"),a=0;a<o.length;a++)n.push(parseInt(o[a],16));return n},toUCS2Bytes:function(t){t=e(t);for(var n,i=[],r=0,o=t.length;r<o;r++)n=t.charCodeAt(r),i.push(n>>8),i.push(255&n);return i},toPascalStringBytes:function(e){var t=[],n=e?e.length<256?e.length:255:0;t.push(n);for(var i=0,r=e.length;i<r;i++){var o=e.charCodeAt(i);t.push(o<128?o:42)}return t},getUTF8String:function(e){for(var t="",n=0,i=e.length;n<i;n++)if(e[n]<127)t+=String.fromCharCode(e[n]);else t+="%"+(256+e[n]).toString(16).slice(1);return unescape(t)},getUCS2String:function(e){for(var t="",n=0,i=e.length;n<i;n+=2)t+=String.fromCharCode((e[n]<<8)+e[n+1]);return t},getPascalString:function(t){for(var n=[],i=0,r=t.length;i<r;){for(var o=t[i++],a="";o-- >0&&i<r;)a+=String.fromCharCode(t[i++]);a=e(a),n.push(a)}return n}}}),define("fonteditor/dialog/setting-glyf",["require","../i18n/i18n","../template/dialog/setting-glyf.tpl","fonteditor-core/ttf/util/string","./setting"],function(require){var e=require("../i18n/i18n"),t=require("../template/dialog/setting-glyf.tpl"),n=require("fonteditor-core/ttf/util/string"),i=/^(?:\$[A-F0-9]+)(?:\,\$[A-F0-9]+)*$/gi;return require("./setting").derive({title:e.lang.dialog_glyph_info,getTpl:function(){return t},set:function(e){$("#setting-glyf-unicode").on("blur",function(e){var t=$(this).val(),r=$("#setting-glyf-name");if(!r.val()){if(t.match(i))t=Number("0x"+t.split(",")[0].slice(1));else if(t)t=t.charCodeAt(0);r.val(n.getUnicodeName(t))}}),this.setFields(e||{})},onDispose:function(){$("#setting-glyf-unicode").off("blur")},validate:function(){var t=this.getFields();if(void 0===t.leftSideBearing&&void 0===t.rightSideBearing&&void 0===t.unicode&&void 0===t.name)return alert(e.lang.dialog_no_input),!1;else return t}})}),define("fonteditor/template/dialog/setting-editor.tpl",[],function(){return'<div class="form-inline column-3">\n  <div class="form-group">\n    <div class="input-group input-group-sm">\n      <span class="input-group-addon">${lang.dialog_editor_viewercolor}</span>\n      <input data-field="viewer.color" type="text" class="form-control">\n    </div>\n  </div>\n  <div class="form-group">\n    <div class="input-group input-group-sm">\n      <span class="input-group-addon">${lang.dialog_editor_fontsize}</span>\n      <select data-field="viewer.shapeSize" class="form-control">\n        <option value="xlarge">${lang.dialog_editor_fontsize_xlarge}</option>\n        <option value="large">${lang.dialog_editor_fontsize_large}</option>\n        <option value="normal">${lang.dialog_editor_fontsize_normal}</option>\n        <option value="small">${lang.dialog_editor_fontsize_small}</option>\n      </select>\n    </div>\n  </div>\n  <div class="form-group">\n    <div class="input-group input-group-sm">\n      <span class="input-group-addon">${lang.dialog_editor_pageSize}</span>\n      <input data-field="viewer.pageSize" type="number" class="form-control">\n    </div>\n  </div>\n</div>\n<hr>\n<div class="form-inline column-3">\n  <div class="form-group">\n    <div class="input-group input-group-sm">\n      <span class="input-group-addon">${lang.dialog_editor_gridsorption}</span>\n      <span class="form-control">\n        <input data-field="editor.sorption.enableGrid" type="checkbox">\n      </span>\n    </div>\n  </div>\n  <div class="form-group">\n    <div class="input-group input-group-sm">\n      <span class="input-group-addon">${lang.dialog_editor_shapesorption}</span>\n      <span class="form-control">\n        <input data-field="editor.sorption.enableShape" type="checkbox">\n      </span>\n    </div>\n  </div>\n</div>\n<div class="form-inline">\n  <div class="input-group input-group-sm">\n    <span class="input-group-addon">${lang.dialog_editor_showgrid}</span>\n    <span class="form-control"><input data-field="editor.axis.showGrid" type="checkbox"></span>\n  </div>\n</div>\n<div class="form-inline column-3">\n  <div class="form-group">\n    <div class="input-group input-group-sm">\n      <span class="input-group-addon">${lang.dialog_editor_fillcontour}</span>\n      <span class="form-control"><input data-field="editor.fontLayer.fill" type="checkbox"></span>\n    </div>\n  </div>\n  <div class="form-group">\n    <div class="input-group input-group-sm">\n      <span class="input-group-addon">${lang.dialog_editor_contourstrokecolor}</span>\n      <input data-field="editor.fontLayer.strokeColor" type="text" class="form-control">\n    </div>\n  </div>\n  <div class="form-group">\n    <div class="input-group input-group-sm">\n      <span class="input-group-addon">${lang.dialog_editor_contourfillcolor}</span>\n      <input data-field="editor.fontLayer.fillColor" type="text" class="form-control">\n    </div>\n  </div>\n</div>\n<div class="form-inline column-3">\n  <div class="form-group">\n    <div class="input-group input-group-sm">\n      <span class="input-group-addon">${lang.dialog_editor_gapcolor}</span>\n      <input data-field="editor.axis.gapColor" type="text" class="form-control">\n    </div>\n  </div>\n  <div class="form-group">\n    <div class="input-group input-group-sm">\n      <span class="input-group-addon">${lang.dialog_editor_gap}</span>\n      <input data-field="editor.axis.graduation.gap" type="number" class="form-control">\n    </div>\n  </div>\n</div>\n<div class="form-inline column-3">\n  <div class="form-group">\n    <div class="input-group input-group-sm">\n      <span class="input-group-addon">${lang.dialog_editor_metricscolor}</span>\n      <input data-field="editor.axis.metricsColor" type="text" class="form-control">\n    </div>\n  </div>\n</div>\n<div class="form-inline column-3">\n  <div class="input-group input-group-sm">\n    <span class="input-group-addon">${lang.dialog_savesetting}</span>\n    <span class="form-control"><input data-field="saveSetting" type="checkbox"></span>\n    </div> <a href="#" id="setting-editor-default">${lang.dialog_resetsetting}</a>\n  </div>\n'}),define("fonteditor/dialog/setting-editor",["require","../i18n/i18n","../template/dialog/setting-editor.tpl","common/lang","../widget/program","./setting"],function(require){var e=require("../i18n/i18n"),t=require("../template/dialog/setting-editor.tpl"),n=require("common/lang"),i=require("../widget/program");return require("./setting").derive({title:e.lang.dialog_editor_setting,getTpl:function(){return t},set:function(e){this.setting=n.clone(e),this.setFields(this.setting);var t=this;$("#setting-editor-default").on("click",function(e){e.preventDefault(),t.setting=i.setting.getDefault("editor"),t.setFields(t.setting),t.oldSetting=null})},onDispose:function(){$("#setting-editor-default").off("click")},validate:function(){return this.getFields(n.clone(this.setting))}})}),define("fonteditor/dialog/setting-find-glyf",["require","../i18n/i18n","./setting"],function(require){var e=require("../i18n/i18n"),t=/^(?:\$[A-F0-9]+)(?:\,\$[A-F0-9]+)*$/gi,n='<div id="setting-find-condition"><label class="radio-inline"><input type="radio" name="setting-find-condition" value="unicode" checked="checked">'+e.lang.dialog_find_glyf_by_unicode+'</label><label class="radio-inline"><input type="radio" name="setting-find-condition" value="name">'+e.lang.dialog_find_glyf_by_name+'</label><label class="radio-inline"><input type="radio" name="setting-find-condition" value="index">'+e.lang.dialog_find_glyf_by_index+'</label></div><p class="form-line">'+e.lang.dialog_find_glyf_example+'</p><div><input value="" id="setting-find-value" class="form-control"></div>';return require("./setting").derive({title:e.lang.findglyf,getTpl:function(){return n},set:function(e){$("#setting-find-condition").on("click",'input[type="radio"]',function(){$("#setting-find-value").focus()})},onDispose:function(){$("#setting-find-condition").off("click",'input[type="radio"]')},validate:function(){var n=$("#setting-find-condition").find('input[type="radio"]:checked').val(),i=$("#setting-find-value").val();if(!i.length)return alert(e.lang.dialog_set_unicode),!1;if("unicode"===n)if(i.match(t))i=i.split(",");else i=i.split("").map(function(e){return"$"+e.charCodeAt(0).toString(16)});else if("index"===n)if(i.match(/^\d+(,\d+)*$/))i=i.split(",");else return alert(e.lang.dialog_set_unicode),!1;var r={};return r[n]=i,r}})}),define("fonteditor/template/dialog/setting-ie.tpl",[],function(){return'<div class="form-inline">\n    <div class="form-group">\n        <div class="input-group input-group-sm">\n            <span class="input-group-addon">${lang.dialog_combine_svg_single_glyph}</span>\n            <span class="form-control">\n                <input data-field="import.combinePath" type="checkbox">\n            </span>\n        </div>\n    </div>\n</div>\n\n<div class="form-inline">\n    <div class="form-group">\n        <div class="input-group input-group-sm">\n            <span class="input-group-addon">${lang.dialog_save_with_glyf_name}</span>\n            <span class="form-control">\n                <input data-field="export.saveWithGlyfName" type="checkbox">\n            </span>\n        </div>\n    </div>\n</div>\n\n<div class="form-inline">\n    <div class="input-group input-group-sm">\n        <span class="input-group-addon">${lang.dialog_savesetting}</span>\n        <span class="form-control"><input data-field="saveSetting" type="checkbox"></span>\n    </div>\n    <a href="#" id="setting-ie-default">${lang.dialog_resetsetting}</a>\n</div>\n'}),define("fonteditor/dialog/setting-ie",["require","../i18n/i18n","../template/dialog/setting-ie.tpl","common/lang","../widget/program","./setting"],function(require){var e=require("../i18n/i18n"),t=require("../template/dialog/setting-ie.tpl"),n=require("common/lang"),i=require("../widget/program");return require("./setting").derive({title:e.lang.dialog_import_and_export,getTpl:function(){return t},set:function(e){this.setting=n.clone(e),this.setFields(this.setting);var t=this;$("#setting-ie-default").on("click",function(e){e.preventDefault(),t.setting=i.setting.getDefault("ie"),t.setFields(t.setting),t.oldSetting=null})},onDispose:function(){$("#setting-ie-default").off("click")},validate:function(){return this.getFields(n.clone(this.setting))}})}),define("fonteditor/template/dialog/setting-import-pic.tpl",[],function(){return'<div id="import-pic-dialog">\n    <div class="form-group">\n        <div class="input-group btn-right">\n            <div class="import-pic-url">\n                <div class="input-group input-group-sm">\n                    <span class="input-group-addon">${lang.dialog_picurl}</span>\n                    <input id="import-pic-url-text" value="" class="form-control">\n                </div>\n            </div>\n            <button type="button" data-action="import-url" class="btn btn-flat btn-new btn-sm" title="${lang.dialog_picurl_load_title}">${lang.dialog_picurl_load}</button>&nbsp;\n            <button type="button" data-action="fitwindow" class="btn btn-flat btn-new btn-sm">${lang.dialog_adjustwindow}</button>&nbsp;\n            <button type="button" data-action="fitwindow-left" class="btn btn-flat btn-new btn-sm">${lang.dialog_showorigin}</button>&nbsp;\n            <button type="button" data-action="fitwindow-right" class="btn btn-flat btn-new btn-sm">${lang.dialog_showcontour}</button>\n        </div>\n        <button data-action="openfile" type="button" class="btn btn-flat btn-new btn-sm">${lang.dialog_choosepic}</button>\n        <span>${lang.dialog_choosepic_tip}</span>\n        <form id="import-pic-form" style="width:0px;height:0px;overflow:hidden;"><input id="import-pic-file" type="file"></form>\n    </div>\n    <div class="preview-panel"><div class="canvas-left"><canvas id="import-pic-canvas-origin"></canvas></div><div class="canvas-right"><canvas id="import-pic-canvas-fit"></canvas></div></div>\n    <div class="form-inline">\n        <button type="button" data-filter="restore" class="btn btn-flat btn-sm btn-right">${lang.resume}</button>\n        <span class="form-title">${lang.dialog_preprocess}: </span>\n        <div class="form-group">\n            <div class="input-group input-group-sm">\n                <span class="input-group-addon">${lang.dialog_reverse}</span>\n                <span class="form-control"><input data-filter="reverse" type="checkbox"></span>\n            </div>\n        </div>\n        <div class="form-group">\n            <div class="input-group input-group-sm">\n                <span class="input-group-addon">${lang.dialog_gaussblur}</span>\n                <span class="form-control"><input data-filter="gaussBlur" type="range" min="0" max="20" value="0"\n                step="1"></span>\n            </div>\n        </div>\n        <div class="form-group">\n            <div class="input-group input-group-sm">\n                <span class="input-group-addon">${lang.dialog_contrast}</span>\n                <span class="form-control"><input data-filter="contrast" type="range" min="-50" max="50" value="0" step="1"></span>\n            </div>\n        </div>\n    </div>\n    <div class="form-inline">\n        <button type="button" data-filter="restore-binarize" class="btn btn-flat btn-sm btn-right">${lang.resume}</button>\n        <span class="form-title">${lang.dialog_contour}: </span>\n        <div class="form-group">\n            <div class="input-group input-group-sm">\n                <span class="input-group-addon">${lang.dialog_binarize_threshold}</span>\n                <span class="form-control"><input data-filter="threshold" type="range" min="0" max="255" value="200" step="1"></span>\n            </div>\n            <div class="input-group input-group-sm">\n                <select id="import-pic-threshold-pre" class="form-control">\n                    <option value="">${lang.dialog_threshold_default}</option>\n                    <option value="mean">${lang.dialog_threshold_mean}</option>\n                    <option value="minimum">${lang.dialog_threshold_minimum}</option>\n                    <option value="intermodes">${lang.dialog_threshold_intermodes}</option>\n                    <option value="ostu">${lang.dialog_threshold_ostu}</option>\n                    <option value="isoData">${lang.dialog_threshold_isodata}</option>\n                </select>\n            </div>\n        </div>\n        <div class="form-group">\n            <div class="input-group input-group-sm">\n                <span class="input-group-addon">${lang.dialog_pic_smooth}</span>\n                <span class="form-control"><input data-filter="smooth" type="checkbox" checked="checked"></span>\n            </div>\n        </div>\n        <div class="form-group">\n            <span class="input-group">\n                <button type="button" data-filter="open" class="btn btn-sm btn-flat btn-new">${lang.dialog_pic_open}</button>&nbsp;\n                <button type="button" data-filter="close" class="btn btn-sm btn-flat btn-new">${lang.dialog_pic_close}</button>&nbsp;\n                <button type="button" data-filter="dilate" class="btn btn-sm btn-flat btn-new">${lang.dialog_pic_dilate}</button>&nbsp;\n                <button type="button" data-filter="erode" class="btn btn-sm btn-flat btn-new">${lang.dialog_pic_enrode}</button>\n            </span>\n        </div>\n    </div>\n</div>\n'}),define("common/getPixelRatio",["require"],function(require){return function(e){var t=e.backingStorePixelRatio||e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/t}(HTMLCanvasElement.prototype)}),define("render/util/drawPath",["require"],function(require){function e(e,t){for(var n,i,r,o=0,a=t.length;o<a;o++){if(n=t[o],i=0===o?t[a-1]:t[o-1],r=o===a-1?t[0]:t[o+1],0===o)if(n.onCurve)e.moveTo(n.x,n.y);else if(i.onCurve)e.moveTo(i.x,i.y);else e.moveTo((i.x+n.x)/2,(i.y+n.y)/2);if(n.onCurve&&r.onCurve)e.lineTo(r.x,r.y);else if(!n.onCurve)if(r.onCurve)e.quadraticCurveTo(n.x,n.y,r.x,r.y);else e.quadraticCurveTo(n.x,n.y,(n.x+r.x)/2,(n.y+r.y)/2)}}return e}),define("graphics/image/util/cloneImage",["require"],function(require){return function(e){return{width:e.width,height:e.height,gray:e.gray,binarize:e.binarize,data:e.data.slice(0)}}}),define("graphics/image/filter/gray",["require"],function(require){function e(e,t){for(var n=e.width,i=e.height,r=0,o=e.data,a=[],s=0;s<i;s++){r=s*n;for(var l=0;l<n;l++){var u=4*(l+r),f=255;if(o[u+3]<25)f=255;else{var c=o[u+0],d=o[u+1],h=o[u+2];f=Math.floor(.299*c+.587*d+.114*h)}a[l+r]=t?255-f:f}}return{width:n,height:i,gray:!0,data:a}}return e}),define("graphics/image/filter/binarize",["require"],function(require){function e(e,t){t=t||200;for(var n=e.width,i=e.height,r=e.data,o=0,a=0;o<i;o++){a=o*n;for(var s=0;s<n;s++)r[a+s]=r[a+s]<t?0:255}return e.binarize=!0,e}return e}),define("graphics/image/filter/brightness",["require"],function(require){function e(e,t,n){t=t||0,n=n||0;for(var i=e.data,r=t/50,o=n/50,a=Math.tan((45+44*o)*Math.PI/180),s=0,l=i.length;s<l;s++)i[s]=Math.floor((i[s]-127.5*(1-r))*a+127.5*(1+r));return e}return e}),define("graphics/image/filter/sharp",["require"],function(require){function e(e,t){t=t||.6;for(var n=e.width,i=e.height,r=e.data,o=0,a=1;a<i;a++){o=a*n;for(var s=1;s<n;s++){var l=s+o,u=r[l]-(r[l-1]+r[l-n]+r[l-n-1])/3;r[l]+=Math.floor(u*t)}}return e}return e}),define("graphics/image/util/filteringImage",["require"],function(require){function e(e,t,n,i,r){var o,a,s,l,u,f,c,d;for(a=0;a<n;a++)for(o=0;o<t;o++){for(f=0,u=0,s=-i;s<=i;s++)for(l=-i;l<=i;l++){if((c=o+s)<0||c>=t)c=o-s;if((d=a+l)<0||d>=n)d=a-l;f+=e[c+d*t]*r[u++]}e[o+a*t]=Math.floor(f)}return e}return e}),define("graphics/image/filter/gaussBlur",["require","../util/filteringImage"],function(require){function e(e,t){var n,i,r,o=[],a=0,s=1/(2*Math.PI*t*t),l=-1/(2*t*t);for(r=0,n=-e;n<=e;n++)for(i=-e;i<=e;i++){var u=s*Math.exp(l*(n*n+i*i));o[r++]=u,a+=u}for(r=0,n=-e;n<=e;n++)for(i=-e;i<=e;i++)o[r++]/=a;return o}function t(t,i,r){i=Math.floor((i||3)/2);var o=t.data,a=t.width,s=t.height,l=e(i,r||1.5);return t.data=n(o,a,s,i,l),t}var n=require("../util/filteringImage");return t}),define("graphics/image/filter/blur",["require","../util/filteringImage"],function(require){function e(e){for(var t=[],n=Math.pow(2*e+1,2),i=1/n,r=0;r<n;r++)t[r]=i;return t}function t(t,i){i=Math.floor((i||3)/2);var r=t.data,o=t.width,a=t.height,s=e(i);return t.data=n(r,o,a,i,s),t}var n=require("../util/filteringImage");return t}),define("graphics/image/filter/reverse",["require"],function(require){function e(e){for(var t=e.data,n=0,i=t.length;n<i;n++)t[n]=255-t[n];return e}return e}),define("graphics/image/util/de",["require"],function(require){function e(e,t){var n,i,r=[];if("square"===e)for(n=0;n<2*t+1;n++)for(i=0;i<2*t+1;i++)r.push({x:n-t,y:i-t});else if("circle"===e)for(n=0;n<2*t+1;n++)for(i=0;i<2*t+1;i++){var o=Math.pow(n-t,2)+Math.pow(i-t,2);if(o<=t*t)r.push({x:n-t,y:i-t})}else if("rhomb"===e){for(n=-t;n<=t;n++)for(i=-t;i<=t;i++)if(Math.abs(n)+Math.abs(i)<=t)r.push({x:n,y:i})}else if("cross"===e){for(n=t;n>0;n--)r.push({x:0,y:-n}),r.push({x:-n,y:0}),r.push({x:0,y:n}),r.push({x:n,y:0});r.push({x:0,y:0})}return r}function t(e,t,n,i,r,o,a){for(var s=0,l=o.length;s<l;s++){var u=i+o[s].x,f=r+o[s].y;if(!(u<0||u>=t||f<0||f>=n))e[f*t+u]=a}return!1}function n(e,t,n,i,r,o){var a=r*t;if(i>0&&e[i-1+a]===o||r>0&&e[i+a-t]===o||i<t-1&&e[i+1+a]===o||r<n-1&&e[i+a+t]===o)return!0;else return!1}function i(i,r,o,a){o=o||"cross",a=Math.floor((a||2)/2);var s=255,l=0;if("erode"===r)s=0,l=255;for(var u=i.width,f=i.height,c=i.data,d=e(o,a),h=c.slice(0),p=0,g=0;p<f;p++){g=p*u;for(var m=0;m<u;m++)if(c[g+m]===s&&n(c,u,f,m,p,l))t(h,u,f,m,p,d,l)}return i.data=h,i}return{execute:i}}),define("graphics/image/filter/dilate",["require","../util/de"],function(require){var e=require("../util/de").execute;return function(t,n,i){return e(t,"dilate",n,i)}}),define("graphics/image/filter/erode",["require","../util/de"],function(require){var e=require("../util/de").execute;return function(t,n,i){return e(t,"erode",n,i)}}),define("graphics/image/filter/close",["require","./dilate","./erode"],function(require){var e=require("./dilate"),t=require("./erode");return function(n,i,r){return t(e(n,i,r))}}),define("graphics/image/filter/open",["require","./dilate","./erode"],function(require){var e=require("./dilate"),t=require("./erode");return function(n,i,r){return e(t(n,i,r))}}),define("graphics/image/util/getHistogram",["require"],function(require){function e(e){for(var t=[],n=0,i=256;n<i;n++)t[n]=0;var r=e.data;for(n=0,i=r.length;n<i;n++)t[r[n]]++;return t}return e}),define("graphics/image/util/threshold",["require"],function(require){function e(e){for(var t=0,n=1;n<255;n++)if(e[n-1]<e[n]&&e[n+1]<e[n])if(++t>2)return!1;return 2===t?!0:!1}return{mean:function(e){for(var t=0,n=0,i=0;i<256;i++)n+=e[i],t+=i*e[i];return t/n},minimum:function(t){var n,i=0,r=[],o=[];for(n=0;n<256;n++)r[n]=t[n],o[n]=t[n];for(;!e(o);){for(o[0]=(r[0]+r[0]+r[1])/3,n=1;n<255;n++)o[n]=(r[n-1]+r[n]+r[n+1])/3;if(o[255]=(r[254]+r[255]+r[255])/3,++i>=1e3)return-1;r=o.slice(0)}var a=!1;for(n=1;n<255;n++){if(o[n-1]<o[n]&&o[n+1]<o[n])a=!0;if(a&&o[n-1]>=o[n]&&o[n+1]>=o[n])return 255-(n-1)}return-1},intermodes:function(t){var n,i,r=0,o=[],a=[];for(n=0;n<256;n++)o[n]=t[n],a[n]=t[n];for(;!e(a);){for(a[0]=(o[0]+o[0]+o[1])/3,n=1;n<255;n++)a[n]=(o[n-1]+o[n]+o[n+1])/3;if(a[255]=(o[254]+o[255]+o[255])/3,++r>=1e3)return-1;o=a.slice(0)}var s=[0,0];for(n=1,i=0;n<255;n++)if(a[n-1]<a[n]&&a[n+1]<a[n])s[i++]=n-1;return 255-(s[0]+s[1])/2},ostu:function(e){var t,n,i,r,o,a,s,l,u,f=0,c=0,d=0,h=0,p=0,g=0,m=0;for(l=0;l<256&&0===e[l];l++);for(u=255;u>l&&0===e[l];u--);if(u===l)return u;if(l+1===u)return l;for(t=l;t<=u;t++)f+=e[t];for(g=0,t=l;t<=u;t++)g+=e[t]*t;for(a=-1,t=l;t<u;t++)if(c+=e[t],d=f-c,n=c/f,i=d/f,h+=e[t]*t,p=g-h,r=h/c,o=p/d,(s=n*i*(r-o)*(r-o))>a)a=s,m=t;return m},isoData:function(e){var t,n=0,i=e.length;for(t=1;t<i;t++)if(e[t]>0){n=t+1;break}for(var r,o,a,s;;){for(r=0,a=0,t=0;t<n;t++)a+=e[t],r+=e[t]*t;for(s=0,o=0,t=n+1;t<i;t++)o+=e[t],s+=e[t]*t;if(a>0&&o>0)if(r/=a,s/=o,n===Math.round((r+s)/2))break;if(++n>i-2)return 0}return n}}}),define("graphics/image/util/getThreshold",["require","./threshold"],function(require){function e(e,n){return(t[n]||t.mean)(e)}var t=require("./threshold");return e}),define("graphics/image/ImageProcessor",["require","./util/cloneImage","./filter/gray","./filter/binarize","./filter/brightness","./filter/sharp","./filter/gaussBlur","./filter/blur","./filter/reverse","./filter/close","./filter/open","./filter/dilate","./filter/erode","./util/getHistogram","./util/getThreshold"],function(require){function e(e){e&&this.set(e)}var t=require("./util/cloneImage"),n=require("./filter/gray"),i=require("./filter/binarize"),r=require("./filter/brightness"),o=require("./filter/sharp"),a=require("./filter/gaussBlur"),s=require("./filter/blur"),l=require("./filter/reverse"),u=require("./filter/close"),f=require("./filter/open"),c=require("./filter/dilate"),d=require("./filter/erode"),h=require("./util/getHistogram"),p=require("./util/getThreshold");return e.prototype.set=function(e){if(!e.gray)e=n(e);return this.imageData=e,this.originData=null,this},e.prototype.get=function(){return this.imageData},e.prototype.getOrigin=function(){return this.originData},e.prototype.save=function(){return this.originData=t(this.imageData),this},e.prototype.clone=function(){return new e(t(this.imageData))},e.prototype.restore=function(){if(this.originData)this.imageData=t(this.originData);return this},e.prototype.getHistogram=function(){return h(this.imageData)},e.prototype.getThreshold=function(e){return p(this.getHistogram(),e)},e.prototype.binarize=function(e){return this.imageData=i(this.imageData,e),this},e.prototype.brightness=function(e,t){return this.imageData=r(this.imageData,e,t),this},e.prototype.reverse=function(){return this.imageData=l(this.imageData),this},e.prototype.close=function(e,t){if(!this.imageData.binarize)this.binarize();return this.imageData=u(this.imageData,e,t),this},e.prototype.open=function(e,t){if(!this.imageData.binarize)this.binarize();return this.imageData=f(this.imageData,e,t),this},e.prototype.dilate=function(e,t){if(!this.imageData.binarize)this.binarize();return this.imageData=c(this.imageData,e,t),this},e.prototype.erode=function(e,t){if(!this.imageData.binarize)this.binarize();return this.imageData=d(this.imageData,e,t),this},e.prototype.gaussBlur=function(e,t){return this.imageData=a(this.imageData,e,t),this},e.prototype.blur=function(e){return this.imageData=s(this.imageData,e),this},e.prototype.sharp=function(e){return this.imageData=o(this.imageData,e),this},e.prototype.brightness=function(e,t){return this.imageData=r(this.imageData,e,t),this},e.prototype.dispose=function(){this.imageData=this.originData=null},e}),define("graphics/image/contour/smooth",["require"],function(require){function e(e,t){t=Math.floor((t||2)/2);for(var n=2*t+1,i=0,r=e.length;i<r;i++){for(var o,a=e[i],s=a.x,l=a.y,u=0;u<t;u++)o=(i+r-u)%r,s+=e[o].x,l+=e[o].y,o=(i+r+u)%r,s+=e[o].x,l+=e[o].y;a.x=Math.floor(s/n),a.y=Math.floor(l/n)}return e}return e}),define("graphics/image/contour/findContours",["require","./smooth"],function(require){function e(e){for(var t=[],n=0,i=e.length;n<i;n++){var r=e[n],o=e[n===i-1?0:n+1];if(t.push(r),Math.abs(r.x-o.x)>1){var a,s;if(r.x<o.x)for(a=r.x+1,s=o.x;a<s;a++)t.push({x:a,y:r.y});else for(a=r.x-1,s=o.x;a>s;a--)t.push({x:a,y:r.y})}}return t}function t(t,a,s){a=a||10,s=s||3;var l,u,f,c,d,h,p,g,m,y,v,x,w,b,C=0,S=255,_=t.data,M=t.width,E=t.height,k=[],P=[];for(p=[],b={},u=0;u<E;u++)d=u*M,_[d]=S,_[d+M-1]=S;for(d=(E-1)*M,u=0;u<M;u++)_[u]=S,_[d+u]=S;for(u=0;u<M;){for(;u<M&&_[u]===S;u++);if(u===M)break;for(b.next={x:u,y:0},p.push(b=b.next);u<M&&_[u]===C;u++);b.next=b.link={x:u-1,y:0},p.push(b=b.next)}for(l=1;l<E;l++){for(d=l*M,y=[],u=0;u<M;){for(;u<M&&_[d+u]===S;u++);if(u===M)break;for(b.next={x:u,y:l},y.push(b=b.next);u<M&&_[d+u]===C;u++);b.next=b.link={x:u-1,y:l},y.push(b=b.next)}for(g=Math.floor(p.length/2),v=Math.floor(y.length/2),m=p[0],x=y[0],h=i,f=0,c=0;f<g&&c<v;)switch(h){case i:if(m.next.x<x.next.x){if(m.next.x>=x.x-1)x.link=m,h=r,w=m.next;else m.next.link=m;f++,m=m.next.next}else{if(m.x<=x.next.x+1)x.link=m,h=o,w=x.next;else x.link=x.next,k.push(x);c++,x=x.next.next}break;case r:if(m.x>x.next.x+1)w.link=x.next,h=i,c++,x=x.next.next;else if(w.link=m,m.next.x<x.next.x)f++,w=m.next,m=m.next.next;else h=o,w=x.next,c++,x=x.next.next;break;case o:if(x.x>m.next.x+1)m.next.link=w,h=i,f++,m=m.next.next;else if(P.push(x),x.link=w,x.next.x<m.next.x)c++,w=x.next,x=x.next.next;else h=r,f++,w=m.next,m=m.next.next}for(;c<v;c++)if(h===i)x.link=x.next,k.push(x),x=x.next.next;else w.link=x.next,h=i,x=x.next.next;for(;f<g;f++)if(h===i)m.next.link=m,m=m.next.next;else m.next.link=w,h=i,m=m.next.next;p=y}for(g=Math.floor(p.length/2),m=p[0],f=0;f<g;f++)m.next.link=m,m=m.next.next;var L,B,U,q,A=[],I=0;for(f=0;f<2;f++)for(q=0===f?k:P,u=0,c=q.length;u<c;u++,I++)if(B=L=q[u],L.link){U=[];do{U.push({x:L.x,y:L.y});var T=L;L=L.link,T.link=0}while(L&&L!==B);if(!(U.length<4))if(U=e(U),U.length>=a){if(s>1&&U.length>=2*s)U=n(U,s);U.flag=0===f?0:1,A.push(U)}}return A}var n=require("./smooth"),i=1,r=2,o=3;return t}),define("fonteditor-core/graphics/util",["require"],function(require){function e(e){var t=e.x;if(Math.abs(Math.round(t)-t)<2e-5)e.x=Math.round(t);else e.x=Math.round(1e5*e.x)/1e5;if(t=e.y,Math.abs(Math.round(t)-t)<5e-5)e.y=Math.round(t);else e.y=Math.round(1e5*e.y)/1e5;return e}function t(e){if(Math.abs(Math.round(e)-e)<2e-5)return Math.round(e);else return Math.round(1e5*e)/1e5}function n(e,n,i){if(i)return t(n.x)<=t(e.x+e.width)&&t(n.x)>=t(e.x)&&t(n.y)<=t(e.y+e.height)&&t(n.y)>=t(e.y);else return n.x<=e.x+e.width&&n.x>=e.x&&n.y<=e.y+e.height&&n.y>=e.y}function i(e,n){return t(e.x)===t(n.x)&&t(e.y)===t(n.y)}function r(e){return Math.floor(7*Math.floor(10*e.x)+131*Math.floor(100*e.y))}return{ceil:t,ceilPoint:e,isPointInBound:n,isPointOverlap:i,getPointHash:r}}),define("fonteditor-core/graphics/pathUtil",["require","./util"],function(require){function e(e){for(var t=[],n=0,i=e.length;n<i;n++){var r=n===i-1?0:n+1;if(t.push(e[n]),!e[n].onCurve&&!e[r].onCurve)t.push({x:(e[n].x+e[r].x)/2,y:(e[n].y+e[r].y)/2,onCurve:!0})}return t}function t(e){for(var t=[],n=0,i=e.length;n<i;n++){var r=n===i-1?0:n+1,o=0===n?i-1:n-1;if(!(!e[o].onCurve&&e[n].onCurve&&!e[r].onCurve&&Math.abs(2*e[n].x-e[o].x-e[r].x)<.001&&Math.abs(2*e[n].y-e[o].y-e[r].y)<.001))t.push(e[n])}return t}function n(e){if(e.length<3)return 0;for(var t=0,n=0,i=e.length;n<i;n++){var r=e[n],o=0===n?e[i-1]:e[n-1],a=n===i-1?e[0]:e[n+1],s=(r.x-o.x)*(a.y-r.y)-(r.y-o.y)*(a.x-r.x);if(s<0)t--;else if(s>0)t++}return 0===t?0:t<0?1:-1}function i(e){var t=0;return e.forEach(function(e){t=2147483647&131*t+l(e)+(e.onCurve?1:0)}),t}function r(e){for(var t={},n=[],i=0,r=e.length;i<r;i++){var o=31*e[i].x+e[i].y;if(!t[o])n.push(e[i]),t[o]=1}return n}function o(e){for(var t=0,n=e.length;t<n;t++){var i=e[t],r=0===t?e[n-1]:e[t-1],o=t===n-1?e[0]:e[t+1];i.index=t,i.next=o,i.prev=r}return e}function a(e,t){for(var n=0,i=e.length;n<i;n++){var r=e[n];r.x*=t,r.y*=t}return e}function s(e){return e?e.map(function(e){var t={x:e.x,y:e.y};if(e.onCurve)t.onCurve=!0;return t}):e}var l=require("./util").getPointHash;return{interpolate:e,deInterpolate:t,isClockWise:n,removeOverlapPoints:r,getPathHash:i,makeLink:o,scale:a,clone:s}}),define("graphics/pathUtil",["require","fonteditor-core/graphics/pathUtil"],function(require){return require("fonteditor-core/graphics/pathUtil")}),define("graphics/vector",["require"],function(require){function e(e,t,n,i){var r,o,a,s;if("number"==typeof e)r=e,o=t,a=n,s=i;else r=t.x-e.x,o=t.y-e.y,a=n.x-t.x,s=n.y-t.y;return(r*a+o*s)/Math.sqrt(r*r+o*o)/Math.sqrt(a*a+s*s)}function t(e,t,n){var i=t.y-e.y,r=e.x-t.x;if(0===i&&0===r)return Math.pow(n.x-e.x,2)+Math.pow(n.y-e.y,2);if(0===i)return Math.pow(n.y-e.y,2);if(0===r)return Math.pow(n.x-e.x,2);var o=t.x*e.y-e.x*t.y;return Math.pow(i*n.x+r*n.y+o,2)/(i*i+r*r)}function n(e,n,i){return Math.sqrt(t(e,n,i))}function i(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function r(e){var t=1/Math.sqrt(e.x*e.x+e.y*e.y);return e.x=e.x*t,e.y=e.y*t,e}return{getCos:e,getDist:n,getDistPow:t,normalize:r,dist:i}}),define("graphics/image/contour/findBreakPoints",["require","graphics/pathUtil","graphics/vector"],function(require){function e(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function t(t,i){t=n(t);var f=a*i,c=s*i,d=l*i,h=u*i,p=t[0],g=p;do{if(g.ndist=g.next.pdist=e(g,g.next),Math.abs(g.x-g.next.x)<=h&&Math.abs(g.y-g.next.y)<=h)g.ntiny=!0,g.next.ptiny=!0;var m=r(g.ptiny?g.prev.prev:g.prev,g,g.ntiny?g.next.next:g.next);if(g.theta=Math.acos(m>1?1:m),Math.abs(g.next.x-g.x)<i&&Math.abs(g.next.y-g.y)>=d)g.next.vertical=!0,g.vertical=!0;else if(Math.abs(g.next.y-g.y)<i&&Math.abs(g.next.x-g.x)>=d)g.next.hoz=!0,g.hoz=!0;if(g.x<=g.prev.x&&g.x<=g.next.x)g.xTop=!0,g.apex=!0;if(g.y<=g.prev.y&&g.y<=g.next.y)g.yTop=!0,g.apex=!0;if(g.x>=g.prev.x&&g.x>=g.next.x)g.xBottom=!0,g.apex=!0;if(g.y>=g.prev.y&&g.y>=g.next.y)g.yBottom=!0,g.apex=!0;g=g.next}while(g!==p);g=p;do{if(g.theta>o)g.corner=!0,g.visited=!0,g.breakPoint=!0;if(!g.visited&&g.theta>.3&&(g.ndist>f&&g.pdist>f||g.pdist>f&&g.ndist>f))g.corner=!0,g.visited=!0,g.breakPoint=!0;if(!g.visited&&g.apex&&g.theta>.5&&(g.ndist>c||g.pdist>c))g.corner=!0,g.visited=!0,g.breakPoint=!0;if(!g.visited&&g.theta>.5&&(g.ndist>c||g.pdist>c))g.corner=!0,g.visited=!0,g.breakPoint=!0;g=g.next}while(g!==p);if(!t.some(function(e){return e.corner}))return!1;g=p;do{if(!g.visited){if(!g.visited&&!g.breakpoint&&g.theta<.5&&g.theta>.2&&(g.pdist>c&&g.ndist<c||g.ndist>c&&g.pdist<c))g.visited=!0,g.breakPoint=!0;g=g.next}else g=g.next}while(g!==p);g=p;do{if(g.corner&&g.hoz&&g.vertical)g.x=Math.abs(g.prev.x-g.x)<=i?g.prev.x:g.next.x,g.y=Math.abs(g.prev.y-g.y)<=i?g.prev.y:g.next.y;else if(g.corner&&g.pdist<d&&g.ndist<d)g.tangency=!0;else if(g.apex&&g.next.apex&&g.prev.theta<.4&&g.next.theta<.4&&g.pdist>d&&g.ndist>d){var y;if(g.xTop&&g.next.xTop||g.xBottom&&g.next.xBottom)y=Math.max(Math.floor(Math.abs(g.next.y-g.y)/4),4*i),g.y=g.y>g.next.y?g.y-y:g.y+y,g.next.y=g.next.y>g.y?g.next.y-y:g.next.y+y;if(g.yTop&&g.next.yTop||g.yBottom&&g.next.yBottom)y=Math.max(Math.floor(Math.abs(g.next.x-g.x)/4),4*i),g.x=g.x>g.next.x?g.x-y:g.x+y,g.next.x=g.next.x>g.x?g.next.x-y:g.next.x+y}g=g.next}while(g!==p);var v=t.filter(function(e){return e.breakPoint});return v.sort(function(e,t){return e.index-t.index}),v}var n=require("graphics/pathUtil").makeLink,i=require("graphics/vector"),r=i.getCos,o=1,a=80,s=30,l=12,u=3;return t}),define("fonteditor-core/graphics/pathIterator",["require"],function(require){function e(e,t){for(var n,i,r,o,a=0,s=e.length;a<s;a++){if(n=e[a],i=0===a?e[s-1]:e[a-1],r=a===s-1?e[0]:e[a+1],0===a)if(n.onCurve)o=n;else if(i.onCurve)o=i;else o={x:(i.x+n.x)/2,y:(i.y+n.y)/2};if(n.onCurve&&r.onCurve){if(!1===t("L",n,r,0,a))break;o=r}else if(!n.onCurve)if(r.onCurve){if(!1===t("Q",o,n,r,a))break;o=r}else{var l={x:(n.x+r.x)/2,y:(n.y+r.y)/2};if(!1===t("Q",o,n,l,a))break;o=l}}}return e}),define("fonteditor-core/graphics/computeBoundingBox",["require","./pathIterator"],function(require){function e(e){if(0===e.length)return!1;for(var t=e[0].x,n=e[0].x,i=e[0].y,r=e[0].y,o=1;o<e.length;o++){var a=e[o];if(a.x<t)t=a.x;if(a.x>n)n=a.x;if(a.y<i)i=a.y;if(a.y>r)r=a.y}return{x:t,y:i,width:n-t,height:r-i}}function t(t,n,i){var r,o=t.x+i.x-2*n.x;if(0===o)r=.5;else r=(t.x-n.x)/o;o=t.y+i.y-2*n.y;var a;if(0===o)a=.5;else a=(t.y-n.y)/o;r=Math.max(Math.min(r,1),0),a=Math.max(Math.min(a,1),0);var s=1-r,l=1-a;return e([t,i,{x:s*s*t.x+2*s*r*n.x+r*r*i.x,y:s*s*t.y+2*s*r*n.y+r*r*i.y},{x:l*l*t.x+2*l*a*n.x+a*a*i.x,y:l*l*t.y+2*l*a*n.y+a*a*i.y}])}function n(n){var i=[],o=function(e,n,r,o){if("L"===e)i.push(n),i.push(r);else if("Q"===e){var a=t(n,r,o);i.push(a),i.push({x:a.x+a.width,y:a.y+a.height})}};if(1===arguments.length)r(n,function(e,n,r,o){if("L"===e)i.push(n),i.push(r);else if("Q"===e){var a=t(n,r,o);i.push(a),i.push({x:a.x+a.width,y:a.y+a.height})}});else for(var a=0,s=arguments.length;a<s;a++)r(arguments[a],o);return e(i)}function i(t){var n=[];if(1===arguments.length)n=t;else for(var i=0,r=arguments.length;i<r;i++)Array.prototype.splice.apply(n,[n.length,0].concat(arguments[i]));return e(n)}var r=require("./pathIterator");return{computeBounding:e,quadraticBezier:t,computePath:n,computePathBox:i}}),define("graphics/computeBoundingBox",["require","fonteditor-core/graphics/computeBoundingBox"],function(require){return require("fonteditor-core/graphics/computeBoundingBox")}),define("graphics/image/contour/douglasPeuckerReducePoints",["require","graphics/vector"],function(require){function e(t,i,r,o,a){if(!(r-i<3)){for(var s=t[i],l=t[r],u=-1,f=0,c=i+1;c<r;c++){var d=n(s,l,t[c]);if(d>f)f=d,u=c}if(f>o)a.push(u),e(t,i,u,o,a),e(t,u,r,o,a)}}function t(t,n,r,o,a){n=n||0,r=r||t.length-1,a=a||i*(o||1);var s=[];if(e(t,n,r,a,s),s.length)return s.unshift(n),s=s.map(function(e){return t[e].contourIndex=e,t[e]}),s.sort(function(e,t){return e.contourIndex-t.contourIndex}),s;else return t}var n=require("graphics/vector").getDist,i=1;return t}),define("graphics/image/contour/reducePoints",["require","graphics/image/contour/douglasPeuckerReducePoints","graphics/pathUtil","graphics/vector"],function(require){function e(e,i,o,a,s){var l=t(e,i,o,a,s);l=n(l);var u=l[0],f=3*a,c=Math.PI/2,d=u;do{if(!d.visited){if(Math.abs(d.x-d.next.x)<=f&&Math.abs(d.y-d.next.y)<=f){var h=r(d.x-d.prev.x,d.y-d.prev.y,d.next.next.x-d.next.x,d.next.next.y-d.next.y),p=Math.acos(h>1?1:h);if(p<c)if(d.x>=d.prev.x&&d.x>=d.next.x||d.x<=d.prev.x&&d.x<=d.next.x||d.y>=d.prev.y&&d.y>=d.next.y||d.y<=d.prev.y&&d.y<=d.next.y)d.next.deleted=!0;else d.deleted=!0;d.visited=d.next.visited=!0}d=d.next}else d=d.next}while(d!==u);return l.filter(function(e){return delete e.visited,!e.deleted})}var t=require("graphics/image/contour/douglasPeuckerReducePoints"),n=require("graphics/pathUtil").makeLink,i=require("graphics/vector"),r=i.getCos;return e}),define("graphics/image/contour/fitCurve",["require"],function(require){function e(e){var t=1/Math.sqrt(e.x*e.x+e.y*e.y);return e.x=e.x*t,e.y=e.y*t,e}function t(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function n(t,n){return e({x:t[n+1].x-t[n].x,y:t[n+1].y-t[n].y})}function i(t,n){return e({x:t[n-1].x-t[n].x,y:t[n-1].y-t[n].y})}function r(t,n){return e({x:(t[n-1].x-t[n+1].x)/2,y:(t[n-1].y-t[n+1].y)/2})}function o(e){var t=1-e;return t*t*t}function a(e){var t=1-e;return 3*e*(t*t)}function s(e){return 3*e*e*(1-e)}function l(e){return e*e*e}function u(e,t){return e.x*t.x+e.y*t.y}function f(e,n,i){var r,o=[0];for(r=n+1;r<=i;r++)o[r-n]=o[r-n-1]+t(e[r-1],e[r]);var a=o[i-n];for(r=n+1;r<=i;r++)o[r-n]=o[r-n]/a;return o}function c(e,t,n){var i,r,o=[];for(i=0;i<=e;i++)o[i]={x:t[i].x,y:t[i].y};for(i=1;i<=e;i++)for(r=0;r<=e-i;r++)o[r].x=(1-n)*o[r].x+n*o[r+1].x,o[r].y=(1-n)*o[r].y+n*o[r+1].y;return o[0]}function d(e,t,n,i,r){for(var o=0,a=Math.floor((n-t+1)/2),s=t+1;s<n;s++){var l=c(3,i,r[s-t]),u=l.x-e[s].x,f=l.y-e[s].y,d=u*u+f*f;if(d>=o)o=d,a=s}return{dist:o,index:a}}function h(e,t,n){var i,r,o,a,s,l,u=[],f=[];for(o=c(3,e,n),l=0;l<=2;l++)u[l]={x:3*(e[l+1].x-e[l].x),y:3*(e[l+1].y-e[l].y)};for(l=0;l<=1;l++)f[l]={x:6*(e[l+1].x-e[l].x),y:6*(e[l+1].y-e[l].y)};if(a=c(2,u,n),s=c(1,f,n),i=(o.x-t.x)*a.x+(o.y-t.y)*a.y,0===(r=a.x*a.x+a.y*a.y+(o.x-t.x)*s.x+(o.y-t.y)*s.y))return n;else return n-i/r}function p(e,t,n,i,r){for(var o=[],a=t;a<=n;a++)o[a-t]=h(r,e[a],i[a-t]);return o}function g(e,t,n,i,r,f){var c,d,h,p=[],g=[[0,0],[0,0]],m=[0,0],y=n-t+1;for(h=0;h<y;h++){var v={x:r.x,y:r.y},x={x:f.x,y:f.y};d=i[h],v.x*=a(d),v.y*=a(d),x.x*=s(d),x.y*=s(d),p[h]=[v,x]}var w=e[t],b=e[n];for(h=0;h<y;h++){g[0][0]+=u(p[h][0],p[h][0]),g[0][1]+=u(p[h][0],p[h][1]),g[1][0]=g[0][1],g[1][1]+=u(p[h][1],p[h][1]);var C=e[t+h];d=i[h],c={x:C.x-(w.x*o(d)+w.x*a(d)+b.x*s(d)+b.x*l(d)),y:C.y-(w.y*o(d)+w.y*a(d)+b.y*s(d)+b.y*l(d))},m[0]+=u(p[h][0],c),m[1]+=u(p[h][1],c)}var S=g[0][0]*g[1][1]-g[1][0]*g[0][1],_=g[0][0]*m[1]-g[1][0]*m[0],M=m[0]*g[1][1]-m[1]*g[0][1],E=0===S?0:M/S,k=0===S?0:_/S,P=Math.sqrt(Math.pow(w.x-b.x,2)+Math.pow(w.y-b.y,2)),L=1e-6*P,B=[];if(B[0]=w,B[3]=b,E<L||k<L){var U=P/3;return B[1]={x:r.x*U+w.x,y:r.y*U+w.y},B[2]={x:f.x*U+b.x,y:f.y*U+b.y},B}return B[1]={x:r.x*E+w.x,y:r.y*E+w.y},B[2]={x:f.x*k+b.x,y:f.y*k+b.y},B}function m(e,t,n,i,o,a,s){var l,u=[];if(2===n-t+1){var c=e[t],h=e[n],y=Math.sqrt(Math.pow(c.x-h.x,2)+Math.pow(c.y-h.y,2))/3;return u[0]=c,u[3]=h,u[1]={x:i.x*y+c.x,y:i.y*y+c.y},u[2]={x:o.x*y+h.x,y:o.y*y+h.y},s.push(u[1]),s.push(u[2]),void s.push(u[3])}var x,w=f(e,t,n);u=g(e,t,n,w,i,o);var b=d(e,t,n,u,w);if(b.dist<a)return s.push(u[1]),s.push(u[2]),void s.push(u[3]);if(b.dist<a*a)for(l=0;l<v;l++){if(x=p(e,t,n,w,u),u=g(e,t,n,x,i,o),b=d(e,t,n,u,x),b.dist<a)return s.push(u[1]),s.push(u[2]),void s.push(u[3]);w=x}var C=b.index,S=r(e,C);m(e,t,C,i,S,a,s),S.x=-S.x,S.y=-S.y,m(e,C,n,S,o,a,s)}function y(e,t,r,o){var a=e.length-1;if(!r)r=n(e,0);if(!o)o=i(e,a);var s=[];return m(e,0,a,r,o,t,s),s}var v=4;return y.normalize=e,y}),define("fonteditor-core/math/bezierCubic2Q2",["require"],function(require){function e(e,t,n,i){return[e,{x:(3*n.x-i.x+3*t.x-e.x)/4,y:(3*n.y-i.y+3*t.y-e.y)/4},i]}function t(t,n,i,r){if(t.x===n.x&&t.y===n.y&&i.x===r.x&&i.y===r.y)return[[t,{x:(t.x+r.x)/2,y:(t.y+r.y)/2},r]];var o=r.x-3*i.x+3*n.x-t.x,a=r.y-3*i.y+3*n.y-t.y;if(o*o+a*a<=4)return[e(t,n,i,r)];var s={x:(r.x+3*i.x+3*n.x+t.x)/8,y:(r.y+3*i.y+3*n.y+t.y)/8};return[e(t,{x:(t.x+n.x)/2,y:(t.y+n.y)/2},{x:(t.x+2*n.x+i.x)/4,y:(t.y+2*n.y+i.y)/4},s),e(s,{x:(r.x+n.x+2*i.x)/4,y:(r.y+n.y+2*i.y)/4},{x:(r.x+i.x)/2,y:(r.y+i.y)/2},r)]}return t}),define("math/bezierCubic2Q2",["require","fonteditor-core/math/bezierCubic2Q2"],function(require){return require("fonteditor-core/math/bezierCubic2Q2")}),define("graphics/image/contour/fitBezier",["require","./fitCurve","math/bezierCubic2Q2","graphics/vector"],function(require){function e(e,i,o,a){i=i||1;for(var s=2*i*i,l=t(e,s,o,a),u=e[0],f=[],c=0,d=l.length;c<d;c+=3){var h=r(u,l[c],l[c+1]);if(Math.acos(h>1?1:h)>3){if(!c)u.onCurve=!0,f.push(u)}else{var p=n(u,l[c],l[c+1],l[c+2]);if(1===p.length)p[0][2].onCurve=!0,f.push(p[0][1]),f.push(p[0][2]);else p[0][2].onCurve=!0,f.push(p[0][1]),f.push(p[0][2]),p[1][2].onCurve=!0,f.push(p[1][1]),f.push(p[1][2])}u=l[c+2]}return f.map(function(e){return{x:e.x,y:e.y,onCurve:!!e.onCurve}})}var t=require("./fitCurve"),n=require("math/bezierCubic2Q2"),i=require("graphics/vector"),r=i.getCos;return e}),define("fonteditor-core/graphics/pathAdjust",["require"],function(require){function e(e,t,n,i,r){t=void 0===t?1:t,n=void 0===n?1:n;for(var o,a=i||0,s=r||0,l=0,u=e.length;l<u;l++)o=e[l],o.x=t*(o.x+a),o.y=n*(o.y+s);return e}return e}),define("graphics/pathAdjust",["require","fonteditor-core/graphics/pathAdjust"],function(require){return require("fonteditor-core/graphics/pathAdjust")}),define("fonteditor-core/graphics/path/circle",["require"],function(require){return[{x:582,y:0},{x:758,y:75},{x:890,y:208},{x:965,y:384},{x:965,y:583},{x:890,y:760},{x:758,y:891},{x:582,y:966},{x:383,y:966},{x:207,y:891},{x:75,y:760},{x:0,y:583},{x:0,y:384},{x:75,y:208},{x:207,y:75},{x:383,y:0}]}),define("graphics/path/circle",["require","fonteditor-core/graphics/path/circle"],function(require){return require("fonteditor-core/graphics/path/circle")}),define("graphics/image/contour/fitOval",["require","graphics/pathUtil","graphics/computeBoundingBox","graphics/pathAdjust","graphics/path/circle","common/lang"],function(require){function e(e){var a=n.computeBounding(e),s=n.computePath(r),l=a.width/s.width,u=a.height/s.height,f=o.clone(r);return i(f,l,u),i(f,1,1,a.x-s.x,a.y-s.y),-1===t.isClockWise(e)?f:f.reverse()}var t=require("graphics/pathUtil"),n=require("graphics/computeBoundingBox"),i=require("graphics/pathAdjust"),r=require("graphics/path/circle"),o=require("common/lang");return e}),define("graphics/image/contour/fitContour",["require","graphics/computeBoundingBox","graphics/image/contour/reducePoints","graphics/vector","./findBreakPoints","./fitBezier","./fitOval"],function(require){function e(e){return!isNaN(e.x)&&!isNaN(e.y)}function t(e,t){for(var n=[],i=t,r=0,o=e.length;r<o;r++){var a=e[r],s=e[r===o-1?0:r+1],l=e[0===r?o-1:r-1];if(!(a.onCurve&&Math.abs(a.x-s.x)<i&&Math.abs(a.y-s.y)<i))if(!(!l.onCurve&&a.onCurve&&!s.onCurve&&Math.abs(2*a.x-l.x-s.x)<i&&Math.abs(2*a.y-l.y-s.y)<i))n.push(a)}return n}function n(e){var t=e[0],n=t,i=r.computeBounding(e);if(Math.abs(i.width-i.height)/i.width>.1)return!1;do{if(Math.abs(n.theta-n.next.theta)>.15)return!1;n=n.next}while(n!==t);return!0}function i(i,r,f){f=f||{},r=r||1;var c=o(i,0,i.length-1,r);if(f.segment)return c.map(function(e){return{x:e.x,y:e.y,onCurve:!0}});var d=s(c,r),h=[];if(!1===d){if(n(c))return u(c);c.forEach(function(e){h.push({x:e.x,y:e.y})})}else for(var p,g,m,y,v,x,w,b=0,C=d.length;b<C;b++)if(p=b===C-1,g=d[b],m=d[p?0:b+1],1===g.right)h.push({x:g.x,y:g.y,onCurve:!0});else{if(h.push({x:g.x,y:g.y,onCurve:g.tangency?!1:!0}),p)y=c.slice(g.index).concat(c.slice(0,m.index+1));else y=c.slice(g.index,m.index+1);if(y.length<=2)continue;if(v=l(y,r),v.length&&v.every(e))for(x=0,w=v.length-1;x<w;x++)h.push({x:v[x].x,y:v[x].y,onCurve:v[x].onCurve});else for(x=1,w=y.length-1;x<w;x++)h.push({x:y[x].x,y:y[x].y})}if(h.length<=2)return[];else if(h.length<=4&&a.getDist(h[0],h[1],h[2])<r)return[];return t(h.map(function(e){return e.x=Math.round(e.x),e.y=Math.round(e.y),e}),r)}var r=require("graphics/computeBoundingBox"),o=require("graphics/image/contour/reducePoints"),a=require("graphics/vector"),s=require("./findBreakPoints"),l=require("./fitBezier"),u=require("./fitOval");return i}),define("graphics/image/ContourPointsProcessor",["require","./contour/findContours","./contour/findBreakPoints","./contour/fitContour","graphics/pathUtil","graphics/image/contour/douglasPeuckerReducePoints"],function(require){function e(e,t){t=t||{},this.scale=t.scale||2,this.segment=t.segment||!1,e&&this.set(e)}var t=require("./contour/findContours"),n=require("./contour/findBreakPoints"),i=require("./contour/fitContour"),r=require("graphics/pathUtil"),o=require("graphics/image/contour/douglasPeuckerReducePoints");return e.prototype.import=function(e){var n=t(e);this.set(n)},e.prototype.set=function(e){e=e||[];var t=this.scale;e.forEach(function(e){r.scale(e,t)}),this.contourPoints=e},e.prototype.get=function(){var e=1/this.scale;return this.contourPoints.map(function(t){return r.scale(r.clone(t),e)})},e.prototype.getBreakPoints=function(e){var t=this.scale,i=[];return(e>=0?[this.contourPoints[e]]:this.contourPoints).forEach(function(e){var a=o(e,0,e.length-1,t);i=i.concat(n(r.clone(a),t))}),r.scale(i,1/this.scale)},e.prototype.getContours=function(){var e=this.scale,t=this.segment;return this.contourPoints.map(function(n){return i(r.clone(n),e,{segment:t})}).filter(function(e){return e&&e.length>2}).map(function(t){return r.scale(t,1/e)})},e.prototype.dispose=function(){this.contourPoints=null},e}),define("fonteditor-core/graphics/pathRotate",["require"],function(require){function e(e,t,n,i){t=void 0===t?0:t;for(var r,o,a,s=n||0,l=i||0,u=Math.cos(t),f=Math.sin(t),c=0,d=e.length;c<d;c++)a=e[c],r=u*(a.x-s)-f*(a.y-l),o=u*(a.y-l)+f*(a.x-s),a.x=r+s,a.y=o+l;return e}return e}),define("fonteditor-core/graphics/pathsUtil",["require","./computeBoundingBox","./pathAdjust","./pathRotate"],function(require){function e(e,t){if(!t)return e;var n=i.computePath.apply(null,e),r=n.x+n.width/2,a=n.y+n.height/2;return e.forEach(function(e){o(e,t,r,a)}),e}function t(e,t,n){var o=i.computePath.apply(null,e),a=o.x,s=o.y,l=o.width,u=o.height;if(-1===t)e.forEach(function(e){r(e,-1,1,-a,0),r(e,1,1,a+l,0),e.reverse()});if(-1===n)e.forEach(function(e){r(e,1,-1,0,-s),r(e,1,1,0,s+u),e.reverse()});return e}function n(e,t,n){var o=i.computePath.apply(null,e);return e.forEach(function(e){r(e,1,1,t-o.x,n-o.y)}),e}var i=require("./computeBoundingBox"),r=require("./pathAdjust"),o=require("./pathRotate");return{rotate:e,mirror:function(e){return t(e,-1,1)},flip:function(e){return t(e,1,-1)},move:n}}),define("graphics/pathsUtil",["require","fonteditor-core/graphics/pathsUtil"],function(require){return require("fonteditor-core/graphics/pathsUtil")}),define("fonteditor/dialog/setting-import-pic",["require","../i18n/i18n","../template/dialog/setting-import-pic.tpl","common/string","common/getPixelRatio","common/lang","../widget/program","render/util/drawPath","graphics/image/ImageProcessor","graphics/image/ContourPointsProcessor","graphics/image/util/getHistogram","graphics/image/util/getThreshold","graphics/pathsUtil","./setting"],function(require){function e(e){return $("#import-pic-dialog").find('[data-filter="'+e+'"]')}function t(t){var i=$("#import-pic-canvas-origin").get(0);i.style.visiblity="hidden";var a=t.width,s=t.height;if(i.width=a,i.height=s,1!==c)i.style.width=a/c+"px",i.style.height=s/c+"px";i.ctx.drawImage(t,0,0,a,s);var l=i.ctx.getImageData(0,0,a,s),u=h.data.imageProcessor;u.set(l),u.grayData=u.clone(),u.resultContours=null;var f=y(u.get());e("threshold").val(v(f,"ostu")),$("#import-pic-threshold-pre").val("ostu"),r(),o(),n()}function n(){var e=h.data.imageProcessor.get(),t=$("#import-pic-canvas-origin").get(0);t.style.visiblity="hidden";var n=e.width,r=e.height;if(!e.binarize)o(),e=h.data.imageProcessor.get();for(var a,s=t.ctx.getImageData(0,0,n,r),l=s.data,u=e.data,f=0;f<r;f++){a=n*f;for(var c=0;c<n;c++){var d=a+c;if(0===u[d])l[4*d]=208,l[4*d+1]=247,l[4*d+2]=113,l[4*d+3]=255;else l[4*d]=255,l[4*d+1]=255,l[4*d+2]=255,l[4*d+3]=255}}h.data.pointsProcessor.import(e),h.data.pointsProcessor.get().forEach(function(e){e.forEach(function(e){var t=e.y*n+e.x;l[4*t]=255,l[4*t+1]=0,l[4*t+2]=0,l[4*t+3]=255})}),t.ctx.putImageData(s,0,0),t.style.visiblity="visible",h.loading.hide(),setTimeout(function(){i()},20)}function i(){var e=h.data.imageProcessor.get(),t=e.width,n=e.height,i=$("#import-pic-canvas-fit").get(0);if(i.ctx.clearRect(0,0,t,n),i.width=c*t,i.height=c*n,1!==c)i.style.width=t/c+"px",i.style.height=n/c+"px";i.ctx.fillStyle="green",i.ctx.beginPath(),(h.data.imageProcessor.resultContours=h.data.pointsProcessor.getContours()).forEach(function(e){p(i.ctx,e)}),i.ctx.fill()}function r(){var t=h.data.imageProcessor;if(t.set(t.grayData.clone().get()),e("reverse").is(":checked"))t.reverse();if(+e("gaussBlur").val()>=2)t.gaussBlur(+e("gaussBlur").val());if(+e("contrast").val())t.brightness(0,+e("contrast").val());t.save()}function o(){h.data.imageProcessor.binarize(+e("threshold").val())}function a(){var i=$("#import-pic-canvas-origin").get(0);i.ctx=i.getContext("2d");var a=$("#import-pic-canvas-fit").get(0);if(a.ctx=a.getContext("2d"),1!==c)i.width=i.height=0,i.style.width=i.style.height="auto",a.width=a.height=0,a.style.width=a.style.height="auto";$("#import-pic-file").get(0).onchange=function(e){var n=e.target.files[0];if(n){if(!/\.(?:jpg|gif|png|jpeg|bmp|svg)$/i.test(n.name))return void alert(l.lang.msg_not_support_file_type);var i=new FileReader;h.loading.show(l.lang.msg_loading_pic,1e4),i.onload=function(e){var n=new Image;n.onload=function(){t(n)},n.onerror=function(){h.loading.warn(l.lang.msg_read_pic_error,2e3)},n.src=e.target.result,e.target.value=""},i.onerror=function(){h.loading.warn(l.lang.msg_read_pic_error,2e3)},i.readAsDataURL(n)}};var s=d.debounce(function(t){if("threshold"===t)h.data.imageProcessor.restore(),o();else if("threshold-pre"===t){var i=$("#import-pic-threshold-pre").val();if(i){var a=y(h.data.imageProcessor.getOrigin());e("threshold").val(v(a,$("#import-pic-threshold-pre").val())),h.data.imageProcessor.restore(),o()}}else if("restore"===t)e("reverse").get(0).checked=!1,e("gaussBlur").val(0),e("contrast").val(0),r(),o();else if("reverse"===t||"gaussBlur"===t||"contrast"===t||"restore-binarize"===t)r(),o();else if("open"===t||"close"===t||"dilate"===t||"erode"===t)h.data.imageProcessor[t]();else if("smooth"===t)h.data.pointsProcessor.segment=!e("smooth").get(0).checked;n()},100);$("#import-pic-dialog").on("click","[data-action]",function(){var e=$(this).data("action");if("openfile"===e)$("#import-pic-file").click();else if("fitwindow"===e)$("#import-pic-dialog").find(".preview-panel").toggleClass("fitpanel");else if("fitwindow-left"===e)$("#import-pic-dialog").find(".preview-panel").removeClass("fitpanel").removeClass("showright").toggleClass("showleft");else if("fitwindow-right"===e)$("#import-pic-dialog").find(".preview-panel").removeClass("fitpanel").removeClass("showleft").toggleClass("showright");else if("import-url"===e)$("#import-pic-dialog").find(".import-pic-url").toggleClass("show-url")}).on("click","[data-filter]",function(e){if(h.data.imageProcessor.grayData){var t=$(this).data("filter");h.loading.show(l.lang.msg_processing,1e4),s(t)}}),$("#import-pic-threshold-pre").on("change",function(e){if(h.data.imageProcessor.grayData)h.loading.show(l.lang.msg_processing,1e4),s("threshold-pre")}),$("#import-pic-url-text").on("keyup",function(e){if(13===e.keyCode){var n=this.value.trim();if(/^https?:\/\//i.test(n)){this.value="",$("#import-pic-dialog").find(".import-pic-url").removeClass("show-url"),h.loading.show(l.lang.msg_loading_pic,1e4);var i=new Image;i.onload=function(){t(i)},i.onerror=function(){h.loading.warn(l.lang.msg_read_pic_error,2e3)},i.src=f.format(h.config.readOnline,["image",n])}else alert(l.lang.msg_input_pic_url)}})}function s(){$("#import-pic-file").get(0).onchange=null,$("#import-pic-dialog").off("click"),$("#import-pic-threshold-pre").off("change"),$("#import-pic-url-text").off("keyup")}var l=require("../i18n/i18n"),u=require("../template/dialog/setting-import-pic.tpl"),f=require("common/string"),c=require("common/getPixelRatio"),d=require("common/lang"),h=require("../widget/program"),p=require("render/util/drawPath"),g=require("graphics/image/ImageProcessor"),m=require("graphics/image/ContourPointsProcessor"),y=require("graphics/image/util/getHistogram"),v=require("graphics/image/util/getThreshold"),x=require("graphics/pathsUtil");return require("./setting").derive({title:l.lang.dialog_import_pic,style:"import-pic-dialog",getTpl:function(){return u},set:function(){h.data.imageProcessor=new g,h.data.pointsProcessor=new m,a()},onDispose:function(){s(),h.data.imageProcessor.grayData&&h.data.imageProcessor.grayData.dispose(),h.data.imageProcessor.dispose(),h.data.pointsProcessor.dispose(),h.data.imageProcessor=h.data.pointsProcessor=null},validate:function(){var e=h.data.imageProcessor.resultContours;if(e)if(!e||!e.length)alert(l.lang.msg_no_glyph_to_import);else return{contours:x.flip(e)};return{}}})}),define("fonteditor/template/dialog/setting-sync.tpl",[],function(){return'\n<div class="form-group">\n  <button id="setting-sync-cancel" type="button" class="btn btn-flat btn-sm btn-right">${lang.cancelsync}</button>\n  <div class="input-group input-group-sm">\n    <span class="input-group-addon">${lang.remoteurl}</span>\n    <input data-field="url" type="text" class="form-control">\n  </div>\n</div>\n\n<div class="form-group">\n  <span class="btn-right" style="width: 70px;line-height: 30px">\n    <a href="./doc/index.html#font-sync" target="_blank">帮助</a>\n  </span>\n  <div class="input-group input-group-sm">\n    <span class="input-group-addon">${lang.pushurl}</span>\n    <input data-field="pushUrl" type="text" class="form-control">\n  </div>\n</div>\n\n<div class="form-inline column-2">\n\n  <div class="form-group">\n    <div class="input-group input-group-sm">\n      <span class="input-group-addon">${lang.fontname}</span>\n      <input data-field="name" type="text" class="form-control">\n    </div>\n  </div>\n  <div class="form-group">\n    <div class="input-group input-group-sm">\n      <span class="input-group-addon">${lang.autosync}</span>\n      <span class="form-control">\n        <input data-field="autoSync" type="checkbox" checked="checked">\n      </span>\n    </div>\n  </div>\n</div>\n<div class="form-inline">\n  <span>${lang.fonttype}： </span>\n\n  <div class="form-group">\n    <div class="input-group input-group-sm">\n      <span class="input-group-addon">woff</span>\n      <span class="form-control">\n        <input data-field="woff" type="checkbox" checked="checked">\n      </span>\n    </div>\n  </div>\n\n  <div class="form-group">\n    <div class="input-group input-group-sm">\n      <span class="input-group-addon">ttf</span>\n      <span class="form-control">\n        <input data-field="ttf" type="checkbox" checked="checked">\n      </span>\n    </div>\n  </div>\n\n  <div class="form-group">\n    <div class="input-group input-group-sm">\n      <span class="input-group-addon">svg</span>\n      <span class="form-control">\n        <input data-field="svg" type="checkbox">\n      </span>\n    </div>\n  </div>\n\n  <div class="form-group">\n    <div class="input-group input-group-sm">\n      <span class="input-group-addon">eot</span>\n      <span class="form-control">\n        <input data-field="eot" type="checkbox">\n      </span>\n    </div>\n  </div>\n</div>\n'}),define("fonteditor/dialog/setting-sync",["require","../i18n/i18n","../template/dialog/setting-sync.tpl","./setting"],function(require){var e=require("../i18n/i18n"),t=require("../template/dialog/setting-sync.tpl");return require("./setting").derive({title:e.lang.syncfont,getTpl:function(){return t},set:function(e){this.setFields(e||{}),this.newProject=e.newProject;var t=this;$("#setting-sync-cancel").on("click",function(){t.hide(0)})},onDispose:function(){$("#setting-sync-cancel").off("click")},validate:function(){var t=this.getFields();if(!t.name)return alert(e.lang.dialog_alert_set_sync_name),!1;if(!t.url&&!t.pushUrl)return alert(e.lang.dialog_alert_set_url_or_syncurl),!1;if(this.newProject&&!t.url)return alert(e.lang.dialog_alert_set_sync_url),!1;if(!(t.woff||t.ttf||t.svg||t.eot))return alert(e.lang.dialog_alert_set_filetype),!1;else return t}})}),define("fonteditor-core/ttf/util/contour2svg",["require"],function(require){function e(e,t){if(t=t||2,!e.length)return"";for(var n,i,r,o,a,s=function(e){return+e.toFixed(t)},l=[],u=0,f=e.length;u<f;u++){if(n=e[u],i=0===u?e[f-1]:e[u-1],r=u===f-1?e[0]:e[u+1],0===u)if(n.onCurve)o=n.x,a=n.y,l.push("M"+s(o)+" "+s(a));else if(i.onCurve)o=i.x,a=i.y,l.push("M"+s(o)+" "+s(a));else o=(i.x+n.x)/2,a=(i.y+n.y)/2,l.push("M"+s(o)+" "+s(a));if(n.onCurve&&r.onCurve)l.push("l"+s(r.x-o)+" "+s(r.y-a)),o=r.x,a=r.y;else if(!n.onCurve)if(r.onCurve)l.push("q"+s(n.x-o)+" "+s(n.y-a)+" "+s(r.x-o)+" "+s(r.y-a)),o=r.x,a=r.y;else{var c=(n.x+r.x)/2,d=(n.y+r.y)/2;l.push("q"+s(n.x-o)+" "+s(n.y-a)+" "+s(c-o)+" "+s(d-a)),o=c,a=d}}return l.push("Z"),l.join(" ")}return e}),define("fonteditor-core/ttf/util/contours2svg",["require","./contour2svg"],function(require){function e(e,n){if(!e.length)return"";else return e.map(function(e){return t(e,n)}).join("")}var t=require("./contour2svg");return e}),define("fonteditor-core/graphics/pathCeil",["require"],function(require){function e(e,t){for(var n,i=0,r=e.length;i<r;i++)if(n=e[i],!t)n.x=Math.round(n.x),n.y=Math.round(n.y);else n.x=Number(n.x.toFixed(t)),n.y=Number(n.y.toFixed(t));return e}return e}),define("fonteditor/widget/util/glyf2svgfile",["require","fonteditor-core/graphics/computeBoundingBox","fonteditor-core/ttf/util/contours2svg","fonteditor-core/graphics/pathAdjust","fonteditor-core/graphics/pathCeil","fonteditor-core/ttf/util/string","common/string","common/lang"],function(require){function e(e,u){var f={size:u.size,unitsPerEm:u.unitsPerEm,name:o(e.name),fillColor:u.fillColor||"#000"};if(e.contours&&e.contours.length){var c=s.clone(e.contours),d=t.computePath.apply(null,c),h=Math.max(d.width,d.height),p=u.unitsPerEm/h;c.forEach(function(e){i(e,1,1,-d.x,-d.y-d.height/2),i(e,1,-1,0,0),i(e,p,p,(h-d.width)/2,d.height/2),r(e,2)}),f.d='d="'+n(c)+'"'}return a.format(l,f)}var t=require("fonteditor-core/graphics/computeBoundingBox"),n=require("fonteditor-core/ttf/util/contours2svg"),i=require("fonteditor-core/graphics/pathAdjust"),r=require("fonteditor-core/graphics/pathCeil"),o=require("fonteditor-core/ttf/util/string").escape,a=require("common/string"),s=require("common/lang"),l='<?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg id="${name}" width="${size}" height="${size}" style="width:${size}px;height:${size}px;" version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${unitsPerEm} ${unitsPerEm}" enable-background="new 0 0 ${unitsPerEm} ${unitsPerEm}" xml:space="preserve"><path fill="${fillColor}" ${d}/></svg>';return e}),define("fonteditor/widget/util/download",["require"],function(require){function e(e,t){var n=document.createElement("a");if(n.download=e,n.href=t,n.addEventListener("click",function(){n.remove()}),document.body.appendChild(n),n.click)n.click();else{var i=document.createEvent("MouseEvents");i.initMouseEvent("click",!0,!0,document.defaultView,0,0,0,0,0,!1,!1,!1,!1,0,null),n.dispatchEvent(i)}}return e}),define("fonteditor-core/ttf/svg2base64",["require"],function(require){function e(e,t){return"data:"+(t=t||"font/svg")+";charset=utf-8;base64,"+btoa(e)}return e}),define("fonteditor-core/ttf/util/bytes2base64",["require"],function(require){function e(e){var n,i,r="";if(e instanceof ArrayBuffer){n=e.byteLength;var o=new DataView(e,0,n);for(i=0;i<n;i++)r+=String.fromCharCode(o.getUint8(i,!1))}else if(e.length)for(n=e.length,i=0;i<n;i++)r+=String.fromCharCode(e[i]);return t(r)}var t="undefined"!=typeof window?window.btoa:function(e){return new Buffer(e,"binary").toString("base64")};return e}),define("fonteditor/dialog/colorpicker",["require","common/lang"],function(require){var e=(require("common/lang"),{customBG:"#222",margin:"5px -2px 0",doRender:"div div",cssAddon:'.cp-color-picker{border:1px solid #999; padding:10px 10px 0;background:#eee; overflow:visible; border-radius:3px;}.cp-color-picker:after{content:""; display:block; position:absolute; top:-15px; left:12px; border:8px solid #eee;border-color: transparent transparent #eee}.cp-color-picker:before{content:""; display:block; position:absolute; top:-16px; left:12px; border:8px solid #eee;border-color: transparent transparent #999}.cp-xy-slider:active {cursor:none;}.cp-xy-slider{border:1px solid #999; margin-bottom:10px;}.cp-xy-cursor{width:12px; height:12px; margin:-6px}.cp-z-slider{margin-left:10px; border:1px solid #999;}.cp-z-cursor{border-width:5px; margin-top:-5px;}.cp-color-picker .cp-alpha{margin:10px 0 0; height:6px; border-radius:6px;overflow:visible; border:1px solid #999; box-sizing:border-box;background: linear-gradient(to right, rgba(238,238,238,1) 0%,rgba(238,238,238,0) 100%);}.cp-color-picker .cp-alpha{margin:10px 0}.cp-alpha-cursor{background: #eee; border-radius: 100%;width:14px; height:14px; margin:-5px -7px; border:1px solid #666!important;box-shadow:inset -2px -4px 3px #ccc}',renderCallback:function(e,t){if(!1===t)this.$trigger.trigger("change")}});return{show:function(t,n){return $(t).colorPicker($.extend({},e,n))}}}),define("fonteditor/template/dialog/glyf-download.tpl",[],function(){return'<div class="glyf-download-dialog">\n    <div class="form-inline">\n        <span class="form-title">${lang.dialog_glyf_name}: <em id="glyf-download-name"></em></span>\n        <div class="form-group field-margin">\n            <div class="input-group input-group-sm">\n                <span class="input-group-addon">${lang.dialog_color}</span>\n                <input id="glyf-download-color" type="text" value="#666" class="form-control">\n            </div>\n        </div>\n\n        <div class="form-group field-margin">\n            <div class="input-group input-group-sm">\n                <span class="input-group-addon">${lang.dialog_size}</span>\n                <input id="glyf-download-size" type="number" value="128" min="10" max="10000" step="1" class="form-control"><span class="input-group-addon">px</span>\n            </div>\n        </div>\n    </div>\n    <div id="glyf-download-preview" class="preview-panel">\n\n    </div>\n    <div class="form-inline glyf-download-btn">\n        <div class="input-group input-group-sm">\n            <a id="glyf-download-svg" class="btn btn-flat btn-new">${lang.dialog_download_svg}</a>\n            <a id="glyf-download-png" class="btn btn-flat field-margin">${lang.dialog_download_png}</a>\n        </div>\n    </div>\n</div>\n'}),define("fonteditor/dialog/glyf-download",["require","common/getPixelRatio","../i18n/i18n","../widget/util/glyf2svgfile","../widget/util/download","fonteditor-core/ttf/svg2base64","fonteditor-core/ttf/util/bytes2base64","./colorpicker","./setting","../template/dialog/glyf-download.tpl"],function(require){function e(e){var t={fillColor:$("#glyf-download-color").val().trim(),size:+$("#glyf-download-size").val(),unitsPerEm:e.ttf.head.unitsPerEm};return r(e.glyf,t)}function t(){var t=e(this.setting),i=+$("#glyf-download-size").val(),r=document.createElement("canvas");r.width=r.height=i;var o=new Image;o.src="data:image/svg+xml;base64,"+btoa(t),o.width=o.height=i,o.onload=function(e){r.getContext("2d").drawImage(o,0,0,i,i,0,0,n*i,n*i)};var a=$("#glyf-download-preview");a.children().remove(),a.append(r)}var n=require("common/getPixelRatio"),i=require("../i18n/i18n"),r=require("../widget/util/glyf2svgfile"),o=require("../widget/util/download"),a=require("fonteditor-core/ttf/svg2base64"),s=(require("fonteditor-core/ttf/util/bytes2base64"),require("./colorpicker"));return require("./setting").derive({title:i.lang.dialog_export_glyf,nofooter:!0,getTpl:function(){return require("../template/dialog/glyf-download.tpl")},set:function(n){var i=$.proxy(t,this);$("#glyf-download-color").on("change",i),$("#glyf-download-size").on("change",i),s.show("#glyf-download-color"),$("#glyf-download-svg").on("click",$.proxy(function(t){var n=e(this.setting);$(t.target);o((this.setting.glyf.name||"svg")+".svg",a(n))},this)),$("#glyf-download-png").on("click",$.proxy(function(e){var t=$("#glyf-download-preview canvas").get(0),n=t.toDataURL();$(e.target);o((this.setting.glyf.name||"png")+".png",n)},this)),$("#glyf-download-name").html(n.glyf.name),this.setting=n,t.call(this)},onDispose:function(){$("#glyf-download-color").off("change"),$("#glyf-download-size").off("change"),$("#glyf-download-svg").off("click"),$("#glyf-download-png").off("click"),this.setting=null}})}),define("fonteditor/dialog/support",["require","../dialog/setting-unicode","../dialog/setting-name","../dialog/setting-adjust-pos","../dialog/setting-adjust-glyf","../dialog/setting-metrics","../dialog/font-online","../dialog/font-url","../dialog/setting-glyf","../dialog/setting-editor","../dialog/setting-find-glyf","../dialog/setting-ie","../dialog/setting-import-pic","../dialog/setting-sync","../dialog/glyf-download"],function(require){return{unicode:require("../dialog/setting-unicode"),name:require("../dialog/setting-name"),"adjust-pos":require("../dialog/setting-adjust-pos"),"adjust-glyf":require("../dialog/setting-adjust-glyf"),metrics:require("../dialog/setting-metrics"),online:require("../dialog/font-online"),url:require("../dialog/font-url"),glyf:require("../dialog/setting-glyf"),editor:require("../dialog/setting-editor"),"find-glyf":require("../dialog/setting-find-glyf"),ie:require("../dialog/setting-ie"),"import-pic":require("../dialog/setting-import-pic"),sync:require("../dialog/setting-sync"),"glyf-download":require("../dialog/glyf-download")}}),define("editor/widget/clipboard",["require"],function(require){var e=window.localStorage,t="clipboard.default";return{set:function(n,i){e.setItem(t,JSON.stringify({type:i||-9999,data:n}))},get:function(n){var i=e.getItem(t);if(null!==i)if(i=JSON.parse(i),i.type===n)return i.data;return null},clear:function(){e.removeItem(t)}}}),define("fonteditor-core/common/ajaxFile",["require"],function(require){function e(e){var t=new XMLHttpRequest;t.onreadystatechange=function(){if(4===t.readyState){var n=t.status;if(n>=200&&n<300||304===n){if(e.onSuccess)if("binary"===e.type){var i=t.responseBlob||t.response;e.onSuccess(i)}else if("xml"===e.type)e.onSuccess(t.responseXML);else if("json"===e.type)e.onSuccess(JSON.parse(t.responseText));else e.onSuccess(t.responseText)}else if(e.onError)e.onError(t,t.status)}};var n=(e.method||"GET").toUpperCase(),i=null;if(e.params){var r=[];if(Object.keys(e.params).forEach(function(t){r.push(t+"="+encodeURIComponent(e.params[t]))}),r=r.join("&"),"GET"===n)e.url+=(-1===e.url.indexOf("?")?"?":"&")+r;else i=r}if(t.open(n,e.url,!0),"binary"===e.type)t.responseType="arraybuffer";t.send(i)}return e}),define("common/ajaxFile",["require","fonteditor-core/common/ajaxFile"],function(require){return require("fonteditor-core/common/ajaxFile")}),define("fonteditor-core/ttf/util/glyfAdjust",["require","../../graphics/pathAdjust","../../graphics/pathCeil","../../graphics/computeBoundingBox"],function(require){function e(e,r,o,a,s,l){if(r=r||1,o=o||1,a=a||0,s=s||0,e.contours&&e.contours.length){if(1!==r||1!==o)e.contours.forEach(function(e){t(e,r,o)});if(0!==a||0!==s)e.contours.forEach(function(e){t(e,1,1,a,s)});if(!1!==l)e.contours.forEach(function(e){n(e)})}var u=e.advanceWidth;if(void 0===e.xMin||void 0===e.yMax||void 0===e.leftSideBearing||void 0===e.advanceWidth){var f;if(e.contours&&e.contours.length)f=i.computePathBox.apply(this,e.contours);else f={x:0,y:0,width:0,height:0};if(e.xMin=f.x,e.xMax=f.x+f.width,e.yMin=f.y,e.yMax=f.y+f.height,e.leftSideBearing=e.xMin,void 0!==u)e.advanceWidth=Math.round(u*r+a);else e.advanceWidth=e.xMax+Math.abs(e.xMin)}else e.xMin=Math.round(e.xMin*r+a),e.xMax=Math.round(e.xMax*r+a),e.yMin=Math.round(e.yMin*o+s),e.yMax=Math.round(e.yMax*o+s),e.leftSideBearing=Math.round(e.leftSideBearing*r+a),e.advanceWidth=Math.round(u*r+a);return e}var t=require("../../graphics/pathAdjust"),n=require("../../graphics/pathCeil"),i=require("../../graphics/computeBoundingBox");return e}),define("fonteditor-core/ttf/data/empty",["require"],function(require){return{version:1,numTables:10,searchRenge:128,entrySelector:3,rengeShift:64,head:{version:1,fontRevision:1,checkSumAdjustment:0,magickNumber:1594834165,flags:11,unitsPerEm:1024,created:14289408e5,modified:14289408e5,xMin:34,yMin:0,xMax:306,yMax:682,macStyle:0,lowestRecPPEM:8,fontDirectionHint:2,indexToLocFormat:0,glyphDataFormat:0},glyf:[{contours:[[{x:34,y:0,onCurve:!0},{x:34,y:682,onCurve:!0},{x:306,y:682,onCurve:!0},{x:306,y:0,onCurve:!0}],[{x:68,y:34,onCurve:!0},{x:272,y:34,onCurve:!0},{x:272,y:648,onCurve:!0},{x:68,y:648,onCurve:!0}]],xMin:34,yMin:0,xMax:306,yMax:682,advanceWidth:374,leftSideBearing:34,name:".notdef"}],cmap:{},name:{fontFamily:"fonteditor",fontSubFamily:"Medium",uniqueSubFamily:"FontEditor 1.0 : fonteditor",version:"Version 1.0 ; FontEditor (v0.0.1)",postScriptName:"fonteditor",fullName:"fonteditor"},hhea:{version:1,ascent:812,descent:-212,lineGap:92,advanceWidthMax:374,minLeftSideBearing:34,minRightSideBearing:68,xMaxExtent:306,caretSlopeRise:1,caretSlopeRun:0,caretOffset:0,reserved0:0,reserved1:0,reserved2:0,reserved3:0,metricDataFormat:0,numOfLongHorMetrics:1},post:{italicAngle:0,postoints:65411,underlinePosition:50,underlineThickness:0,isFixedPitch:0,minMemType42:0,maxMemType42:0,minMemType1:0,maxMemType1:1,format:2},maxp:{version:1,numGlyphs:0,maxPoints:0,maxContours:0,maxCompositePoints:0,maxCompositeContours:0,maxZones:0,maxTwilightPoints:0,maxStorage:0,maxFunctionDefs:0,maxStackElements:0,maxSizeOfInstructions:0,maxComponentElements:0,maxComponentDepth:0},"OS/2":{version:4,xAvgCharWidth:1031,usWeightClass:400,usWidthClass:5,fsType:0,ySubscriptXSize:665,ySubscriptYSize:716,ySubscriptXOffset:0,ySubscriptYOffset:143,ySuperscriptXSize:665,ySuperscriptYSize:716,ySuperscriptXOffset:0,ySuperscriptYOffset:491,yStrikeoutSize:51,yStrikeoutPosition:265,sFamilyClass:0,bFamilyType:2,bSerifStyle:0,bWeight:6,bProportion:3,bContrast:0,bStrokeVariation:0,bArmStyle:0,bLetterform:0,bMidline:0,bXHeight:0,ulUnicodeRange1:1,ulUnicodeRange2:268435456,ulUnicodeRange3:0,ulUnicodeRange4:0,achVendID:"PfEd",fsSelection:192,usFirstCharIndex:65535,usLastCharIndex:-1,sTypoAscender:812,sTypoDescender:-212,sTypoLineGap:92,usWinAscent:812,usWinDescent:212,ulCodePageRange1:1,ulCodePageRange2:0,sxHeight:792,sCapHeight:0,usDefaultChar:0,usBreakChar:32,usMaxContext:1}}}),define("fonteditor-core/ttf/data/default",["require"],function(require){return{fontId:"fonteditor",name:{fontFamily:"fonteditor",fontSubFamily:"Medium",uniqueSubFamily:"FontEditor 1.0 : fonteditor",version:"Version 1.0; FontEditor (v1.0)",postScriptName:"fonteditor"}}}),define("fonteditor-core/ttf/getEmptyttfObject",["require","../common/lang","./data/empty","./data/default"],function(require){function e(){var e=t.clone(n);return t.extend(e.name,i.name),e.head.created=e.head.modified=Date.now(),e}var t=require("../common/lang"),n=require("./data/empty"),i=require("./data/default");return e}),define("fonteditor/controller/actions",["require","../i18n/i18n","../dialog/support","../widget/program","common/ajaxFile","common/string","common/lang","fonteditor-core/ttf/util/glyfAdjust","fonteditor-core/ttf/getEmptyttfObject"],function(require){function e(e,n){r({type:"svg"===e?"xml":"binary",url:n,onSuccess:function(t){i.loader.load(t,{type:e||"ttf",success:function(e){i.loading.hide(),i.ttfManager.set(e),i.data.projectId=null,i.projectViewer.unSelect()}})},onError:function(){alert(t.lang.msg_read_file_error)}})}var t=require("../i18n/i18n"),n=require("../dialog/support"),i=require("../widget/program"),r=require("common/ajaxFile"),o=require("common/string"),a=require("common/lang"),s=require("fonteditor-core/ttf/util/glyfAdjust"),l=require("fonteditor-core/ttf/getEmptyttfObject"),u=a.debounce(function(){i.editor.focus()},20),f=a.debounce(function(e){i.loading.show(t.lang.msg_syncing,4e3),i.sync.addTask(e).then(function(n){if(e.newProject&&n&&n.newData)c.new({ttf:n.newData,config:{sync:e.config}});else if("push"===e.type&&n&&n.newData)i.ttfManager.ttf.set(n.newData),i.ttfManager.fireChange(!0),i.project.update(e.projectId,n.newData).then(function(){i.ttfManager.setState("saved")});i.loading.show(t.lang.msg_sync_success,400)},function(n){if(e.newProject&&1===n.status)alert(t.lang.msg_error_sync_font);n.reason&&console.warn(n.reason)})},500),c={undo:function(){if(i.editor.isEditing())i.editor.undo(),u();else i.ttfManager.undo()},redo:function(){if(i.editor.isEditing())i.editor.redo(),u();else i.ttfManager.redo()},new:function(e){if(!i.ttfManager.isChanged()||window.confirm(t.lang.msg_confirm_save_proj))i.ttfManager.set(e&&e.ttf||l()),i.data.projectId=null,c.save(e)},open:function(){$("#font-import").click()},import:function(){if(i.ttfManager.get())$("#font-import").click()},export:function(e){if(i.ttfManager.get()){var t=$(e.target);i.exporter.export(i.ttfManager.get(),{type:t.attr("data-type"),error:function(e){i.fire("font-error",e)}})}},"sync-from-server":function(){new(0,n.sync)({onChange:function(e){e.timestamp=-1,f({type:"pull",newProject:1,config:e})}}).show({newProject:1})},sync:function(e,t,n){f({type:"push",projectId:e,ttf:t,config:n})},dosync:function(e){var t=i.project.getConfig(e).sync;if(t&&t.autoSync)c.sync(e,i.ttfManager.get(),t)},save:function(e){if(i.ttfManager.get()){var n=i.data.projectId;if(n)i.project.update(n,i.ttfManager.get()).then(function(){i.ttfManager.setState("saved"),i.loading.show(t.lang.msg_save_success,400),c.dosync(n)},function(){i.loading.show(t.lang.msg_save_failed,1e3)});else{var r=i.ttfManager.get().name.fontFamily||"";if(r=window.prompt(t.lang.msg_input_proj_name,r))r=o.encodeHTML(r),e=e||{},i.project.add(r,e.ttf||i.ttfManager.get(),e.config).then(function(e){i.data.projectId=e,i.ttfManager.setState("new"),i.projectViewer.show(i.project.items(),e),i.loading.show(t.lang.msg_save_success,400)},function(){i.loading.show(t.lang.msg_save_failed,400)})}}},"add-new":function(){if(i.ttfManager.get()){var e=i.viewer.getSelected();i.ttfManager.insertGlyf({},e[0])}else c.new()},"add-online":function(){new(0,n.online)({onChange:function(n){if(!i.ttfManager.isChanged()||window.confirm(t.lang.msg_confirm_save_proj))i.loading.show(t.lang.msg_loading,1e3),setTimeout(function(){var t=n.slice(n.lastIndexOf(".")+1),r=n;if(/^https?:\/\//i.test(n))r=o.format(i.config.readOnline,["font",encodeURIComponent(n)]);e(t,r)},20)}}).show()},"add-url":function(){new(0,n.url)({onChange:function(n){if(!i.ttfManager.isChanged()||window.confirm(t.lang.msg_confirm_save_proj))i.loading.show(t.lang.msg_loading,1e3),setTimeout(function(){var t=o.format(i.config.readOnline,["font",encodeURIComponent(n)]);e(n.slice(n.lastIndexOf(".")+1),t)},20)}}).show()},preview:function(e){var t=i.ttfManager.get();if(t){var n=e.target.getAttribute("data-format");i.previewer.load(t,n)}},"setting-name":function(){var e=i.ttfManager.get();if(e){new(0,n.name)({onChange:function(e){i.ttfManager.setInfo(e)}}).show($.extend({},e.head,e.name))}},"setting-metrics":function(){var e=i.ttfManager.get();if(e){new(0,n.metrics)({onChange:function(e){i.ttfManager.setMetrics(e)}}).show($.extend({},e["OS/2"],e.hhea,e.post))}},"setting-glyf-name":function(){if(i.ttfManager.get())if(window.confirm(t.lang.msg_confirm_gen_names))i.ttfManager.genGlyfName(i.viewer.getSelected())},"setting-glyf-clearname":function(){if(i.ttfManager.get())i.ttfManager.clearGlyfName(i.viewer.getSelected())},"setting-optimize":function(){if(i.ttfManager.get()){var e=i.ttfManager.optimize();if(!0!==e){if(e.repeat)i.fire("font-error",{number:10200,data:e.repeat});alert(e.message)}}},"setting-sort":function(){if(i.ttfManager.get()){var e=i.ttfManager.sortGlyf();if(!0!==e)alert(e.message)}},"setting-compound2simple":function(){if(i.ttfManager.get())i.ttfManager.compound2simple(i.viewer.getSelected())},"setting-editor":function(){new(0,n.editor)({onChange:function(e){i.setting.set("editor",e,e.saveSetting),setTimeout(function(){i.viewer.setSetting(e.viewer),i.editor.setSetting(e.editor)},20)}}).show(i.setting.get("editor"))},"import-pic":function(){var e=n["import-pic"];if(i.ttfManager.get())new e({onChange:function(e){if(e.contours)if(i.editor.isVisible())i.editor.execCommand("addcontours",e.contours,{scale:1,selected:!0}),u();else{var t=i.viewer.getSelected();i.ttfManager.insertGlyf(s({contours:e.contours},1,1,0,0,!1),t[0])}}}).show()},"setting-import-and-export":function(){new(0,n.ie)({onChange:function(e){i.setting.set("ie",e,e.saveSetting)}}).show(i.setting.get("ie"))}};return c}),define("fonteditor-core/graphics/pathTransform",["require"],function(require){function e(e,t,n,i,r,o,a){for(var s,l,u,f=0,c=e.length;f<c;f++)u=e[f],s=u.x,l=u.y,u.x=s*t+l*i+o,u.y=s*n+l*r+a;return e}return e}),define("fonteditor-core/ttf/util/transformGlyfContours",["require","../../graphics/pathCeil","../../graphics/pathTransform","../../common/lang"],function(require){function e(r,o,a,s){if(!r.glyfs)return r;if(!a)a={};var l=[];if(r.glyfs.forEach(function(s){var u=o.glyf[s.glyphIndex];if(u&&u!==r){if(u.compound&&!a[s.glyphIndex])e(u,o,a,s.glyphIndex);for(var f=i.clone(u.compound?a[s.glyphIndex]||[]:u.contours),c=s.transform,d=0,h=f.length;d<h;d++)n(f[d],c.a,c.b,c.c,c.d,c.e,c.f),l.push(t(f[d]))}}),null!=s)a[s]=l;return l}var t=require("../../graphics/pathCeil"),n=require("../../graphics/pathTransform"),i=require("../../common/lang");return e}),define("fonteditor-core/ttf/util/compound2simple",["require"],function(require){function e(e,t){return e.contours=t,delete e.compound,delete e.glyfs,delete e.instructions,e}return e}),define("fonteditor/controller/default",["require","../i18n/i18n","common/lang","../dialog/support","editor/widget/clipboard","./actions","fonteditor-core/ttf/util/transformGlyfContours","fonteditor-core/ttf/util/compound2simple","fonteditor-core/ttf/util/glyfAdjust"],function(require){function e(e){if(10200===e.number&&e.data){var t=Array.isArray(e.data)?e.data:[e.data],n=c.setting.get("editor").viewer.pageSize,i=Math.ceil(t[0]/n);r(c.ttfManager.get(),i,t)}}function t(e){return{unitsPerEm:e.head.unitsPerEm,metrics:{ascent:e.hhea.ascent,descent:e.hhea.descent,capHeight:e["OS/2"].sCapHeight||.8*e.hhea.ascent,xHeight:e["OS/2"].sxHeight||.4*e.head.unitsPerEm}}}function n(e){var n=c.editor.isVisible(),i=c.ttfManager.get();if(i){if($(".main").addClass("editing"),$(".editor").addClass("editing"),c.viewer.setMode("editor"),!n)c.editor.show(),c.fire("editor-show");if(c.editor.setAxis(t(i)),null==e)return;e=+e;var r=i.glyf[e];if(r){var o=h.clone(r);if(o.compound){if(!confirm(d.lang.msg_transform_compound_glyf))return;var a=require("fonteditor-core/ttf/util/transformGlyfContours");o=require("fonteditor-core/ttf/util/compound2simple")(o,a(r,i))}c.editor.setFont(o)}}}function i(){$(".main").removeClass("editing"),$(".editor").removeClass("editing"),c.editor&&c.editor.hide(),c.fire("editor-hide"),c.viewer.clearEditing(),c.viewer.setMode("list"),c.viewer.focus()}function r(e,t,n){var i=e.glyf.length,r=c.setting.get("editor").viewer.pageSize,o=Math.ceil(i/r);if(t>o)t=o;else if(t<1)t=1;if(c.viewer.setPage(t-1),c.viewer.show(e,n||c.viewer.getSelected()),c.viewer.focus(),i>r)c.viewerPager.show(t,r,i);else c.viewerPager.hide()}function o(e,t){var n,i=c.ttfManager.get(),r=i.glyf,o=r.length,a=e.length,s=t?-1:1;if(1===a){n=e[0];var l=n+s;if(l>=0&&l<o){var u=r[n];r[n]=r[l],r[l]=u,c.viewer.setSelected([l]),c.viewer.refresh(i,[n,l])}}else if(a)if(e=e.sort(function(e,t){return e-t}),t&&e[0]>0||!t&&e[a-1]<o-1){var f;if(t){for(n=e[0]-1,f=1;f<a;f++)if(e[f-1]+1!==e[f])r.splice(e[f-1]+1,0,r[n]),r.splice(n,1),n=e[f]-1;r.splice(e[a-1]+1,0,r[n]),r.splice(n,1)}else{for(n=e[a-1]+1,f=a-2;f>=0;f--)if(e[f+1]-1!==e[f])r.splice(e[f+1],0,r[n]),r.splice(n+1,1),n=e[f]+1;r.splice(e[0],0,r[n]),r.splice(n+1,1)}c.viewer.setSelected(e.map(function(e){return e+s})),c.viewer.refresh(i)}}function a(e){var t=h.debounce(function(){e.ttfManager.pushHistory()},200);e.viewer.on("del",function(t){if(t.list)e.ttfManager.removeGlyf(t.list)}).on("edit",function(t){if(t.lastEditing===t.list[0])return void n();if(!e.editor.isChanged()||confirm(d.lang.msg_confirm_save_glyph))$(".main").addClass("editing"),$(".editor").addClass("editing"),e.viewer.setEditing(t.list[0]),n(t.list[0])}).on("copy",function(t){var n=e.ttfManager.getCopiedGlyf(t.list),i={unitsPerEm:e.ttfManager.get().head.unitsPerEm,glyf:n};g.set(i,"glyf")}).on("cut",function(t){var n=e.ttfManager.getGlyf(t.list),i={unitsPerEm:e.ttfManager.get().head.unitsPerEm,glyf:n};g.set(i,"glyf"),e.ttfManager.removeGlyf(t.list)}).on("paste",function(t){var n=g.get("glyf");if(n&&n.glyf.length){if(e.ttfManager.get().head.unitsPerEm!==n.unitsPerEm){var i=e.ttfManager.get().head.unitsPerEm/(n.unitsPerEm||1024),r=require("fonteditor-core/ttf/util/glyfAdjust");n.glyf.forEach(function(e){r(e,i,i)})}e.ttfManager.appendGlyf(n.glyf,e.viewer.getSelected())}}).on("undo",function(t){e.ttfManager.undo()}).on("redo",function(t){e.ttfManager.redo()}).on("adjust-pos",function(t){var n=e.viewer.getSelected(),i={};if(1===n.length){var r=e.ttfManager.getGlyf(n)[0];i={unicode:r.unicode,leftSideBearing:r.leftSideBearing,rightSideBearing:r.advanceWidth-r.xMax}}new(0,p["adjust-pos"])({onChange:function(t){setTimeout(function(){e.ttfManager.adjustGlyfPos(n,t)},20)}}).show(i)}).on("adjust-glyf",function(t){new(0,p["adjust-glyf"])({onChange:function(t){setTimeout(function(){e.ttfManager.adjustGlyf(e.viewer.getSelected(),t)},20)}}).show()}).on("setting-font",function(t){var n=e.viewer.getSelected();if(n.length){var i=e.ttfManager.getGlyf(n)[0];new(0,p.glyf)({onChange:function(t){e.ttfManager.updateGlyf(t,n[0])}}).show({unicode:i.unicode,leftSideBearing:i.leftSideBearing,rightSideBearing:i.advanceWidth-(i.xMax||0),name:i.name})}}).on("find-glyf",function(t){new(0,p["find-glyf"])({onChange:function(t){var n=e.ttfManager.findGlyf(t);if(n.length){var i=e.setting.get("editor").viewer.pageSize,o=Math.ceil(n[0]/i);r(e.ttfManager.get(),o,n)}else e.loading.warn(d.lang.msg_no_related_glhph,1e3)}}).show()}).on("download-glyf",function(t){var n=p["glyf-download"],i=e.ttfManager.getCopiedGlyf(t.list);(new n).show({ttf:e.ttfManager.get(),glyf:i[0]})}).on("setting-unicode",function(t){new(0,p.unicode)({onChange:function(t){setTimeout(function(){if(e.ttfManager.get()){var n=e.viewer.getSelected();e.ttfManager.setUnicode(t.unicode,n,t.isGenerateName)}},20)}}).show()}).on("setting-sync",function(t){if(e.data.projectId){var n=e.project.getConfig(e.data.projectId).sync;if(!n)n={name:e.ttfManager.get().name.fontFamily};new(0,p.sync)({onChange:function(t){e.project.updateConfig(e.data.projectId,{sync:t?$.extend(n,t):null}),e.projectViewer.show(e.project.items(),e.data.projectId)}}).show(n)}}).on("refresh",function(t){if(e.ttfManager.get())r(e.ttfManager.get(),1)}).on("moveleft",function(i){var r=e.viewer.getEditing();if(e.editor.isVisible()){if(r<=0)r=e.ttfManager.get().glyf.length;if(e.editor.isChanged()&&!confirm(d.lang.msg_confirm_save_glyph))return;e.viewer.setEditing(--r),n(r)}else{var a=e.viewer.getSelected();if(a.length)o(a,!0),t()}}).on("moveright",function(i){var r=e.viewer.getEditing();if(e.editor.isVisible()){if(r>=e.ttfManager.get().glyf.length-1)r=-1;if(e.editor.isChanged()&&!confirm(d.lang.msg_confirm_save_glyph))return;e.viewer.setEditing(++r),n(r)}else{var a=e.viewer.getSelected();if(a.length)o(a,!1),t()}}),e.viewerPager.on("change",function(t){r(e.ttfManager.get(),t.page)})}function s(e){var t=function(){var e=$(".editor").css("width");if(e)$(".main").css("margin-left",e)};e.on("editor-show",function(){e.editor.editor.render.resizeCapture.un("resize",t),e.editor.editor.render.resizeCapture.on("resize",t),t(),e.spliter.enable()}).on("editor-hide",function(){e.editor.editor.render.resizeCapture.un("resize",t),$(".main").css("margin-left",""),e.spliter.disable()}),e.spliter.disable().on("change",function(t){var n=$(".editor"),i=n.width();if(t.delta+i>400)n.width(i+t.delta),e.editor.editor.render.resizeCapture.fire("resize",t)})}function l(e){e.projectViewer.on("open",function(t){var n=e.data.projectId;e.project.get(t.projectId).then(function(n){if(n){if(e.ttfManager.isChanged()&&!window.confirm(d.lang.msg_confirm_save_proj))return;e.ttfManager.set(n),e.data.projectId=t.projectId,e.projectViewer.select(t.projectId),e.viewer.focus(),window.localStorage.setItem("project-cur",t.projectId)}},function(){if(window.confirm(d.lang.msg_error_open_proj)){var i=function(){e.projectViewer.show(e.project.items(),n)};e.project.remove(t.projectId,!0).then(i,i)}})}).on("saveas",function(){e.data.projectId=null,m.save(),e.viewer.focus()}).on("sync",function(e){m.dosync(e.projectId)}).on("del",function(t){e.project.remove(t.projectId).then(function(){if(t.projectId===e.data.projectId)e.data.projectId=null},function(){e.loading.warn(d.lang.msg_error_del_proj,1e3)}),e.viewer.focus()})}function u(e){e.ttfManager.on("change",function(t){var n=e.viewer.getEditing();if("update"===t.changeType&&e.editor.isEditing()&&-1!==n)e.viewer.refresh(t.ttf,[n]);else r(t.ttf,e.viewer.getPage()+1)}).on("set",function(t){if(!e.viewer.inited)e.viewer.setMode("list"),e.viewer.inited=!0;if(!e.menuInited)$('.action-groups [data-disabled="1"]').removeAttr("data-disabled"),e.menuInited=!0;r(t.ttf,1,[])})}function f(t){var r=function(){var e=t.viewer.getEditing();if(-1!==e)t.ttfManager.replaceGlyf(t.editor.getFont(),e);else t.ttfManager.insertGlyf(t.editor.getFont());t.editor.setChanged(!1)};t.on("save",function(e){if(t.ttfManager.get()){var n=e.saveType;if("force"===n){if(t.editor.isEditing())r();m.save()}else if("editor"===n||t.editor.isEditing())r(),t.viewer.blur(),t.editor.focus();else m.save(),t.editor.blur(),t.viewer.focus()}}).on("paste",function(e){var n=g.get("glyf");if(n&&n.glyf.length)if(!t.editor.isEditing())t.viewer.fire("paste");else t.editor.execCommand("addcontours",n.glyf[0].contours,{selected:!0})}).on("function",function(e){if(113===e.keyCode)if(!t.editor.isVisible())n();else i();else if(114===e.keyCode||115===e.keyCode){var r=t.ttfManager.get();if(r)t.previewer.load(r,114===e.keyCode?"ttf":"woff")}}).on("font-error",function(t){e(t)})}var c,d=require("../i18n/i18n"),h=require("common/lang"),p=require("../dialog/support"),g=require("editor/widget/clipboard"),m=require("./actions");return{init:function(e){c=e,a(c),s(c),u(c),l(c),f(c),$(".close-editor").click(function(){i()}),c.init({viewer:c.viewer.main.get(0),editor:c.editor.main.get(0)}),window.onbeforeunload=function(){if(c.ttfManager.isChanged())return d.lang.msg_confirm_save_proj}}}}),define("editor/options",["require"],function(require){return{editor:{unitsPerEm:512,sorption:{enableGrid:!1,enableShape:!0,gridDelta:5,delta:5,sorptionColor:"#F0913A"},referenceline:{style:{strokeColor:"#746AFE"}},coverLayer:{lineColor:"#4780FF",outlineColor:"#3372FF",strokeColor:"#4780FF",fillColor:"white"},fontLayer:{lineWidth:1,strokeColor:"#888",fill:!0,fillColor:"#999"},axis:{showGrid:!0,gapColor:"#DEDCFE",axisColor:"red",metricsColor:"#FF9592",emColor:"red",metrics:{ascent:480,descent:-33,xHeight:256,capHeight:358},graduation:{gap:100,thickness:20,markHeight:3,markBackgroundColor:"#C3CBD2",markColor:"#65737E",color:"#65737E"}},contextMenu:{}},render:{defaultRatio:1.2,minScale:.1,maxScale:200,enableScale:!0,enableResize:!0}}}),define("fonteditor/setting/editor",["require","editor/options"],function(require){var e=require("editor/options").editor;return{saveSetting:!0,viewer:{color:"",shapeSize:"normal",pageSize:100},editor:{sorption:{enableGrid:!1,enableShape:!0},fontLayer:{strokeColor:e.fontLayer.strokeColor,fill:!0,fillColor:e.fontLayer.fillColor},referenceline:{style:{strokeColor:e.referenceline.style.strokeColor}},axis:{showGrid:!0,gapColor:e.axis.gapColor,metricsColor:e.axis.metricsColor,graduation:{gap:e.axis.graduation.gap}}}}}),define("fonteditor/setting/ie",["require"],function(require){return{saveSetting:!0,import:{combinePath:!0},export:{saveWithGlyfName:!0}}}),define("fonteditor/setting/support",["require","./editor","./ie"],function(require){return{editor:require("./editor"),ie:require("./ie")}}),define("fonteditor/widget/settingmanager",["require","common/lang","../setting/support"],function(require){var e=require("common/lang"),t=require("../setting/support"),n=window.localStorage,i={};return{get:function(t){if(!t)throw"setting name empty";if(i[t])return i[t];var r=null,o=n.getItem("setting."+t);if(o)r=e.overwrite(this.getDefault(t),JSON.parse(o));else r=this.getDefault(t);return i[t]=r},set:function(t,r,o){if(!t)throw"setting name empty";if(o)if(!e.equals(r,this.getDefault(t)))n.setItem("setting."+t,JSON.stringify(r));else n.removeItem("setting."+t);return i[t]=r},isStored:function(e){return!!n.getItem("setting."+e)},getDefault:function(n){if(t[n])return e.clone(t[n]);else return null}}}),define("fonteditor/config",["require"],function(require){return{readOnline:location.hostname.indexOf("baidu.com")>=0?"/font/proxy?type=${0}&url=${1}":"./php/readOnline.php?type=${0}&file=${1}",proxyUrl:function(){var e=document.createElement("a");return e.href="proxy.html",e.href}()}}),define("fonteditor/widget/Spliter",["require","common/lang","common/observable"],function(require){function e(e){e.onMouseDown=function(t){e.deltaX=e.x=t.pageX,e.cover.appendTo(document.body),$(window).on("mousemove",i).on("mouseup",r)};var t=n.throttle(function(t){var n=t.pageX-e.x,i=t.pageX-e.deltaX;if(e.deltaX=t.pageX,i)e.fire("change",{offset:n,delta:i})},200),i=function(e){t(e)},r=function(n){e.cover.remove(),t(n),$(window).off("mousemove",i).off("mouseup",r)};e.enable()}function t(t){this.main=$(t),this.cover=$('<div style="position:fixed;z-index: 100;width: 100%;height: 100%;left:0;top:0;cursor:e-resize"></div>'),e(this)}var n=require("common/lang");return t.prototype.enable=function(){if(!this.isEnabled)this.isEnabled=!0,this.main.css("cursor","e-resize").on("mousedown",this.onMouseDown);return this},t.prototype.disable=function(){if(this.isEnabled)delete this.isEnabled,this.main.css("cursor","").off("mousedown",this.onMouseDown);return this},t.prototype.dispose=function(){this.disable(),this.cover.remove(),this.main=this.cover=null},require("common/observable").mixin(t.prototype),t}),define("fonteditor/widget/Toolbar",["require","common/observable"],function(require){function e(e){for(var t={},n=0,i=e.length;n<i;n++)if(e[n])t[e[n]]=!0;return t}function t(){var e=this;this.main.on("click","[data-id]",function(t){if(!this.getAttribute("data-disabled")){var n=this.getAttribute("data-id"),i=e.commands[n];if(i){var r=i.name;if("toggle"===i.type){if(i.on)return this.removeAttribute("data-on"),i.on=!1,void e.fire("command:un",{command:r,args:i});this.setAttribute("data-on",1),i.on=!0}e.fire("command",{command:r,args:i})}}})}function n(e,n){if(n=n||{},this.main=$(e),this.commands=n.commands||[],t.call(this),this.commands.length)this.setCommands()}var i=require("common/observable");return n.prototype.setCommands=function(e){e=e||this.commands;var t="";return e.forEach(function(e,n){if("split"===e.type)t+='<li data-id="-1" data-split="1"></li>';else{if(t+='<li data-id="'+n+'"'+(e.disabled?' data-disabled="1"':"")+(e.on?' data-on="1"':"")+(e.ico?'data-theme="ico" title="'+e.title+'"':"")+">",e.ico)t+='<i class="ico i-'+e.ico+'"></i>';else t+=e.title+(e.quickKey?"(<i>"+e.quickKey+"</i>)":"");t+="</li>"}}),this.main.html(t),this.commands=e,this},n.prototype.disableCommands=function(t){var n=this.main.find("[data-id]");if(t)t=e(t),this.commands.forEach(function(e,i){if(t[e.name])e.disabled=!0,$(n[i]).attr("data-disabled",1)});return this},n.prototype.enableCommands=function(t){var n=this.main.find("[data-id]");if(t)t=e(t),this.commands.forEach(function(e,i){if(t[e.name])delete e.disabled,$(n[i]).attr("data-disabled",null)});return this},n.prototype.removeCommands=function(t){if(t){t=e(t);for(var n=this.commands.length;n>=0;n--){if(t[this.commands[n].name])this.commands.splice(n,1),this.main.find('[data-id="'+n+'"]').remove()}}return this},n.prototype.show=function(){return this.main.show(),this},n.prototype.hide=function(){return this.main.hide(),this},n.prototype.dispose=function(){this.main.un("click","[data-id]"),this.main=null,this.commands=null},i.mixin(n.prototype),n}),define("editor/i18n/zh-cn",["require"],function(require){return{copy:"复制",paste:"粘贴",cut:"剪切",del:"删除",save:"保存",undo:"撤销",redo:"重做",rangemode:"轮廓模式",pointmode:"点模式",order:"顺序",upshape:"上移一层",downshape:"下移一层",reversepoints:"改变方向",topshape:"置前",bottomshape:"置后",align:"水平方向",alignleft:"左对齐",aligncenter:"居中对齐",alignright:"右对齐",verticalalign:"垂直方向",alignshapes:"对齐形状",aligntop:"顶端对齐",alignmiddle:"垂直居中对齐",aligndescent:"底端对齐",alignbaseline:"基线对齐",rotateleft:"向左旋转",rotateright:"向右旋转",transform:"变换",flip:"翻转",mirror:"镜像",splitshapes:"切割轮廓",joinshapes:"结合",intersectshapes:"相交",tangencyshapes:"相切",removeshapes:"删除轮廓",adjustpos:"调整位置",adjustglyf:"调整字形",addpath:"添加路径",addshapes:"添加形状",circle:"圆",rect:"矩形",roundrect:"圆角矩形",star:"五角星",arrow:"箭头",triangle:"三角形",heart:"心形",tel:"电话",drop:"水滴",du:"度图标",setting:"设置",gridsorption:"吸附到网格线",shapesorption:"吸附到轮廓",showgrid:"显示网格",moresetting:"更多..",addreferenceline:"添加参考线",clearreferenceline:"清除参考线",addboundreferenceline:"添加边界参考线",rescale:"重置缩放",fontsetting:"字形信息",addpoint:"添加点",removepoint:"删除点",oncurve:"在曲线上",offcurve:"远离曲线",asstart:"作为开始点"}}),define("editor/i18n/en-us",["require"],function(require){return{copy:"Copy",paste:"Paste",cut:"Cut",del:"Del",save:"Save",undo:"Undo",redo:"Redo",rangemode:"Range Mode",pointmode:"Point Mode",order:"Order",upshape:"Bring Forward",downshape:"Send Back",reversepoints:"Change Direction",topshape:"Bring To Front",bottomshape:"Send To Back",align:"Horizontal Align",alignleft:"Align Left",aligncenter:"Align Center",alignright:"Align Right",verticalalign:"Vertical Align",alignshapes:"Align Shapes",aligntop:"Align Top",alignmiddle:"Align Middle",aligndescent:"Align Bottom",alignbaseline:"Align Baseline",rotateleft:"Rotate Left",rotateright:"Rotate Right",transform:"Transform",flip:"Flip",mirror:"Mirror",splitshapes:"Split Contours",joinshapes:"Join Contours",intersectshapes:"Intersection",tangencyshapes:"Tangency",removeshapes:"Remove",adjustpos:"Adjust Position",adjustglyf:"Adjust Glyph",addpath:"Add Contour",addshapes:"Add Shape",circle:"Circle",rect:"Rectangle",roundrect:"Rounded Rectangle",star:"Star",arrow:"Arrow",triangle:"Triangle",heart:"Heart",tel:"Tel",drop:"Drop",du:"Du Icon",setting:"Setting",gridsorption:"Adsorbed to Grid",shapesorption:"Adsorbed to Contour",showgrid:"Show Grid",moresetting:"More..",addreferenceline:"Add Reference Line",clearreferenceline:"Clear Reference Line",addboundreferenceline:"Bound Reference Line",rescale:"Rescale",fontsetting:"Font Setting",addpoint:"Add Point",removepoint:"Remove Point",oncurve:"On Curve",offcurv:"Off Curve",asstart:"First Point"}}),define("editor/i18n/i18n",["require","common/I18n","./zh-cn","./en-us"],function(require){return new(require("common/I18n"))([["zh-cn",require("./zh-cn")],["en-us",require("./en-us")]],window.language)}),define("fonteditor/menu/viewer",["require","editor/i18n/i18n","../i18n/i18n"],function(require){var e=require("editor/i18n/i18n"),t=require("../i18n/i18n");return[{name:"copy",title:e.lang.copy,quickKey:"C",disabled:!0},{name:"cut",title:e.lang.cut,quickKey:"X"},{name:"paste",title:e.lang.paste,quickKey:"V"},{name:"del",title:e.lang.del,quickKey:"D",disabled:!0},{type:"split"},{name:"adjust-pos",title:e.lang.adjustpos},{name:"adjust-glyf",title:e.lang.adjustglyf},{name:"setting-font",title:e.lang.fontsetting,disabled:!0},{type:"split"},{name:"find-glyf",title:t.lang.findglyf},{name:"download-glyf",title:t.lang.downloadglyf},{type:"split"},{name:"setting-unicode",title:t.lang.setunicode},{name:"setting-sync",title:t.lang.syncfont}]}),define("fonteditor/widget/Pager",["require","common/observable","../i18n/i18n"],function(require){function e(e,t){this.main=$(e),this.options=t||{},this.main.html(i),this.textPage=this.main.find('input[data-pager="text"]');var n=this;n.main.on("click","button[data-pager]",function(e){if(!this.getAttribute("data-disabled")){var t=this.getAttribute("data-pager"),i=n.page;if("prev"===t)i=n.page>1?n.page-1:1;else if("next"===t)i=n.page<n.totalPage?n.page+1:n.totalPage;else if("goto"===t){var r=+n.textPage.val();if(r>=1&&r<=n.totalPage)i=r;else i=n.page}if(n.textPage.val(i),i!==n.page)n.page=i,n.fire("change",{page:i})}}),n.textPage.on("keyup",function(e){if(13===e.keyCode){var t=+this.value.trim();if(t>=1&&t<=n.totalPage)n.page=t,n.fire("change",{page:t});else this.value=n.page}})}var t=require("common/observable"),n=require("../i18n/i18n"),i='<button data-pager="prev" type="button" class="btn btn-flat btn-new btn-sm">'+n.lang.prevpage+'</button><input data-pager="text" type="text" class="form-control"><span data-pager="info"></span><button data-pager="goto" type="button" class="btn btn-flat btn-new btn-sm">'+n.lang.gotopage+'</button><button data-pager="next" type="button" class="btn btn-flat btn-new btn-sm">'+n.lang.nextpage+"</button>";return e.prototype.show=function(e,t,n){if(n<=t)this.hide();else this.page=e,this.totalPage=Math.ceil(n/t),this.main.find('[data-pager="text"]').val(e),this.main.find('[data-pager="info"]').html("/ "+this.totalPage),this.main.find('[data-pager="prev"]')[1===e?"attr":"removeAttr"]("data-disabled",1),this.main.find('[data-pager="next"]')[e===this.totalPage?"attr":"removeAttr"]("data-disabled",1);this.main.show()},e.prototype.hide=function(){this.main.hide()},e.prototype.dispose=function(){this.main.un("click","button[data-pager]"),this.main.find('input[data-pager="text"]').un("keyup")},t.mixin(e.prototype),e}),define("render/capture/Mouse",["require","common/lang","common/observable"],function(require){function e(e){return e.offsetX||e.layerX||e.clientX}function t(e){return e.offsetY||e.layerY||e.clientY}function n(n){return{x:e(n),y:t(n),which:n.which,ctrlKey:n.ctrlKey||n.metaKey,metaKey:n.metaKey,altKey:n.altKey,shiftKey:n.shiftKey,originEvent:n}}function i(e){if(e.stopPropagation(),e.preventDefault)e.preventDefault();else e.returnValue=!1}function r(e){if(!1!==this.events.mousedown){i(e);var t=n(e);if(this.startX=t.x,this.startY=t.y,this.startTime=Date.now(),this.isDown=!0,this.fire("down",t),3===e.which)this.fire("rightdown",t);document.addEventListener("mouseup",this.handlers.mouseup,!1)}}function o(e){if(i(e),!1!==this.events.dblclick)this.fire("dblclick",n(e))}function a(e){if(!1!==this.events.mousemove){i(e);var t=n(e);if(this.fire("move",t),this.isDown&&!1!==this.events.drag){if(t.startX=this.startX,t.startY=this.startY,t.deltaX=t.x-this.startX,t.deltaY=t.y-this.startY,Math.abs(t.deltaX)>=this.dragDelta||Math.abs(t.deltaY)>=this.dragDelta)if(!this.isDragging)this.isDragging=!0,this.fire("dragstart",t);if(this.isDragging)this.fire("drag",t)}}}function s(e){if(!1!==this.events.mouseup){i(e);var t=n(e);if(t.time=Date.now()-this.startTime,this.fire("up",t),3===e.which)this.fire("rightup",t);if(this.isDown&&this.isDragging&&!1!==this.events.drag)t.deltaX=t.x-this.startX,t.deltaY=t.y-this.startY,this.isDragging=!1,this.fire("dragend",t);else if(this.isDown&&!this.isDragging&&!1!==this.events.click)this.isDragging=!1,this.fire("click",t);this.isDown=!1,document.removeEventListener("mouseup",this.handlers.mouseup)}}function l(e){if(!1!==this.events.mousewheel){i(e);var t=Date.now();if(!(this.lastWheel&&t-this.lastWheel<15)){this.lastWheel=t;var r=0;if(e.wheelDelta)r=e.wheelDelta%120==0?e.wheelDelta/120:e.wheelDelta/3;else if(e.detail)r=-e.detail/3;var o=n(e);o.delta=r,this.fire("wheel",o)}}}function u(e){if(!1!==this.events.mouseover)i(e),this.fire("over")}function f(e){if(!1!==this.events.mouseout)i(e),this.fire("out")}function c(e,t){this.main=e,t=t||{},this.events=t.events||{},this.dragDelta=2,this.handlers={mousewheel:d.bind(l,this),mousemove:d.bind(a,this),mousedown:d.bind(r,this),dblclick:d.bind(o,this),mouseover:d.bind(u,this),mouseout:d.bind(f,this),mouseup:d.bind(s,this)},this.start()}var d=require("common/lang"),h=require("common/observable");return c.prototype={constructor:c,start:function(){if(!this.listening){this.listening=!0;var e=this.main;e.addEventListener("DOMMouseScroll",this.handlers.mousewheel,!1),e.addEventListener("mousewheel",this.handlers.mousewheel,!1),e.addEventListener("mousemove",this.handlers.mousemove,!1),e.addEventListener("mousedown",this.handlers.mousedown,!1),e.addEventListener("dblclick",this.handlers.dblclick,!1),e.addEventListener("mouseover",this.handlers.mouseover,!1),e.addEventListener("mouseout",this.handlers.mouseout,!1)}return this},stop:function(){if(this.listening){this.listening=!1;var e=this.main;e.removeEventListener("DOMMouseScroll",this.handlers.mousewheel),e.removeEventListener("mousewheel",this.handlers.mousewheel),e.removeEventListener("mousemove",this.handlers.mousemove),e.removeEventListener("mousedown",this.handlers.mousedown),e.removeEventListener("click",this.handlers.click),e.removeEventListener("dblclick",this.handlers.dblclick),e.removeEventListener("mouseover",this.handlers.mouseover),e.removeEventListener("mouseout",this.handlers.mouseout),document.removeEventListener("mouseup",this.handlers.mouseup)}return this},isListening:function(){return!!this.listening},dispose:function(){this.stop(),this.un(),this.main=this.events=null}},h.mixin(c.prototype),c}),define("fonteditor/widget/DragSelector",["require","render/capture/Mouse"],function(require){function e(e){var t=[];return this.main.children().each(function(n,i){var r=$(i),o=r.offset(),a={x:o.left+r.width()/2,y:o.top+r.height()/2};if(a.x>=e.x&&a.x<=e.x+e.width&&a.y>=e.y&&a.y<=e.y+e.height)t.push(i)}),t}function t(){var t=this;t.capture=new i(t.main.get(0),{events:{dblclick:!1,mousewheel:!1,mouseover:!1,mouseout:!1}}),t.capture.on("dragstart",function(e){t.rangeElement.show(),t.main.addClass("no-hover"),t.startX=e.originEvent.pageX,t.startY=e.originEvent.pageY});var n=function(e){var n=e.originEvent.pageX,i=e.originEvent.pageY;t.rangeElement.css({left:Math.min(t.startX,n),top:Math.min(t.startY,i),width:Math.abs(t.startX-n),height:Math.abs(t.startY-i)})};t.capture.on("drag",n),t.capture.on("dragend",function(n){t.rangeElement.hide(),t.main.removeClass("no-hover");var i=n.originEvent.pageX,r=n.originEvent.pageY,o=Math.abs(t.startX-i),a=Math.abs(t.startY-r);if(!(o<20&&a<20))n.items=e.call(t,{x:Math.min(t.startX,i),y:Math.min(t.startY,r),width:o,height:a}),t.onSelect&&t.onSelect(n)})}function n(e,n){this.main=$(e),this.rangeElement=$(n.rangeElement||"#selection-range"),this.onSelect=n.onSelect,t.call(this)}var i=require("render/capture/Mouse");return n.prototype.dispose=function(){this.capture.dispose(),this.main=this.rangeElement=this.capture=null},n}),define("fonteditor/widget/glyfviewer/binder",["require","../../i18n/i18n","common/lang","../DragSelector","../program"],function(require){function e(e){var t=$(e.target),n=t.attr("data-action"),i=t.parent("[data-index]"),r=+i.attr("data-index"),o=this.getEditing();if("del"===n){if(!window.confirm(s.lang.msg_confirm_del_glyph))return;i.remove();var a=this.getSelected().indexOf(r);if(a>=0)this.selectedList.splice(a,1);if(r===o)this.setEditing(-1);this.fire("del",{list:[r]})}else if("edit"===n)this.fire("edit",{lastEditing:o,list:[r]})}function t(e){var t=e.items,n=e.ctrl,i=e.shiftKey;if(!n&&!i)this.main.children().removeClass("selected");t.forEach(function(e){if(n)$(e).toggleClass("selected");else $(e).addClass("selected")}),this.fire("selection:change")}function n(e){e.preventDefault(),e.stopPropagation()}function i(e){if(f.listening){var t=this;e.ctrl=e.ctrl||e.metaKey;var i;if(t.listening)if(65===e.keyCode&&e.ctrl)n(e),t.main.children().addClass("selected"),t.fire("selection:change");else if(90===e.keyCode&&e.ctrl)n(e),t.fire("undo");else if(89===e.keyCode&&e.ctrl)n(e),t.fire("redo");else if(27===e.keyCode)e.stopPropagation(),t.clearSelected(),t.clearEditing(),t.fire("selection:change");else if(37===e.keyCode)t.fire("moveleft");else if(39===e.keyCode)t.fire("moveright");else if(46===e.keyCode||88===e.keyCode&&e.ctrl){if(n(e),i=t.getSelected(),i.length){t.clearSelected();var r=i.indexOf(t.getEditing());if(r>=0)t.clearEditing();t.fire("selection:change"),t.fire(46===e.keyCode?"del":"cut",{list:i})}}else if(67===e.keyCode&&e.ctrl)if(n(e),i=t.getSelected(),i.length)t.fire("copy",{list:i})}}function r(){var t=this;t.main.on("click","[data-action]",l.bind(e,this)).on("dblclick","[data-index]",function(e){if(e.ctrl=e.ctrlKey||e.metaKey,!e.ctrl&&!e.shiftKey&&!e.target.getAttribute("data-action")&&"list"===t.mode){var n=$(this).attr("data-index");t.fire("edit",{lastEditing:t.getEditing(),list:[n]})}}).on("click","[data-index]",function(e){if(e.ctrl=e.ctrlKey||e.metaKey,!e.target.getAttribute("data-action")){var n=null,i=this,r=$(i);if(!e.ctrl&&!e.shiftKey){if("editor"===t.mode){var o=r.attr("data-index");t.fire("edit",{lastEditing:t.getEditing(),list:[o]})}if(n=t.main.find(".selected"),r.hasClass("selected")&&1===n.length&&n[0]===i)return;return n.removeClass("selected"),r.addClass("selected"),void t.fire("selection:change")}if(e.ctrl)return r.toggleClass("selected"),void t.fire("selection:change");else if(e.shiftKey)if(n=Array.prototype.slice.call(t.main.find(".selected")),r.addClass("selected"),!n.length)t.fire("selection:change");else if(-1===n.indexOf(i)){var a=+i.getAttribute("data-index"),s=null,l=0,u=4294967295;if(n.forEach(function(e){if((l=Math.abs(a-e.getAttribute("data-index")))<u)s=e,u=l}),u>1)for(s=a<+s.getAttribute("data-index")?i:s,l=1;l<u;l++)$(s=s.nextElementSibling).addClass("selected");t.fire("selection:change")}}}),t.downlistener=l.bind(i,this)}function o(){var e=[];return this.main.find(".selected").each(function(t,n){e.push(+n.getAttribute("data-index"))}),e}function a(){var e=this.commandMenu,t=this;t.on("selection:change",l.debounce(function(){var n=o.call(t);if(t.selectedList=n,n.length)e.enableCommands(["copy","cut","del"]),e[1===n.length?"enableCommands":"disableCommands"](["setting-font","download-glyf"]);else e.disableCommands(["copy","cut","del","setting-font","download-glyf"])},100));var n=l.debounce(function(){t.focus()},20);e.on("command",function(e){var i=e.command;if("paste"===i||"adjust-pos"===i||"adjust-glyf"===i)t.fire(i);else{var r=t.getSelected();if("cut"===i||"del"===i)t.clearSelected();t.fire(i,{list:r})}n()})}var s=require("../../i18n/i18n"),l=require("common/lang"),u=require("../DragSelector"),f=require("../program");return function(){if(r.call(this),this.dragSelector=new u(this.main,{onSelect:l.bind(t,this)}),this.options.commandMenu)this.commandMenu=this.options.commandMenu,delete this.options.commandMenu,a.call(this)}}),define("fonteditor-core/ttf/util/glyf2svg",["require","./contours2svg","./transformGlyfContours"],function(require){function e(e,i){if(!e)return"";var r=[];if(!e.compound){if(e.contours&&e.contours.length)r.push(t(e.contours))}else{var o=n(e,i);if(o&&o.length)r.push(t(o))}return r.join(" ")}var t=require("./contours2svg"),n=require("./transformGlyfContours");return e}),define("fonteditor/widget/glyfviewer/render",["require","fonteditor-core/ttf/util/glyf2svg","common/string","../../i18n/i18n"],function(require){var e=require("fonteditor-core/ttf/util/glyf2svg"),t=require("common/string"),n=require("../../i18n/i18n"),i='<div data-index="${index}" class="glyf-item ${compound} ${modify} ${selected} ${editing}"><i data-action="edit" class="ico i-edit" title="'+n.lang.edit+'"></i><i data-action="del" class="ico i-del" title="'+n.lang.del+'"></i><svg class="glyf" viewbox="0 0 ${unitsPerEm} ${unitsPerEm}"><g transform="scale(1, -1) translate(0, -${translateY}) scale(0.9, 0.9) "><path class="path" ${fillColor} ${d}/></g></svg><div data-field="unicode" class="unicode" title="${unicode}">${unicode}</div><div data-field="name" class="name" title="${name}">${name}</div></div>';return{render:function(n,r,o){var a={index:o.index,compound:n.compound?"compound":"",selected:o.selected?"selected":"",editing:o.editing?"editing":"",modify:n.modify,unitsPerEm:o.unitsPerEm,translateY:o.unitsPerEm+o.descent,unicode:(n.unicode||[]).map(function(e){return"$"+e.toString(16).toUpperCase()}).join(","),name:t.encodeHTML(n.name||""),fillColor:o.color?'style="fill:'+o.color+'"':""},s="";if(s=e(n,r))a.d='d="'+s+'"';return t.format(i,a)}}}),define("fonteditor/widget/glyfviewer/GLYFViewer",["require","common/lang","./binder","./render","common/observable"],function(require){function e(e){var t=e.head.unitsPerEm,n=e.hhea.descent,i={};(this.selectedList||[]).forEach(function(e){i[e]=!0});var r="",a=this.options.color,s=this.getEditing(),l=this.page*this.options.pageSize,u=l+this.options.pageSize,f=e.glyf.slice(l,u),c=o.render;f.forEach(function(o,u){var f=l+u;r+=c(o,e,{index:f,unitsPerEm:t,descent:n,selected:i[f],editing:s===f,color:a})}),this.main.html(r)}function t(e,t){var n=e.head.unitsPerEm,i=e.hhea.descent,r={};(this.selectedList||[]).forEach(function(e){r[e]=!0});var a=this.main,s=this.options.color,l=this.getEditing(),u=o.render;a.hide(),t.forEach(function(t){var o=u(e.glyf[t],e,{index:t,unitsPerEm:n,descent:i,selected:r[t],editing:l===t,color:s}),f=a.find('[data-index="'+t+'"]');if(f.length)$(o).insertBefore(f),f.remove()}),a.show()}function n(e,t){this.options=i.extend({color:"",shapeSize:"normal",pageSize:100},t),this.main=$(e),this.mode="list",this.page=0,this.selectedList=[],r.call(this)}var i=require("common/lang"),r=require("./binder"),o=require("./render");return n.prototype.focus=function(){if(!this.listening)this.listening=!0,document.body.addEventListener("keydown",this.downlistener)},n.prototype.blur=function(){if(this.listening)this.listening=!1,document.body.removeEventListener("keydown",this.downlistener)},n.prototype.setPage=function(e){this.page=e||0},n.prototype.getPage=function(){return this.page},n.prototype.show=function(t,n){if(n)this.setSelected(n);e.call(this,t),this.fire("selection:change")},n.prototype.refresh=function(n,i){if(!i||0===i.length)e.call(this,n);else t.call(this,n,i)},n.prototype.setSelected=function(e){this.selectedList=e||[]},n.prototype.getSelected=function(){return this.selectedList},n.prototype.clearSelected=function(){this.main.children().removeClass("selected"),this.selectedList=[]},n.prototype.getEditing=function(){return this.editingIndex>=0?this.editingIndex:-1},n.prototype.setEditing=function(e){if(this.clearEditing(),e=+e,this.editingIndex=e>=0?e:-1,-1!==e)this.main.find('[data-index="'+e+'"]').addClass("editing")},n.prototype.clearEditing=function(){this.main.find(".editing").removeClass("editing"),this.editingIndex=-1},n.prototype.setSetting=function(e){var t=this.options;if(e.shapeSize!==t.shapeSize)this.main.removeClass(t.shapeSize),this.main.addClass(e.shapeSize);var n=!1;if(e.color!==t.color)n=!0;if(e.pageSize!==t.pageSize)n=!0;if(this.options=i.overwrite(t,e),n)this.fire("refresh")},n.prototype.getSetting=function(){return this.options},n.prototype.setMode=function(e){if(this.mode=e||"list",this.commandMenu)this.commandMenu["list"===this.mode?"show":"hide"]()},require("common/observable").mixin(n.prototype),n}),define("fonteditor/menu/editor",["require","editor/i18n/i18n"],function(require){var e=require("editor/i18n/i18n");return[{name:"copyshapes",title:e.lang.copy,quickKey:"C",disabled:!0},{name:"pasteshapes",title:e.lang.paste,quickKey:"V"},{name:"removeshapes",title:e.lang.del,quickKey:"D",disabled:!0},{name:"save",title:e.lang.save,quickKey:"S"},{type:"split"},{name:"rangemode",title:e.lang.rangemode,ico:"rangemode"},{name:"pointmode",title:e.lang.pointmode,ico:"pointmode"},{type:"split"},{name:"upshape",title:e.lang.upshape,ico:"upshape",disabled:!0},{name:"downshape",title:e.lang.downshape,ico:"downshape",disabled:!0},{name:"reversepoints",title:e.lang.reversepoints,ico:"reversepoints",disabled:!0},{type:"split"},{name:"horizontalalignshapes",title:e.lang.alignleft,ico:"alignleft",align:"left",disabled:!0},{name:"horizontalalignshapes",title:e.lang.aligncenter,ico:"aligncenter",align:"center",disabled:!0},{name:"horizontalalignshapes",title:e.lang.alignright,ico:"alignright",align:"right",disabled:!0},{name:"verticalalignshapes",title:e.lang.aligntop,ico:"aligntop",align:"ascent",disabled:!0},{name:"verticalalignshapes",title:e.lang.alignmiddle,ico:"alignmiddle",align:"middle",disabled:!0},{name:"verticalalignshapes",title:e.lang.aligndescent,ico:"aligndescent",align:"descent",disabled:!0},{name:"verticalalignshapes",title:e.lang.alignbaseline,ico:"alignbaseline",align:"baseline",disabled:!0},{type:"split"},{name:"rotateleft",title:e.lang.rotateleft,ico:"rotateleft",disabled:!0},{name:"rotateright",title:e.lang.rotateright,ico:"rotateright",disabled:!0},{name:"flipshapes",title:e.lang.flip,ico:"flip",disabled:!0},{name:"mirrorshapes",title:e.lang.mirror,ico:"mirror",disabled:!0},{type:"split"},{name:"splitshapes",title:e.lang.splitshapes,ico:"splitshapes"},{name:"joinshapes",title:e.lang.joinshapes,ico:"joinshapes",disabled:!0},{name:"intersectshapes",title:e.lang.intersectshapes,ico:"intersectshapes",disabled:!0},{name:"tangencyshapes",title:e.lang.tangencyshapes,ico:"tangencyshapes",disabled:!0}]}),define("render/util/guid",["require"],function(require){function e(e){return(e||"render")+"-"+t++}var t=0;return e}),define("render/Layer",["require","./util/guid","common/lang","graphics/computeBoundingBox"],function(require){function e(e){return e=e||{},e.id=e.id||i("shape"),e.type=e.type||"circle",e.layerId=this.id,e}function t(e,t){e.fillStyle=t.fillColor||"black",e.strokeStyle=t.strokeColor||"black",e.lineWidth=t.lineWidth||1,e.font=t.font||"normal 10px arial"}function n(e,t){this.context=e,this.options=r.extend({stroke:!0,fill:!0,thin:!0},t),this.painter=this.options.painter,this.id=this.options.id||i("layer"),this.level=this.options.level,this.shapes=[],this.disabled=!1}var i=require("./util/guid"),r=require("common/lang"),o=require("graphics/computeBoundingBox");return n.prototype={constructor:n,refresh:function(){var e=this.painter.support,n=this.context,i=this.options,r=this.painter.camera;if(n.clearRect(0,0,this.painter.width,this.painter.height),t(n,i),!1!==i.thin)n.translate(-.5,-.5);n.beginPath();for(var o,a,s=this.shapes,l=0,u=s.length;l<u;l++)if(o=s[l],!0!==o.disabled)if(a=e[o.type]){if(1!==r.ratio)a.adjust(o,r);if(o.style){if(!1!==i.fill)n.fill();if(!1!==i.stroke)n.stroke();if(n.beginPath(),t(n,o.style),a.draw(n,o,r),!1!==i.fill||o.style.fill)n.fill();if(!1!==i.stroke||o.style.stroke)n.stroke();t(n,i),n.beginPath()}else a.draw(n,o,r)}if(!1!==i.fill)n.fill();if(!1!==i.stroke)n.stroke();if(!1!==i.thin)n.translate(.5,.5);return this},getShape:function(e){if("string"==typeof e)return this.shapes.filter(function(t){return t.id===e})[0];else if("number"==typeof e)return this.shapes[e];else if("object"==typeof e)return e},addShape:function(t,n){if("string"==typeof t)return n=n||{},n.type=t,t=e.call(this,n),this.shapes.push(t),t;else if("object"==typeof t)return this.shapes.push(t),t;throw"add shape faild"},removeShape:function(e){var t=-1;if("object"==typeof e)t=this.shapes.indexOf(e);else if("string"==typeof e){for(var n=0,i=this.shapes.length;n<i;n++)if(e===this.shapes[n].id){t=n;break}}else if("number"==typeof e)t=e;else throw"need shape id to be removed";if(t>=0&&t<this.shapes.length)return this.shapes.splice(t,1),!0;else return!1},clearShapes:function(){return this.shapes.length=0,this.shapes=[],this},getShapeIn:function(e){for(var t=this.painter.support,n=this.shapes,i=[],r=0,o=n.length;r<o;r++)if(!1!==n[r].selectable&&t[n[r].type].isIn(n[r],e.x,e.y))i.push(n[r]);return i.length?i:!1},adjust:function(e){var t=[];if(e)e=this.getShape(e),t.push(e);else t=this.shapes;for(var n,i=this.painter.support,r=this.painter.camera,o=0,a=t.length;o<a;o++)if(e=t[o],n=i[e.type])if(1!==r.ratio)n.adjust(e,r);return this},move:function(e,t,n){var i=[];if(n)n=this.getShape(n),i.push(n);else i=this.shapes;for(var r,o=this.painter.support,a=0,s=i.length;a<s;a++)if(n=i[a],r=o[n.type])r.move(n,e,t);return this},moveTo:function(e,t,n){var i=[];if(n)n=this.getShape(n),i.push(n);else i=this.shapes;var r,o=this.painter.support,a=this.getBound(i);if(a)for(var s=e-(a.x+a.width/2),l=t-(a.y+a.height/2),u=0,f=i.length;u<f;u++)if(n=i[u],r=o[n.type])r.move(n,s,l);return this},getBound:function(e){if(e=e||this.shapes,0===e.length)return!1;for(var t,n,i=[],r=this.painter.support,a=0,s=e.length;a<s;a++)if(t=e[a],n=r[t.type])if(void 0!==t.x&&void 0!==t.y)i.push(t);else{var l=n.getRect(t);if(l)i.push(l),i.push({x:l.x+l.width,y:l.y+l.height})}return o.computeBounding(i)},createShape:function(t){return e.call(this,t)},dispose:function(){this.main=this.painter=this.context=this.options=null,this.shapes.length=0,this.shapes=null}},n}),define("render/shape/Shape",["require","common/lang"],function(require){function e(e){e=e||{}}function t(e){return n.clone(e)}var n=require("common/lang");return e.prototype={constructor:e,adjust:function(e,t){var n=t.center,i=t.ratio;if("number"==typeof e.x)e.x=i*(e.x-n.x)+n.x;if("number"==typeof e.y)e.y=i*(e.y-n.y)+n.y;if("number"==typeof e.width)e.width=i*e.width;if("number"==typeof e.width)e.height=i*e.height;if("number"==typeof e.r)e.r=i*e.r;return e},move:function(e,t,n){if("number"==typeof e.x)e.x+=t;if("number"==typeof e.y)e.y+=n;return e},getRect:function(e){return!1},isIn:function(e,t,n){return!1},draw:function(e,t,n){},dispose:function(){}},e.derive=function(t){function i(){e.apply(this,arguments)}return i.prototype=t,n.inherits(i,e),i},e.clone=t,e}),define("render/shape/Circle",["require","./Shape"],function(require){var e={type:"circle",getRect:function(e){return{x:e.x-e.r,y:e.y-e.r,width:2*e.r,height:2*e.r}},isIn:function(e,t,n){return Math.pow(e.x-t,2)+Math.pow(e.y-n,2)<=Math.pow(e.r,2)},draw:function(e,t){e.moveTo(t.x+t.r,t.y),e.arc(t.x,t.y,t.r,0,2*Math.PI,!0)}};return require("./Shape").derive(e)}),define("render/shape/CirclePoint",["require","./Shape"],function(require){var e=2,t={type:"cpoint",getRect:function(t){var n=t.size||e;return{x:t.x-n,y:t.y-n,width:2*n,height:2*n}},isIn:function(t,n,i){var r=t.size||e;return Math.pow(t.x-n,2)+Math.pow(t.y-i,2)<=Math.pow(2*r,2)},draw:function(t,n){var i=n.size||e,r=Math.round(n.x),o=Math.round(n.y);t.moveTo(r+i,o),t.arc(r,o,i,0,2*Math.PI,!0)}};return require("./Shape").derive(t)}),define("render/shape/Point",["require","./Shape"],function(require){var e=6,t={type:"point",getRect:function(t){var n=t.size||e;return{x:t.x-n/2,y:t.y-n/2,width:n,height:n}},isIn:function(t,n,i){var r=t.size||e,o=r,a=r;return n<=t.x+o&&n>=t.x-o&&i<=t.y+a&&i>=t.y-a},draw:function(t,n){var i=Math.round(n.x),r=Math.round(n.y),o=n.size||e,a=o/2,s=o/2;t.moveTo(i-a,r-s),t.lineTo(i+a,r-s),t.lineTo(i+a,r+s),t.lineTo(i-a,r+s),t.lineTo(i-a,r-s)}};return require("./Shape").derive(t)}),define("render/util/dashedLineTo",["require"],function(require){function e(e,t,n,i,r,o){o="number"!=typeof o?2:o;var a=i-t,s=r-n,l=Math.floor(Math.sqrt(a*a+s*s)/o);a/=l,s/=l;for(var u=!0,f=0;f<l;++f){if(u)e.moveTo(t,n);else e.lineTo(t,n);u=!u,t+=a,n+=s}e.lineTo(i,r)}return e}),define("render/shape/Rect",["require","../util/dashedLineTo","./Shape"],function(require){var e=require("../util/dashedLineTo"),t={type:"rect",getRect:function(e){return e},isIn:function(e,t,n){var i=e.width,r=e.height;return t<=e.x+i&&t>=e.x&&n<=e.y+r&&n>=e.y},draw:function(t,n){var i=Math.round(n.x),r=Math.round(n.y),o=Math.round(n.width),a=Math.round(n.height);if(n.dashed)e(t,i,r,i+o,r),e(t,i+o,r,i+o,r+a),e(t,i+o,r+a,i,r+a),e(t,i,r+a,i,r);else t.moveTo(i,r),t.lineTo(i+o,r),t.lineTo(i+o,r+a),t.lineTo(i,r+a),t.lineTo(i,r)}};return require("./Shape").derive(t)}),define("graphics/util",["require","fonteditor-core/graphics/util"],function(require){return require("fonteditor-core/graphics/util")}),define("graphics/isBoundingBoxCross",["require","./util"],function(require){function e(e,n){var i=t(n,e,!0),r=t(n,{x:e.x+e.width,y:e.y},!0),o=t(n,{x:e.x,y:e.y+e.height},!0),a=t(n,{x:e.x+e.width,y:e.y+e.height},!0);if(i&&r&&o&&a)return 2;var s=t(e,n,!0),l=t(e,{x:n.x+n.width,y:n.y},!0),u=t(e,{x:n.x,y:n.y+n.height},!0),f=t(e,{x:n.x+n.width,y:n.y+n.height},!0);if(s&&l&&u&&f)return 3;if(!1===(i||r||o||a||s||l||u||f))if(e.x>n.x&&e.x<n.x+n.width||e.y>n.y&&e.y<n.y+n.height)return 1;else return!1;return 1}var t=require("./util").isPointInBound;return e}),define("graphics/matrix",["require"],function(require){function e(e,t){return e.map(function(e){return e*t})}function t(e,t){return e.map(function(e,n){return e-t[n]})}function n(e,t){return e.map(function(e,n){return e+t[n]})}return{multi:e,minus:t,plus:n}}),define("graphics/isSegmentCross",["require","./isBoundingBoxCross","./util","./matrix"],function(require){function e(e,t,n,i,r){var o=[e,t,n,i].sort(function(e,t){return e[r]<t[r]?-1:1}),a=[];if(o[0][r]===o[1][r])a.push(o[0]),a.push(o[2]);else if(o[2][r]===o[3][r])a.push(o[1]),a.push(o[3]);else if(a.push(o[1]),o[1][r]!==o[2][r])a.push(o[2]);return a}function t(t,o,l,u){var f,c,d;if(o.x<t.x)f=o,o=t,t=f;if(u.x<l.x)f=u,u=l,l=f;var h={x:Math.min(t.x,o.x),y:Math.min(t.y,o.y),width:Math.abs(t.x-o.x),height:Math.abs(t.y-o.y)},p={x:Math.min(l.x,u.x),y:Math.min(l.y,u.y),width:Math.abs(l.x-u.x),height:Math.abs(l.y-u.y)};if(n(h,p)){var g=[o.y-t.y,-(o.x-t.x),t.y*(o.x-t.x)-t.x*(o.y-t.y)],m=[u.y-l.y,-(u.x-l.x),l.y*(u.x-l.x)-l.x*(u.y-l.y)];if(g[0]===g[1]&&g[0]===g[2]&&0===g[0])if(Math.abs((u.y-t.y)*(l.x-t.x)-(l.y-t.y)*(u.x-t.x))<=.001&&t.x>=l.x&&t.x<=u.x)return[t];else return!1;if(m[0]===m[1]&&m[0]===m[2]&&0===m[0])if(Math.abs((o.y-l.y)*(t.x-l.x)-(t.y-l.y)*(o.x-l.x))<=.001&&l.x>=t.x&&l.x<=o.x)return[l];else return!1;if(g[1]===m[1]&&0===g[1])if(o.x===u.x)return e(t,o,l,u,"y");else return!1;else if(g[0]===m[0]&&0===g[0])if(o.y===u.y)return e(t,o,l,u,"x");else return!1;else if(g[0]*m[1]==g[1]*m[0])if(g[1]*m[2]==g[2]*m[1])return e(t,o,l,u,"x");else return!1;var y=s(a(g,m[0]),a(m,g[0]));if(d=-y[2]/y[1],0!==g[0])c=-(g[2]+g[1]*d)/g[0];else c=-(m[2]+m[1]*d)/m[0];if(f=i({x:c,y:d}),r(h,f,!0)&&r(p,f,!0))return[f]}return!1}var n=require("./isBoundingBoxCross"),i=require("./util").ceilPoint,r=require("./util").isPointInBound,o=require("./matrix"),a=o.multi,s=o.minus;return t}),define("graphics/isSegmentRayCross",["require","./isSegmentCross"],function(require){function e(e,n,i){return t(e,n,i,{x:1e5,y:i.y})}var t=require("./isSegmentCross");return e}),define("graphics/isInsidePolygon",["require","./isSegmentRayCross"],function(require){function e(e,n){for(var i,r,o,a=0,s=0,l=e.length;s<l;s++)if(i=e[s],r=e[s===l-1?0:s+1],o=t(i,r,n)){if(o.y===n.y)return!0;a+=o.length}return!!(a%2)}var t=require("./isSegmentRayCross");return e}),define("render/shape/Polygon",["require","../util/dashedLineTo","graphics/pathAdjust","graphics/computeBoundingBox","graphics/isInsidePolygon","./Shape"],function(require){var e=require("../util/dashedLineTo"),t=require("graphics/pathAdjust"),n=require("graphics/computeBoundingBox"),i=require("graphics/isInsidePolygon"),r={type:"polygon",adjust:function(e,n){var i=n.ratio,r=n.center.x,o=n.center.y;t(e.points,i,i,-r,-o),t(e.points,1,1,r,o)},move:function(e,n,i){return t(e.points,1,1,n,i),e},getRect:function(e){return n.computeBounding(e.points)},isIn:function(e,t,r){var o=n.computeBounding(e.points);if(t<=o.x+o.width&&t>=o.x&&r<=o.y+o.height&&r>=o.y)return i(e.points,{x:t,y:r});else return!1},draw:function(t,n){var i=n.points;if(i&&!(i.length<2)){var r=0,o=i.length;if(n.dashed){for(;r<o-1;r++)e(t,Math.round(i[r].x),Math.round(i[r].y),Math.round(i[r+1].x),Math.round(i[r+1].y));e(t,Math.round(i[o-1].x),Math.round(i[o-1].y),Math.round(i[0].x),Math.round(i[0].y))}else{for(t.moveTo(Math.round(i[0].x),Math.round(i[0].y)),r=1;r<o;r++)t.lineTo(Math.round(i[r].x),Math.round(i[r].y));t.lineTo(Math.round(i[0].x),Math.round(i[0].y))}}}};return require("./Shape").derive(r)}),define("graphics/pathIterator",["require","fonteditor-core/graphics/pathIterator"],function(require){return require("fonteditor-core/graphics/pathIterator")}),define("math/quadraticEquation",["require"],function(require){function e(e,t,n){if(0===e)return[-n/t];var i,r;if(0===t){if(0===n)return[0];if(e>0&&n<0||e<0&&n>0)return r=Math.sqrt(-n/e),[r,-r];else return!1}if(0===n)return[0,-t/e];var o=Math.pow(t,2)-4*e*n;if(o>=0)if(i=(-t+Math.sqrt(o,2))/e/2,r=(-t-Math.sqrt(o,2))/e/2,i===r)return[i];else return[i,r];return!1}return e}),define("math/bezierQ2Equation",["require","./quadraticEquation"],function(require){function e(e,n,i){var r=t(e,n,i);if(!r)return r;var o=r.filter(function(e){return e>=0&&e<=1});return o.length?o:!1}var t=require("./quadraticEquation");return e}),define("graphics/isBezierLineCross",["require","../math/bezierQ2Equation","./util"],function(require){function e(e,i,r,o,a){var s;if(o.y===a.y)s=t(e.y+r.y-2*i.y,2*(i.y-e.y),e.y-o.y);else if(o.x===a.x)s=t(e.x+r.x-2*i.x,2*(i.x-e.x),e.x-o.x);else{var l=(a.y-o.y)/(a.x-o.x),u=o.y-l*o.x,f=e.x+r.x-2*i.x,c=2*(i.x-e.x),d=e.x,h=e.y+r.y-2*i.y,p=2*(i.y-e.y),g=e.y;s=t(l*f-h,l*c-p,l*d+u-g)}if(s)return s.sort(function(e,t){return e-t}).map(function(t){return n({x:e.x*Math.pow(1-t,2)+2*i.x*t*(1-t)+r.x*Math.pow(t,2),y:e.y*Math.pow(1-t,2)+2*i.y*t*(1-t)+r.y*Math.pow(t,2)})});else return!1}var t=require("../math/bezierQ2Equation"),n=require("./util").ceilPoint;return e}),define("graphics/isBezierRayCross",["require","./isBezierLineCross"],function(require){function e(e,n,i,r){if(0==((e.y>r.y)+(n.y>r.y)+(i.y>r.y))%3)return!1;var o=t(e,n,i,r,{x:1e5,y:r.y});if(o){var a=o.filter(function(e){return e.x>=r.x});return a.length?a:!1}return!1}var t=require("./isBezierLineCross");return e}),define("graphics/isInsidePath",["require","./pathIterator","./isBezierRayCross","./isSegmentRayCross"],function(require){function e(e,r){var o,a=0;return t(e,function(e,t,s,l){if("L"===e){if(o=i(t,s,r)){if(2===o.length){if(r.x>=Math.min(o[0].x,o[1].x)&&r.x<=Math.max(o[0].x,o[1].x))return a=1,!1;return}if(o[0].x===r.x)return a=1,!1;if(s.y>t.y)a--;else a++}}else if("Q"===e){var u=null,f=null;if(o=n(t,s,l,r)){if(o[0].x===r.x||o[1]&&o[1].x===r.x)return a=1,!1;if(2===o.length)return;if(o=o[0],o.y>t.y&&o.y<s.y)u=t,f=s;else u=s,f=l;if(f.y>u.y)a--;else a++}}}),!!a}var t=require("./pathIterator"),n=require("./isBezierRayCross"),i=require("./isSegmentRayCross");return e}),define("render/shape/Font",["require","./Shape","graphics/isInsidePath","graphics/pathAdjust","../util/drawPath","graphics/computeBoundingBox"],function(require){var e=require("./Shape"),t=require("graphics/isInsidePath"),n=require("graphics/pathAdjust"),i=require("../util/drawPath"),r=require("graphics/computeBoundingBox"),o={type:"font",adjust:function(e,t){for(var i=t.ratio,r=t.center.x,o=t.center.y,a=e.contours,s=0,l=a.length;s<l;s++)n(a[s],i,i,-r,-o),n(a[s],1,1,r,o);return e},move:function(e,t,i){for(var r=e.contours,o=0,a=r.length;o<a;o++)n(r[o],1,1,t,i);return e},getRect:function(e){return r.computePath.apply(null,e.contours)},isIn:function(e,n,i){var o=r.computePath.apply(null,e.contours);if(n<=o.x+o.width&&n>=o.x&&i<=o.y+o.height&&i>=o.y)for(var a=e.contours,s=0,l=a.length;s<l;s++)if(t(a[s],{x:n,y:i}))return!0;return!1},draw:function(e,t){for(var n=t.contours,r=0,o=n.length;r<o;r++)i(e,n[r])}};return e.derive(o)}),define("render/shape/Path",["require","graphics/isInsidePath","graphics/pathAdjust","../util/drawPath","graphics/computeBoundingBox","./Shape"],function(require){var e=require("graphics/isInsidePath"),t=require("graphics/pathAdjust"),n=require("../util/drawPath"),i=require("graphics/computeBoundingBox"),r={type:"path",adjust:function(e,n){var i=n.ratio,r=n.center.x,o=n.center.y;t(e.points,i,i,-r,-o),t(e.points,1,1,r,o)},move:function(e,n,i){return t(e.points,1,1,n,i),e},getRect:function(e){return i.computePath(e.points)},isIn:function(t,n,r){var o=i.computePath(t.points);if(n<=o.x+o.width&&n>=o.x&&r<=o.y+o.height&&r>=o.y)return e(t.points,{x:n,y:r});else return!1},draw:function(e,t){n(e,t.points)}};return require("./Shape").derive(r)}),define("render/util/drawAxis",["require","./dashedLineTo"],function(require){function e(e,n){var i,r=Math.round(n.graduation.gap*n.scale),o=Math.round(e.canvas.width+r),a=Math.round(e.canvas.height+r),s=Math.round(n.x),l=Math.round(n.y);if(!1!==n.showGrid){for(e.beginPath(),e.strokeStyle=n.gapColor||"#A6A6FF",i=l;i<a;i+=r)e.moveTo(0,i),e.lineTo(o,i);for(i=l;i>0;i-=r)e.moveTo(0,i),e.lineTo(o,i);for(i=s;i<o;i+=r)e.moveTo(i,0),e.lineTo(i,a);for(i=s;i>0;i-=r)e.moveTo(i,0),e.lineTo(i,a);e.stroke()}e.beginPath(),e.strokeStyle=n.metricsColor||"#FF6E67";var u=n.metrics,f=n.graduation.thickness||22,c=Object.keys(u);c.forEach(function(n){var i=l-Math.round(u[n]);t(e,0,i,o,i,4)}),e.stroke(),e.beginPath(),e.strokeStyle=n.axisColor||"red",e.moveTo(0,l),e.lineTo(o,l),e.moveTo(s,0),e.lineTo(s,a),e.stroke(),e.save(),e.scale(.8,.8),c.forEach(function(t){e.fillText(t,1.25*f,1.25*(l-u[t])-2)}),e.fillText("Baseline",1.25*f,1.25*l-2),e.restore()}var t=require("./dashedLineTo");return e}),define("render/shape/Axis",["require","../util/drawAxis","./Shape"],function(require){var e=require("../util/drawAxis"),t={type:"axis",adjust:function(e,t){var n=t.center,i=t.ratio;e.unitsPerEm*=i;var r=e.metrics;return Object.keys(r).forEach(function(e){r[e]*=i}),e.x=i*(e.x-n.x)+n.x,e.y=i*(e.y-n.y)+n.y,e},isIn:function(e,t,n){return!1},getBound:function(e){return{x:e.x,y:e.y,width:0,height:0}},draw:function(t,n,i){n.scale=i.scale,t.save(),e(t,n),t.restore(),t.beginPath()}};return require("./Shape").derive(t)}),define("render/util/drawGraduation",["require"],function(require){function e(e,t){var n=Math.round(t.x),i=Math.round(t.y),r=e.canvas.width,o=e.canvas.height,a=t.graduation.thickness||20,s=t.graduation.markHeight||3;e.beginPath(),e.fillStyle=t.graduation.markBackgroundColor||"#EEE",e.fillRect(0,0,r,a),e.fillRect(0,0,a,o),e.fill(),e.strokeStyle=t.graduation.markColor||"#000",e.moveTo(a,0),e.lineTo(a,o),e.moveTo(0,a),e.lineTo(r,a),e.stroke();var l,u,f,c,d,h=t.graduation.gap,p=t.graduation.gap*t.scale;if(h>=p)l=h/p,u=Math.floor(l)*h/20,f=h/20*Math.floor(l)/l;else{if(l=p/h,(u=Math.floor(h/20/l))>=2)u=2*Math.floor(u/2);else u=1;f=u*l}for(e.fillStyle=e.strokeStyle,c=n,d=0;c<r;d++,c+=f)e.moveTo(c,a-(d%5?s:2*s)),e.lineTo(c,a);for(c=n,d=0;c>a;d++,c-=f)e.moveTo(c,a-(d%5?s:2*s)),e.lineTo(c,a);var g=0;for(c=i,d=0;c>a;d++,c-=f)e.moveTo(a-(d%5?s:2*s),c),e.lineTo(a,c);for(c=i,d=0;c<o;d++,c+=f)e.moveTo(a-(d%5?s:2*s),c),e.lineTo(a,c);for(e.save(),e.fillStyle=t.graduation.color||"#000",e.scale(.8,.8),g=a-8,c=n,d=0;c<r;d++,c+=f)if(0==d%10)e.fillText(Math.ceil(u*d),1.25*c-3,1.25*g);for(c=n,d=0;c>a;d++,c-=f)if(0==d%10)e.fillText(Math.ceil(-u*d),1.25*c-3,1.25*g);for(g=0,c=i,d=0;c>a;d++,c-=f)if(0==d%10)e.fillText(Math.ceil(u*d),1.25*g,1.25*c+3);for(c=i,d=0;c<o;d++,c+=f)if(0==d%10)e.fillText(Math.ceil(-u*d),1.25*g,1.25*c+3);e.restore(),e.stroke()}return e}),define("render/shape/Graduation",["require","../util/drawGraduation","./Shape"],function(require){var e=require("../util/drawGraduation"),t={type:"graduation",adjust:function(e,t){return e},isIn:function(e,t,n){return!1},draw:function(t,n,i){n.scale=i.scale,t.save(),e(t,n.config),t.restore(),t.beginPath()}};return require("./Shape").derive(t)}),define("render/shape/Line",["require","../util/dashedLineTo","graphics/computeBoundingBox","./Shape"],function(require){var e=require("../util/dashedLineTo"),t=require("graphics/computeBoundingBox"),n={type:"line",adjust:function(e,t){var n=t.center,i=t.ratio;if(void 0!==e.p0.x)e.p0.x=i*(e.p0.x-n.x)+n.x;else e.p0.y=i*(e.p0.y-n.y)+n.y;if(void 0!==e.p1)e.p1.x=i*(e.p1.x-n.x)+n.x,e.p1.y=i*(e.p1.y-n.y)+n.y;return e},move:function(e,t,n){if(void 0!==e.p0.x)e.p0.x+=t;else e.p0.y+=n;if(void 0!==e.p1)e.p1.x+=t,e.p1.y+=n;return e},getRect:function(e){return void 0===e.p1?!1:t.computeBounding([e.p0,e.p1])},isIn:function(e,t,n){if(void 0===e.p1)return void 0!==e.p0.x&&Math.abs(e.p0.x-t)<4||void 0!==e.p0.y&&Math.abs(e.p0.y-n)<4;var i=e.p0.x;return(n-e.p0.y)*(t-e.p1.x)==(n-e.p1.y)*(t-i)},draw:function(t,n){var i,r,o,a;if(void 0===n.p1)if(void 0!==n.p0.x)i=Math.round(n.p0.x),t.moveTo(i,0),t.lineTo(i,t.canvas.height);else r=Math.round(n.p0.y),t.moveTo(0,r),t.lineTo(t.canvas.width,r);else if(i=Math.round(n.p0.x),r=Math.round(n.p0.y),o=Math.round(n.p1.x),a=Math.round(n.p1.y),n.dashed)e(t,i,r,o,a);else t.moveTo(i,r),t.lineTo(o,a)}};return require("./Shape").derive(n)}),define("render/shape/BezierCurve",["require","graphics/isInsidePath","graphics/pathAdjust","graphics/computeBoundingBox","./Shape"],function(require){var e=require("graphics/isInsidePath"),t=require("graphics/pathAdjust"),n=require("graphics/computeBoundingBox"),i={type:"beziercurve",adjust:function(e,n){var i=n.ratio,r=n.center.x,o=n.center.y;t(e.points,i,i,-r,-o),t(e.points,1,1,r,o)},move:function(e,n,i){return t(e.points,1,1,n,i),e},getRect:function(e){return n.computePath(e.points)},isIn:function(t,i,r){var o=n.computePath(t.points);if(i<=o.x+o.width&&i>=o.x&&r<=o.y+o.height&&r>=o.y)return e(t.points,{x:i,y:r});else return!1},draw:function(e,t){var n=t.points;if(3===n.length)e.moveTo(n[0].x,n[0].y),e.quadraticCurveTo(n[1].x,n[1].y,n[2].x,n[2].y);else if(4===n.length)e.moveTo(n[0].x,n[0].y),e.bezierCurveTo(n[1].x,n[1].y,n[2].x,n[2].y,n[3].x,n[3].y)}};return require("./Shape").derive(i)}),define("render/shape/GridArrow",["require","./Shape"],function(require){var e=6,t=3,n={type:"gridarrow",adjust:function(e,t){var n=t.center,i=t.ratio;if(void 0!==e.p0.x)e.p0.x=i*(e.p0.x-n.x)+n.x;else e.p0.y=i*(e.p0.y-n.y)+n.y;return e},move:function(e,t,n){if(void 0!==e.p0.x)e.p0.x+=t;else e.p0.y+=n;return e},getRect:function(e){return!1},isIn:function(e,t,n){return void 0!==e.p0.x&&Math.abs(e.p0.x-t)<4||void 0!==e.p0.y&&Math.abs(e.p0.y-n)<4},draw:function(n,i){if(void 0!==i.p0.x){if(x0=Math.round(i.p0.x),n.moveTo(x0,0),n.lineTo(x0,n.canvas.height),i.arrow)n.moveTo(x0,i.arrow.y),n.lineTo(x0-t,i.arrow.y+e),n.lineTo(x0+t,i.arrow.y+e),n.lineTo(x0,i.arrow.y)}else if(y0=Math.round(i.p0.y),n.moveTo(0,y0),n.lineTo(n.canvas.width,y0),i.arrow)n.moveTo(i.arrow.x,y0),n.lineTo(i.arrow.x+e,y0-t),n.lineTo(i.arrow.x+e,y0+t),n.lineTo(i.arrow.x,y0)}};return require("./Shape").derive(n)}),define("render/shape/support",["require","./Circle","./CirclePoint","./Point","./Rect","./Polygon","./Font","./Path","./Axis","./Graduation","./Line","./BezierCurve","./GridArrow"],function(require){return{circle:require("./Circle"),cpoint:require("./CirclePoint"),point:require("./Point"),rect:require("./Rect"),polygon:require("./Polygon"),font:require("./Font"),path:require("./Path"),axis:require("./Axis"),graduation:require("./Graduation"),line:require("./Line"),beziercurve:require("./BezierCurve"),gridarrow:require("./GridArrow")}}),define("render/Camera",["require"],function(require){function e(e,t,n){this.reset(e,t,n)}return e.prototype.reset=function(e,t,n){this.center=e||{x:0,y:0},this.scale=t||1,this.ratio=n||1},e.prototype.dispose=function(){this.center=this.ratio=this.scale=null},e}),define("render/Painter",["require","./util/guid","./Layer","common/getPixelRatio","./shape/support","./Camera","graphics/computeBoundingBox"],function(require){function e(e){var t=document.createElement("canvas"),n=e.level||1;if(t.id=e.id,t.width=e.width,t.height=e.height,t.style.position="absolute",t.style.zIndex=n>u?1:n,e.background)t.style.background=e.background;return t}function t(t){t=t||{},t.id=t.id||i("layer"),t.width=this.width,t.height=this.height,t.level=t.level||1,t.painter=this;var n=e(t);return this.main.appendChild(n),new r(n.getContext("2d"),t)}function n(e,t){this.main=e,this.options=t||{},this.layers=[],this.main.style.position="relative",this.resetSize(),this.camera=new s({x:this.width/2,y:this.height/2});var n={};Object.keys(a).forEach(function(e){n[e]=new a[e]}),this.support=n}var i=require("./util/guid"),r=require("./Layer"),o=require("common/getPixelRatio"),a=require("./shape/support"),s=require("./Camera"),l=require("graphics/computeBoundingBox"),u=1e4;return n.prototype={constructor:n,addSupport:function(e){if(this.support[e.type])throw"exist the same shape type";return this.support[e.type]=e,this},refresh:function(){return this.layers.forEach(function(e){e.refresh()}),this},getLayer:function(e){if("string"==typeof e)return this.layers.filter(function(t){return t.id===e})[0];else if("number"==typeof e)return this.layers[e];else if("object"==typeof e)return e},addLayer:function(e,n){if(e instanceof r)return this.layers.push(e),e;else if("string"==typeof e)return n=n||{},n.id=e,e=t.call(this,n),this.layers.push(e),e;throw"add layer faild"},removeLayer:function(e){var t=-1;if(e instanceof r)t=this.layers.indexOf(e);else if("string"==typeof e){for(var n=0,i=this.layers.length;n<i;n++)if(e===this.layers[n].id){t=n;break}}else if("number"==typeof t)t=t;else throw"need layer id to be removed";if(t>=0&&t<this.layers.length)return e=this.layers[t],e.dispose(),this.main.removeChild(document.getElementById(e.id)),this.layers.splice(t,1),!0;else return!1},getShapeIn:function(e){for(var t=this.layers.filter(function(e){return!e.disabled}),n=0,i=t.length;n<i;n++){var r=t[n].getShapeIn(e);if(r)return r}},adjust:function(e){var t=[];if(e){var n=this.getLayer(e);t.push(n)}else t=this.layers;return t.forEach(function(e){e.adjust()}),this},move:function(e,t,n){var i=[];if(n){var r=this.getLayer(n);i.push(r)}else i=this.layers;return i.forEach(function(n){n.move(e,t)}),this},moveTo:function(e,t,n){var i=[];if(n){var r=this.getLayer(n);i.push(r)}else i=this.layers;var o=[];i.forEach(function(e){var t=e.getBound();if(t)o.push(t),o.push({x:t.x+t.width,y:t.y+t.height})});var a=l.computeBounding(o);if(a){var s=e-(a.x+a.width/2),u=t-(a.y+a.height/2);i.forEach(function(e){e.move(s,u)})}return this},clearShapes:function(){for(var e=this.layers,t=0,n=e.length;t<n;t++)e[t].clearShapes();return this},resetSize:function(){if(this.options.width)this.main.style.width=this.options.width+"px";if(this.options.height)this.main.style.height=this.options.height+"px";var e=this.main.clientWidth,t=this.main.clientHeight;return this.layers.forEach(function(n){document.getElementById(n.id).style.width=e+"px",document.getElementById(n.id).style.height=t+"px",document.getElementById(n.id).width=e*o,document.getElementById(n.id).height=t*o}),this.width=e,this.height=t,this},getSize:function(){return{width:this.width,height:this.height}},reset:function(){return this.clearShapes(),this.resetSize(),this.camera.reset({x:this.width/2,y:this.height/2}),this},dispose:function(){for(var e=this.layers,t=0,n=e.length;t<n;t++)e[t].dispose(),this.main.removeChild(document.getElementById(e[t].id));this.main=this.layers=this.options=null},createLayer:function(e){return t.call(this,e)}},n}),define("render/capture/Keyboard",["require","common/lang","common/observable"],function(require){function e(e){return{keyCode:e.keyCode,key:o[e.keyCode],ctrlKey:e.ctrlKey||e.metaKey,metaKey:e.metaKey,altKey:e.altKey,shiftKey:e.shiftKey,originEvent:e}}function t(t,n){if(!1!==this.events["key"+Event]){var i=e(n);this.fire("key"+t,i);var r=o[i.keyCode];if(r)this.fire(r+":"+t,i)}}function n(e,n){this.main=e,n=n||{},this.events=n.events||{},this.handlers={keydown:i.bind(t,this,"down"),keyup:i.bind(t,this,"up"),keypress:i.bind(t,this,"press")},this.start()}var i=require("common/lang"),r=require("common/observable"),o={37:"left",38:"up",39:"right",40:"down",13:"enter",27:"esc",8:"backspace",45:"insert",46:"delete",16:"shift",17:"ctrl",18:"alt",36:"home",47:"help",20:"caps",9:"tab"};return n.prototype={constructor:n,start:function(){if(!this.listening){this.listening=!0;var e=document.body;e.addEventListener("keydown",this.handlers.keydown,!1),e.addEventListener("keyup",this.handlers.keyup,!1),e.addEventListener("keypress",this.handlers.keypress,!1)}return this},stop:function(){if(this.listening){this.listening=!1;var e=document.body;e.removeEventListener("keydown",this.handlers.keydown),e.removeEventListener("keyup",this.handlers.keyup),e.removeEventListener("keypress",this.handlers.keypress)}return this},isListening:function(){return!!this.listening},dispose:function(){this.stop(),this.main=this.events=null,this.un()}},r.mixin(n.prototype),n}),define("render/capture/Resize",["require","common/lang","common/observable"],function(require){function e(e){return{originEvent:e}}function t(t){if(!1!==this.events.resize){var n=e(t);this.fire("resize",n)}}function n(e,n){this.main=e,n=n||{},this.events=n.events||{},this.debounce=n.debounce||200,this.handlers={resize:i.debounce(i.bind(t,this),this.debounce)},this.start()}var i=require("common/lang"),r=require("common/observable");return n.prototype={constructor:n,start:function(){if(!this.listening)this.listening=!0,window.addEventListener("resize",this.handlers.resize,!1);return this},stop:function(){if(this.listening)this.listening=!1,window.removeEventListener("resize",this.handlers.resize);return this},isListening:function(){return!!this.listening},dispose:function(){this.stop(),this.main=this.events=null,this.un()}},r.mixin(n.prototype),n}),define("render/Render",["require","common/lang","./util/guid","./Painter","./capture/Mouse","./capture/Keyboard","./capture/Resize","common/observable"],function(require){function e(){this.painter=new r(this.main,this.options.painter),this.capture=new o(this.main,this.options.mouse),this.keyCapture=new a(this.main,this.options.keyboard),this.camera=this.painter.camera;var e=this;if(this.options.enableScale)this.capture.on("wheel",function(t){if(t.altKey||t.ctrlKey){var n=e.options.defaultRatio||1.2,i=t.delta>0?n:1/n,r=e.camera.scale*i;if(r<e.options.minScale||r>e.options.maxScale)return;e.scale(i,t)}else{var o=t.delta>0?30:-30;e.move(t.shiftKey?o:0,t.shiftKey?0:o),e.refresh()}});if(this.options.enableResize)this.resizeCapture=new s(this.main),this.resizeCapture.on("resize",function(t){if("none"===e.main.style.display)return void(e.hasResized=!0);var n=e.painter.getSize();e.painter.resetSize();var i=e.painter.getSize();e.fire("resize",{size:i,prevSize:n})})}function t(t,r){if(this.main=t,this.options=n.extend({defaultRatio:1.2,minScale:.2,maxScale:200,enableScale:!0,enableResize:!0},r),this.id=i(),!this.main)throw"require a main dom element";e.call(this)}var n=require("common/lang"),i=require("./util/guid"),r=require("./Painter"),o=require("./capture/Mouse"),a=require("./capture/Keyboard"),s=require("./capture/Resize"),l=require("common/observable");return t.prototype.setCursor=function(e){return this.main.style.cursor=e||"default",this},t.prototype.refresh=function(){if(this.hasResized)this.painter.resetSize(),this.hasResized=!1;return this.painter.refresh(),this},t.prototype.reset=function(){this.painter.reset()},t.prototype.scale=function(e,t,n){var i=this.camera.scale*e;if(!(i<this.options.minScale||i>this.options.maxScale)){if(this.camera.ratio=e,this.camera.center.x=t.x,this.camera.center.y=t.y,this.camera.scale=i,!0!==n)this.painter.refresh();else this.painter.adjust();this.camera.ratio=1}},t.prototype.scaleTo=function(e,t,n){if(this.scale(e/this.camera.scale,this.camera.center,!0),this.painter.moveTo(t.x,t.y),this.camera.reset(t,e),!0!==n)this.painter.refresh()},t.prototype.focus=function(){this.keyCapture.start()},t.prototype.blur=function(){this.keyCapture.stop()},t.prototype.dispose=function(){this.un(),this.painter.dispose(),this.capture.dispose(),this.keyCapture.dispose(),this.resizeCapture&&this.resizeCapture.dispose(),this.main=this.options=this.camera=null,this.painter=this.capture=this.keyCapture=null},["addSupport","move","getSize","getLayer","addLayer","removeLayer","getShapeIn","clearShapes"].forEach(function(e){t.prototype[e]=function(){return this.painter[e].apply(this.painter,arguments)}}),l.mixin(t.prototype),t}),define("math/cubeEquation",["require","./quadraticEquation"],function(require){function e(e,n,i,r){if(0===e)return t(n,i,r);if(0===r)return t(e,n,i);if(1!==e)n/=e,i/=e,r/=e;var o,a,s,l,u,f,c,d;if(a=(3*i-n*n)/9,s=-27*r+n*(9*i-n*n*2),s/=54,o=a*a*a+s*s,c=n/3,o>0)return u=s+Math.sqrt(o),u=u<0?-Math.pow(-u,1/3):Math.pow(u,1/3),f=s-Math.sqrt(o),f=f<0?-Math.pow(-f,1/3):Math.pow(f,1/3),[-c+u+f];var h,p,g;if(0===o)return d=s<0?-Math.pow(-s,1/3):Math.pow(s,1/3),h=2*d-c,p=-(d+c),g=p,h===p?h:[h,p];else return a=-a,l=a*a*a,l=Math.acos(s/Math.sqrt(l)),d=2*Math.sqrt(a),h=-c+d*Math.cos(l/3),p=-c+d*Math.cos((l+2*Math.PI)/3),g=-c+d*Math.cos((l+4*Math.PI)/3),[h,p,g]}var t=require("./quadraticEquation");return e}),define("math/quarticEquation",["require","./cubeEquation"],function(require){function e(e,n,i,r,o){if(0===e)return t(n,i,r,o);if(0===o)return t(e,n,i,r);if(1!==e)n/=e,i/=e,r/=e,o/=e;var a,s,l,u,f,c,d,h,p,g,m,y,v,x,w,b,C,S,_,M,E,k;if(a=-i,s=-4*o+r*n,l=4*i*o-(n*n*o+r*r),f=(3*s-a*a)/9,c=-27*l+a*(9*s-a*a*2),c/=54,u=f*f*f+c*c,b=a/3,u>0)x=c+Math.sqrt(u),x=x<0?-Math.pow(-x,1/3):Math.pow(x,1/3),w=c-Math.sqrt(u),w=w<0?-Math.pow(-w,1/3):Math.pow(w,1/3),_=-b+x+w;else if(0===u)C=c<0?-Math.pow(-c,1/3):Math.pow(c,1/3),_=2*C-b;else f=-f,m=f*f*f,m=Math.acos(c/Math.sqrt(m)),C=2*Math.sqrt(f),_=-b+C*Math.cos(m/3);if(b=n/4,S=b*n-i+_,d=h=p=g=y=v=M=E=k=0,S>=0)if(0===S)if((m=-4*o+_*_)<0)E=2*Math.sqrt(-m);else M=2*Math.sqrt(m),k=-M;else d=Math.sqrt(S),M=-(8*r+n*n*n)/4+n*i,M/=d,k=-M;else h=Math.sqrt(-S),E=-(8*r+n*n*n)/4+n*i,E/=h,E=-E;if(M+=3*n*b-(2*i+S),k+=3*n*b-(2*i+S),0===E){if(M>=0)p=Math.sqrt(M);else g=Math.sqrt(-M);if(k>=0)y=Math.sqrt(k);else v=Math.sqrt(-k)}else c=Math.sqrt(M*M+E*E),c=Math.sqrt(c),m=Math.atan2(E,M),m/=2,y=p=c*Math.cos(m),g=c*Math.sin(m),v=-g;var P=[];if(0===h+g)P.push((d+p)/2-b);if(0===-g+h)P.push(d/2-(b+p/2));if(0===-h+v)P.push(y/2-(b+d/2));if(0===h+v)P.push(-(b+(d+y)/2));for(var L={},B=[],U=0,q=P.length;U<q;U++)if(!L[P[U]])B.push(P[U]),L[P[U]]=!0;return B.length?B:!1}var t=require("./cubeEquation");return e}),define("math/bezierQ4Equation",["require","./quarticEquation"],function(require){function e(e,n,i,r,o){var a=t(e,n,i,r,o);if(!a)return a;var s=a.filter(function(e){return e>=0&&e<=1});return s.length?s:!1}var t=require("./quarticEquation");return e}),define("graphics/isBezierCross",["require","./computeBoundingBox","./isBoundingBoxCross","../math/bezierQ2Equation","../math/bezierQ4Equation","./util","./matrix"],function(require){function e(e,a,f,c,d,h){var p=t.quadraticBezier(e,a,f),g=t.quadraticBezier(c,d,h);if(n(p,g)){var m,y,v,x,w=[e.x+f.x-2*a.x,2*(a.x-e.x),e.x-c.x,c.x+h.x-2*d.x,2*(d.x-c.x)],b=[e.y+f.y-2*a.y,2*(a.y-e.y),e.y-c.y,c.y+h.y-2*d.y,2*(d.y-c.y)],C=!1;if(0!==w[3]&&0!==b[3])if(m=l(s(w,b[3]),s(b,w[3])),0===m[4])C=i.apply(this,m);else m=s(m,1/m[4]),v=s([Math.pow(m[0],2),2*m[0]*m[1],2*m[0]*m[2]+Math.pow(m[1],2),2*m[1]*m[2],Math.pow(m[2],2)],b[3]),y=s([0,0,m[0],m[1],m[2]],b[4]),x=u(v,y),x[2]=x[2]-b[0],x[3]=x[3]-b[1],x[4]=x[4]-b[2],C=r.apply(this,x);else if(0===w[3]&&0===b[3]){if(0!==w[4]&&0!==b[4])m=l(s(w,b[4]),s(b,w[4])),C=i.apply(this,m);else if(0===w[4])C=i.apply(this,w);else if(0===b[4])C=i.apply(this,b),m=w,w=b,b=m}else{if(0===b[3])m=w,w=b,b=m;if(0===w[4])C=i.apply(this,w);else m=s(w,1/w[4]),v=s([Math.pow(m[0],2),2*m[0]*m[1],2*m[0]*m[2]+Math.pow(m[1],2),2*m[1]*m[2],Math.pow(m[2],2)],b[3]),y=s([0,0,m[0],m[1],m[2]],b[4]),x=u(v,y),x[2]=x[2]-b[0],x[3]=x[3]-b[1],x[4]=x[4]-b[2],C=r.apply(this,x)}if(C){for(var S,_,M,E,k,P=C.length-1;P>=0;P--)if(S=C[P],!(_=i(b[3]-w[3],b[4]-w[4],w[0]*Math.pow(S,2)+w[1]*S+w[2]-(b[0]*Math.pow(S,2)+b[1]*S+b[2]))))C.splice(P,1);else{for(var L=_.length-1;L>=0;L--)if(M=_[L],E=e.x*Math.pow(1-S,2)+2*a.x*S*(1-S)+f.x*Math.pow(S,2),k=c.x*Math.pow(1-M,2)+2*d.x*M*(1-M)+h.x*Math.pow(M,2),.001<Math.abs(E-k))_.splice(L,1);if(!_.length)C.splice(P,1)}return C.length?C.sort(function(e,t){return e-t}).map(function(t){return o({x:e.x*Math.pow(1-t,2)+2*a.x*t*(1-t)+f.x*Math.pow(t,2),y:e.y*Math.pow(1-t,2)+2*a.y*t*(1-t)+f.y*Math.pow(t,2)})}):!1}}return!1}var t=require("./computeBoundingBox"),n=require("./isBoundingBoxCross"),i=require("../math/bezierQ2Equation"),r=require("../math/bezierQ4Equation"),o=require("./util").ceilPoint,a=require("./matrix"),s=a.multi,l=a.minus,u=a.plus;return e}),define("graphics/isBezierSegmentCross",["require","./computeBoundingBox","./isBezierLineCross","./isBoundingBoxCross","./util"],function(require){function e(e,o,a,s,l){var u=t.quadraticBezier(e,o,a),f={x:Math.min(s.x,l.x),y:Math.min(s.y,l.y),width:Math.abs(s.x-l.x),height:Math.abs(s.y-l.y)};if(i(u,f)){var c=n(e,o,a,s,l);if(c)return c.filter(function(e){return r(f,e,!0)})}return!1}var t=require("./computeBoundingBox"),n=require("./isBezierLineCross"),i=require("./isBoundingBoxCross"),r=require("./util").isPointInBound;return e}),define("graphics/join/getJoint",["require","../isSegmentCross","../isBezierCross","../isBezierSegmentCross","../pathIterator"],function(require){function e(e){return 31*(31*e.x+e.y)}function t(t,a,s,l,u,f){var c,d=[];o(t,function(e,t,o,h,p){if("L"===e){if("L"===a)c=n(s,l,t,o);else if("Q"===a)c=r(s,l,u,t,o,h)}else if("Q"===e)if("L"===a)c=r(t,o,h,s,l);else if("Q"===a)c=i(t,o,h,s,l,u);if(c)d=d.concat(c.map(function(e){return e.index0=f,e.index1=p,e}))});for(var h={},p=d.length-1;p>=0;p--){var g=d[p];if(h[e(g)])d.splice(p,1);else h[e(g)]=!0}return d.length?d:!1}var n=require("../isSegmentCross"),i=require("../isBezierCross"),r=require("../isBezierSegmentCross"),o=require("../pathIterator");return t}),define("graphics/join/getPathJoint",["require","./getJoint","../pathIterator"],function(require){function e(e,i){var r,o=[];return n(e,function(e,n,a,s,l){if("L"===e)r=t(i,"L",n,a,0,l);else if("Q"===e)r=t(i,"Q",n,a,s,l);if(r)o=o.concat(r)}),o.length?o:!1}var t=require("./getJoint"),n=require("../pathIterator");return e}),define("graphics/isPathCross",["require","./computeBoundingBox","./join/getPathJoint","./isInsidePath","./isBoundingBoxCross","./pathUtil"],function(require){function e(e,a,s,l){if(s=s||t.computePath(e),l=l||t.computePath(a),r(s,l)){var u=n(e,a);if(!u)if(i(e,a[0]))return 2;else if(i(a,e[0]))return 3;return o.removeOverlapPoints(u)}return!1}var t=require("./computeBoundingBox"),n=require("./join/getPathJoint"),i=require("./isInsidePath"),r=require("./isBoundingBoxCross"),o=require("./pathUtil");return e}),define("render/util/selectShape",["require","graphics/computeBoundingBox","graphics/isPathCross"],function(require){function e(e,i){if(1===e.length)return e[0];var r=e.map(function(e){var n=t.computePath(e.points);return e._bound=n,e._size=n.width*n.height,e}).sort(function(e,t){return e._size-t._size}),o=r[0],a=r[r.length-1],s=n(o.points,a.points,o._bound,a._bound),l=o;if(2===s)l=a;else if(3===s)l=o;else if(i&&Math.abs(o._size-a._size)/o._size<.01){var u=o._bound.x+o._bound.width/2,f=o._bound.y+o._bound.height/2,c=a._bound.x+a._bound.width/2,d=a._bound.y+a._bound.height/2;if(Math.pow(i.x-c,2)+Math.pow(i.y-d,2)>Math.pow(i.x-u,2)+Math.pow(i.y-f,2))l=a}return e.forEach(function(e){delete e._bound,delete e._size}),l}var t=require("graphics/computeBoundingBox"),n=require("graphics/isPathCross");return e}),define("render/Controller",["require","./util/selectShape"],function(require){function e(){var e=this.render;e.capture.on("down",function(t){var i=e.getLayer("cover").getShapeIn(t);if(i)e.selectedShape=i[0];else if(i=e.getLayer("font").getShapeIn(t),i.length>1)e.selectedShape=n(i,t);else e.selectedShape=i[0];e.camera.x=t.x,e.camera.y=t.y}),e.capture.on("drag",function(t){var n=e.selectedShape;if(n)e.getLayer(n.layerId).move(t.x-e.camera.x,t.y-e.camera.y,n).refresh();else e.move(t.x-e.camera.x,t.y-e.camera.y).refresh();e.camera.x=t.x,e.camera.y=t.y}),e.capture.on("dragend",function(t){var n=e.selectedShape;if(n)e.getLayer(n.layerId).move(t.x-e.camera.x,t.y-e.camera.y,n).refresh(),e.selectedShape=null;else e.painter.refresh()})}function t(e){this.options=e||{}}var n=require("./util/selectShape");return t.prototype.setRender=function(t){return this.render=t,e.call(this),this},t.prototype.dispose=function(){this.render&&this.render.dispose(),this.options=this.render=null},t}),define("render/main",["require","./Render","./Controller"],function(require){var e=require("./Render"),t=require("./Controller"),exports={};return exports.create=function(n,i){i=i||{};var r=new e(n,i),o=i.controller;if(delete i.controller,!o)o=new t;return o.setRender(r),r},exports}),define("editor/menu/point",["require","../i18n/i18n"],function(require){var e=require("../i18n/i18n");return[{name:"add",title:e.lang.addpoint},{name:"remove",title:e.lang.removepoint},{name:"onCurve",title:e.lang.oncurve},{name:"offCurve",title:e.lang.offcurve},{name:"asStart",title:e.lang.asstart}]}),define("editor/menu/shape",["require","../i18n/i18n"],function(require){var e=require("../i18n/i18n");return[{name:"removeshapes",title:e.lang.removeshapes},{name:"reversepoints",title:e.lang.reversepoints},{name:"cutshapes",title:e.lang.cut},{name:"copyshapes",title:e.lang.copy},{name:"order",title:e.lang.order,items:[{name:"topshape",title:e.lang.topshape},{name:"bottomshape",title:e.lang.bottomshape},{name:"upshape",title:e.lang.upshape},{name:"downshape",title:e.lang.downshape}]},{name:"transform",title:e.lang.transform,items:[{name:"rotateleft",title:e.lang.rotateleft},{name:"rotateright",title:e.lang.rotateright},{name:"flipshapes",title:e.lang.flip},{name:"mirrorshapes",title:e.lang.mirror}]},{name:"horizontalalignshapes_",title:e.lang.align,items:[{name:"horizontalalignshapes",align:"left",title:e.lang.alignleft},{name:"horizontalalignshapes",align:"center",title:e.lang.aligncenter},{name:"horizontalalignshapes",align:"right",title:e.lang.alignright}]},{name:"verticalalignshapes_",title:e.lang.verticalalign,items:[{name:"verticalalignshapes",align:"ascent",title:e.lang.aligntop},{name:"verticalalignshapes",align:"middle",title:e.lang.alignmiddle},{name:"verticalalignshapes",align:"descent",title:e.lang.aligndescent},{name:"verticalalignshapes",align:"baseline",title:e.lang.alignbaseline}]},{name:"addreferenceline",title:e.lang.addboundreferenceline}]}),define("editor/menu/shapes",["require","../i18n/i18n"],function(require){var e=require("../i18n/i18n");return[{name:"reversepoints",title:e.lang.reversepoints},{name:"removeshapes",title:e.lang.removeshapes},{name:"cutshapes",title:e.lang.cut},{name:"copyshapes",title:e.lang.copy},{name:"join",title:e.lang.joinshapes,items:[{name:"joinshapes",title:e.lang.joinshapes},{name:"intersectshapes",title:e.lang.intersectshapes},{name:"tangencyshapes",title:e.lang.tangencyshapes}]},{name:"transform",title:e.lang.transform,items:[{name:"rotateleft",title:e.lang.rotateleft},{name:"rotateright",title:e.lang.rotateright},{name:"flipshapes",title:e.lang.flip},{name:"mirrorshapes",title:e.lang.mirror}]},{name:"alignshapes_",title:e.lang.alignshapes,items:[{name:"alignshapes",align:"left",title:e.lang.alignleft},{name:"alignshapes",align:"center",title:e.lang.aligncenter},{name:"alignshapes",align:"right",title:e.lang.alignright},{name:"alignshapes",align:"top",title:e.lang.aligntop},{name:"alignshapes",align:"middle",title:e.lang.alignmiddle},{name:"alignshapes",align:"bottom",title:e.lang.aligndescent}]},{name:"horizontalalignshapes_",title:e.lang.align,items:[{name:"horizontalalignshapes",align:"left",title:e.lang.alignleft},{name:"horizontalalignshapes",align:"center",title:e.lang.aligncenter},{name:"horizontalalignshapes",align:"right",title:e.lang.alignright}]},{name:"verticalalignshapes_",title:e.lang.verticalalign,items:[{name:"verticalalignshapes",align:"ascent",title:e.lang.aligntop},{name:"verticalalignshapes",align:"middle",title:e.lang.alignmiddle},{name:"verticalalignshapes",align:"descent",title:e.lang.aligndescent},{name:"verticalalignshapes",align:"baseline",title:e.lang.alignbaseline}]},{name:"addreferenceline",title:e.lang.addboundreferenceline}]}),define("editor/menu/editor",["require","../i18n/i18n"],function(require){var e=require("../i18n/i18n");return[{name:"addpath",title:e.lang.addpath},{name:"add_shapes",title:e.lang.addshapes,items:[{name:"addsupportshapes",type:"circle",title:e.lang.circle},{name:"addsupportshapes",type:"rect",title:e.lang.rect},{name:"addsupportshapes",type:"roundrect",title:e.lang.roundrect},{name:"addsupportshapes",type:"star",title:e.lang.star},{name:"addsupportshapes",type:"arrow",title:e.lang.arrow},{name:"addsupportshapes",type:"triangle",title:e.lang.triangle},{name:"addsupportshapes",type:"heart",title:e.lang.heart},{name:"addsupportshapes",type:"tel",title:e.lang.tel},{name:"addsupportshapes",type:"drop",title:e.lang.drop},{name:"addsupportshapes",type:"du",title:e.lang.du}]},{name:"undo",title:e.lang.undo},{name:"redo",title:e.lang.redo},{name:"paste",title:e.lang.paste},{name:"split",title:e.lang.splitshapes},{name:"setting",title:e.lang.setting,items:[{name:"gridsorption",title:e.lang.gridsorption},{name:"shapesorption",title:e.lang.shapesorption},{name:"showgrid",title:e.lang.showgrid},{name:"moresetting",title:e.lang.moresetting}]},{name:"addreferenceline",title:e.lang.addreferenceline},{name:"clearreferenceline",title:e.lang.clearreferenceline},{name:"rescale",title:e.lang.rescale},{name:"fontsetting",title:e.lang.fontsetting},{name:"save",title:e.lang.save}]}),define("editor/menu/commandList",["require","./point","./shape","./shapes","./editor"],function(require){return{point:require("./point"),shape:require("./shape"),shapes:require("./shapes"),editor:require("./editor")}}),define("editor/mode/point",["require","common/lang","../menu/commandList"],function(require){function e(e){if(this.curPoint)if(!1!==e.returnValue){this.contextMenu.hide();var n=e.command,i=this.curShape,r=i.points,o=+this.curPoint.pointId;if("add"===n){var a=r[o],s=r[o===r.length-1?0:o+1],l={x:(a.x+s.x)/2,y:(a.y+s.y)/2,onCurve:!0};r.splice(o+1,0,l)}else if("remove"===n)r.splice(o,1);else if("onCurve"===n)r[o].onCurve=!0;else if("offCurve"===n)delete r[o].onCurve;else if("asStart"===n)i.points=r.slice(o).concat(r.slice(0,o));else if(this.supportCommand(n))return void this.execCommand(n);t.call(this,i),delete this.curPoint,this.fontLayer.refresh(),this.fire("change")}}function t(e){var t=[],i=e.points.length-1,r=n.clone(e),o=this.options.coverLayer;r.id="cover-"+e.id,r.selectable=!1,r.style={strokeColor:o.outlineColor},r.points.forEach(function(e,n){var r={type:e.onCurve?"point":"cpoint",x:e.x,y:e.y,point:e,pointId:n,style:{fill:!0,stroke:!0,strokeColor:o.strokeColor,fillColor:o.fillColor}};if(0===n)r.style.strokeColor="blue",r.style.fillColor="blue",r.style.strokeWidth=2;else if(n===i)r.style.strokeColor="red",r.style.fillColor="red",r.style.strokeWidth=2;t.push(r)});var a=this.coverLayer;a.clearShapes(),a.addShape(r),t.forEach(function(e){a.addShape(e)}),this.curShape=e,a.refresh()}var n=require("common/lang"),i={left:[-1,0],right:[1,0],up:[0,-1],down:[0,1]};return{down:function(e){if(this.curPoint)if(this.curPoint._style)this.curPoint.style=n.clone(this.curPoint._style);delete this.curPoint;var t=this.coverLayer.getShapeIn(e);if(t){if(this.curPoint=t[0],this.curPoint._style=n.clone(this.curPoint.style),this.curPoint.style.fillColor=this.options.coverLayer.outlineColor,this.sorption.isEnable())if(this.sorption.enableShape){var i=[],r=[];this.curShape.points.forEach(function(e){i.push(e.x),r.push(e.y)});var o=this.referenceLineLayer.shapes;o.forEach(function(e){if(void 0!==e.p0.x)i.push(e.p0.x);if(void 0!==e.p0.y)r.push(e.p0.y)}),this.sorption.clear(),i.length&&this.sorption.addXAxis(i),r.length&&this.sorption.addYAxis(r)}this.coverLayer.refresh()}},drag:function(e){var t=this.render.camera;if(this.curPoint){var n=this.curPoint,i=this.curShape.points[n.pointId];if(t.event.altKey)n.x=i.x;else n.x=i.x+t.event.deltaX;if(t.event.shiftKey)n.y=i.y;else n.y=i.y+t.event.deltaY;if(this.sorption.isEnable()){var r;if(r=this.sorption.detectX(n.x))n.x=r.axis;if(r=this.sorption.detectY(n.y))n.y=r.axis}n.point.x=n.x,n.point.y=n.y,this.coverLayer.refresh()}},dragend:function(){if(this.curPoint){var e=this.curShape.points[this.curPoint.pointId];if(e.x=this.curPoint.x,e.y=this.curPoint.y,this.sorption.isEnable())this.sorption.clear();this.fontLayer.refresh()}this.fire("change")},move:function(e){if(this.coverLayer.getShapeIn(e))this.render.setCursor("pointer");else this.render.setCursor("default")},rightdown:function(t){if(this.curPoint)this.contextMenu.onClick=n.bind(e,this),this.contextMenu.show(t,require("../menu/commandList").point)},keyup:function(t){if("delete"===t.key&&this.curPoint)e.call(this,{command:"remove"});else if(i[t.key]&&this.curPoint)this.fire("change");else if("esc"===t.key)this.setMode()},keydown:function(e){if(i[e.key]&&this.curPoint){var t=i[e.key],n=this.curPoint;if(t[0])n.x+=t[0];if(t[1])n.y+=t[1];var r=this.curShape.points[n.pointId];r.x=n.point.x=n.x,r.y=n.point.y=n.y,this.coverLayer.refresh(),this.fontLayer.refresh()}},begin:function(e){var n=this;t.call(n,e)},end:function(){delete this.curPoint,delete this.curShape,this.coverLayer.clearShapes(),this.coverLayer.refresh(),this.render.setCursor("default")}}}),define("editor/mode/range",["require","graphics/computeBoundingBox","graphics/isBoundingBoxCross"],function(require){function e(e){var i=this.fontLayer.shapes,r=[];return i.forEach(function(i){var o=t.computePath(i.points);if(3===n(e,o))r.push(i)}),r.length?r:!1}var t=require("graphics/computeBoundingBox"),n=require("graphics/isBoundingBoxCross"),i={down:function(e){if(1===e.which)i.begin.call(this,e)},drag:function(e){if(1===e.which)if(this.selectionBox){var t=this.render.camera;this.selectionBox.width=t.x-this.selectionBox.x,this.selectionBox.height=t.y-this.selectionBox.y,this.coverLayer.refresh()}},up:function(t){if(1===t.which){if(this.selectionBox){var n={x:Math.min(this.selectionBox.x,this.selectionBox.x+this.selectionBox.width),y:Math.min(this.selectionBox.y,this.selectionBox.y+this.selectionBox.height),width:Math.abs(this.selectionBox.width),height:Math.abs(this.selectionBox.height)};if(n.width>=20&&n.height>=20){var i;if(i=e.call(this,n))return void this.setMode("shapes",i,"range")}}this.setMode()}},begin:function(){var e=this.render.camera;this.selectionBox={type:"rect",dashed:!0,x:e.x,y:e.y},this.coverLayer.addShape(this.selectionBox)},end:function(){this.selectionBox=null,this.coverLayer.clearShapes(),this.coverLayer.refresh()}};return i}),define("editor/mode/pan",["require"],function(require){return{drag:function(e){if(1===e.which){var t=this.render.camera;this.render.move(t.mx,t.my),this.render.refresh()}},keyup:function(e){if(32===e.keyCode)this.setMode("bound")},begin:function(){this.render.setCursor("pointer")},end:function(){this.render.setCursor("default")}}}),define("editor/mode/referenceline",["require","common/lang"],function(require){var e=require("common/lang"),t={newLine:1,dragLine:2,drag:function(e){if(1===e.which)if(this.currentLine){var n=this.render.camera,i=this.currentLine;if(void 0!==i.p0.x)i.p0.x+=n.mx;else i.p0.y+=n.my;this.referenceLineLayer.refresh()}else if(this._dragMode===t.newLine)if(e.startX<=20&&e.x>20)this.currentLine=this.referenceLineLayer.addShape("gridarrow",{p0:{x:e.x},style:this.options.referenceline.style}),this._dragMode=t.dragLine,this.render.setCursor("col-resize");else if(e.startY<=20&&e.y>20)this.currentLine=this.referenceLineLayer.addShape("gridarrow",{p0:{y:e.y},style:this.options.referenceline.style}),this._dragMode=t.dragLine,this.render.setCursor("row-resize")},up:function(e){if(1===e.which){if(this.currentLine){var t=this.currentLine;if(t===this.rightSideBearing&&t.p0.x<20)t.p0.x=this.p0.x,this.referenceLineLayer.refresh();else if(void 0!==t.p0.x&&t.p0.x<20||void 0!==t.p0.y&&t.p0.y<20)this.execCommand("removereferenceline",t)}this.setMode()}},begin:function(n){if(n===t.dragLine){var i=arguments[1];if(void 0!==i.p0.x)this.render.setCursor("col-resize");else this.render.setCursor("row-resize");this.currentLine=i,this.p0=e.clone(i.p0)}this._dragMode=n},end:function(){delete this._dragMode,delete this.currentLine,delete this.p0,this.render.setCursor("default")}};return t}),define("editor/mode/bound",["require","render/util/selectShape","./referenceline"],function(require){var e=require("render/util/selectShape"),t=require("./referenceline");return{down:function(n){if(1===n.which){if(n.x<=20||n.y<=20)return void this.setMode("referenceline",t.newLine,n.x,n.y);var i=this.fontLayer.getShapeIn(n);if(i){var r=e(i,n);return void this.setMode("shapes",[r],"bound")}if(i=this.referenceLineLayer.getShapeIn(n)){var o=i[0];return void this.setMode("referenceline",t.dragLine,o,n)}this.setMode("range")}},keydown:function(e){if(32===e.keyCode)this.setMode("pan");else if(65===e.keyCode&&e.ctrlKey)this.setMode("shapes",this.fontLayer.shapes.slice())}}}),define("editor/group/moveTransform",["require","common/lang","graphics/pathAdjust"],function(require){function e(e,i,r,o){var a=i?0:e.x-e.startX,s=r?0:e.y-e.startY,l=this.shapes,u=this.bound,f=this.editor.coverLayer,c=f.getShape("bound");if(o){var d,h,p=u.x+u.width/2,g=u.y+u.height/2,m=this.editor.options.sorption.sorptionColor;if(!i){var y=f.getShape("sorptionX");if(!y)y=f.addShape({type:"line",id:"sorptionX",style:{strokeColor:m},p0:{},p1:{}});var v=[this.bound.x,p,this.bound.x+this.bound.width];for(d=0;d<3;d++)if(h=this.editor.sorption.detectX(v[d]+a)){a=h.axis-v[d],y.p0.x=y.p1.x=h.axis,y.p0.y=g+s,y.p1.y=h.y,y.disabled=!1;break}if(3===d)y.disabled=!0}if(!r){var x=f.getShape("sorptionY");if(!x)x=f.addShape({type:"line",id:"sorptionY",style:{strokeColor:m},p0:{},p1:{}});var w=[this.bound.y,g,this.bound.y+this.bound.height];for(d=0;d<3;d++)if(h=this.editor.sorption.detectY(w[d]+s)){s=h.axis-w[d],x.p0.x=p+a,x.p1.x=h.x,x.p0.y=x.p1.y=h.axis,x.disabled=!1;break}if(3===d)x.disabled=!0}}this.coverShapes.forEach(function(e,i){var r=t.clone(l[i]);n(r.points,1,1,a,s),t.extend(e,r)}),c.points=n([{x:u.x,y:u.y},{x:u.x+u.width,y:u.y},{x:u.x+u.width,y:u.y+u.height},{x:u.x,y:u.y+u.height}],1,1,a,s),f.refresh()}var t=require("common/lang"),n=require("graphics/pathAdjust");return e}),define("editor/group/getScaleMatrix",["require"],function(require){function e(e,t,n){var i=[0,0,1,1];switch(e){case 1:i[0]=t.x+t.width,i[1]=t.y+t.height,i[2]=-(n.x-i[0])/t.width,i[3]=-(n.y-i[1])/t.height;break;case 2:i[0]=t.x,i[1]=t.y+t.height,i[2]=(n.x-i[0])/t.width,i[3]=-(n.y-i[1])/t.height;break;case 3:i[0]=t.x,i[1]=t.y,i[2]=(n.x-i[0])/t.width,i[3]=(n.y-i[1])/t.height;break;case 4:i[0]=t.x+t.width,i[1]=t.y,i[2]=-(n.x-i[0])/t.width,i[3]=(n.y-i[1])/t.height;break;case 5:i[1]=t.y+t.height,i[2]=1,i[3]=-(n.y-i[1])/t.height;break;case 7:i[1]=t.y,i[3]=(n.y-i[1])/t.height;break;case 6:i[0]=t.x,i[2]=(n.x-i[0])/t.width;break;case 8:i[0]=t.x+t.width,i[2]=-(n.x-i[0])/t.width}return i}return e}),define("editor/group/scaleTransform",["require","./getScaleMatrix","graphics/pathAdjust","common/lang"],function(require){function e(e,o){var a=t(e.pos,this.bound,o);if(r.indexOf(e.pos)>=0)if(!o.event.shiftKey){var s=Math.max(Math.abs(a[2]),Math.abs(a[3]));a[2]=a[2]>=0?s:-s,a[3]=a[3]>=0?s:-s}var l=this.shapes;this.coverShapes.forEach(function(e,t){var r=i.clone(l[t]);if(n(r.points,a[2],a[3],-a[0],-a[1]),n(r.points,1,1,a[0],a[1]),a[2]<0&&a[3]>=0)r.points=r.points.reverse();if(a[3]<0&&a[2]>=0)r.points=r.points.reverse();i.extend(e,r)});var u=this.editor.coverLayer,f=u.getShape("bound"),c=this.bound,d=n([{x:c.x,y:c.y},{x:c.x+c.width,y:c.y},{x:c.x+c.width,y:c.y+c.height},{x:c.x,y:c.y+c.height}],a[2],a[3],-a[0],-a[1]);n(d,1,1,a[0],a[1]),f.points=d,u.refresh()}var t=require("./getScaleMatrix"),n=require("graphics/pathAdjust"),i=require("common/lang"),r=[1,2,3,4];return e}),define("math/getAngle",["require"],function(require){function e(e,t,n,i){var r=Math.acos((e*n+t*i)/Math.sqrt(e*e+t*t)/Math.sqrt(n*n+i*i));if(e*i-n*t<0)r=2*Math.PI-r;return r}return e}),define("editor/group/getRotateMatrix",["require","math/getAngle"],function(require){function e(e,t,r,o){var a=i(e,t,r,o),s=(180*a/Math.PI+360)%45;if(Math.min(s,45-s)<n)a=45*Math.round(180*a/Math.PI/45)*Math.PI/180;return a}function t(t,n,i){var r=[n.x+n.width/2,n.y+n.height/2,0];switch(t){case 1:case 2:case 3:case 4:return r[2]=e(i.startX-r[0],i.startY-r[1],i.x-r[0],i.y-r[1]),r;case 5:return r[0]=0,r[1]=n.y+n.height,r[2]=e(0,n.height,i.x-i.startX,n.height),r;case 7:return r[0]=0,r[1]=n.y,r[2]=e(0,-n.height,i.x-i.startX,-n.height),r;case 6:return r[0]=n.x,r[1]=0,r[2]=e(n.width,0,n.width,i.y-i.startY),r;case 8:return r[0]=n.x+n.width,r[1]=0,r[2]=e(-n.width,0,-n.width,i.y-i.startY),r}return r}var n=3,i=require("math/getAngle");return t}),define("graphics/pathRotate",["require","fonteditor-core/graphics/pathRotate"],function(require){return require("fonteditor-core/graphics/pathRotate")}),define("fonteditor-core/graphics/pathSkew",["require"],function(require){function e(e,t,n,i){t=void 0===t?0:t;var r,o,a,s=n||0,l=Math.tan(t);if(0===s)for(o=0,a=e.length;o<a;o++)r=e[o],r.x+=l*(r.y-i);else for(o=0,a=e.length;o<a;o++)r=e[o],r.y+=l*(r.x-n);return e}return e}),define("graphics/pathSkew",["require","fonteditor-core/graphics/pathSkew"],function(require){return require("fonteditor-core/graphics/pathSkew")}),define("editor/group/rotateTransform",["require","./getRotateMatrix","graphics/pathRotate","graphics/pathSkew","common/lang"],function(require){function e(e,o){var a=t(e.pos,this.bound,o),s=e.pos<=4?n:i,l=this.shapes;this.coverShapes.forEach(function(e,t){var n=r.clone(l[t]);s(n.points,a[2],a[0],a[1]),r.extend(e,n)});var u=this.editor.coverLayer,f=u.getShape("bound"),c=this.bound;f.points=s([{x:c.x,y:c.y},{x:c.x+c.width,y:c.y},{x:c.x+c.width,y:c.y+c.height},{x:c.x,y:c.y+c.height}],a[2],a[0],a[1]);var d=u.getShape("boundcenter");if(!d)d={type:"cpoint",id:"boundcenter",x:c.x+c.width/2,y:c.y+c.height/2},u.addShape(d);d.x=(f.points[0].x+f.points[2].x)/2,d.y=(f.points[0].y+f.points[2].y)/2,u.refresh()}var t=require("./getRotateMatrix"),n=require("graphics/pathRotate"),i=require("graphics/pathSkew"),r=require("common/lang");return e}),define("editor/group/BoundControl",["require","common/lang"],function(require){function e(e){this.layer=e,this.controls=[{id:"bound-point",type:"polygon",dashed:!0,selectable:!1},{},{},{},{},{},{},{},{}]}var t=require("common/lang");return e.prototype.refresh=function(e,n){var i=[{points:[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},{x:e.x,y:e.y+e.height}]},{x:e.x,y:e.y,pos:1},{x:e.x+e.width,y:e.y,pos:2},{x:e.x+e.width,y:e.y+e.height,pos:3},{x:e.x,y:e.y+e.height,pos:4},{x:e.x+e.width/2,y:e.y,pos:5},{x:e.x+e.width,y:e.y+e.height/2,pos:6},{x:e.x+e.width/2,y:e.y+e.height,pos:7},{x:e.x,y:e.y+e.height/2,pos:8}],r=this.controls;i.forEach(function(e,i){if(i>0)if("rotate"===n&&i<=4)e.type="cpoint",e.size=3;else e.type="point",e.size=6;t.extend(r[i],e)}),this.show()},e.prototype.show=function(){var e=this.layer;if(!e.getShape("bound-point"))this.controls.forEach(function(t){e.addShape(t)});e.refresh()},e.prototype.hide=function(){var e=this.layer;if(e.getShape("bound-point"))this.controls.forEach(function(t){e.removeShape(t)});e.refresh()},e.prototype.dispose=function(){this.hide(),this.layer.refresh(),this.controls.length=0,this.controls=this.layer=null},e}),define("editor/group/ShapesGroup",["require","graphics/pathAdjust","common/lang","graphics/computeBoundingBox","./moveTransform","./scaleTransform","./rotateTransform","./BoundControl"],function(require){function e(e){return r.computePath.apply(null,e.map(function(e){return e.points}))}function t(e,t){this.editor=t,this.boundControl=new l(t.coverLayer),this.setShapes(e)}var n=require("graphics/pathAdjust"),i=require("common/lang"),r=require("graphics/computeBoundingBox"),o=require("./moveTransform"),a=require("./scaleTransform"),s=require("./rotateTransform"),l=require("./BoundControl");return t.prototype.beginTransform=function(t,n){if(this.bound=e(this.shapes),this.editor.coverLayer.addShape({id:"bound",type:"polygon",dashed:!0,selectable:!1,points:[]}),this.boundControl.hide(),"move"===this.mode&&this.editor.sorption.isEnable())if(this.editor.sorption.enableShape){var i=[],r=this.shapes,o=this.bound;i.push({points:[{x:o.x,y:o.y,onCurve:!0},{x:o.x+o.width,y:o.y+o.height,onCurve:!0}]}),this.editor.fontLayer.shapes.forEach(function(e){if(r.indexOf(e)<0)i.push(e)});var a=this.editor.referenceLineLayer.shapes,s=[],l=[];a.forEach(function(e){if(void 0!==e.p0.x)s.push(e.p0.x);if(void 0!==e.p0.y)l.push(e.p0.y)}),this.editor.sorption.clear(),i.length&&this.editor.sorption.addShapes(i),s.length&&this.editor.sorption.addXAxis(s),l.length&&this.editor.sorption.addYAxis(l)}},t.prototype.transform=function(e,t,n){if("move"===this.mode)o.call(this,t,n.ctrlKey?!1:n.altKey,n.ctrlKey?!1:n.shiftKey,this.editor.sorption.isEnable());else if("scale"===this.mode)a.call(this,e,t);else if("rotate"===this.mode)s.call(this,e,t)},t.prototype.finishTransform=function(e,t,n){var i=this.coverShapes;if(this.coverShapes=this.shapes,this.transform(e,t,n),this.coverShapes=i,delete this.bound,this.editor.coverLayer.removeShape("bound"),this.editor.coverLayer.removeShape("boundcenter"),this.editor.fontLayer.refresh(),"move"===this.mode&&this.editor.sorption.isEnable())this.editor.coverLayer.removeShape("sorptionX"),this.editor.coverLayer.removeShape("sorptionY"),this.editor.sorption.clear();this.refresh()},t.prototype.setShapes=function(e){var t=this.editor.coverLayer;if(this.shapes)this.shapes=null;if(this.coverShapes)this.coverShapes.forEach(function(e){t.removeShape(e)}),this.coverShapes=null;this.shapes=e,this.coverShapes=i.clone(this.shapes);var n=this.editor.options.coverLayer.outlineColor;this.coverShapes.forEach(function(e){e.id="cover-"+e.id,e.selectable=!1,e.style={strokeColor:n},t.addShape(e)})},t.prototype.getBound=function(){if(this.shapes.length)return e(this.shapes);else return!1},t.prototype.setMode=function(e){this.mode=e},t.prototype.move=function(e,t){this.shapes.forEach(function(i){n(i.points,1,1,e,t)}),this.editor.fontLayer.refresh(),this.editor.coverLayer.move(e,t),this.editor.coverLayer.refresh()},t.prototype.refresh=function(){this.boundControl.refresh(e(this.shapes),this.mode)},t.prototype.dispose=function(){this.editor.coverLayer.clearShapes(),this.boundControl.dispose(),this.shapes=this.coverShapes=this.boundControl=this.editor=null},t}),define("editor/util/cursor",["require"],function(require){return{scale:{1:"nw-resize",2:"ne-resize",3:"se-resize",4:"sw-resize",5:"s-resize",6:"e-resize",7:"n-resize",8:"w-resize"},rotate:{1:"pointer",2:"pointer",3:"pointer",4:"pointer",5:"e-resize",6:"s-resize",7:"w-resize",8:"n-resize"}}}),define("editor/mode/shapes",["require","render/util/guid","../group/ShapesGroup","common/lang","render/util/selectShape","../menu/commandList","../util/cursor"],function(require){function e(e){if(this.currentGroup.shapes.length){this.contextMenu.hide();var t=e.command,n=e.args,i=this.currentGroup.shapes;switch(t){case"topshape":case"bottomshape":case"upshape":case"downshape":this.execCommand(t,i[0]);break;case"joinshapes":case"intersectshapes":case"tangencyshapes":case"rotateleft":case"rotateright":case"flipshapes":case"mirrorshapes":case"cutshapes":case"copyshapes":case"removeshapes":case"reversepoints":this.execCommand(t,i);break;case"alignshapes":case"verticalalignshapes":case"horizontalalignshapes":this.execCommand(t,i,n.align);break;case"addreferenceline":var r=this.currentGroup.getBound();if(r)this.execCommand(t,r.x,r.y),this.execCommand(t,r.x+r.width,r.y+r.height);break;default:if(this.supportCommand(t))this.execCommand(t)}}}var t=require("render/util/guid"),n=require("../group/ShapesGroup"),i=require("common/lang"),r=require("render/util/selectShape"),o=require("../menu/commandList"),a=require("../util/cursor"),s={left:[-1,0],right:[1,0],up:[0,-1],down:[0,1]};return{down:function(e){var t=this.render,n=t.getLayer("cover").getShapeIn(e);if(n)this.currentPoint=i.clone(n[0]);else{if(this.currentPoint=null,n=t.getLayer("font").getShapeIn(e)){var o=n[0];if(n.length>1)o=r(n,e);var a=this.currentGroup.shapes.indexOf(o);if(a>=0){if(e.ctrlKey&&!e.altKey)this.currentGroup.shapes.splice(a,1),this.refreshSelected(this.currentGroup.shapes.slice(0)),this.clicked=!1;return}var s=[o];if(e.ctrlKey)s=s.concat(this.currentGroup.shapes);return this.currentGroup.setMode("scale"),this.refreshSelected(s),void(this.clicked=!1)}this.setMode("range")}},dragstart:function(e){if(this.currentPoint)this.currentGroup.beginTransform(this.currentPoint,this.render.camera,e);else{if(e.ctrlKey&&e.altKey){var n=i.clone(this.currentGroup.shapes),r=this.fontLayer;n.forEach(function(e){e.id=t("shape"),r.addShape(e)}),this.currentGroup.setShapes(n)}this.currentGroup.setMode("move"),this.currentGroup.beginTransform(this.currentPoint,this.render.camera,e)}},drag:function(e){if(this.currentGroup)this.currentGroup.transform(this.currentPoint,this.render.camera,e)},dragend:function(e){if(this.currentPoint)this.currentGroup.finishTransform(this.currentPoint,this.render.camera,e),this.currentPoint=null,this.fire("change");else if("move"===this.currentGroup.mode)this.currentGroup.finishTransform(this.currentPoint,this.render.camera,e),this.currentGroup.setMode("scale"),this.fire("change");this.render.setCursor("default")},move:function(e){var t=this.coverLayer.getShapeIn(e),n=this.currentGroup.mode;if(t&&"move"!==n)this.render.setCursor(a[this.currentGroup.mode][t[0].pos]||"default");else this.render.setCursor("default")},rightdown:function(t){this.contextMenu.onClick=i.bind(e,this),this.contextMenu.show(t,this.currentGroup.shapes.length>1?o.shapes:o.shape)},click:function(e){if(this.clicked){var t=this.currentGroup.mode;this.currentGroup.setMode("scale"===t?"rotate":"scale"),this.currentGroup.refresh()}this.clicked=!0},keyup:function(e){if("delete"===e.key)this.execCommand("removeshapes",this.currentGroup.shapes),this.setMode();else if(65===e.keyCode&&e.ctrlKey)this.currentGroup.setShapes(this.fontLayer.shapes.slice()),this.currentGroup.refresh();else if(s[e.key])this.fire("change");else if("esc"===e.key)this.setMode()},keydown:function(e){if(88===e.keyCode&&e.ctrlKey){if(this.currentGroup.shapes.length)this.execCommand("cutshapes",this.currentGroup.shapes)}else if(67===e.keyCode&&e.ctrlKey)if(this.currentGroup.shapes.length)this.execCommand("copyshapes",this.currentGroup.shapes);if(s[e.key])this.currentGroup.move(s[e.key][0],s[e.key][1])},begin:function(e,t){if(this.currentGroup=new n(e,this),this.currentGroup.refresh(),this.currentGroup.setMode("scale"),"bound"===t||"addpath"===t)this.clicked=!1;else this.clicked=!0;this.fire("selection:change",{shapes:e})},end:function(){this.currentPoint=null,this.currentGroup.dispose(),this.currentGroup=null,this.render.setCursor("default"),this.fire("selection:change")}}}),define("editor/mode/addshapes",["require","graphics/pathAdjust","graphics/computeBoundingBox","common/lang"],function(require){var e=require("graphics/pathAdjust"),t=require("graphics/computeBoundingBox"),n=require("common/lang");return{down:function(e){if(1===e.which){this.coverLayer.clearShapes();for(var n=0,i=this.curShapes.length;n<i;n++)this.coverLayer.addShape("path",{points:[]});this.curBound=t.computePath.apply(null,this.curShapes)}},drag:function(t){if(1===t.which)if(this.curShapes){var i=t.startX,r=t.startY,o=t.x-t.startX,a=t.y-t.startY,s=o/this.curBound.width,l=a/this.curBound.height;if(t.shiftKey){var u=Math.min(Math.abs(s),Math.abs(l));s=s>0?u:-u,l=l>0?u:-u}for(var f=this.curShapes,c=this.coverLayer.shapes,d=0,h=f.length;d<h;d++){var p=n.clone(f[d]);e(p,s,l),e(p,1,1,i,r),c[d].points=p}this.coverLayer.refresh()}},dragend:function(e){if(1===e.which){if(this.curShapes){for(var t=this.fontLayer,i=n.clone(this.coverLayer.shapes),r=0,o=i.length;r<o;r++)t.addShape(i[r]);return t.refresh(),this.fire("change"),void this.setMode("shapes",i)}this.setMode()}},begin:function(e){this.render.setCursor("crosshair"),this.curShapes=e},end:function(){this.curShapes=this.curBound=null,this.coverLayer.clearShapes(),this.coverLayer.refresh(),this.render.setCursor("default")}}}),define("editor/mode/addpath",["require"],function(require){return{down:function(e){var t=this.coverLayer,n=t.getShapeIn(e);if(n[0]&&this.points.length>1&&n[0]===this.points[0]){var i=this.points.map(function(e){var t={x:e.x,y:e.y};if(e.onCurve)t.onCurve=!0;return t}),r=this.fontLayer.addShape("path",{points:i});this.fontLayer.refresh(),this.fire("change"),this.setMode("shapes",[r],"addpath")}else{var o=e.x,a=e.y;if(this.points.length){var s=this.points[this.points.length-1];if(e.shiftKey)a=s.y;if(e.altKey)o=s.x}var l=t.addShape({type:"point",x:o,y:a,onCurve:!0});if(this.points.push(l),1===this.points.length)l.style={strokeColor:"red"};else{var u=this.points[this.points.length-2];if(u.onCurve)t.addShape({type:"line",p0:{x:u.x,y:u.y},p1:{x:l.x,y:l.y}});else t.addShape({type:"beziercurve",points:this.points.slice(this.points.length-3)})}this.dashedLine.p0.x=l.x,this.dashedLine.p0.y=l.y,t.refresh()}this.downMouse=!0},up:function(e){if(this.downMouse=!1,this.curCurve)this.curCurve=null,this.points.push({x:e.x,y:e.y,onCurve:!1})},move:function(e){var t=this.coverLayer.getShapeIn(e);if(t[0]&&t[0]===this.points[0])this.render.setCursor("pointer");else this.render.setCursor("crosshair");var n=this.points,i=e.x,r=e.y,o=n[n.length-1];if((e.shiftKey||e.altKey)&&n.length){if(e.shiftKey)r=o.y;if(e.altKey)i=o.x}if(this.downMouse&&n.length>=2){var a=n[n.length-2];if(!this.curCurve&&a.onCurve)n.splice(n.length-1,0,{x:2*o.x-i,y:2*o.y-r,onCurve:!1}),this.coverLayer.shapes.splice(this.coverLayer.shapes.length-1,1),this.curCurve=this.coverLayer.addShape({type:"beziercurve",points:n.slice(n.length-3)});else a.x=2*o.x-i,a.y=2*o.y-r;this.dashedLine.disabled=!0,this.coverLayer.refresh()}else if(n.length)this.dashedLine.p1.x=i,this.dashedLine.p1.y=r,this.dashedLine.disabled=!1,this.coverLayer.refresh()},undo:function(e){if(this.points.length){var t=this.points,n=this.coverLayer.shapes,i=t[t.length-1],r=t[t.length-2];if(i&&!i.onCurve)t.splice(t.length-3,3),n.splice(n.length-2,2);else if(r&&!r.onCurve)t.splice(t.length-2,2),n.splice(n.length-2,2);else t.splice(t.length-1,1),n.splice(n.length-2,2);if(t.length){var o=t[t.length-1];this.dashedLine.p0.x=o.x,this.dashedLine.p0.y=o.y}else this.dashedLine.disabled=!0;this.coverLayer.refresh()}},begin:function(){this.coverLayer.clearShapes(),this.points=[],this.dashedLine=this.coverLayer.addShape({type:"line",dashed:!0,disabled:!0,selectable:!1,p0:{},p1:{}}),this.render.setCursor("crosshair")},end:function(){this.points=this.dashedLine=this.downMouse=this.curCurve=null,this.coverLayer.clearShapes(),this.coverLayer.refresh(),this.render.setCursor("default")}}}),define("editor/mode/split",["require"],function(require){return{down:function(e){if(1===e.which)this.coverLayer.clearShapes(),this.splitLine=this.coverLayer.addShape({type:"line",p0:{x:e.x,y:e.y},p1:{x:e.x,y:e.y}})},move:function(e){if(1===e.which)if(this.splitLine){if(this.splitLine.p1.x=e.x,this.splitLine.p1.y=e.y,e.shiftKey)this.splitLine.p1.y=this.splitLine.p0.y;if(e.altKey)this.splitLine.p1.x=this.splitLine.p0.x;this.coverLayer.refresh()}},up:function(e){if(1===e.which){if(this.splitLine){var t=this.splitLine.p0,n=this.splitLine.p1;if(Math.abs(t.x-n.x)>=20||Math.abs(t.y-n.y)>=20)if(!1!==this.execCommand("splitshapes",t,n))return}this.setMode()}},begin:function(){},end:function(){delete this.splitLine,this.coverLayer.clearShapes(),this.coverLayer.refresh()}}}),define("editor/mode/support",["require","./point","./range","./pan","./bound","./shapes","./addshapes","./addpath","./split","./referenceline"],function(require){return{point:require("./point"),range:require("./range"),pan:require("./pan"),default:require("./bound"),shapes:require("./shapes"),addshapes:require("./addshapes"),addpath:require("./addpath"),split:require("./split"),referenceline:require("./referenceline")}}),define("editor/widget/ContextMenu",["require"],function(require){function e(e,t){var n=document.createElement("ul");return n.className=t.className||"editor-contextmenu",n.style.position="absolute",n.style.zIndex=t.zIndex||1e3,n.style.display="none",e.appendChild(n),n}function t(t,n){this.container=t||document.body,this.main=e(this.container,n||{}),this.commands={};var i=this;i._commandClick=function(e){var t=e.target.getAttribute("data-id"),n=e.target.getAttribute("data-super");if(t){var r=(n?i.commands[n].items:i.commands)[t],o={command:r.name,args:r,pos:i.pos};i.onClick&&i.onClick(o)}},i.main.addEventListener("click",i._commandClick,!1),i._hideClick=function(){i.hide()}}return t.prototype.setCommands=function(e){var t="";e.forEach(function(e,n){if(e.items)t+='<li data-sub="'+n+'">',t+="<ul>",e.items.forEach(function(e,i){t+='<li data-super="'+n+'" data-id="'+i+'"'+(e.selected?' data-tag="selected"':"")+">"+e.title+"</li>"}),t+="</ul>",t+=e.title+"</li>";else t+='<li data-id="'+n+'"'+(e.selected?' data-tag="selected"':"")+">"+e.title+"</li>"}),this.commands=e,this.main.innerHTML=t},t.prototype.show=function(e,t){if(t)this.setCommands(t);this._visible=!0,this.main.style.display="block";var n=this.container.clientWidth,i=this.container.clientHeight,r=this.main.offsetWidth,o=this.main.offsetHeight,a=e.x+r>n?n-r:e.x,s=e.y+o>i?i-o:e.y;this.main.style.left=a+"px",this.main.style.top=s+"px",this.pos=e,this.container.addEventListener("click",this._hideClick)},t.prototype.hide=function(){this._visible=!1,this.main.style.display="none",this.onClick=null,this.container.removeEventListener("click",this._hideClick)},t.prototype.visible=function(){return null==this._visible?this._visible="none"!==this.main.style.display:this._visible},t.prototype.dispose=function(){this.hide(),this.main.removeEventListener("click",this._commandClick),this.container.removeEventListener("click",this._hideClick),this._commandClick=this._hideClick=null,this.main.remove(),this.main=this.container=this.pos=null,this.onClick=null},t}),define("editor/command/shape",["require","graphics/pathsUtil"],function(require){var e=require("graphics/pathsUtil");return{removeshapes:function(e){var t=this.fontLayer;e.forEach(function(e){t.removeShape(e)}),t.refresh(),this.refreshSelected([]),this.setMode()},reversepoints:function(e){e.forEach(function(e){e.points=e.points.reverse()}),this.fontLayer.refresh()},topshape:function(e){var t=this.fontLayer.shapes.indexOf(e);this.fontLayer.shapes.splice(t,1),this.fontLayer.shapes.push(e)},bottomshape:function(e){var t=this.fontLayer.shapes.indexOf(e);this.fontLayer.shapes.splice(t,1),this.fontLayer.shapes.unshift(e)},upshape:function(e){var t=this.fontLayer.shapes.indexOf(e);this.fontLayer.shapes.splice(t,1),this.fontLayer.shapes.splice(t+1,0,e)},downshape:function(e){var t=this.fontLayer.shapes.indexOf(e);this.fontLayer.shapes.splice(t,1),this.fontLayer.shapes.splice(t-1,0,e)},cutshapes:function(e){var t=this.getShapes(e);this.setClipBoard(t);var n=this.fontLayer;e.forEach(function(e){n.removeShape(e)}),n.refresh(),this.refreshSelected([])},copyshapes:function(e){e=this.getShapes(e),this.setClipBoard(e)},pasteshapes:function(t,n){if(!t||!t.length)return!1;if(n){var i=t.map(function(e){return e.points}),r=this.axis,o=this.render.camera.scale,a=(n.x-r.x)/o,s=(r.y-n.y)/o;e.move(i,a,s)}this.addShapes(t),this.setMode("shapes",t)},addshapes:function(e,t){this.addShapes(e),t&&this.setSelected(e)},addcontours:function(t,n){if(n=n||{},n.flip)e.flip(t);if(n.mirror)e.mirror(t);var i=this.addContours(t,n.scale);n.selected&&this.setSelected(i)}}}),define("editor/command/transform",["require","graphics/pathsUtil"],function(require){function e(e,n){if(!n)return!1;var i=e.map(function(e){return e.points});t.rotate(i,n)}var t=require("graphics/pathsUtil"),n={rotate:function(t,n){if(!t||!t.length)return!1;var i=e(t,n);if(!1!==i)this.fontLayer.refresh(),this.refreshSelected(t);return i},rotateleft:function(e){return e=e||this.currentGroup&&this.currentGroup.shapes,n.rotate.call(this,e,-Math.PI/2)},rotateright:function(e){return e=e||this.currentGroup&&this.currentGroup.shapes,n.rotate.call(this,e,Math.PI/2)},flipshapes:function(e){if(!(e=e||this.currentGroup&&this.currentGroup.shapes)||!e.length)return!1;t.flip(e.map(function(e){return e.points})),this.fontLayer.refresh(),this.refreshSelected(e)},mirrorshapes:function(e){if(!(e=e||this.currentGroup&&this.currentGroup.shapes)||!e.length)return!1;t.mirror(e.map(function(e){return e.points})),this.fontLayer.refresh(),this.refreshSelected(e)}};return n}),define("editor/command/align",["require","graphics/computeBoundingBox","graphics/pathAdjust"],function(require){var e=require("graphics/computeBoundingBox"),t=require("graphics/pathAdjust");return{alignshapes:function(n,i){if(!(n=n||this.currentGroup&&this.currentGroup.shapes)||!n.length)return!1;var r=n.map(function(e){return e.points}),o=e.computePath.apply(null,r);o.x1=o.x+o.width,o.y1=o.y+o.height,o.xc=o.x+o.width/2,o.yc=o.y+o.height/2;var a,s;r.forEach(function(n){var r=e.computePath(n);if(a=0,s=0,"left"===i)a=o.x-r.x;else if("center"===i)a=o.xc-r.x-r.width/2;else if("right"===i)a=o.x1-r.x-r.width;else if("top"===i)s=o.y-r.y;else if("middle"===i)s=o.yc-r.y-r.height/2;else if("bottom"===i)s=o.y1-r.y-r.height;t(n,1,1,a,s)}),this.fontLayer.refresh(),this.refreshSelected(n)},verticalalignshapes:function(n,i){if(!(n=n||this.currentGroup&&this.currentGroup.shapes)||!n.length)return!1;var r=n.map(function(e){return e.points}),o=this.axis.metrics,a=this.axis.y,s=a-o.ascent,l=a-o.descent,u=(s+l)/2,f=e.computePath.apply(null,r),c=0;if("ascent"===i)c=s-f.y;else if("middle"===i)c=u-f.y-f.height/2;else if("descent"===i)c=l-f.y-f.height;else if("baseline"===i)c=a-f.y-f.height;r.forEach(function(e){t(e,1,1,0,c)}),this.fontLayer.refresh(),this.refreshSelected(n)},horizontalalignshapes:function(n,i){if(!(n=n||this.currentGroup&&this.currentGroup.shapes)||!n.length)return!1;var r=n.map(function(e){return e.points}),o=this.axis.x,a=this.rightSideBearing.p0.x,s=e.computePath.apply(null,r),l=0;if("left"===i)l=o-s.x;else if("center"===i)l=(o+a)/2-s.x-s.width/2;else if("right"===i)l=a-s.x-s.width;r.forEach(function(e){t(e,1,1,l,0)}),this.fontLayer.refresh(),this.refreshSelected(n)}}}),define("fonteditor-core/graphics/getArc",["require","../math/bezierCubic2Q2"],function(require){function e(e,t,n,i){var r=e*i-t*n<0?-1:1,o=Math.sqrt(e*e+t*t),a=Math.sqrt(e*e+t*t),s=e*n+t*i,l=s/(o*a);if(l>1||l<-1)l=Math.max(l,-1),l=Math.min(l,1);return r*Math.acos(l)}function t(e,t,n,i){n=Math.abs(n),i=Math.abs(i);var r=e*e/(n*n)+t*t/(i*i);if(r>1)n*=Math.sqrt(r),i*=Math.sqrt(r);return[n,i]}function n(t,n,i,r,o,a,l,u,f,c){var d=c*(t-i)/2+f*(n-r)/2,h=-f*(t-i)/2+c*(n-r)/2,p=l*l,g=u*u,m=d*d,y=h*h,v=p*g-p*y-g*m;if(v<0)v=0;v/=p*y+g*m,v=Math.sqrt(v)*(o===a?-1:1);var x=v*l/u*h,w=v*-u/l*d,b=c*x-f*w+(t+i)/2,C=f*x+c*w+(n+r)/2,S=(d-x)/l,_=(h-w)/u,M=(-d-x)/l,E=(-h-w)/u,k=e(1,0,S,_),P=e(S,_,M,E);if(0===a&&P>0)P-=s;if(1===a&&P<0)P+=s;return[b,C,k,P]}function i(e,t){var n=4/3*Math.tan(t/4),i=Math.cos(e),r=Math.sin(e),o=Math.cos(e+t),a=Math.sin(e+t);return[i,r,i-r*n,r+i*n,o+a*n,a-o*n,o,a]}function r(e,r,o,a,l,u,f,c,d){var h=Math.sin(d*s/360),p=Math.cos(d*s/360),g=p*(e-o)/2+h*(r-a)/2,m=-h*(e-o)/2+p*(r-a)/2;if(0===g&&0===m)return[];if(0===f||0===c)return[];var y=t(g,m,f,c);f=y[0],c=y[1];var v=n(e,r,o,a,l,u,f,c,h,p),x=[],w=v[2],b=v[3],C=Math.max(Math.ceil(Math.abs(b)/(s/4)),1);b/=C;for(var S=0;S<C;S++)x.push(i(w,b)),w+=b;return x.map(function(e){for(var t=0;t<e.length;t+=2){var n=e[t+0],i=e[t+1];n*=f,i*=c;var r=p*n-h*i,o=h*n+p*i;e[t+0]=r+v[0],e[t+1]=o+v[1]}return e})}function o(e,t,n,i,o,s,l){var u=r(s.x,s.y,l.x,l.y,i,o,e,t,n),f=[];if(u.length)f.push({x:u[0][0],y:u[0][1],onCurve:!0}),u.forEach(function(e,t){var n=a({x:e[0],y:e[1]},{x:e[2],y:e[3]},{x:e[4],y:e[5]},{x:e[6],y:e[7]});if(n[0][2].onCurve=!0,f.push(n[0][1]),f.push(n[0][2]),n[1])n[1][2].onCurve=!0,f.push(n[1][1]),f.push(n[1][2])});return f}var a=require("../math/bezierCubic2Q2"),s=2*Math.PI;return o}),define("fonteditor-core/ttf/svg/parseParams",["require"],function(require){function e(e){return+e.trim()}var t=/-?\d+(?:\.\d+)?(?:e[-+]?\d+)?\b/g;return function(n){if(!n)return[];var i=n.match(t);return i?i.map(e):[]}}),define("fonteditor-core/ttf/svg/path2contours",["require","../../math/bezierCubic2Q2","../../graphics/getArc","./parseParams"],function(require){function e(e,t){var n,r,o=[];e.forEach(function(e){var t=i(e[0],e[1],e[2],e[3]);for(n=0,r=t.length;n<r;n++)o.push(t[n])});var a,s;for(n=0,r=o.length;n<r;n++)if(a=o[n],0===n)t.push({x:a[1].x,y:a[1].y}),t.push({x:a[2].x,y:a[2].y,onCurve:!0});else{if(s=o[n-1],s[1].x+a[1].x===2*a[0].x&&s[1].y+a[1].y===2*a[0].y)t.pop();t.push({x:a[1].x,y:a[1].y}),t.push({x:a[2].x,y:a[2].y,onCurve:!0})}return t.push({x:a[2].x,y:a[2].y,onCurve:!0}),t}function t(t){for(var n,i,o,a,s,l,u,f,c,d,h,p,g,m,y=[],v=[],x=0,w=0,b=0,C=t.length;b<C;b++)if(n=t[b],o=n.cmd,a=n.relative,!(i=n.args)||i.length||"Z"===o){if("Z"===o)y.push(v),v=[];else if("M"===o||"L"===o){if(i.length%2)throw new Error("`M` command error:"+i.join(","));if(a)u=x,f=w;else u=0,f=0;for(s=0,l=i.length;s<l;s+=2){if(a)u+=i[s],f+=i[s+1];else u=i[s],f=i[s+1];v.push({x:u,y:f,onCurve:!0})}x=u,w=f}else if("H"===o){if(a)x+=i[0];else x=i[0];v.push({x:x,y:w,onCurve:!0})}else if("V"===o){if(a)w+=i[0];else w=i[0];v.push({x:x,y:w,onCurve:!0})}else if("Q"===o){if(a)u=x,f=w;else u=0,f=0;for(s=0,l=i.length;s<l;s+=4)if(v.push({x:u+i[s],y:f+i[s+1]}),v.push({x:u+i[s+2],y:f+i[s+3],onCurve:!0}),a)u+=i[s+2],f+=i[s+3];else u=0,f=0;if(a)x=u,w=f;else x=i[l-2],w=i[l-1]}else if("T"===o){var S=v.pop(),_=v[v.length-1];if(!_)_=S;for(v.push(_={x:2*S.x-_.x,y:2*S.y-_.y}),u=x,f=w,s=0,l=i.length-2;s<l;s+=2){if(a)u+=i[s],f+=i[s+1];else u=i[s],f=i[s+1];S={x:u,y:f},v.push(_={x:2*S.x-_.x,y:2*S.y-_.y})}if(a)x=u+i[l],w=f+i[l+1];else x=i[l],w=i[l+1];v.push({x:x,y:w,onCurve:!0})}else if("C"===o){if(i.length%6)throw new Error("`C` command params error:"+i.join(","));if(c=[],a)u=x,f=w;else u=0,f=0;for(d={x:x,y:w},s=0,l=i.length;s<l;s+=6)if(p={x:u+i[s],y:f+i[s+1]},g={x:u+i[s+2],y:f+i[s+3]},h={x:u+i[s+4],y:f+i[s+5]},c.push([d,p,g,h]),d=h,a)u+=i[s+4],f+=i[s+5];else u=0,f=0;if(a)x=u,w=f;else x=i[l-2],w=i[l-1];e(c,v),m=c[c.length-1][2]}else if("S"===o){if(i.length%4)throw new Error("`S` command params error:"+i.join(","));if(c=[],a)u=x,f=w;else u=0,f=0;if(d=v.pop(),!m)m=d;for(p={x:2*d.x-m.x,y:2*d.y-m.y},s=0,l=i.length;s<l;s+=4)if(g={x:u+i[s],y:f+i[s+1]},h={x:u+i[s+2],y:f+i[s+3]},c.push([d,p,g,h]),d=h,p={x:2*d.x-g.x,y:2*d.y-g.y},a)u+=i[s+2],f+=i[s+3];else u=0,f=0;if(a)x=u,w=f;else x=i[l-2],w=i[l-1];e(c,v),m=c[c.length-1][2]}else if("A"===o){if(i.length%7)throw new Error("arc command params error:"+i.join(","));for(s=0,l=i.length;s<l;s+=7){var M=i[s+5],E=i[s+6];if(a)M=x+M,E=w+E;var k=r(i[s],i[s+1],i[s+2],i[s+3],i[s+4],{x:x,y:w},{x:M,y:E});if(k&&k.length>1)for(var P=1,L=k.length;P<L;P++)v.push(k[P]);x=M,w=E}}}else console.warn("`"+o+"` command args empty!");return y}function n(e){if(!e||!e.length)return null;if(e=e.trim(),"M"!==e[0]&&"m"!==e[0])e="M 0 0"+e;e=e.replace(/(\d+)\s*(m|$)/gi,"$1z$2");for(var n,i,r,a=[],s=!1,l=0,u=e.length;l<u;l++){var f=e[l].toUpperCase(),c=f!==e[l];switch(f){case"M":if(0===l){n=f,i=1;break}case"Q":case"T":case"C":case"S":case"H":case"V":case"L":case"A":case"Z":if("Z"===n)a.push({cmd:"Z"});else r=e.slice(i,l),a.push({cmd:n,relative:s,args:o(r)});n=f,s=c,i=l+1}}return a.push({cmd:"Z"}),t(a)}var i=require("../../math/bezierCubic2Q2"),r=require("../../graphics/getArc"),o=require("./parseParams");return n}),define("fonteditor-core/graphics/reducePath",["require"],function(require){function e(e,t,n){if((t.onCurve&&n.onCurve||!t.onCurve&&!n.onCurve)&&Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2)<=1)return!0;if(t.onCurve&&e.onCurve&&n.onCurve&&Math.abs((n.y-t.y)*(e.x-t.x)-(e.y-t.y)*(n.x-t.x))<=.001)return!0;if(!t.onCurve&&e.onCurve&&n.onCurve&&Math.abs((n.y-t.y)*(e.x-t.x)-(e.y-t.y)*(n.x-t.x))<=.001)return!0;else return!1}function t(t){if(!t.length)return t;for(var n,i,r,o=t.length-1,a=o;o>=0;o--)if(r=t[o],i=o===a?t[0]:t[o+1],n=0===o?t[a]:t[o-1],!e(n,r,i));else t.splice(o,1),a--;return t}return t}),define("graphics/reducePath",["require","fonteditor-core/graphics/reducePath"],function(require){return require("fonteditor-core/graphics/reducePath")}),define("graphics/pathBoolean",["require","fonteditor-core/ttf/util/contours2svg","fonteditor-core/ttf/svg/path2contours","./pathUtil","./reducePath","paper"],function(require){function e(){if(!l.project)l.setup(document.createElement("canvas"))}function t(e){var t=r(e);return new l.CompoundPath(t)}function n(e){var t=e.getPathData();return o(t)}function i(i,r){if(i.length<2)return i;e();var o,f=t(i.slice(0,i.length-1)),c=t(i.slice(i.length-1));if(r===u.intersect)o=f.intersect(c);else if(r===u.join)o=f.unite(c);else if(r===u.differ)o=f.subtract(c);else if(r===u.tangency)o=f.exclude(c);var d=o?n(o):i;l.clear();for(var h=0,p=d.length;h<p;h++)d[h]=a.deInterpolate(d[h]),d[h]=s(d[h]);return d}var r=require("fonteditor-core/ttf/util/contours2svg"),o=require("fonteditor-core/ttf/svg/path2contours"),a=require("./pathUtil"),s=require("./reducePath"),l=require("paper"),u={intersect:0,join:1,differ:2,tangency:3};return i.Relation=u,i}),define("graphics/pathSplitBySegment",["require","fonteditor-core/ttf/svg/path2contours","fonteditor-core/ttf/util/contours2svg","./pathUtil","./reducePath","paper"],function(require){function e(){if(!l.project)l.setup(document.createElement("canvas"))}function t(e){var t=o(e);return new l.CompoundPath(t)}function n(e){var t=e.getPathData();return r(t)}function i(i,r,o){e();var u=t(i),f=new l.Path({segments:[[r.x,r.y],[o.x,o.y]],closed:!1}),c=u.getIntersections(f);if(!c||!c.length)return i;c.forEach(function(e){e.split()}),u.children.forEach(function(e){e.segments[0].clearHandles(),e.segments[e.segments.length-1].clearHandles(),e.closePath()}),u.resolveCrossings().reorient();var d=n(u);l.clear();for(var h=0,p=d.length;h<p;h++)d[h]=a.deInterpolate(d[h]),d[h]=s(d[h]);return d}var r=require("fonteditor-core/ttf/svg/path2contours"),o=require("fonteditor-core/ttf/util/contours2svg"),a=require("./pathUtil"),s=require("./reducePath"),l=require("paper");return i}),define("graphics/isBoundingBoxSegmentCross",["require","./util","./isSegmentCross"],function(require){function e(e,i,r){if(t(e,i)||t(e,r))return!0;if(n(e,{x:e.x,y:e.y+e.height},i,r)||n(e,{x:e.x+e.width,y:e.y},i,r)||n({x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},i,r)||n({x:e.x,y:e.y+e.height},{x:e.x+e.width,y:e.y+e.height},i,r))return!0;else return!1}var t=require("./util").isPointInBound,n=require("./isSegmentCross");return e}),define("editor/command/join",["require","graphics/pathBoolean","common/lang","graphics/pathSplitBySegment","graphics/computeBoundingBox","graphics/isBoundingBoxSegmentCross"],function(require){function e(e,i){var r,o,a=e.map(function(e){return e.points}),s=t(a,i),l=!1;if(s.length===a.length){for(r=0,o=s.length;r<o;r++)if(s[r]!==a[r]){l=!0;break}}else l=!0;if(l){var u=this.fontLayer,f=s.length,c=e.length,d=Math.min(f,c);for(r=0;r<d;r++)e[r].points=n.clone(s[r]);if(c>d){for(r=d;r<c;r++)u.removeShape(e[r]);e.splice(d,c-d)}if(f>d)for(r=d;r<f;r++){var h=u.addShape("path",{points:s[r]});e.push(h)}u.refresh()}return e}var t=require("graphics/pathBoolean"),n=require("common/lang"),i=require("graphics/pathSplitBySegment"),r=require("graphics/computeBoundingBox"),o=require("graphics/isBoundingBoxSegmentCross");return{joinshapes:function(n){e.call(this,n,t.Relation.join),this.refreshSelected(n)},intersectshapes:function(n){e.call(this,n,t.Relation.intersect),this.refreshSelected(n)},tangencyshapes:function(n){e.call(this,n,t.Relation.tangency),this.refreshSelected(n)},splitshapes:function(e,t){var a,s,l=this.fontLayer.shapes,u=[];for(a=0,s=l.length;a<s;a++){var f=r.computePath(l[a].points);if(o(f,e,t))u.push(l[a])}if(u.length){var c=i(u.map(function(e){return e.points}),e,t);if(c.length){var d=this.fontLayer;for(a=0,s=u.length;a<s;a++)u[a].points=n.clone(c[a]);if(c.length>u.length)for(a=u.length,s=c.length;a<s;a++){var h=d.addShape("path",{points:c[a]});u.push(h)}d.refresh(),this.setMode("shapes",u)}return!0}return!1}}}),define("editor/command/referenceline",["require"],function(require){return{addreferenceline:function(e,t){if(e>20)this.referenceLineLayer.addShape("gridarrow",{p0:{x:e}});if(t>20)this.referenceLineLayer.addShape("gridarrow",{p0:{y:t}});this.referenceLineLayer.refresh()},removereferenceline:function(e,t){var n=[];if("object"==typeof e)n.push(e);var i=this.referenceLineLayer,r=this.rightSideBearing;if(e>20||t>20){var o=this.referenceLineLayer.getShapeIn(e,t);n=n.concat(o)}n=n.filter(function(e){return e!==r}),n.forEach(function(e){i.removeShape(e)}),i.refresh()},clearreferenceline:function(){var e=this.referenceLineLayer,t=this.rightSideBearing;e.shapes.filter(function(e){return"gridarrow"===e.type&&e!==t}).forEach(function(t){e.removeShape(t)}),e.refresh()}}}),define("editor/shapes/circle",["require"],function(require){return[[{x:383,y:0},{x:207,y:75},{x:75,y:208},{x:0,y:384},{x:0,y:583},{x:75,y:760},{x:207,y:891},{x:383,y:966},{x:582,y:966},{x:758,y:891},{x:890,y:760},{x:965,y:583},{x:965,y:384},{x:890,y:208},{x:758,y:75},{x:582,y:0}]]}),define("editor/shapes/rect",["require"],function(require){return[[{x:0,y:0,onCurve:!0},{x:200,y:0,onCurve:!0},{x:200,y:200,onCurve:!0},{x:0,y:200,onCurve:!0}]]}),define("editor/shapes/roundrect",["require"],function(require){return[[{x:615,y:573,onCurve:!0},{x:615,y:591},{x:591,y:615},{x:573,y:615,onCurve:!0},{x:42,y:615,onCurve:!0},{x:24,y:615},{x:14,y:601,onCurve:!0},{x:0,y:591},{x:0,y:573,onCurve:!0},{x:0,y:42,onCurve:!0},{x:0,y:24},{x:14,y:14,onCurve:!0},{x:24,y:0},{x:42,y:0,onCurve:!0},{x:573,y:0,onCurve:!0},{x:591,y:0},{x:601,y:14,onCurve:!0},{x:615,y:24},{x:615,y:42,onCurve:!0},{x:615,y:573,onCurve:!0}]]}),define("editor/shapes/arrow",["require"],function(require){return[[{x:1,y:380,onCurve:!0},{x:1,y:423},{x:43,y:453},{x:88,y:453,onCurve:!0},{x:109,y:453},{x:197,y:452},{x:296,y:452},{x:390,y:451},{x:418,y:451,onCurve:!0},{x:457,y:450},{x:502,y:465},{x:502,y:493,onCurve:!0},{x:502,y:513},{x:505,y:570},{x:505,y:590,onCurve:!0},{x:506,y:626},{x:545,y:646},{x:575,y:621,onCurve:!0},{x:605,y:596},{x:687,y:529},{x:775,y:458},{x:859,y:390},{x:892,y:364,onCurve:!0},{x:922,y:339},{x:923,y:295},{x:894,y:272,onCurve:!0},{x:864,y:247},{x:783,y:184},{x:696,y:116},{x:612,y:50},{x:580,y:24,onCurve:!0},{x:544,y:-5},{x:498,y:10},{x:499,y:47,onCurve:!0},{x:499,y:71,onCurve:!0},{x:499,y:101,onCurve:!0},{x:499,y:116},{x:498,y:146},{x:498,y:158,onCurve:!0},{x:498,y:184},{x:467,y:197},{x:440,y:197,onCurve:!0},{x:411,y:197},{x:314,y:198},{x:210,y:198},{x:112,y:199},{x:81,y:199,onCurve:!0},{x:68,y:199},{x:39,y:204},{x:15,y:219},{x:1,y:246},{x:1,y:270,onCurve:!0},{x:1,y:297},{x:0,y:349}]]}),define("editor/shapes/star",["require"],function(require){return[[{x:756,y:610,onCurve:!0},{x:1009,y:364,onCurve:!0},{x:660,y:315,onCurve:!0},{x:504,y:0,onCurve:!0},{x:348,y:315,onCurve:!0},{x:0,y:364,onCurve:!0},{x:252,y:610,onCurve:!0},{x:193,y:958,onCurve:!0},{x:504,y:793,onCurve:!0},{x:815,y:958,onCurve:!0}]]}),define("editor/shapes/triangle",["require"],function(require){return[[{x:25,y:871,onCurve:!0},{x:431,y:465,onCurve:!0},{x:442,y:454},{x:442,y:425},{x:431,y:414,onCurve:!0},{x:25,y:8,onCurve:!0},{x:14,y:-3},{x:0,y:4},{x:0,y:19,onCurve:!0},{x:0,y:860,onCurve:!0},{x:0,y:875},{x:14,y:882}]]}),define("editor/shapes/heart",["require"],function(require){return[[{x:578,y:965},{x:546,y:965},{x:535,y:953,onCurve:!0},{x:143,y:576,onCurve:!0},{x:137,y:570},{x:116,y:549},{x:68,y:488},{x:29,y:425},{x:0,y:337},{x:0,y:295,onCurve:!0},{x:0,y:156},{x:159,y:0},{x:300,y:0,onCurve:!0},{x:340,y:0},{x:419,y:27},{x:490,y:74},{x:539,y:114},{x:562,y:137,onCurve:!0},{x:585,y:114},{x:634,y:74},{x:705,y:27},{x:786,y:0},{x:824,y:0,onCurve:!0},{x:965,y:0},{x:1124,y:156},{x:1124,y:295,onCurve:!0},{x:1124,y:433},{x:981,y:576,onCurve:!0},{x:589,y:953,onCurve:!0}]]}),define("editor/shapes/tel",["require"],function(require){return[[{x:91,y:42,onCurve:!0},{x:116,y:26},{x:154,y:14,onCurve:!0},{x:191,y:0},{x:200,y:0,onCurve:!0},{x:209,y:7},{x:225,y:56,onCurve:!0},{x:244,y:102},{x:258,y:139,onCurve:!0},{x:279,y:193},{x:323,y:269},{x:318,y:285},{x:297,y:309,onCurve:!0},{x:277,y:332},{x:232,y:362},{x:230,y:385,onCurve:!0},{x:223,y:413},{x:258,y:480,onCurve:!0},{x:293,y:545},{x:355,y:610,onCurve:!0},{x:423,y:668},{x:478,y:694,onCurve:!0},{x:536,y:717},{x:569,y:719,onCurve:!0},{x:580,y:719},{x:634,y:663},{x:655,y:636,onCurve:!0},{x:657,y:631},{x:692,y:647,onCurve:!0},{x:722,y:666},{x:782,y:701,onCurve:!0},{x:843,y:738},{x:887,y:768,onCurve:!0},{x:928,y:796},{x:933,y:803,onCurve:!0},{x:931,y:835},{x:882,y:877,onCurve:!0},{x:831,y:921},{x:780,y:942,onCurve:!0},{x:736,y:960},{x:634,y:949},{x:546,y:916,onCurve:!0},{x:441,y:882},{x:121,y:612},{x:45,y:422,onCurve:!0},{x:-11,y:258},{x:3,y:186,onCurve:!0},{x:14,y:111},{x:45,y:84,onCurve:!0},{x:56,y:67},{x:68,y:58,onCurve:!0},{x:77,y:46}]]}),define("editor/shapes/du",["require"],function(require){return[[{x:373,y:0,onCurve:!0},{x:439,y:0},{x:477,y:88,onCurve:!0},{x:485,y:107},{x:489,y:152,onCurve:!0},{x:489,y:245},{x:415,y:293,onCurve:!0},{x:392,y:304},{x:371,y:304,onCurve:!0},{x:283,y:304},{x:255,y:181,onCurve:!0},{x:253,y:162},{x:253,y:152,onCurve:!0},{x:253,y:51},{x:335,y:6,onCurve:!0},{x:354,y:0}],[{x:687,y:23,onCurve:!0},{x:732,y:23},{x:780,y:82,onCurve:!0},{x:807,y:122},{x:807,y:160,onCurve:!0},{x:807,y:223},{x:742,y:287,onCurve:!0},{x:706,y:316},{x:666,y:316,onCurve:!0},{x:662,y:316,onCurve:!0},{x:586,y:316},{x:557,y:242,onCurve:!0},{x:550,y:215},{x:550,y:190,onCurve:!0},{x:550,y:91},{x:654,y:30,onCurve:!0},{x:666,y:27}],[{x:120,y:224,onCurve:!0},{x:200,y:224},{x:249,y:325,onCurve:!0},{x:253,y:352},{x:255,y:380,onCurve:!0},{x:255,y:481},{x:173,y:512,onCurve:!0},{x:152,y:521},{x:120,y:521,onCurve:!0},{x:27,y:521},{x:0,y:396,onCurve:!0},{x:0,y:382,onCurve:!0},{x:0,y:325},{x:40,y:268,onCurve:!0},{x:74,y:224}],[{x:862,y:299,onCurve:!0},{x:866,y:299,onCurve:!0},{x:955,y:299},{x:987,y:386,onCurve:!0},{x:997,y:403},{x:997,y:428,onCurve:!0},{x:997,y:449,onCurve:!0},{x:997,y:586},{x:871,y:586,onCurve:!0},{x:784,y:586},{x:755,y:521,onCurve:!0},{x:746,y:485},{x:746,y:447,onCurve:!0},{x:746,y:299}],[{x:479,y:396,onCurve:!0},{x:491,y:396,onCurve:!0},{x:586,y:396},{x:662,y:508,onCurve:!0},{x:765,y:614},{x:867,y:689,onCurve:!0},{x:919,y:738},{x:919,y:797,onCurve:!0},{x:919,y:808,onCurve:!0},{x:919,y:888},{x:852,y:944,onCurve:!0},{x:803,y:974},{x:734,y:974,onCurve:!0},{x:725,y:974,onCurve:!0},{x:662,y:974},{x:555,y:949,onCurve:!0},{x:517,y:944},{x:489,y:944,onCurve:!0},{x:464,y:944},{x:318,y:963,onCurve:!0},{x:291,y:964},{x:259,y:964,onCurve:!0},{x:255,y:964,onCurve:!0},{x:143,y:964},{x:103,y:906,onCurve:!0},{x:61,y:856},{x:61,y:793,onCurve:!0},{x:61,y:694},{x:194,y:613,onCurve:!0},{x:302,y:525},{x:331,y:483,onCurve:!0},{x:360,y:428},{x:445,y:399,onCurve:!0},{x:472,y:396}],[{x:379,y:552,onCurve:!0},{x:379,y:639,onCurve:!0},{x:379,y:641},{x:375,y:641,onCurve:!0},{x:306,y:641,onCurve:!0},{x:240,y:641},{x:198,y:721,onCurve:!0},{x:192,y:738},{x:192,y:759,onCurve:!0},{x:192,y:776,onCurve:!0},{x:198,y:854},{x:213,y:854,onCurve:!0},{x:266,y:885},{x:304,y:885,onCurve:!0},{x:453,y:885,onCurve:!0},{x:453,y:555,onCurve:!0},{x:453,y:552},{x:449,y:552,onCurve:!0}],[{x:500,y:664,onCurve:!0},{x:500,y:822,onCurve:!0},{x:500,y:871},{x:573,y:885,onCurve:!0},{x:746,y:885,onCurve:!0},{x:746,y:664,onCurve:!0},{x:672,y:664,onCurve:!0},{x:672,y:837,onCurve:!0},{x:672,y:841},{x:666,y:841,onCurve:!0},{x:605,y:841,onCurve:!0},{x:578,y:841},{x:575,y:814,onCurve:!0},{x:575,y:662,onCurve:!0},{x:512,y:662,onCurve:!0}],[{x:316,y:702,onCurve:!0},{x:377,y:702,onCurve:!0},{x:380,y:702},{x:380,y:704,onCurve:!0},{x:380,y:837,onCurve:!0},{x:380,y:841},{x:377,y:841,onCurve:!0},{x:314,y:841,onCurve:!0},{x:270,y:841},{x:257,y:778,onCurve:!0},{x:257,y:727},{x:308,y:702,onCurve:!0},{x:312,y:702}]]}),define("editor/shapes/drop",["require"],function(require){return[[{x:731,y:526},{x:674,y:443,onCurve:!0},{x:669,y:437},{x:589,y:332},{x:525,y:242},{x:446,y:102},{x:426,y:41,onCurve:!0},{x:421,y:22},{x:384,y:0},{x:347,y:0},{x:311,y:22},{x:305,y:41,onCurve:!0},{x:285,y:102},{x:206,y:242},{x:142,y:332},{x:62,y:437},{x:57,y:443,onCurve:!0},{x:0,y:528},{x:0,y:621,onCurve:!0},{x:0,y:759},{x:214,y:953},{x:517,y:953},{x:731,y:759},{x:731,y:621,onCurve:!0}]]}),define("editor/shapes/support",["require","./circle","./rect","./roundrect","./arrow","./star","./triangle","./heart","./tel","./du","./drop"],function(require){return{circle:require("./circle"),rect:require("./rect"),roundrect:require("./roundrect"),arrow:require("./arrow"),star:require("./star"),triangle:require("./triangle"),heart:require("./heart"),tel:require("./tel"),du:require("./du"),drop:require("./drop")}}),define("editor/command/setSelectedCommand",["require"],function(require){function e(e,t,n){for(var i=t.split("."),r=0,o=e.length;r<o;r++)if(e[r].name===i[0])if(!e[r].items)return e[r].selected=!!n,!0;else if(i[1])for(var a=e[r].items,s=0,l=a.length;s<l;s++)if(a[s].name===i[1])return a[s].selected=!!n,!0;return!1}return e}),define("editor/command/editor",["require","common/lang","graphics/computeBoundingBox","../menu/commandList","../shapes/support","./setSelectedCommand"],function(require){var e=require("common/lang"),t=require("graphics/computeBoundingBox"),n=require("../menu/commandList"),i=require("../shapes/support"),r=require("./setSelectedCommand");return{rescale:function(e){this.coverLayer.clearShapes();var t=this.render.getSize();e=e||512/this.options.unitsPerEm,this.render.scaleTo(e,{x:t.width/2,y:t.height/2}),this.setMode()},enlargeview:function(){var e=this.render.getSize();this.render.scale(1.25,{x:e.width/2,y:e.height/2})},narrowview:function(){var e=this.render.getSize();this.render.scale(.8,{x:e.width/2,y:e.height/2})},undo:function(){var e=this.history.back();this.fontLayer.shapes.length=0,this.addShapes(e),this.setMode()},redo:function(){var e=this.history.forward();this.fontLayer.shapes.length=0,this.addShapes(e),this.setMode()},gridsorption:function(e){r(n.editor,"setting.gridsorption",!!e),this.options.sorption.enableGrid=this.sorption.enableGrid=!!e},shapesorption:function(e){r(n.editor,"setting.shapesorption",!!e),this.options.sorption.enableShape=this.sorption.enableShape=!!e},showgrid:function(e){r(n.editor,"setting.showgrid",!!e),this.options.axis.showGrid=this.axis.showGrid=!!e,this.axisLayer.refresh()},moresetting:function(){this.fire("setting:editor",{setting:this.options})},addpath:function(){var e=this;setTimeout(function(){e.setMode("addpath")},20)},addsupportshapes:function(t){if(i[t])this.setMode("addshapes",e.clone(i[t]))},fontsetting:function(){var e=t.computePathBox.apply(null,this.fontLayer.shapes.map(function(e){return e.points})),n=0,i=0;if(e){var r=this.render.camera.scale;n=(e.x-this.axis.x)/r,i=(this.rightSideBearing.p0.x-e.x-e.width)/r}if(this.font)this.fire("setting:font",{setting:{leftSideBearing:Math.round(n),rightSideBearing:Math.round(i||0),unicode:this.font.unicode,name:this.font.name}})}}}),define("editor/command/support",["require","common/lang","./shape","./transform","./align","./join","./referenceline","./editor"],function(require){var e=require("common/lang"),t={};return e.extend(t,require("./shape")),e.extend(t,require("./transform")),e.extend(t,require("./align")),e.extend(t,require("./join")),e.extend(t,require("./referenceline")),e.extend(t,require("./editor")),t}),define("editor/widget/History",["require","common/lang"],function(require){function e(e){e=e||{},this.maxRecord=e.maxRecord||200,this.queue=[],this.index=0}var t=require("common/lang");return e.prototype.add=function(e){if(this.queue.splice(this.index+1,this.maxRecord),this.queue.push(e),this.queue.length>this.maxRecord)this.queue.shift();this.index=this.queue.length-1},e.prototype.get=function(e){return e=e||this.index,t.clone(this.queue[e])},e.prototype.forward=function(){if(this.index<this.queue.length-1)this.index++;return t.clone(this.queue[this.index])},e.prototype.back=function(){if(this.index>0)this.index--;return t.clone(this.queue[this.index])},e.prototype.atFirst=function(){return 0===this.index},e.prototype.atLast=function(){var e=this.queue.length;return 0===e||this.index===e-1},e.prototype.reset=function(){delete this.queue,this.queue=[],this.index=0},e}),define("editor/widget/Sorption",["require","graphics/computeBoundingBox"],function(require){function e(e,t,n){for(var i,r,o=0,a=e.length-1;o<=a;)if(i=o+a>>1,r=e[i].axis,Math.abs(t-r)<n)return e[i];else if(t<r)a=i-1;else o=i+1;return!1}function t(e){this.gridDelta=e.gridDelta||5,this.delta=e.delta||5,this.enableGrid=e.enableGrid||!1,this.enableShape=e.enableShape||!0,this.xAxis=[],this.yAxis=[]}var n=require("graphics/computeBoundingBox");return t.prototype.setGrid=function(e){this.axis=e},t.prototype.addShapes=function(e){for(var t=this.xAxis,i=this.yAxis,r=e.length-1;r>=0;r--){var o=n.computePath(e[r].points),a=o.x+o.width/2,s=o.y+o.height/2;t.push({axis:o.x,y:s}),t.push({axis:a,y:s}),t.push({axis:o.x+o.width,y:s}),i.push({axis:o.y,x:a}),i.push({axis:s,x:a}),i.push({axis:o.y+o.height,x:a})}t.sort(function(e,t){return e.axis-t.axis}),i.sort(function(e,t){return e.axis-t.axis})},t.prototype.addXAxis=function(e){var t=this.xAxis;e.forEach(function(e){t.push({axis:e,y:0})}),t.sort(function(e,t){return e.axis-t.axis})},t.prototype.addYAxis=function(e){var t=this.yAxis;e.forEach(function(e){t.push({axis:e,x:0})}),t.sort(function(e,t){return e.axis-t.axis})},t.prototype.detectX=function(t){if(this.enableShape){var n=e(this.xAxis,t,this.delta);if(n)return n}if(this.enableGrid){var i=(t-this.axis.x)%this.axis.gap;if(Math.abs(i)<this.gridDelta)return{axis:t-i,y:0}}return!1},t.prototype.detectY=function(t){if(this.enableShape){var n=e(this.yAxis,t,this.delta);if(n)return n}if(this.enableGrid){var i=(t-this.axis.y)%this.axis.gap;if(Math.abs(i)<this.gridDelta)return{axis:t-i,x:0}}return!1},t.prototype.isEnable=function(){return this.enableShape||this.enableGrid},t.prototype.clear=function(){this.xAxis.length=0,this.yAxis.length=0},t.prototype.dispose=function(){this.clear(),this.axis=null,this.xAxis=this.yAxis=null},t}),define("editor/util/getFontHash",["require"],function(require){function e(e){var t=Array.prototype.splice,n=[e.advanceWidth||0];if(e.contours&&e.contours.length)e.contours.forEach(function(e){e.forEach(function(e){n.push(e.x),n.push(e.y),n.push(e.onCurve?1:0)})});if(e.unicode&&e.unicode.length)t.apply(n,[n.length,0].concat(e.unicode));if(e.name&&e.name.length)t.apply(n,[n.length,0].concat(e.name.split("").map(function(e){return e.charCodeAt(0)})));for(var i=0,r=0,o=n.length;r<o;r++)i=2147483647&131*i+n[r];return i}return e}),define("editor/controller/initSetting",["require","../command/setSelectedCommand","../menu/commandList","common/lang"],function(require){function e(e){n(i.editor,"setting.gridsorption",!!e.sorption.enableGrid),n(i.editor,"setting.shapesorption",!!e.sorption.enableShape),n(i.editor,"setting.showgrid",!!e.axis.showGrid)}function t(e){this.execCommand("gridsorption",e.sorption.enableGrid),this.execCommand("shapesorption",e.sorption.enableShape),this.execCommand("showgrid",e.axis.showGrid),this.fontLayer.options.fill=!!e.fontLayer.fill,this.fontLayer.options.fillColor=e.fontLayer.fillColor,this.fontLayer.options.strokeColor=e.fontLayer.strokeColor,this.fontLayer.refresh(),this.axis.gapColor=e.axis.gapColor,this.axis.metricsColor=e.axis.metricsColor,this.axis.emColor=e.axis.emColor,this.axis.graduation.gap=e.axis.graduation.gap||100,this.axisLayer.refresh(),this.graduationLayer.refresh(),r.overwrite(this.options,e)}var n=require("../command/setSelectedCommand"),i=require("../menu/commandList"),r=require("common/lang");return function(){e.call(this,this.options),this.setOptions=t}}),define("graphics/pathCeil",["require","fonteditor-core/graphics/pathCeil"],function(require){return require("fonteditor-core/graphics/pathCeil")}),define("editor/controller/initFont",["require","common/lang","graphics/pathAdjust","graphics/pathCeil","graphics/computeBoundingBox","render/util/guid","../util/getFontHash"],function(require){function e(e){this.font=e,this.fontHash=c(e);var t=this.axis.x,n=this.axis.y,i=this.fontLayer;if(i.clearShapes(),!e.compound){var r=e.contours||[];delete e.contours;var o=u.computePathBox.apply(null,r);if(o)e.rightSideBearing=e.advanceWidth-o.x-o.width;else e.rightSideBearing=e.advanceWidth;r.forEach(function(e){i.addShape("path",{points:e})});var l=i.shapes;this.history.reset(),this.history.add(a.clone(l));var f=this.render.camera.scale;l.forEach(function(e){s(e.points,f,-f),s(e.points,1,1,t,n)})}i.refresh();var d=e.advanceWidth;return this.rightSideBearing.p0.x=t+(d||this.options.unitsPerEm)*f,this.referenceLineLayer.refresh(),this.setMode(),this}function t(e,t){t=t||this.render.camera.scale;var n=this.axis,i=this.fontLayer,r={};return i.shapes.forEach(function(e){r[e.id]=!0}),e.forEach(function(e){if(s(e.points,t,-t),s(e.points,1,1,n.x,n.y),r[e.id])e.id=f("shape");i.addShape(e)}),i.refresh(),this}function n(e,t){if(!e||0===e.length)return this;var n=e.map(function(e){return{id:f("shape"),type:"path",points:e}});return this.addShapes(n,t),this.fire("change"),n}function i(e){var t=this.axis;e=e?a.clone(e):a.clone(this.fontLayer.shapes);var n=1/this.render.camera.scale;return e.forEach(function(e){s(e.points,n,-n,-t.x,-t.y)}),e}function r(){var e=a.clone(this.font||{});e.unicode=e.unicode||[],e.name=e.name||"";var t=this.axis,n=Math.round((this.rightSideBearing.p0.x-t.x)/this.render.camera.scale),i=this.getShapes(),r=i.map(function(e){return e.points});r.forEach(function(e){l(e)});var o=u.computePathBox.apply(null,r)||{x:0,y:0,width:0,height:0};if(e.xMin=o.x,e.yMin=o.y,e.xMax=o.x+o.width,e.yMax=o.y+o.height,e.leftSideBearing=e.xMin,0===o.width)e.advanceWidth=e.rightSideBearing;else e.advanceWidth=n||e.xMax+e.rightSideBearing||e.xMax;return delete e.rightSideBearing,e.contours=r,e}function o(e){if(this.font){var t=this.render.camera.scale,n=this.fontLayer.shapes,i=this.axis,r=u.computePathBox.apply(null,n.map(function(e){return e.points}));if(r){var o=0,a=r.x-i.x;if(void 0!==e.leftSideBearing&&Math.abs(e.leftSideBearing-a/t)>.01)o=e.leftSideBearing*t-a,n.forEach(function(e){s(e.points,1,1,o,0)}),this.fontLayer.refresh(),this.font.leftSideBearing=e.leftSideBearing,this.fire("change");if(void 0!==e.rightSideBearing)this.font.rightSideBearing=e.rightSideBearing,this.rightSideBearing.p0.x=r.x+r.width+o+e.rightSideBearing*t,this.referenceLineLayer.refresh()}else this.font.rightSideBearing=e.rightSideBearing;if(void 0!==e.unicode)this.font.unicode=e.unicode;if(void 0!==e.name)this.font.name=e.name;return this.fire("change"),this}}var a=require("common/lang"),s=require("graphics/pathAdjust"),l=require("graphics/pathCeil"),u=require("graphics/computeBoundingBox"),f=require("render/util/guid"),c=require("../util/getFontHash");return function(){this.setFont=e,this.getFont=r,this.adjustFont=o,this.addShapes=t,this.getShapes=i,this.addContours=n}}),define("editor/controller/initRender",["require","../menu/commandList","common/lang","../mode/support","render/util/selectShape"],function(require){function e(e){switch(this.contextMenu.hide(),e.command){case"addreferenceline":this.execCommand("addreferenceline",e.pos.x,e.pos.y);break;case"split":this.setMode("split");break;case"paste":var t=this.getClipBoard();if(t)this.execCommand("pasteshapes",t,e.pos);break;case"addsupportshapes":this.execCommand("addsupportshapes",e.args.type);break;case"gridsorption":this.execCommand("gridsorption",!e.args.selected);break;case"shapesorption":this.execCommand("shapesorption",!e.args.selected);break;case"showgrid":this.execCommand("showgrid",!e.args.selected);break;case"save":this.fire("save");break;default:this.execCommand(e.command)}}function t(){var t=this,a=this.render,s=function(e){a.camera.x=e.x,a.camera.y=e.y,a.camera.event=e};a.capture.on("down",function(e){if(!t.contextMenu.visible())a.camera.startX=e.x,a.camera.startY=e.y,s(e),t.mode.down&&t.mode.down.call(t,e)}),a.capture.on("dragstart",function(e){if(!t.contextMenu.visible())s(e),t.mode.dragstart&&t.mode.dragstart.call(t,e)}),a.capture.on("drag",function(e){if(!t.contextMenu.visible())a.camera.mx=e.x-a.camera.x,a.camera.my=e.y-a.camera.y,s(e),t.mode.drag&&t.mode.drag.call(t,e)}),a.capture.on("dragend",function(e){if(!t.contextMenu.visible())s(e),t.mode.dragend&&t.mode.dragend.call(t,e)}),a.capture.on("move",function(e){if(!t.contextMenu.visible())t.graduationMarker.moveTo(e.x-1,e.y-1),t.mode.move&&t.mode.move.call(t,e)}),a.capture.on("up",function(e){if(!t.contextMenu.visible())t.mode.up&&t.mode.up.call(t,e)}),a.capture.on("click",function(e){if(!t.contextMenu.visible())t.mode.click&&t.mode.click.call(t,e)}),a.capture.on("dblclick",function(e){if(!t.contextMenu.visible()){var n=a.getLayer("font").getShapeIn(e);if(n){var i=o(n,e);t.setMode("point",i)}else if(t.mode===r.point)t.setMode()}}),a.capture.on("rightdown",function(r){if(t.mode.rightdown)t.mode.rightdown.call(t,r);else t.contextMenu.onClick=i.bind(e,t),t.contextMenu.show(r,n.editor)}),a.keyCapture.on("keyup",function(e){if(!t.contextMenu.visible())if("esc"===e.key&&!t.mode.keyup)t.setMode();else t.mode.keyup&&t.mode.keyup.call(t,e)}),a.keyCapture.on("keydown",function(e){if(!t.contextMenu.visible())if(83===e.keyCode&&e.ctrlKey)t.fire("save");else if(86===e.keyCode&&e.ctrlKey){var n=t.getClipBoard();if(n)t.execCommand("pasteshapes",n)}else if(187===e.keyCode&&(e.ctrlKey||e.altKey))e.originEvent.stopPropagation(),e.originEvent.preventDefault(),t.execCommand("enlargeview");else if(189===e.keyCode&&(e.ctrlKey||e.altKey))e.originEvent.stopPropagation(),e.originEvent.preventDefault(),t.execCommand("narrowview");else if(90===e.keyCode&&e.ctrlKey)if(t.mode.undo)t.mode.undo.call(t,e);else t.execCommand("undo");else if(89===e.keyCode&&e.ctrlKey)if(t.mode.redo)t.mode.redo.call(t,e);else t.execCommand("redo");else t.mode.keydown&&t.mode.keydown.call(t,e)}),a.keyCapture.on("keydown",function(e){if(!t.contextMenu.visible())t.mode.keydown&&t.mode.keydown.call(t,e)}),a.on("resize",function(e){t.render.move((e.size.width-e.prevSize.width)/2,(e.size.height-e.prevSize.height)/2),t.render.refresh()})}var n=require("../menu/commandList"),i=require("common/lang"),r=require("../mode/support"),o=require("render/util/selectShape");return t}),define("editor/controller/initLayer",["require","common/lang"],function(require){function e(){this.axisLayer=this.render.addLayer("axis",{level:10,fill:!1}),this.fontLayer=this.render.addLayer("font",t.extend({level:20,lineWidth:1,strokeColor:"#999",fillColor:"#555",strokeSeparate:!1},this.options.fontLayer)),this.coverLayer=this.render.addLayer("cover",t.extend({level:30,fill:!1,strokeColor:this.options.coverLayer.strokeColor,fillColor:this.options.coverLayer.fillColor},this.options.coverLayer)),this.referenceLineLayer=this.render.addLayer("referenceline",{level:40,fill:!1,strokeColor:this.options.referenceline.style.strokeColor}),this.graduationLayer=this.render.addLayer("graduation",{level:50,fill:!1,disabled:!0})}var t=require("common/lang");return e}),define("editor/widget/GraduationMarker",["require"],function(require){function e(e,t){t=t||{};var n=document.createElement("div");n.className="marker-x";var i=document.createElement("div");if(i.className="marker-y",t.thickness)n.style.width=t.thickness+"px",i.style.height=t.thickness+"px";e.appendChild(this.xAxis=n),e.appendChild(this.yAxis=i)}return e.prototype.moveTo=function(e,t){this.xAxis.style.top=t+"px",this.yAxis.style.left=e+"px"},e.prototype.dispose=function(){this.xAxis.parentNode.removeChild(this.xAxis),this.yAxis.parentNode.removeChild(this.yAxis),this.xAxis=this.yAxis=null},e}),define("editor/controller/initAxis",["require","common/lang","../widget/GraduationMarker"],function(require){function e(){var e=this.render.painter.width,t=this.render.painter.height,r=this.options,o=(e-r.unitsPerEm)/2,a=(t+(r.unitsPerEm+r.axis.metrics.descent))/2;this.axis=this.axisLayer.addShape("axis",n.extend(n.clone(r.axis),{id:"axis",x:o,y:a,unitsPerEm:r.unitsPerEm,selectable:!1})),this.rightSideBearing=this.referenceLineLayer.addShape("gridarrow",{id:"rightSideBearing",p0:{x:r.unitsPerEm/2},arrow:{y:22},style:{fill:!0,stroke:!0,fillColor:"blue",strokeColor:"blue"}}),this.graduation=this.graduationLayer.addShape("graduation",{config:this.axis}),this.graduationMarker=new i(this.render.main,r.axis.graduation),this.sorption.setGrid(this.axis)}function t(e){var t=this.options.unitsPerEm;if(this.options.unitsPerEm=e.unitsPerEm,n.overwrite(this.options.axis,e),e.graduation&&e.graduation.gap)this.options.axis.graduation.gap=e.graduation.gap;var i=n.clone(this.options.axis),r=this.render.camera.scale,o=i.metrics;Object.keys(o).forEach(function(e){i.metrics[e]=o[e]*r}),i.unitsPerEm=i.unitsPerEm*r,n.extend(this.axis,i);var a=this.render.getSize();this.render.scale(t/this.options.unitsPerEm,{x:a.width/2,y:a.height/2})}var n=require("common/lang"),i=require("../widget/GraduationMarker");return function(){e.call(this),this.setAxis=t}}),define("editor/command/commandSupport",["require"],function(require){return{history:{alignshapes:!0,verticalalignshapes:!0,horizontalalignshapes:!0,joinshapes:!0,intersectshapes:!0,tangencyshapes:!0,splitshapes:!0,removeshapes:!0,reversepoints:!0,topshape:!0,bottomshape:!0,upshape:!0,downshape:!0,cutshapes:!0,pasteshapes:!0,addshapes:!0,rotateleft:!0,rotateright:!0,flipshapes:!0,mirrorshapes:!0}}}),define("editor/controller/initBinder",["require","../command/commandSupport"],function(require){function e(){var e=this;e.on("change",function(){e.history.add(e.getShapes())}),e.on("command",function(n){if(!1!==n.result&&t.history[n.command])e.fire("change")})}var t=require("../command/commandSupport");return e}),define("editor/Editor",["require","./mode/support","./widget/ContextMenu","./command/support","./widget/clipboard","./widget/History","./widget/Sorption","./util/getFontHash","./controller/initSetting","./controller/initFont","./controller/initRender","./controller/initLayer","./controller/initAxis","./controller/initBinder","common/observable"],function(require){function e(e,t){this.options=t||{},this.contextMenu=new n(e,this.options.contextMenu),this.sorption=new a(this.options.sorption),this.history=new o,this.initers=l.concat(t.initers||[])}var t=require("./mode/support"),n=require("./widget/ContextMenu"),i=require("./command/support"),r=require("./widget/clipboard"),o=require("./widget/History"),a=require("./widget/Sorption"),s=require("./util/getFontHash"),l=[require("./controller/initSetting"),require("./controller/initFont"),require("./controller/initRender"),require("./controller/initLayer"),require("./controller/initAxis"),require("./controller/initBinder")];return e.prototype.setRender=function(e){this.render=e;for(var t=0,n=this.initers.length;t<n;t++)this.initers[t].call(this);return this.axisLayer.refresh(),this.graduationLayer.refresh(),this.setMode(),this},e.prototype.setMode=function(e){if(this.mode)this.mode.end&&this.mode.end.call(this);this.mode=t[e]||t.default;var n=Array.prototype.slice.call(arguments,1);return this.mode.begin&&this.mode.begin.apply(this,n),this},e.prototype.reset=function(){return this.fontLayer.clearShapes(),this.coverLayer.clearShapes(),this.font=null,this.refresh(),this},e.prototype.refresh=function(){return this.render.refresh(),this},e.prototype.setSelected=function(e){this.setMode("shapes",e)},e.prototype.refreshSelected=function(e){if(this.currentGroup){var t=this.currentGroup.shapes;if(this.currentGroup.setShapes(e),this.currentGroup.refresh(),e!==t)this.fire("selection:change",{shapes:e})}},e.prototype.getSelected=function(){return this.currentGroup?this.currentGroup.shapes:null},e.prototype.execCommand=function(e){var t=Array.prototype.slice.call(arguments,1),n={command:e,args:t};if(this.fire("beforecommand",n),!1===n.returnValue)return!1;if(i[e]){var r=i[e].apply(this,t);return n.result=r,this.fire("command",n),r}return!1},e.prototype.supportCommand=function(e){return!!i[e]},e.prototype.addCommand=function(e,t){if(i[e])return!1;else return i[e]=t,!0},e.prototype.isChanged=function(){var e=this.getFont();return this.fontHash!==s(e)},e.prototype.setChanged=function(e){if(e)this.fontHash=0;else{var t=this.getFont();this.fontHash=s(t)}},e.prototype.setClipBoard=function(e){return r.set(e,"editor-shape"),this},e.prototype.getClipBoard=function(){return r.get("editor-shape")},e.prototype.focus=function(){this.render.focus()},e.prototype.blur=function(){this.render.blur()},e.prototype.dispose=function(){this.un(),this.contextMenu.dispose(),this.render&&this.render.dispose(),this.graduationMarker.dispose(),this.options=this.contextMenu=this.render=null,this.fontLayer=this.coverLayer=this.axisLayer=this.referenceLineLayer=this.graduationLayer=null,this.axis=this.rightSideBearing=this.graduation=this.graduationMarker=this.font=null,this.sorption.dispose(),this.sorption=null,this.history.reset(),this.history=null,this.mode=null},require("common/observable").mixin(e.prototype),e}),define("editor/main",["require","render/main","./Editor","./options","common/lang"],function(require){var e=require("render/main"),t=require("./Editor"),n=require("./options"),i=require("common/lang"),exports={};return exports.create=function(r,o){if(!r)throw"need main element";o=i.extend({},n,o);var a=new t(r,o.editor),s=o.render||{};return s.controller=a,e.create(r,s),a},exports}),define("fonteditor/widget/GLYFEditor",["require","editor/main","editor/options","../dialog/support","./program","common/lang"],function(require){function e(){var e=this,t=this.editor,n=s.debounce(function(){e.focus()},20);t.on("setting:font",function(e){new(0,o.glyf)({onChange:function(e){t.adjustFont(e),n()}}).show(e.setting)}),t.on("setting:editor",function(t){new(0,o.editor)({onChange:function(t){setTimeout(function(){a.viewer.setSetting(t.viewer),e.setSetting(t.editor)},20)}}).show({viewer:a.viewer.getSetting(),editor:t.setting})});var i=this.commandMenu;if(i)t.on("selection:change",s.debounce(function(e){var t=e.shapes?e.shapes.length:0;if(!t)i.disableCommands(l.shapes),i.disableCommands(l.shapes2),i.disableCommands(l.shape);else i.enableCommands(l.shapes),i[t>=2?"enableCommands":"disableCommands"](l.shapes2),i[1===t?"enableCommands":"disableCommands"](l.shape)}),100),i.on("command",function(e){n();var i,r=e.command,o=e.args;if("save"===r)return void a.fire("save",{saveType:"editor"});if("splitshapes"===r)return void t.setMode("split");if("pasteshapes"===r)i=t.getClipBoard();else i=t.getSelected();if(i&&i.length)switch(r){case"pointmode":t.setMode("point",i[0]);break;case"topshape":case"bottomshape":case"upshape":case"downshape":t.execCommand(r,i[0]);break;case"copyshapes":case"pasteshapes":case"removeshapes":case"joinshapes":case"intersectshapes":case"tangencyshapes":case"rotateleft":case"rotateright":case"flipshapes":case"mirrorshapes":case"cutshapes":case"copyshapes":case"removeshapes":case"reversepoints":case"joinshapes":case"intersectshapes":case"tangencyshapes":t.execCommand(r,i);break;case"alignshapes":case"verticalalignshapes":case"horizontalalignshapes":t.execCommand(r,i,o.align)}else if("rangemode"===r)t.setMode("bound")})}function t(){if(this.editor)this.editor.execCommand.apply(this.editor,arguments)}function n(e,t){if(this.main=$(e),this.options=s.extend({},t),this.options.commandMenu)this.commandMenu=this.options.commandMenu,delete this.options.commandMenu}var i=require("editor/main"),r=require("editor/options"),o=require("../dialog/support"),a=require("./program"),s=require("common/lang"),l={shapes:["copyshapes","removeshapes","reversepoints","horizontalalignshapes","verticalalignshapes","rotateleft","rotateright","flipshapes","mirrorshapes"],shapes2:["joinshapes","intersectshapes","tangencyshapes"],shape:["pointmode","upshape","downshape"]};return n.prototype.show=function(){if(this.main.show(),!this.editor)this.editor=i.create(this.main.get(0)),e.call(this);this.editing=!0},n.prototype.hide=function(){this.editor&&this.editor.blur(),this.main.hide(),this.editing=!1},n.prototype.isEditing=function(){return this.editing},n.prototype.isVisible=function(){return this.editor&&"none"!==this.main.get(0).style.display},n.prototype.focus=function(){this.editing=!0,this.editor&&this.editor.focus()},n.prototype.blur=function(){this.editing=!1,this.editor&&this.editor.blur()},n.prototype.undo=function(){t.call(this,"undo")},n.prototype.redo=function(){t.call(this,"redo")},n.prototype.setSetting=function(e){if(this.editor)this.editor.setOptions(e);else s.overwrite(r.editor,e)},n.prototype.getSetting=function(){return this.editor?this.editor.options:r.editor},n.prototype.execCommand=t,n.prototype.dispose=function(){this.editor.dispose(),this.main=this.options=this.editor=null},["reset","setFont","getFont","isChanged","setChanged","setAxis","adjustFont"].forEach(function(e){n.prototype[e]=function(){return this.editor?this.editor[e].apply(this.editor,arguments):void 0}}),n}),define("fonteditor/widget/ProjectViewer",["require","../i18n/i18n","common/string","common/observable"],function(require){function e(e,n){this.options=n||{},this.main=$(e);var i=this;i.main.on("click","[data-action]",function(e){e.stopPropagation();var n=$(e.target),r=n.attr("data-action"),o=n.parents("[data-id]").attr("data-id");if("del"===r){if(!window.confirm(t.lang.msg_confirm_del_proj))return;i.current&&i.current.remove(),i.current=null}i.fire(r,{projectId:o})}),i.main.on("click","[data-id]",function(e){i.fire("open",{projectId:$(this).attr("data-id")})})}var t=require("../i18n/i18n"),n=require("common/string");return e.prototype.select=function(e){this.current&&this.current.removeClass("selected"),this.current=$('[data-id="'+e+'"]',this.main).addClass("selected")},e.prototype.unSelect=function(){this.current&&this.current.removeClass("selected"),this.current=null},e.prototype.show=function(e,i){var r="";if((e||[]).forEach(function(e){r+='<dl data-id="'+n.encodeHTML(e.id)+'"><dt>'+n.encodeHTML(e.name)+"</dt><dd>"+(e.config&&e.config.sync?'<span data-action="sync" title="'+t.lang.syncfont+'">'+t.lang.sync+"</span>":"")+'<span data-action="saveas">'+t.lang.saveas+'</span><span data-action="del">'+t.lang.del+"</span></dd></dl>"}),this.main.html(r),void 0!==i)this.select(i)},require("common/observable").mixin(e.prototype),e}),define("common/DataStore",["require","./lang"],function(require){function e(e){if(!n)throw"not support indexed db";t.extend(this,e),this.name=this.name||"default-datastore"}var t=require("./lang"),n=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.msIndexedDB;return e.prototype.open=function(e,t){var i=n.open(this.name),r=this;return i.onerror=function(e){t&&t(e)},i.onsuccess=function(n){if(r.db=n.target.result,!r.db.objectStoreNames.contains(r.storeName))r.switchStore(r.storeName,e,t);else e&&e(n)},this},e.prototype.add=function(e,t,n,i){if(null==t)throw"can't save `null` to datastore";if(this.db){var r=this.db.transaction([this.storeName],"readwrite"),o=r.objectStore(this.storeName).add({id:e,data:t});o.onsuccess=function(t){n&&n(e)},o.onerror=function(e){i&&i(e)}}return this},e.prototype.update=function(e,t,n,i){if(this.db){var r=this.db.transaction([this.storeName],"readwrite"),o=r.objectStore(this.storeName).put({id:e,data:t});o.onsuccess=function(t){if(null==t.target.result)i&&i(t);else n&&n(e)},o.onerror=function(e){i&&i(e)}}return this},e.prototype.get=function(e,t,n){if(this.db){var i=this.db.transaction([this.storeName]),r=i.objectStore(this.storeName).get(e);r.onsuccess=function(e){var i=e.target.result;if(null==i)n&&n(e);else t&&t(i.data)},r.onerror=function(e){n&&n(e)}}return this},e.prototype.remove=function(e,t,n){if(this.db){var i=this.db.transaction([this.storeName],"readwrite"),r=i.objectStore(this.storeName).delete(e);r.onsuccess=function(){t&&t(e)},r.onerror=function(e){n&&n(e)}}return this},e.prototype.clear=function(e,t){if(this.db){var n=this.db.transaction([this.storeName],"readwrite"),i=n.objectStore(this.storeName).clear();i.onsuccess=function(t){e&&e(t)},i.onerror=function(e){t&&t(e)}}return this},e.prototype.removeStore=function(e,t,i){if(this.db){var r=this,o=this.db.version;r.close();var a=n.open(this.name,o+1);a.onerror=function(e){i&&i(e)},a.onupgradeneeded=function(n){r.db=n.target.result,r.db.deleteObjectStore(e),setTimeout(function(){t&&t(n)})}}return this},e.prototype.switchStore=function(e,t,i){if(this.db){var r=this;if(r.storeName=e,!r.db.objectStoreNames.contains(r.storeName)){var o=r.db.version;r.close();var a=n.open(r.name,o+1);a.onerror=function(e){i&&i(e)},a.onupgradeneeded=function(e){r.db=e.target.result,r.db.createObjectStore(r.storeName,{keyPath:"id"}),setTimeout(function(){t&&t(e)})}}else t&&t()}return this},e.prototype.removeDataBase=function(){return n.deleteDataStore(this.name),this},e.prototype.close=function(){return this.db&&this.db.close(),this.db=null,this},e.prototype.dispose=function(){this.close(),this.onError=this.onOpen=this.onUpdate=null},e.enabled=!!n,e}),define("common/promise",[],function(){function e(e){return"function"==typeof e}function t(e){return"[object Object]"===Object.prototype.toString.call(e)}function n(i,r){if(t(r)||e(r)){var o;try{var a=r.then;if(e(a))a.call(r,function(e){if(!o)n(i,e),o=!0},function(e){if(!o)i.reject(e),o=!0});else i.fulfill(r)}catch(e){if(!d)throw e;else if(!o)u(e),i.reject(e)}}else i.fulfill(r)}function i(e,t,i){return function(r){try{var o=i(r);if(o===t)throw new TypeError;n(e,o)}catch(t){if(d)u(t),e.reject(t);else throw t}}}function r(e,t,n){if(e.status===t)p(function(){n(e.data)});else if(t===c.FULFILLED)e.fulfillList.push(n);else if(t===c.REJECTED)e.rejectList.push(n)}function o(e){var t=e.status===c.FULFILLED?e.fulfillList:e.rejectList;if(l(e),t.length)p(function(){for(var n;n=t.shift();)n(e.data)})}function a(t,n,o){var a=new f,l=s(a);if(e(n))n=i(a,l,n);else n=function(e){a.fulfill(e)};if(r(t,c.FULFILLED,n),e(o))o=i(a,l,o);else o=function(e){a.reject(e)};return r(t,c.REJECTED,o),l}function s(e){return{then:function(t,n){return a(e,t,n)}}}function l(e){var t=e.status===c.FULFILLED?"resolve":"reject";if(h)f.emit(t,e.data)}function u(e){if(h)f.emit("exception",e)}function f(){this.status=c.PENDING,this.fulfillList=[],this.rejectList=[]}var c={PENDING:0,FULFILLED:1,REJECTED:2},d=!0,h=!1,p=function(){function t(){var e,t=r.length;for(e=0;e<t;e++)r[e]();r.splice(0,e)}var n,i,r=[],o="promise";if("function"==typeof setImmediate)n=setImmediate;else if(i=window.MutationObserver||window.webKitMutationObserver){var a=new i(function(e){if(e[0].attributeName===o)t()}),s=document.createElement("div");a.observe(s,{attributes:!0}),n=function(e){r.push(e),s.setAttribute(o,Date.now?Date.now():(new Date).getTime())}}else if(e(window.postMessage))window.addEventListener("message",function(e){if(e.source===window&&e.data===o)t()},!1),n=function(e){r.push(e),window.postMessage(o,"*")};else n=function(e){setTimeout(e,0)};return n}();return f.enableGlobalEvent=function(e){e.mixin(this),h=!0},f.disableExceptionCapture=function(){d=!1},f.enableExceptionCapture=function(){d=!0},f.all=function(e){function t(t){return function(n){if(o[t]=n,++r>=e.length)i.fulfill(o)}}function n(e){i.reject(e)}if(!Array.isArray(e))e=Array.prototype.slice.call(arguments);var i=new f,r=0,o=[];return e.forEach(function(e,i){e.then(t(i),n)}),i.promise()},f.promise=function(e){var t=new f;return e(t),t.promise()},f.rejected=function(e){return this.promise(function(t){t.reject(e)})},f.fulfilled=function(e){return this.promise(function(t){t.fulfill(e)})},f.resolved=f.fulfilled,f.prototype.fulfill=function(e){if(this.status===c.PENDING)this.data=e,this.status=c.FULFILLED,o(this)},f.prototype.resolve=f.prototype.fulfill,f.prototype.reject=function(e){if(this.status===c.PENDING)this.data=e,this.status=c.REJECTED,o(this)},f.prototype.promise=function(){return s(this)},f}),define("fonteditor/widget/project",["require","common/lang","common/DataStore","common/promise"],function(require){var e,t=require("common/lang"),n=require("common/DataStore"),i=require("common/promise"),r=window.localStorage||window.sessionStorate,o=new i;if(n.enabled)e=new n({name:"fonteditor-datastore",storeName:"project"}),e.open(function(){o.resolve(a)},function(){e=null,o.resolve(a)});var a={ready:function(){return o.promise()},getId:function(){return""+Date.now()},items:function(){var e=r.getItem("project-list");return e?JSON.parse(e).map(function(e){return e.id=""+e.id,e}):[]},add:function(t,n,o){var a=this.items(),s=o&&o.id||this.getId(),l={name:t,id:s};if(o)l.config=o;if(a.push(l),r.setItem("project-list",JSON.stringify(a)),e){var u=new i;return e.add(s,n,function(){u.resolve(s)},function(){u.reject(n)}),u.promise()}return r.setItem(s,JSON.stringify(n)),i.resolved(s)},update:function(t,n,o){if(o)this.updateConfig(t,o);if(e){var a=new i;return e.update(t,n,function(){a.resolve(t)},function(){a.reject(t)}),a.promise()}return r.setItem(t,JSON.stringify(n)),i.resolved(t)},remove:function(t,n){for(var o=this.items(),a=o.length-1;a>=0;a--)if(o[a].id===t)r.removeItem(o[a].id),o.splice(a,1);if(e){var s=new i;return e.remove(t,function(){r.setItem("project-list",JSON.stringify(o)),s.resolve(o)},function(){n&&r.setItem("project-list",JSON.stringify(o)),s.reject(t)}),s.promise()}return r.setItem("project-list",JSON.stringify(o)),i.resolved(o)},get:function(t){for(var n=this.items(),o=0,a=n.length;o<a;o++)if(n[o].id===t){if(e){var s=new i;return e.get(t,function(e){s.resolve(e)},function(){s.reject(t)}),s.promise()}var l=r.getItem(n[o].id);if(l)return i.resolved(JSON.parse(l))}return i.rejected(t)},getConfig:function(e){var t=this.items(),n=t.filter(function(t){return t.id===e})[0];if(!n)return!1;else return n.config||{}},updateConfig:function(e,n){for(var i=this.items(),o=!1,a=i.length-1;a>=0;a--)if(i[a].id===e){if(i[a].config)t.extend(i[a].config,n);else i[a].config=n;o=!0;break}if(o)r.setItem("project-list",JSON.stringify(i));return o},clear:function(){var t=this.items();if(e)t.forEach(function(t){e.remove(t.id)});else t.forEach(function(e){r.removeItem(e.id)});r.removeItem("project-list")}};return a}),define("fonteditor-core/ttf/util/compound2simpleglyf",["require","./transformGlyfContours","./compound2simple"],function(require){function e(e,i,r){var o;if("number"==typeof e)o=e,e=i.glyf[o];else if(-1===(o=i.glyf.indexOf(e)))return e;if(!e.compound||!e.glyfs)return e;var a={};if(t(e,i,a,o),r)Object.keys(a).forEach(function(e){n(i.glyf[e],a[e])});else n(e,a[o]);return e}var t=require("./transformGlyfContours"),n=require("./compound2simple");return e}),define("fonteditor-core/ttf/util/reduceGlyf",["require","../../graphics/reducePath"],function(require){function e(e){for(var n,i=e.contours,r=i.length-1;r>=0;r--)if(n=t(i[r]),!(n.length<=2));else i.splice(r,1);if(0===e.contours.length)delete e.contours;return e}var t=require("../../graphics/reducePath");return e}),define("fonteditor-core/ttf/util/optimizettf",["require","./reduceGlyf","../../graphics/pathCeil"],function(require){function e(e){var i={},r=[];if(e.glyf.forEach(function(e,o){if(e.unicode)e.unicode=e.unicode.sort(),e.unicode.sort(function(e,t){return e-t}).forEach(function(e){if(i[e])r.push(o);else i[e]=!0});if(!e.compound&&e.contours)e.contours.forEach(function(e){n(e)}),t(e);e.xMin=Math.round(e.xMin||0),e.xMax=Math.round(e.xMax||0),e.yMin=Math.round(e.yMin||0),e.yMax=Math.round(e.yMax||0),e.leftSideBearing=Math.round(e.leftSideBearing||0),e.advanceWidth=Math.round(e.advanceWidth||0)}),!e.glyf.some(function(e){return e.compound}))e.glyf=e.glyf.filter(function(e,t){return 0===t||e.contours&&e.contours.length});if(!r.length)return!0;else return{repeat:r}}var t=require("./reduceGlyf"),n=require("../../graphics/pathCeil");return e}),define("fonteditor-core/ttf/ttf",["require","../common/lang","./util/string","../graphics/pathAdjust","../graphics/pathCeil","../graphics/computeBoundingBox","./util/compound2simpleglyf","./util/glyfAdjust","./util/optimizettf","./data/default"],function(require){function e(e,t,n,i){return e.forEach(function(e){if(e.contours&&e.contours.length){var r=e.advanceWidth-e.xMax,o=l.computePath.apply(null,e.contours),u=(t-n-i)/o.height,f=(t+n)/2,c=f-(o.y+o.height/2)*u;e.contours.forEach(function(e){if(1!==u)a(e,u,u);a(e,1,1,0,c),s(e)});var d=l.computePathBox.apply(null,e.contours);e.xMin=d.x,e.xMax=d.x+d.width,e.yMin=d.y,e.yMax=d.y+d.height,e.leftSideBearing=e.xMin,e.advanceWidth=e.xMax+r}}),e}function t(e,t,n,i){var r=!1;if(null!=t)r=!0,e.forEach(function(e){if(e.leftSideBearing!==t)f(e,1,1,t-e.leftSideBearing)});if(null!=n)r=!0,e.forEach(function(e){e.advanceWidth=e.xMax+n});if(null!=i)r=!0,e.forEach(function(e){if(e.contours&&e.contours.length){var t=l.computePath.apply(this,e.contours),n=i-t.y;f(e,1,1,0,n)}});return r?e:[]}function n(n,i,r){r=r||{scale:!0};var o=i.glyf.filter(function(e,t){return e.contours&&e.contours.length&&".notdef"!==e.name&&".null"!==e.name&&"nonmarkingreturn"!==e.name});if(r.adjustGlyf){var a=n.hhea.ascent,s=n.hhea.descent;t(o,16,16),e(o,a,s,16),o.forEach(function(e){n.glyf.push(e)})}else if(r.scale){var l=1;if(i.head.unitsPerEm&&i.head.unitsPerEm!==n.head.unitsPerEm)l=n.head.unitsPerEm/i.head.unitsPerEm;o.forEach(function(e){f(e,l,l),n.glyf.push(e)})}return o}function i(e){this.ttf=e}var r=require("../common/lang"),o=require("./util/string"),a=require("../graphics/pathAdjust"),s=require("../graphics/pathCeil"),l=require("../graphics/computeBoundingBox"),u=require("./util/compound2simpleglyf"),f=require("./util/glyfAdjust"),c=require("./util/optimizettf"),d=require("./data/default");return i.prototype.codes=function(){return Object.keys(this.ttf.cmap)},i.prototype.getGlyfIndexByCode=function(e){var t="number"==typeof e?e:e.charCodeAt(0);return this.ttf.cmap[t]||-1},i.prototype.getGlyfByIndex=function(e){return this.ttf.glyf[e]},i.prototype.getGlyfByCode=function(e){var t=this.getGlyfIndexByCode(e);return this.getGlyfByIndex(t)},i.prototype.set=function(e){return delete this.ttf,this.ttf=e,this},i.prototype.get=function(){return this.ttf},i.prototype.addGlyf=function(e){return this.insertGlyf(e)},i.prototype.insertGlyf=function(e,t){if(t>=0&&t<this.ttf.glyf.length)this.ttf.glyf.splice(t,0,e);else this.ttf.glyf.push(e);return[e]},i.prototype.mergeGlyf=function(e,t){return n(this.ttf,e,t)},i.prototype.removeGlyf=function(e){for(var t=this.ttf.glyf,n=[],i=t.length-1;i>=0;i--)if(e.indexOf(i)>=0)n.push(t[i]),t.splice(i,1);return n},i.prototype.setUnicode=function(e,t,n){var i=this.ttf.glyf,r=[];if(t&&t.length){var a=t.indexOf(0);if(a>=0)t.splice(a,1);r=t.map(function(e){return i[e]})}else r=i.slice(1);if(r.length>1){var s=function(e){return e<33};r=r.filter(function(e){return!e.unicode||!e.unicode.some(s)})}if(r.length)e=Number("0x"+e.slice(1)),r.forEach(function(t){if(160===e||12288===e)e++;if(t.unicode=[e],n)t.name=o.getUnicodeName(e);e++});return r},i.prototype.genGlyfName=function(e){var t=this.ttf.glyf,n=[];if(e&&e.length)n=e.map(function(e){return t[e]});else n=t;if(n.length){var i=this.ttf.glyf[0];n.forEach(function(e){if(e===i)e.name=".notdef";else if(e.unicode&&e.unicode.length)e.name=o.getUnicodeName(e.unicode[0]);else e.name=".notdef"})}return n},i.prototype.clearGlyfName=function(e){var t=this.ttf.glyf,n=[];if(e&&e.length)n=e.map(function(e){return t[e]});else n=t;if(n.length)n.forEach(function(e){delete e.name});return n},i.prototype.appendGlyf=function(e,t){var n=this.ttf.glyf,i=e.slice(0);if(t&&t.length){for(var r=Math.min(e.length,t.length),o=0;o<r;o++)n[t[o]]=e[o];e=e.slice(r)}if(e.length)Array.prototype.splice.apply(n,[n.length,0].concat(e));return i},i.prototype.adjustGlyfPos=function(e,n){return t(this.getGlyf(e),n.leftSideBearing,n.rightSideBearing,n.verticalAlign)},i.prototype.adjustGlyf=function(t,n){var i=this.getGlyf(t),r=!1;if(n.reverse||n.mirror)r=!0,i.forEach(function(e){if(e.contours&&e.contours.length){var t=e.xMax+e.xMin,i=e.yMax+e.yMin;e.contours.forEach(function(e){a(e,n.mirror?-1:1,n.reverse?-1:1),a(e,1,1,n.mirror?t:0,n.reverse?i:0)})}});if(n.scale&&1!==n.scale){r=!0;var o=n.scale;i.forEach(function(e){if(e.contours&&e.contours.length)f(e,o,o)})}else if(n.ajdustToEmBox){r=!0;var s=this.ttf.hhea.ascent,l=this.ttf.hhea.descent,u=2*(n.ajdustToEmPadding||0);e(i,s,l,u)}return r?i:[]},i.prototype.getGlyf=function(e){var t=this.ttf.glyf;if(e&&e.length)return e.map(function(e){return t[e]});else return t},i.prototype.findGlyf=function(e){if(!e)return[];var t=[];if(e.unicode){var n=Array.isArray(e.unicode)?e.unicode:[e.unicode],i={};n.forEach(function(e){if("string"==typeof e)e=Number("0x"+e.slice(1));i[e]=!0}),t.push(function(e){if(!e.unicode||!e.unicode.length)return!1;for(var t=0,n=e.unicode.length;t<n;t++)if(i[e.unicode[t]])return!0})}if(e.name){var r=e.name;t.push(function(e){return e.name&&0===e.name.indexOf(r)})}if("function"==typeof e.filter)t.push(e.filter);var o=[];return this.ttf.glyf.forEach(function(e,n){for(var i,r=0;i=t[r++];)if(!0===i(e)){o.push(n);break}}),o},i.prototype.replaceGlyf=function(e,t){if(t>=0&&t<this.ttf.glyf.length)return this.ttf.glyf[t]=e,[e];else return[]},i.prototype.setGlyf=function(e){return delete this.glyf,this.ttf.glyf=e||[],this.ttf.glyf},i.prototype.sortGlyf=function(){var e=this.ttf.glyf;if(e.length>1){if(e.some(function(e){return e.compound}))return-2;var t=e.shift();return e.sort(function(e,t){if(!(e.unicode&&e.unicode.length||t.unicode&&t.unicode.length))return 0;else if((!e.unicode||!e.unicode.length)&&t.unicode)return 1;else if(e.unicode&&(!t.unicode||!t.unicode.length))return-1;return Math.min.apply(null,e.unicode)-Math.min.apply(null,t.unicode)}),e.unshift(t),e}return-1},i.prototype.setName=function(e){if(e)this.ttf.name.fontFamily=this.ttf.name.fullName=e.fontFamily||d.name.fontFamily,this.ttf.name.fontSubFamily=e.fontSubFamily||d.name.fontSubFamily,this.ttf.name.uniqueSubFamily=e.uniqueSubFamily||"",this.ttf.name.postScriptName=e.postScriptName||"";return this.ttf.name},i.prototype.setHead=function(e){if(e){if(e.unitsPerEm&&e.unitsPerEm>=64&&e.unitsPerEm<=16384)this.ttf.head.unitsPerEm=e.unitsPerEm;if(e.lowestRecPPEM&&e.lowestRecPPEM>=8&&e.lowestRecPPEM<=16384)this.ttf.head.lowestRecPPEM=e.lowestRecPPEM;if(e.created)this.ttf.head.created=e.created;if(e.modified)this.ttf.head.modified=e.modified}return this.ttf.head},i.prototype.setHhea=function(e){return r.overwrite(this.ttf.hhea,e,["ascent","descent","lineGap"]),this.ttf.hhea},i.prototype.setOS2=function(e){return r.overwrite(this.ttf["OS/2"],e,["usWinAscent","usWinDescent","sTypoAscender","sTypoDescender","sTypoLineGap","sxHeight","bXHeight","usWeightClass","usWidthClass","yStrikeoutPosition","yStrikeoutSize","achVendID","bFamilyType","bSerifStyle","bWeight","bProportion","bContrast","bStrokeVariation","bArmStyle","bLetterform","bMidline","bXHeight"]),this.ttf["OS/2"]},i.prototype.setPost=function(e){return r.overwrite(this.ttf.post,e,["underlinePosition","underlineThickness"]),this.ttf.post},i.prototype.calcMetrics=function(){var e,t,n=-16384,i=16384,r=120,o=72;return this.ttf.glyf.forEach(function(a){if(a.yMax>n)n=a.yMax;if(a.yMin<i)i=a.yMin;if(a.unicode){if(a.unicode.indexOf(r)>=0)e=a.yMax;if(a.unicode.indexOf(o)>=0)t=a.yMax}}),n=Math.round(n),i=Math.round(i),{ascent:n,descent:i,sTypoAscender:n,sTypoDescender:i,usWinAscent:n,usWinDescent:-i,sxHeight:e||0,sCapHeight:t||0}},i.prototype.optimize=function(){return c(this.ttf)},i.prototype.compound2simple=function(e){var t=this.ttf;if(t.maxp&&!t.maxp.maxComponentElements)return[];var n,i;if(!e||!e.length)for(e=[],n=0,i=t.glyf.length;n<i;++n)if(t.glyf[n].compound)e.push(n);var r=[];for(n=0,i=e.length;n<i;++n){var o=e[n];if(t.glyf[o]&&t.glyf[o].compound)u(o,t,!0),r.push(t.glyf[o])}return r},i}),define("fonteditor/widget/TTFManager",["require","../i18n/i18n","common/lang","editor/widget/History","fonteditor-core/ttf/ttf","fonteditor-core/ttf/util/string","fonteditor-core/ttf/util/transformGlyfContours","fonteditor-core/ttf/util/compound2simple","common/observable"],function(require){function e(e){return e.forEach(function(e){delete e.modify}),e}function t(e){this.ttf=new o(e),this.changed=!1,this.history=new r}var n=require("../i18n/i18n"),i=require("common/lang"),r=require("editor/widget/History"),o=require("fonteditor-core/ttf/ttf"),a=require("fonteditor-core/ttf/util/string"),s=require("fonteditor-core/ttf/util/transformGlyfContours"),l=require("fonteditor-core/ttf/util/compound2simple");return t.prototype.pushHistory=function(){return this.history.add(i.clone(this.ttf.get())),this},t.prototype.fireChange=function(e,t){return e&&this.pushHistory(),this.changed=!0,this.fire("change",{ttf:this.ttf.get(),changeType:t||"change"}),this},t.prototype.set=function(t){if(this.ttf.get()!==t)this.ttf.set(t),e(this.ttf.getGlyf()),this.history.reset(),this.pushHistory(),this.changed=!1,this.fire("set",{ttf:this.ttf.get()});return this},t.prototype.get=function(){return this.ttf.get()},t.prototype.findGlyf=function(e){if(null!=e.index){var t=this.ttf.getGlyf().length;return e.index.filter(function(e){return e>=0&&e<t})}return this.ttf.findGlyf(e)},t.prototype.insertGlyf=function(e,t){var n=this.ttf.getGlyf(),i=32;if(!e.unicode||!e.unicode.length){for(var r=n.length-1;r>0;r--){var o=n[r];if(o.unicode&&o.unicode.length){var s=Math.max.apply(null,o.unicode);i=Math.max(s,i)}}if(65535===++i)i++;e.unicode=[i]}if(!e.name)e.name=a.getUnicodeName(e.unicode[0]);return e.modify="new",this.ttf.insertGlyf(e,t),this.fireChange(!0),this},t.prototype.merge=function(e,t){var n=this.ttf.mergeGlyf(e,t);if(n.length)n.forEach(function(e){e.modify="new"}),this.fireChange(!0);return this},t.prototype.removeGlyf=function(e){if(this.ttf.removeGlyf(e).length)this.fireChange(!0);return this},t.prototype.setUnicode=function(e,t,n){var i=this.ttf.setUnicode(e,t,n);if(i.length)i.forEach(function(e){e.modify="edit"}),this.fireChange(!0);return this},t.prototype.genGlyfName=function(e){var t=this.ttf.genGlyfName(e);if(t.length)t.forEach(function(e){e.modify="edit"}),this.fireChange(!0);return this},t.prototype.clearGlyfName=function(e){var t=this.ttf.clearGlyfName(e);if(t.length)t.forEach(function(e){e.modify="edit"}),this.fireChange(!0);return this},t.prototype.appendGlyf=function(e,t){var n=this.ttf.appendGlyf(e,t);if(n.length)n.forEach(function(e){e.modify="new"}),this.fireChange(!0);return this},t.prototype.replaceGlyf=function(e,t){var n=this.ttf.replaceGlyf(e,t);if(n.length)n[0].modify="edit",this.fireChange(!0,"replace");return this},t.prototype.adjustGlyfPos=function(e,t){var n=this.ttf.adjustGlyfPos(e,t);if(n.length)n.forEach(function(e){e.modify="edit"}),this.fireChange(!0);return this},t.prototype.adjustGlyf=function(e,t){var n=this.ttf.adjustGlyf(e,t);if(n.length)n.forEach(function(e){e.modify="edit"}),this.fireChange(!0);return this},t.prototype.updateGlyf=function(e,t){var n=this.getGlyf([t])[0],i=!1;if(e.unicode.length)n.unicode=e.unicode,n.modify="edit",i=!0;if(e.name!==n.name)n.name=e.name,n.modify="edit",i=!0;if(void 0!==e.leftSideBearing&&e.leftSideBearing!==n.leftSideBearing||void 0!==e.rightSideBearing&&e.rightSideBearing+(n.xMax||0)!==n.advanceWidth){var r=this.ttf.adjustGlyfPos([t],e);if(r.length)r.forEach(function(e){e.modify="edit"}),i=!0}return i&&this.fireChange(!0),this},t.prototype.getGlyf=function(e){return this.ttf.getGlyf(e)},t.prototype.setInfo=function(e){return this.ttf.setName(e),this.ttf.setHead(e),this.fireChange(!0),this},t.prototype.setMetrics=function(e){return this.ttf.setHhea(e),this.ttf.setOS2(e),this.ttf.setPost(e),this.fireChange(!0),this},t.prototype.optimize=function(){var e=this.ttf.optimize();if(this.ttf.get().glyf.forEach(function(e){e.modify="edit"}),this.fireChange(!0),!0===e)return!0;var t="";if(e.repeat)t=n.lang.msg_repeat_unicode+e.repeat.join(",");return{repeat:e.repeat,message:t}},t.prototype.sortGlyf=function(){var e=this.ttf.sortGlyf();if(-1===e)return{message:n.lang.msg_no_sort_glyf};else if(-2===e)return{message:n.lang.msg_has_compound_glyf_sort};if(e.length)e.forEach(function(e){e.modify="edit"}),this.fireChange(!0);return!0},t.prototype.compound2simple=function(e){var t=this.ttf.compound2simple(e);if(t.length)t.forEach(function(e){e.modify="edit"}),this.fireChange(!0);return this},t.prototype.undo=function(){if(!this.history.atFirst())this.ttf.set(this.history.back()),this.fireChange(!1);return this},t.prototype.redo=function(){if(!this.history.atLast())this.ttf.set(this.history.forward()),this.fireChange(!1);return this},t.prototype.isChanged=function(){return!!this.changed},t.prototype.setState=function(e){if("new"===e)this.changed=!1;else if("saved"===e)this.ttf.get().glyf.forEach(function(e){delete e.modify}),this.fire("change",{ttf:this.ttf.get(),changeType:e}),this.changed=!1;return this},t.prototype.getCopiedGlyf=function(e){for(var t=[],n=this.ttf.get(),r=0,o=e.length;r<o;++r){var a=e[r],u=i.clone(n.glyf[a]);if(n.glyf[a].compound)l(u,s(n.glyf[a],n));t.push(u)}return t},t.prototype.clearGlyfTag=e,t.prototype.calcMetrics=function(){if(this.ttf)return this.ttf.calcMetrics()},t.prototype.dispose=function(){this.un(),delete this.ttf},require("common/observable").mixin(t.prototype),t}),"undefined"!=typeof exports)module.exports={toArrayBuffer:toArrayBuffer,toBuffer:toBuffer};else define("fonteditor-core/nodejs/buffer",["require"],function(require){return{toArrayBuffer:toArrayBuffer,toBuffer:toBuffer}});if(define("fonteditor-core/ttf/i18n",["require","../common/I18n"],function(require){return new(require("../common/I18n"))([["zh-cn",{10001:"超出读取范围：${0}, ${1}",10002:"超出写入范围：${0}, ${1}",10003:"未知数据类型：${0}, ${1}",10004:"不支持svg解析",10101:"错误的ttf文件",10102:"错误的woff文件",10103:"错误的svg文件",10104:"读取ttf文件错误",10105:"读取woff文件错误",10106:"读取svg文件错误",10107:"写入ttf文件错误",10108:"写入woff文件错误",10109:"写入svg文件错误",10112:"写入svg symbol 错误",10110:"读取eot文件错误",10111:"读取eot字体错误",10200:"重复的unicode代码点，字形序号：${0}",10201:"ttf字形轮廓数据为空",10202:"不支持标志位：ARGS_ARE_XY_VALUES",10203:"未找到表：${0}",10204:"读取ttf表错误",10205:"未找到解压函数",10301:"错误的otf文件",10302:"读取otf表错误",10303:"otf字形轮廓数据为空"}],["en-us",{10001:"Reading index out of range: ${0}, ${1}",10002:"Writing index out of range: ${0}, ${1}",10003:"Unknown datatype: ${0}, ${1}",10004:"No svg parser",10101:"ttf file damaged",10102:"woff file damaged",10103:"svg file damaged",10104:"Read ttf error",10105:"Read woff error",10106:"Read svg error",10107:"Write ttf error",10108:"Write woff error",10109:"Write svg error",10112:"Write svg symbol error",10110:"Read eot error",10111:"Write eot error",10200:"Repeat unicode, glyph index: ${0}",10201:"ttf `glyph` data is empty",10202:"Not support compound glyph flag: ARGS_ARE_XY_VALUES",10203:"No ttf table: ${0}",10204:"Read ttf table data error",10205:"No zip deflate function",10301:"otf file damaged",10302:"Read otf table error",10303:"otf `glyph` data is empty"}]],"undefined"!=typeof window?window.language:"en-us")}),define("fonteditor-core/ttf/error",["require","../common/string","./i18n"],function(require){var e=require("../common/string"),t=require("./i18n").lang;return t.raise=function(n){var i,r;if("object"==typeof n)i=n.number||0,r=n.data;else i=n;var o=t[i];if(arguments.length>1){var a="object"==typeof arguments[1]?arguments[1]:Array.prototype.slice.call(arguments,1);o=e.format(o,a)}var s=new Error(o);if(s.number=i,r)s.data=r;throw s},t}),define("fonteditor-core/ttf/reader",["require","../common/lang","./error"],function(require){function e(e,t,n){if(void 0===t)t=this.offset;if(void 0===n)n=this.littleEndian;if(void 0===o[e])return this["read"+e](t,n);var i=o[e];return this.offset=t+i,this.view["get"+e](t,n)}function t(e,t,n,i){var r=e.byteLength||e.length;this.offset=t||0,this.length=n||r-this.offset,this.littleEndian=i||!1,this.view=new DataView(e,this.offset,this.length)}var n=require("../common/lang").extend,i=require("../common/lang").curry,r=require("./error");if("undefined"==typeof ArrayBuffer||"undefined"==typeof DataView)throw new Error("not support ArrayBuffer and DataView");var o={Int8:1,Int16:2,Int32:4,Uint8:1,Uint16:2,Uint32:4,Float32:4,Float64:8},a={};return Object.keys(o).forEach(function(t){a["read"+t]=i(e,t)}),t.prototype={constructor:t,read:e,readBytes:function(e,t){if(1===arguments.length)t=arguments[0],e=this.offset;if(t<0||e+t>this.length)r.raise(10001,this.length,e+t);for(var n=[],i=0;i<t;++i)n.push(this.view.getUint8(e+i));return this.offset=e+t,n},readString:function(e,t){if(1===arguments.length)t=arguments[0],e=this.offset;if(t<0||e+t>this.length)r.raise(10001,this.length,e+t);for(var n="",i=0;i<t;++i){var o=this.readUint8(e+i);n+=String.fromCharCode(o)}return this.offset=e+t,n},readChar:function(e){return this.readString(e,1)},readFixed:function(e){if(void 0===e)e=this.offset;var t=this.readInt32(e,!1)/65536;return Math.ceil(1e5*t)/1e5},readLongDateTime:function(e){if(void 0===e)e=this.offset;var t=this.readUint32(e+4,!1),n=new Date;return n.setTime(1e3*t-20775456e5),n},seek:function(e){if(void 0===e)this.offset=0;if(e<0||e>this.length)r.raise(10001,this.length,e);return this.offset=e,this},dispose:function(){delete this.view}},n(t.prototype,a),t}),define("fonteditor-core/ttf/writer",["require","../common/lang","./error"],function(require){function e(e,t,n,i){if(void 0===n)n=this.offset;if(void 0===i)i=this.littleEndian;if(void 0===r[e])return this["write"+e](t,n,i);var o=r[e];return this.offset=n+o,this.view["set"+e](n,t,i),this}function t(e,t,n,i){var r=e.byteLength||e.length;this.offset=t||0,this.length=n||r-this.offset,this.littleEndian=i||!1,this.view=new DataView(e,this.offset,this.length)}var n=require("../common/lang"),i=require("./error");if("undefined"==typeof ArrayBuffer||"undefined"==typeof DataView)throw new Error("not support ArrayBuffer and DataView");var r={Int8:1,Int16:2,Int32:4,Uint8:1,Uint16:2,Uint32:4,Float32:4,Float64:8},o={};return Object.keys(r).forEach(function(t){o["write"+t]=n.curry(e,t)}),t.prototype={constructor:t,write:e,writeBytes:function(e,t,n){t=t||e.byteLength||e.length;var r;if(!t)return this;if(void 0===n)n=this.offset;if(t<0||n+t>this.length)i.raise(10002,this.length,n+t);if(e instanceof ArrayBuffer){var o=new DataView(e,0,t),a=this.littleEndian;for(r=0;r<t;++r)this.view.setUint8(n+r,o.getUint8(r,a),a)}else for(r=0;r<t;++r)this.view.setUint8(n+r,e[r],a);return this.offset=n+t,this},writeEmpty:function(e,t){if(e<0)i.raise(10002,this.length,e);if(void 0===t)t=this.offset;for(var n=this.littleEndian,r=0;r<e;++r)this.view.setUint8(t+r,0,n);return this.offset=t+e,this},writeString:function(e,t,n){if(e=e||"",void 0===n)n=this.offset;if((t=t||e.replace(/[^\x00-\xff]/g,"11").length)<0||n+t>this.length)i.raise(10002,this.length,n+t);this.seek(n);for(var r,o=0,a=e.length;o<a;++o)if((r=e.charCodeAt(o)||0)>127)this.writeUint16(r);else this.writeUint8(r);return this.offset=n+t,this},writeChar:function(e,t){return this.writeString(e,t)},writeFixed:function(e,t){if(void 0===t)t=this.offset;return this.writeInt32(Math.round(65536*e),t),this},writeLongDateTime:function(e,t){if(void 0===t)t=this.offset;var n=-20775456e5;if(void 0===e)e=n;else if("function"==typeof e.getTime)e=e.getTime();else if(/^\d+$/.test(e))e=+e;else e=Date.parse(e);var i=Math.round((e-n)/1e3);return this.writeUint32(0,t),this.writeUint32(i,t+4),this},seek:function(e){if(void 0===e)this.offset=0;if(e<0||e>this.length)i.raise(10002,this.length,e);return this._offset=this.offset,this.offset=e,this},head:function(){return this.offset=this._offset||0,this},getBuffer:function(){return this.view.buffer},dispose:function(){delete this.view}},n.extend(t.prototype,o),t}),define("fonteditor-core/ttf/woff2ttf",["require","./reader","./writer","./error"],function(require){function e(e,r){r=r||{};var o=new t(e),a=o.readUint32(0),s=o.readUint32(4);if(2001684038!==a||65536!==s)o.dispose(),i.raise(10102);var l,u,f,c=o.readUint16(12),d=o.readUint32(16),h=[];for(u=0;u<c;++u){o.seek(44+20*u),l={tag:o.readString(o.offset,4),offset:o.readUint32(),compLength:o.readUint32(),length:o.readUint32(),checkSum:o.readUint32()};var p=o.readBytes(l.offset,l.compLength);if(p.length<l.length){if(!r.inflate)o.dispose(),i.raise(10105);l.data=r.inflate(p)}else l.data=p;l.length=l.data.length,h.push(l)}var g=new n(new ArrayBuffer(d)),m=Math.floor(Math.log(c)/Math.LN2),y=16*Math.pow(2,m),v=16*c-y;g.writeFixed(1),g.writeUint16(c),g.writeUint16(y),g.writeUint16(m),g.writeUint16(v);var x=12+16*h.length;for(u=0,f=h.length;u<f;++u)l=h[u],g.writeString(l.tag),g.writeUint32(l.checkSum),g.writeUint32(x),g.writeUint32(l.length),x+=l.length+(l.length%4?4-l.length%4:0);for(u=0,f=h.length;u<f;++u)if(l=h[u],g.writeBytes(l.data),l.length%4)g.writeEmpty(4-l.length%4);return g.getBuffer()}var t=require("./reader"),n=require("./writer"),i=require("./error");return e}),define("fonteditor-core/ttf/table/struct",["require"],function(require){var e={Int8:1,Uint8:2,Int16:3,Uint16:4,Int32:5,Uint32:6,Fixed:7,FUnit:8,F2Dot14:11,LongDateTime:12,Char:13,String:14,Bytes:15},t={};return Object.keys(e).forEach(function(n){t[e[n]]=n}),e.names=t,e}),define("fonteditor-core/ttf/table/table",["require","./struct","../../common/lang","../error"],function(require){function e(e){var t=this.offset;if(void 0!==t)e.seek(t);var n=this;return this.struct.forEach(function(t){var i=t[0],o=t[1];switch(o){case r.Int8:case r.Uint8:case r.Int16:case r.Uint16:case r.Int32:case r.Uint32:var s=r.names[o];n[i]=e.read(s);break;case r.Fixed:n[i]=e.readFixed();break;case r.LongDateTime:n[i]=e.readLongDateTime();break;case r.Bytes:n[i]=e.readBytes(e.offset,t[2]||0);break;case r.Char:n[i]=e.readChar();break;case r.String:n[i]=e.readString(e.offset,t[2]||0);break;default:a.raise(10003,i,o)}}),this.valueOf()}function t(e,t){var n=t[this.name];if(!n)a.raise(10203,this.name);return this.struct.forEach(function(t){var i=t[0],o=t[1];switch(o){case r.Int8:case r.Uint8:case r.Int16:case r.Uint16:case r.Int32:case r.Uint32:var s=r.names[o];e.write(s,n[i]);break;case r.Fixed:e.writeFixed(n[i]);break;case r.LongDateTime:e.writeLongDateTime(n[i]);break;case r.Bytes:e.writeBytes(n[i],t[2]||0);break;case r.Char:e.writeChar(n[i]);break;case r.String:e.writeString(n[i],t[2]||0);break;default:a.raise(10003,i,o)}}),e}function n(){var e=0;return this.struct.forEach(function(t){var n=t[1];switch(n){case r.Int8:case r.Uint8:e+=1;break;case r.Int16:case r.Uint16:e+=2;break;case r.Int32:case r.Uint32:case r.Fixed:e+=4;break;case r.LongDateTime:e+=8;break;case r.Bytes:e+=t[2]||0;break;case r.Char:e+=1;break;case r.String:e+=t[2]||0;break;default:a.raise(10003,name,n)}}),e}function i(){var e={},t=this;return this.struct.forEach(function(n){e[n[0]]=t[n[0]]}),e}var r=require("./struct"),o=require("../../common/lang").extend,a=require("../error");return{read:e,write:t,size:n,valueOf:i,create:function(r,a,s){function l(e){this.name=r,this.struct=a,this.offset=e}return l.prototype.read=e,l.prototype.write=t,l.prototype.size=n,l.prototype.valueOf=i,o(l.prototype,s),l}}}),define("fonteditor-core/ttf/table/directory",["require","./table"],function(require){return require("./table").create("directory",[],{read:function(e,t){for(var n={},i=t.numTables,r=this.offset,o=r,a=16*i;o<a;o+=16){var s=e.readString(o,4).trim();n[s]={name:s,checkSum:e.readUint32(o+4),offset:e.readUint32(o+8),length:e.readUint32(o+12)}}return n},write:function(e,t){for(var n=t.support.tables,i=0,r=n.length;i<r;i++)e.writeString((n[i].name+"    ").slice(0,4)),e.writeUint32(n[i].checkSum),e.writeUint32(n[i].offset),e.writeUint32(n[i].length);return e},size:function(e){return 16*e.numTables}})}),define("fonteditor-core/ttf/table/head",["require","./table","./struct"],function(require){var e=require("./table"),t=require("./struct");return e.create("head",[["version",t.Fixed],["fontRevision",t.Fixed],["checkSumAdjustment",t.Uint32],["magickNumber",t.Uint32],["flags",t.Uint16],["unitsPerEm",t.Uint16],["created",t.LongDateTime],["modified",t.LongDateTime],["xMin",t.Int16],["yMin",t.Int16],["xMax",t.Int16],["yMax",t.Int16],["macStyle",t.Uint16],["lowestRecPPEM",t.Uint16],["fontDirectionHint",t.Int16],["indexToLocFormat",t.Int16],["glyphDataFormat",t.Int16]])}),define("fonteditor-core/ttf/table/maxp",["require","./table","./struct"],function(require){var e=require("./table"),t=require("./struct");return e.create("maxp",[["version",t.Fixed],["numGlyphs",t.Uint16],["maxPoints",t.Uint16],["maxContours",t.Uint16],["maxCompositePoints",t.Uint16],["maxCompositeContours",t.Uint16],["maxZones",t.Uint16],["maxTwilightPoints",t.Uint16],["maxStorage",t.Uint16],["maxFunctionDefs",t.Uint16],["maxInstructionDefs",t.Uint16],["maxStackElements",t.Uint16],["maxSizeOfInstructions",t.Uint16],["maxComponentElements",t.Uint16],["maxComponentDepth",t.Int16]],{write:function(t,n){return e.write.call(this,t,n.support),t},size:function(e){return 32}})}),define("fonteditor-core/ttf/util/readWindowsAllCodes",["require"],function(require){function e(e,t){var n,i,r,o,a,s={},l=e.filter(function(e){return 0===e.format});if(l.length)for(l=l[0],n=0,r=l.glyphIdArray.length;n<r;n++)if(l.glyphIdArray[n])s[n]=l.glyphIdArray[n];var u=e.filter(function(e){return 3===e.platformID&&10===e.encodingID&&12===e.format})[0],f=e.filter(function(e){return 3===e.platformID&&1===e.encodingID&&4===e.format})[0],c=e.filter(function(e){return 3===e.platformID&&3===e.encodingID&&2===e.format})[0];if(u)for(n=0,r=u.nGroups;n<r;n++){var d=u.groups[n],h=d.startId;for(o=d.start,a=d.end;o<=a;)s[o++]=h++}else if(f){var p=f.segCountX2/2,g=(f.glyphIdArrayOffset-f.idRangeOffsetOffset)/2;for(n=0;n<p;++n)for(o=f.startCode[n],a=f.endCode[n];o<=a;++o)if(0===f.idRangeOffset[n])s[o]=(o+f.idDelta[n])%65536;else{i=n+f.idRangeOffset[n]/2+(o-f.startCode[n])-g;var m=f.glyphIdArray[i];if(0!==m)s[o]=(m+f.idDelta[n])%65536;else s[o]=0}delete s[65535]}else if(c){var y=c.subHeadKeys,v=c.subHeads,x=c.glyphs,w=t.maxp.numGlyphs;for(i=0,n=0;n<256;n++)if(0===y[n]){if(n>=c.maxPos)i=0;else if(n<v[0].firstCode||n>=v[0].firstCode+v[0].entryCount||v[0].idRangeOffset+(n-v[0].firstCode)>=x.length)i=0;else if(0!==(i=x[v[0].idRangeOffset+(n-v[0].firstCode)]))i+=v[0].idDelta;if(0!==i&&i<w)s[n]=i}else for(var b=y[n],C=0,S=v[b].entryCount;C<S;C++){if(v[b].idRangeOffset+C>=x.length)i=0;else if(0!==(i=x[v[b].idRangeOffset+C]))i+=v[b].idDelta;if(0!==i&&i<w){var _=(n<<8|C+v[b].firstCode)%65535;s[_]=i}}}return s}return e}),define("fonteditor-core/ttf/table/cmap/parse",["require","../../util/readWindowsAllCodes"],function(require){function e(e,t,n,i){var r,o,a,s,l=i+n.offset;if(n.format=e.readUint16(l),0===n.format){var u=n;for(u.length=e.readUint16(),u.language=e.readUint16(),a=[],r=0,o=u.length-6;r<o;r++)a.push(e.readUint8());u.glyphIdArray=a}else if(2===n.format){var f=n;f.length=e.readUint16(),f.language=e.readUint16();for(var c=[],d=0,h=-1,r=0,o=256;r<o;r++)if(c[r]=e.readUint16()/8,c[r]>d)d=c[r],h=r;var p=[];for(r=0;r<=d;r++)p[r]={firstCode:e.readUint16(),entryCount:e.readUint16(),idDelta:e.readUint16(),idRangeOffset:(e.readUint16()-8*(d-r)-2)/2};s=(l+f.length-e.offset)/2;var g=[];for(r=0;r<s;r++)g[r]=e.readUint16();f.subHeadKeys=c,f.maxPos=h,f.subHeads=p,f.glyphs=g}else if(4===n.format){var m=n;m.length=e.readUint16(),m.language=e.readUint16(),m.segCountX2=e.readUint16(),m.searchRange=e.readUint16(),m.entrySelector=e.readUint16(),m.rangeShift=e.readUint16();var y=m.segCountX2/2,v=[];for(r=0;r<y;++r)v.push(e.readUint16());m.endCode=v,m.reservedPad=e.readUint16();var x=[];for(r=0;r<y;++r)x.push(e.readUint16());m.startCode=x;var w=[];for(r=0;r<y;++r)w.push(e.readUint16());m.idDelta=w,m.idRangeOffsetOffset=e.offset;var b=[];for(r=0;r<y;++r)b.push(e.readUint16());for(m.idRangeOffset=b,s=(m.length-(e.offset-l))/2,m.glyphIdArrayOffset=e.offset,a=[],r=0;r<s;++r)a.push(e.readUint16());m.glyphIdArray=a}else if(6===n.format){var C=n;C.length=e.readUint16(),C.language=e.readUint16(),C.firstCode=e.readUint16(),C.entryCount=e.readUint16(),C.glyphIdArrayOffset=e.offset;var S=[],_=C.entryCount;for(r=0;r<_;++r)S.push(e.readUint16());C.glyphIdArray=S}else if(12===n.format){var M=n;M.reserved=e.readUint16(),M.length=e.readUint32(),M.language=e.readUint32(),M.nGroups=e.readUint32();var E=[],k=M.nGroups;for(r=0;r<k;++r){var P={};P.start=e.readUint32(),P.end=e.readUint32(),P.startId=e.readUint32(),E.push(P)}M.groups=E}else console.warn("not support cmap format:"+n.format)}function t(t,i){var r={},o=this.offset;t.seek(o),r.version=t.readUint16();for(var a=r.numberSubtables=t.readUint16(),s=r.tables=[],l=t.offset,u=0,f=a;u<f;u++){var c={};c.platformID=t.readUint16(l),c.encodingID=t.readUint16(l+2),c.offset=t.readUint32(l+4),e(t,i,c,o),s.push(c),l+=8}return n(s,i)}var n=require("../../util/readWindowsAllCodes");return t}),define("fonteditor-core/ttf/table/cmap/write",["require"],function(require){function e(e,t){e.writeUint16(0),e.writeUint16(262),e.writeUint16(0);for(var n,i=-1;n=t.shift();){for(;++i<n[0];)e.writeUint8(0);e.writeUint8(n[1]),i=n[0]}for(;++i<256;)e.writeUint8(0);return e}function t(e,t){e.writeUint16(4),e.writeUint16(24+8*t.length),e.writeUint16(0);var n=t.length+1,i=Math.floor(Math.log(n)/Math.LN2),r=2*Math.pow(2,i);e.writeUint16(2*n),e.writeUint16(r),e.writeUint16(i),e.writeUint16(2*n-r),t.forEach(function(t){e.writeUint16(t.end)}),e.writeUint16(65535),e.writeUint16(0),t.forEach(function(t){e.writeUint16(t.start)}),e.writeUint16(65535),t.forEach(function(t){e.writeUint16(t.delta)}),e.writeUint16(1);for(var o=0,a=t.length;o<a;o++)e.writeUint16(0);return e.writeUint16(0),e}function n(e,t){return e.writeUint16(12),e.writeUint16(0),e.writeUint32(16+12*t.length),e.writeUint32(0),e.writeUint32(t.length),t.forEach(function(t){e.writeUint32(t.start),e.writeUint32(t.end),e.writeUint32(t.startId)}),e}function i(e,t,n,i){return e.writeUint16(t),e.writeUint16(n),e.writeUint32(i),e}function r(r,o){var a=o.support.cmap.hasGLyphsOver2Bytes;r.writeUint16(0),r.writeUint16(a?4:3);var s=4+(a?32:24),l=o.support.cmap.format4Size,u=o.support.cmap.format0Size;if(i(r,0,3,s),i(r,1,0,s+l),i(r,3,1,s),a)i(r,3,10,s+l+u);if(t(r,o.support.cmap.format4Segments),e(r,o.support.cmap.format0Segments),a)n(r,o.support.cmap.format12Segments);return r}return r}),define("fonteditor-core/ttf/table/cmap/sizeof",["require"],function(require){function e(e){return e>32767?e-65536:e<-32767?e+65536:e}function t(t,n){var i=null,r=[],o={};if(t.forEach(function(t){if(void 0===n||t.unicode<=n){if(null===i||t.unicode!==i.unicode+1||t.id!==i.id+1)if(null!==i)o.end=i.unicode,r.push(o),o={start:t.unicode,startId:t.id,delta:e(t.id-t.unicode)};else o.start=t.unicode,o.startId=t.id,o.delta=e(t.id-t.unicode);i=t}}),null!==i)o.end=i.unicode,r.push(o);return r}function n(e){var t=[];return e.forEach(function(e){if(void 0!==e.unicode&&e.unicode<256)t.push([e.unicode,e.id])}),t.sort(function(e,t){return e[0]-t[0]}),t}function i(e){e.support.cmap={};var i=[];e.glyf.forEach(function(e,t){var n=e.unicode;if("number"==typeof e.unicode)n=[e.unicode];if(n&&n.length)n.forEach(function(e){i.push({unicode:e,id:65535!==e?t:0})})}),i=i.sort(function(e,t){return e.unicode-t.unicode}),e.support.cmap.unicodes=i;var r=i;e.support.cmap.format4Segments=t(r,65535),e.support.cmap.format4Size=24+8*e.support.cmap.format4Segments.length,e.support.cmap.format0Segments=n(i),e.support.cmap.format0Size=262;var o=r.some(function(e){return e.unicode>65535});if(o){e.support.cmap.hasGLyphsOver2Bytes=o;var a=i;e.support.cmap.format12Segments=t(a),e.support.cmap.format12Size=16+12*e.support.cmap.format12Segments.length}return 4+(o?32:24)+e.support.cmap.format0Size+e.support.cmap.format4Size+(o?e.support.cmap.format12Size:0)}return i}),define("fonteditor-core/ttf/table/cmap",["require","./table","./cmap/parse","./cmap/write","./cmap/sizeof"],function(require){var e=require("./table"),t=require("./cmap/parse"),n=require("./cmap/write"),i=require("./cmap/sizeof");return e.create("cmap",[],{read:t,write:n,size:i})}),define("fonteditor-core/ttf/enum/nameId",["require"],function(require){var e={0:"copyright",1:"fontFamily",2:"fontSubFamily",3:"uniqueSubFamily",4:"fullName",5:"version",6:"postScriptName",7:"tradeMark",8:"manufacturer",9:"designer",10:"description",11:"urlOfFontVendor",12:"urlOfFontDesigner",13:"licence",14:"urlOfLicence",16:"preferredFamily",17:"preferredSubFamily",18:"compatibleFull",19:"sampleText"},t={};return Object.keys(e).forEach(function(n){t[e[n]]=+n}),e.names=t,e}),define("fonteditor-core/ttf/enum/platform",["require"],function(require){return{Unicode:0,Macintosh:1,reserved:2,Microsoft:3}}),define("fonteditor-core/ttf/enum/encoding",["require"],function(require){return{mac:{Default:0,"Version1.1":1,ISO10646:2,UnicodeBMP:3,UnicodenonBMP:4,UnicodeVariationSequences:5,FullUnicodecoverage:6},win:{Symbol:0,UCS2:1,ShiftJIS:2,PRC:3,BigFive:4,Johab:5,UCS4:6}}}),define("fonteditor-core/ttf/table/name",["require","./table","../enum/nameId","../util/string","../enum/platform","../enum/encoding"],function(require){var e=require("./table"),t=require("../enum/nameId"),n=require("../util/string"),i=require("../enum/platform"),r=require("../enum/encoding");return e.create("name",[],{read:function(e){var o=this.offset;e.seek(o);var a={};a.format=e.readUint16(),a.count=e.readUint16(),a.stringOffset=e.readUint16();var s,l,u=[],f=a.count;for(s=0;s<f;++s)l={},l.platform=e.readUint16(),l.encoding=e.readUint16(),l.language=e.readUint16(),l.nameId=e.readUint16(),l.length=e.readUint16(),l.offset=e.readUint16(),u.push(l);for(o+=a.stringOffset,s=0;s<f;++s)l=u[s],l.name=e.readBytes(o+l.offset,l.length);var c={},d=i.Macintosh,h=r.mac.Default,p=0;if(u.some(function(e){return e.platform===i.Microsoft&&e.encoding===r.win.UCS2&&1033===e.language}))d=i.Microsoft,h=r.win.UCS2,p=1033;for(s=0;s<f;++s)if(l=u[s],l.platform===d&&l.encoding===h&&l.language===p&&t[l.nameId])c[t[l.nameId]]=0===p?n.getUTF8String(l.name):n.getUCS2String(l.name);return c},write:function(e,t){var n=t.support.name;e.writeUint16(0),e.writeUint16(n.length),e.writeUint16(6+12*n.length);var i=0;return n.forEach(function(t){e.writeUint16(t.platform),e.writeUint16(t.encoding),e.writeUint16(t.language),e.writeUint16(t.nameId),e.writeUint16(t.name.length),e.writeUint16(i),i+=t.name.length}),n.forEach(function(t){e.writeBytes(t.name)}),e},size:function(e){var i=e.name,r=[],o=6;Object.keys(i).forEach(function(e){var a=t.names[e],s=n.toUTF8Bytes(i[e]),l=n.toUCS2Bytes(i[e]);if(void 0!==a)r.push({nameId:a,platform:1,encoding:0,language:0,name:s}),r.push({nameId:a,platform:3,encoding:1,language:1033,name:l}),o+=24+s.length+l.length});var a=["platform","encoding","language","nameId"];return r=r.sort(function(e,t){var n=0;return a.some(function(i){var r=e[i]-t[i];if(r)return n=r,!0}),n}),e.support.name=r,o}})}),define("fonteditor-core/ttf/table/hhea",["require","./table","./struct"],function(require){var e=require("./table"),t=require("./struct");return e.create("hhea",[["version",t.Fixed],["ascent",t.Int16],["descent",t.Int16],["lineGap",t.Int16],["advanceWidthMax",t.Uint16],["minLeftSideBearing",t.Int16],["minRightSideBearing",t.Int16],["xMaxExtent",t.Int16],["caretSlopeRise",t.Int16],["caretSlopeRun",t.Int16],["caretOffset",t.Int16],["reserved0",t.Int16],["reserved1",t.Int16],["reserved2",t.Int16],["reserved3",t.Int16],["metricDataFormat",t.Int16],["numOfLongHorMetrics",t.Uint16]])}),define("fonteditor-core/ttf/table/hmtx",["require","./table"],function(require){return require("./table").create("hmtx",[],{read:function(e,t){var n=this.offset;e.seek(n);var i,r,o=t.hhea.numOfLongHorMetrics,a=[];for(i=0;i<o;++i)r={},r.advanceWidth=e.readUint16(),r.leftSideBearing=e.readInt16(),a.push(r);var s=a[o-1].advanceWidth,l=t.maxp.numGlyphs-o;for(i=0;i<l;++i)r={},r.advanceWidth=s,r.leftSideBearing=e.readInt16(),a.push(r);return a},write:function(e,t){var n,i=t.hhea.numOfLongHorMetrics;for(n=0;n<i;++n)e.writeUint16(t.glyf[n].advanceWidth),e.writeInt16(t.glyf[n].leftSideBearing);var r=t.glyf.length-i;for(n=0;n<r;++n)e.writeInt16(t.glyf[i+n].leftSideBearing);return e},size:function(e){for(var t=0,n=e.glyf[e.glyf.length-1].advanceWidth,i=e.glyf.length-2;i>=0&&n===e.glyf[i].advanceWidth;i--)t++;return e.hhea.numOfLongHorMetrics=e.glyf.length-t,4*e.hhea.numOfLongHorMetrics+2*t}})}),define("fonteditor-core/ttf/table/post",["require","./table","./struct","../util/string","../enum/unicodeName"],function(require){var e=require("./table"),t=require("./struct"),n=require("../util/string"),i=require("../enum/unicodeName"),r=e.create("posthead",[["format",t.Fixed],["italicAngle",t.Fixed],["underlinePosition",t.Int16],["underlineThickness",t.Int16],["isFixedPitch",t.Uint32],["minMemType42",t.Uint32],["maxMemType42",t.Uint32],["minMemType1",t.Uint32],["maxMemType1",t.Uint32]]);return e.create("post",[],{read:function(e,t){var i=e.readFixed(this.offset),o=new r(this.offset).read(e,t);if(2===i){for(var a=e.readUint16(),s=[],l=0;l<a;++l)s.push(e.readUint16());var u=e.offset,f=t.tables.post.length-(u-this.offset),c=e.readBytes(e.offset,f);o.nameIndex=s,o.names=n.getPascalString(c)}else if(2.5===i)o.format=3;return o},write:function(e,t){var n=t.post||{format:3};if(e.writeFixed(n.format),e.writeFixed(n.italicAngle||0),e.writeInt16(n.underlinePosition||0),e.writeInt16(n.underlineThickness||0),e.writeUint32(n.isFixedPitch||0),e.writeUint32(n.minMemType42||0),e.writeUint32(n.maxMemType42||0),e.writeUint32(n.minMemType1||0),e.writeUint32(n.maxMemType1||0),2===n.format){var i=t.glyf.length;e.writeUint16(i);for(var r=t.support.post.nameIndex,o=0,a=r.length;o<a;o++)e.writeUint16(r[o]);t.support.post.names.forEach(function(t){e.writeBytes(t)})}},size:function(e){var t=e.glyf.length;if(e.post=e.post||{},e.post.format=e.post.format||3,e.post.maxMemType1=t,3===e.post.format||1===e.post.format)return 32;for(var r=34+2*t,o=[],a=[],s=0,l=0;l<t;l++)if(0===l)a.push(0);else{var u=e.glyf[l],f=u.unicode?u.unicode[0]:0,c=i[f];if(void 0!==c)a.push(c);else{var d=u.name;if(!d||d.charCodeAt(0)<32)a.push(258+s++),o.push([0]),r++;else{a.push(258+s++);var h=n.toPascalStringBytes(d);o.push(h),r+=h.length}}}return e.support.post={nameIndex:a,names:o},r}})}),define("fonteditor-core/ttf/table/OS2",["require","./table","./struct","../../common/lang"],function(require){var e=require("./table"),t=require("./struct"),n=require("../../common/lang");return e.create("OS/2",[["version",t.Uint16],["xAvgCharWidth",t.Int16],["usWeightClass",t.Uint16],["usWidthClass",t.Uint16],["fsType",t.Uint16],["ySubscriptXSize",t.Uint16],["ySubscriptYSize",t.Uint16],["ySubscriptXOffset",t.Uint16],["ySubscriptYOffset",t.Uint16],["ySuperscriptXSize",t.Uint16],["ySuperscriptYSize",t.Uint16],["ySuperscriptXOffset",t.Uint16],["ySuperscriptYOffset",t.Uint16],["yStrikeoutSize",t.Uint16],["yStrikeoutPosition",t.Uint16],["sFamilyClass",t.Uint16],["bFamilyType",t.Uint8],["bSerifStyle",t.Uint8],["bWeight",t.Uint8],["bProportion",t.Uint8],["bContrast",t.Uint8],["bStrokeVariation",t.Uint8],["bArmStyle",t.Uint8],["bLetterform",t.Uint8],["bMidline",t.Uint8],["bXHeight",t.Uint8],["ulUnicodeRange1",t.Uint32],["ulUnicodeRange2",t.Uint32],["ulUnicodeRange3",t.Uint32],["ulUnicodeRange4",t.Uint32],["achVendID",t.String,4],["fsSelection",t.Uint16],["usFirstCharIndex",t.Uint16],["usLastCharIndex",t.Uint16],["sTypoAscender",t.Int16],["sTypoDescender",t.Int16],["sTypoLineGap",t.Int16],["usWinAscent",t.Uint16],["usWinDescent",t.Uint16],["ulCodePageRange1",t.Uint32],["ulCodePageRange2",t.Uint32],["sxHeight",t.Int16],["sCapHeight",t.Int16],["usDefaultChar",t.Uint16],["usBreakChar",t.Uint16],["usMaxContext",t.Uint16]],{read:function(t,i){var r=t.readUint16(this.offset),o=this.struct;if(0===r)o=o.slice(0,39);else if(1===r)o=o.slice(0,41);var a=e.create("os2head",o),s=new a(this.offset).read(t,i),l={ulCodePageRange1:1,ulCodePageRange2:0,sxHeight:0,sCapHeight:0,usDefaultChar:0,usBreakChar:32,usMaxContext:0};return n.extend(l,s)},size:function(t){var n=16384,i=16384,r=-16384,o=-16384,a=-1,s=16384,l=16384,u=-16384,f=0,c=1114111,d=-1,h=0,p=0,g=0,m=0,y=0,v=0,x=0,w=t.writeOptions?t.writeOptions.hinting:!1;if(w){if(t.cvt)y=Math.max(y,t.cvt.length);if(t.prep)y=Math.max(y,t.prep.length);if(t.fpgm)y=Math.max(y,t.fpgm.length)}return t.glyf.forEach(function(e,b){if(e.compound){var C=0,S=0;e.glyfs.forEach(function(e){var n=t.glyf[e.glyphIndex];if(n)if(C+=n.contours?n.contours.length:0,n.contours&&n.contours.length)n.contours.forEach(function(e){S+=e.length})}),v++,g=Math.max(g,S),m=Math.max(m,C)}else if(e.contours&&e.contours.length){p=Math.max(p,e.contours.length);var _=0;e.contours.forEach(function(e){_+=e.length}),h=Math.max(h,_)}if(w&&e.instructions)y=Math.max(y,e.instructions.length);if(e.compound||e.contours&&e.contours.length){if(e.xMin<n)n=e.xMin;if(e.yMin<i)i=e.yMin;if(e.xMax>r)r=e.xMax;if(e.yMax>o)o=e.yMax;a=Math.max(a,e.advanceWidth),s=Math.min(s,e.leftSideBearing),l=Math.min(l,e.advanceWidth-e.xMax),u=Math.max(u,e.xMax),f+=e.advanceWidth,x++}var M=e.unicode;if("number"==typeof e.unicode)M=[e.unicode];if(Array.isArray(M))M.forEach(function(e){if(65535!==e)c=Math.min(c,e),d=Math.max(d,e)})}),t["OS/2"].version=4,t["OS/2"].achVendID=(t["OS/2"].achVendID+"    ").slice(0,4),t["OS/2"].xAvgCharWidth=f/(x||1),t["OS/2"].ulUnicodeRange2=268435456,t["OS/2"].usFirstCharIndex=c,t["OS/2"].usLastCharIndex=d,t.hhea.version=t.hhea.version||1,t.hhea.advanceWidthMax=a,t.hhea.minLeftSideBearing=s,t.hhea.minRightSideBearing=l,t.hhea.xMaxExtent=u,t.head.version=t.head.version||1,t.head.lowestRecPPEM=t.head.lowestRecPPEM||8,t.head.xMin=n,t.head.yMin=i,t.head.xMax=r,t.head.yMax=o,t.maxp=t.maxp||{},t.support.maxp={version:1,numGlyphs:t.glyf.length,maxPoints:h,maxContours:p,maxCompositePoints:g,maxCompositeContours:m,maxZones:t.maxp.maxZones||0,maxTwilightPoints:t.maxp.maxTwilightPoints||0,maxStorage:t.maxp.maxStorage||0,maxFunctionDefs:t.maxp.maxFunctionDefs||0,maxStackElements:t.maxp.maxStackElements||0,maxSizeOfInstructions:y,maxComponentElements:v,maxComponentDepth:v?1:0},e.size.call(this,t)}})}),define("fonteditor-core/ttf/table/cff/encoding",["require"],function(require){return{standardEncoding:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","","endash","dagger","daggerdbl","periodcentered","","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","","questiondown","","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","","ring","cedilla","","hungarumlaut","ogonek","caron","emdash","","","","","","","","","","","","","","","","","AE","","ordfeminine","","","","","Lslash","Oslash","OE","ordmasculine","","","","","","ae","","","","dotlessi","","","lslash","oslash","oe","germandbls"],expertEncoding:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclamsmall","Hungarumlautsmall","","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","twodotenleader","onedotenleader","comma","hyphen","period","fraction","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","colon","semicolon","commasuperior","threequartersemdash","periodsuperior","questionsmall","","asuperior","bsuperior","centsuperior","dsuperior","esuperior","","","isuperior","","","lsuperior","msuperior","nsuperior","osuperior","","","rsuperior","ssuperior","tsuperior","","ff","fi","fl","ffi","ffl","parenleftinferior","","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdownsmall","centoldstyle","Lslashsmall","","","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","","Dotaccentsmall","","","Macronsmall","","","figuredash","hypheninferior","","","Ogoneksmall","Ringsmall","Cedillasmall","","","","onequarter","onehalf","threequarters","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","","","zerosuperior","onesuperior","twosuperior","threesuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall"]}}),define("fonteditor-core/ttf/table/cff/getCFFString",["require"],function(require){function e(e,n){if(n<=390)n=t[n];else n=e[n-391];return n}var t=[".notdef","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","endash","dagger","daggerdbl","periodcentered","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","questiondown","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","ring","cedilla","hungarumlaut","ogonek","caron","emdash","AE","ordfeminine","Lslash","Oslash","OE","ordmasculine","ae","dotlessi","lslash","oslash","oe","germandbls","onesuperior","logicalnot","mu","trademark","Eth","onehalf","plusminus","Thorn","onequarter","divide","brokenbar","degree","thorn","threequarters","twosuperior","registered","minus","eth","multiply","threesuperior","copyright","Aacute","Acircumflex","Adieresis","Agrave","Aring","Atilde","Ccedilla","Eacute","Ecircumflex","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Ntilde","Oacute","Ocircumflex","Odieresis","Ograve","Otilde","Scaron","Uacute","Ucircumflex","Udieresis","Ugrave","Yacute","Ydieresis","Zcaron","aacute","acircumflex","adieresis","agrave","aring","atilde","ccedilla","eacute","ecircumflex","edieresis","egrave","iacute","icircumflex","idieresis","igrave","ntilde","oacute","ocircumflex","odieresis","ograve","otilde","scaron","uacute","ucircumflex","udieresis","ugrave","yacute","ydieresis","zcaron","exclamsmall","Hungarumlautsmall","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","266 ff","onedotenleader","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","commasuperior","threequartersemdash","periodsuperior","questionsmall","asuperior","bsuperior","centsuperior","dsuperior","esuperior","isuperior","lsuperior","msuperior","nsuperior","osuperior","rsuperior","ssuperior","tsuperior","ff","ffi","ffl","parenleftinferior","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","exclamdownsmall","centoldstyle","Lslashsmall","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","Dotaccentsmall","Macronsmall","figuredash","hypheninferior","Ogoneksmall","Ringsmall","Cedillasmall","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","zerosuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall","001.000","001.001","001.002","001.003","Black","Bold","Book","Light","Medium","Regular","Roman","Semibold"];return e}),define("fonteditor-core/ttf/table/cff/parseCFFDict",["require","./getCFFString"],function(require){function e(e){for(var t={},n=0,i=e.length;n<i;n++){var r=e[n][0];if(void 0===t[r]){var o=e[n][1];t[r]=1===o.length?o[0]:o}else console.warn("dict already has key:"+r)}return t}function t(e){for(var t="",n=15,i=["0","1","2","3","4","5","6","7","8","9",".","E","E-",null,"-"];;){var r=e.readUint8(),o=r>>4,a=15&r;if(o===n)break;if(t+=i[o],a===n)break;t+=i[a]}return parseFloat(t)}function n(e,n){var i,r,o,a;if(28===n)return i=e.readUint8(),r=e.readUint8(),i<<8|r;if(29===n)return i=e.readUint8(),r=e.readUint8(),o=e.readUint8(),a=e.readUint8(),i<<24|r<<16|o<<8|a;if(30===n)return t(e);if(n>=32&&n<=246)return n-139;if(n>=247&&n<=250)return i=e.readUint8(),256*(n-247)+i+108;if(n>=251&&n<=254)return i=e.readUint8(),256*-(n-251)-i-108;throw new Error("invalid b0 "+n+",at:"+e.offset)}function i(e,t,n){for(var i={},r=0,o=t.length;r<o;r++){var a=t[r],l=e[a.op];if(void 0===l)l=void 0!==a.value?a.value:null;if("SID"===a.type)l=s(n,l);i[a.name]=l}return i}function r(t,i,r){if(null!=i)t.seek(i);for(var o=[],a=[],s=t.offset+(null!=r?r:t.length);t.offset<s;){var l=t.readUint8();if(l<=21){if(12===l)l=1200+t.readUint8();o.push([l,a]),a=[]}else a.push(n(t,l))}return e(o)}function o(e,t,n,o){return i(r(e,t||0,n||e.length),l,o)}function a(e,t,n,o){return i(r(e,t||0,n||e.length),u,o)}var s=require("./getCFFString"),l=[{name:"version",op:0,type:"SID"},{name:"notice",op:1,type:"SID"},{name:"copyright",op:1200,type:"SID"},{name:"fullName",op:2,type:"SID"},{name:"familyName",op:3,type:"SID"},{name:"weight",op:4,type:"SID"},{name:"isFixedPitch",op:1201,type:"number",value:0},{name:"italicAngle",op:1202,type:"number",value:0},{name:"underlinePosition",op:1203,type:"number",value:-100},{name:"underlineThickness",op:1204,type:"number",value:50},{name:"paintType",op:1205,type:"number",value:0},{name:"charstringType",op:1206,type:"number",value:2},{name:"fontMatrix",op:1207,type:["real","real","real","real","real","real"],value:[.001,0,0,.001,0,0]},{name:"uniqueId",op:13,type:"number"},{name:"fontBBox",op:5,type:["number","number","number","number"],value:[0,0,0,0]},{name:"strokeWidth",op:1208,type:"number",value:0},{name:"xuid",op:14,type:[],value:null},{name:"charset",op:15,type:"offset",value:0},{name:"encoding",op:16,type:"offset",value:0},{name:"charStrings",op:17,type:"offset",value:0},{name:"private",op:18,type:["number","offset"],value:[0,0]}],u=[{name:"subrs",op:19,type:"offset",value:0},{name:"defaultWidthX",op:20,type:"number",value:0},{name:"nominalWidthX",op:21,type:"number",value:0}];return{parseTopDict:o,parsePrivateDict:a}}),define("fonteditor-core/ttf/table/cff/parseCFFGlyph",["require"],function(require){function e(e,t,n){function i(e,t){h.push({onCurve:!0,x:e,y:t})}function r(e,t,n,i,r,o){h.push({x:e,y:t}),h.push({x:n,y:i}),h.push({onCurve:!0,x:r,y:o})}function o(e,t){if(v)d.push(h);h=[],i(e,t),v=!0}function a(){if(p.length%2!=0&&!m)y=p.shift()+t.nominalWidthX;g+=p.length>>1,p.length=0,m=!0}function s(e){for(var b,C,S,_,M,E,k,P,L,B,U,q,A=0;A<e.length;){var I=e[A];switch(A+=1,I){case 1:case 3:a();break;case 4:if(p.length>1&&!m)y=p.shift()+t.nominalWidthX,m=!0;w+=p.pop(),o(x,w);break;case 5:for(;p.length>0;)x+=p.shift(),w+=p.shift(),i(x,w);break;case 6:for(;p.length>0&&(x+=p.shift(),i(x,w),0!==p.length);)w+=p.shift(),i(x,w);break;case 7:for(;p.length>0&&(w+=p.shift(),i(x,w),0!==p.length);)x+=p.shift(),i(x,w);break;case 8:for(;p.length>0;)l=x+p.shift(),u=w+p.shift(),f=l+p.shift(),c=u+p.shift(),x=f+p.shift(),w=c+p.shift(),r(l,u,f,c,x,w);break;case 10:if(M=p.pop()+t.subrsBias,E=t.subrs[M])s(E);break;case 11:return;case 12:switch(I=e[A],A+=1,I){case 35:l=x+p.shift(),u=w+p.shift(),f=l+p.shift(),c=u+p.shift(),k=f+p.shift(),P=c+p.shift(),L=k+p.shift(),B=P+p.shift(),U=L+p.shift(),q=B+p.shift(),x=U+p.shift(),w=q+p.shift(),p.shift(),r(l,u,f,c,k,P),r(L,B,U,q,x,w);break;case 34:l=x+p.shift(),u=w,f=l+p.shift(),c=u+p.shift(),k=f+p.shift(),P=c,L=k+p.shift(),B=c,U=L+p.shift(),q=w,x=U+p.shift(),r(l,u,f,c,k,P),r(L,B,U,q,x,w);break;case 36:l=x+p.shift(),u=w+p.shift(),f=l+p.shift(),c=u+p.shift(),k=f+p.shift(),P=c,L=k+p.shift(),B=c,U=L+p.shift(),q=B+p.shift(),x=U+p.shift(),r(l,u,f,c,k,P),r(L,B,U,q,x,w);break;case 37:if(l=x+p.shift(),u=w+p.shift(),f=l+p.shift(),c=u+p.shift(),k=f+p.shift(),P=c+p.shift(),L=k+p.shift(),B=P+p.shift(),U=L+p.shift(),q=B+p.shift(),Math.abs(U-x)>Math.abs(q-w))x=U+p.shift();else w=q+p.shift();r(l,u,f,c,k,P),r(L,B,U,q,x,w);break;default:console.warn("Glyph "+n+": unknown operator "+(1200+I)),p.length=0}break;case 14:if(p.length>0&&!m)y=p.shift()+t.nominalWidthX,m=!0;if(v)d.push(h),v=!1;break;case 18:a();break;case 19:case 20:a(),A+=g+7>>3;break;case 21:if(p.length>2&&!m)y=p.shift()+t.nominalWidthX,m=!0;w+=p.pop(),x+=p.pop(),o(x,w);break;case 22:if(p.length>1&&!m)y=p.shift()+t.nominalWidthX,m=!0;x+=p.pop(),o(x,w);break;case 23:a();break;case 24:for(;p.length>2;)l=x+p.shift(),u=w+p.shift(),f=l+p.shift(),c=u+p.shift(),x=f+p.shift(),w=c+p.shift(),r(l,u,f,c,x,w);x+=p.shift(),w+=p.shift(),i(x,w);break;case 25:for(;p.length>6;)x+=p.shift(),w+=p.shift(),i(x,w);l=x+p.shift(),u=w+p.shift(),f=l+p.shift(),c=u+p.shift(),x=f+p.shift(),w=c+p.shift(),r(l,u,f,c,x,w);break;case 26:if(p.length%2)x+=p.shift();for(;p.length>0;)l=x,u=w+p.shift(),f=l+p.shift(),c=u+p.shift(),x=f,w=c+p.shift(),r(l,u,f,c,x,w);break;case 27:if(p.length%2)w+=p.shift();for(;p.length>0;)l=x+p.shift(),u=w,f=l+p.shift(),c=u+p.shift(),x=f+p.shift(),w=c,r(l,u,f,c,x,w);break;case 28:b=e[A],C=e[A+1],p.push((b<<24|C<<16)>>16),A+=2;break;case 29:if(M=p.pop()+t.gsubrsBias,E=t.gsubrs[M])s(E);break;case 30:for(;p.length>0&&(l=x,u=w+p.shift(),f=l+p.shift(),c=u+p.shift(),x=f+p.shift(),w=c+(1===p.length?p.shift():0),r(l,u,f,c,x,w),0!==p.length);)l=x+p.shift(),u=w,f=l+p.shift(),c=u+p.shift(),w=c+p.shift(),x=f+(1===p.length?p.shift():0),r(l,u,f,c,x,w);break;case 31:for(;p.length>0&&(l=x+p.shift(),u=w,f=l+p.shift(),c=u+p.shift(),w=c+p.shift(),x=f+(1===p.length?p.shift():0),r(l,u,f,c,x,w),0!==p.length);)l=x,u=w+p.shift(),f=l+p.shift(),c=u+p.shift(),x=f+p.shift(),w=c+(1===p.length?p.shift():0),r(l,u,f,c,x,w);break;default:if(I<32)console.warn("Glyph "+n+": unknown operator "+I);else if(I<247)p.push(I-139);else if(I<251)b=e[A],A+=1,p.push(256*(I-247)+b+108);else if(I<255)b=e[A],A+=1,p.push(256*-(I-251)-b-108);else b=e[A],C=e[A+1],S=e[A+2],_=e[A+3],A+=4,p.push((b<<24|C<<16|S<<8|_)/65536)}}}var l,u,f,c,d=[],h=[],p=[],g=0,m=!1,y=t.defaultWidthX,v=!1,x=0,w=0;return s(e),{contours:d.map(function(e){var t=e.length-1;if(e[0].x===e[t].x&&e[0].y===e[t].y)e.splice(t,1);return e}),advanceWidth:y}}return e}),define("fonteditor-core/ttf/table/cff/parseCFFCharset",["require","./getCFFString"],function(require){function e(e,n,i,r){if(n)e.seek(n);var o,a,s;i-=1;var l=[".notdef"],u=e.readUint8();if(0===u)for(o=0;o<i;o+=1)a=e.readUint16(),l.push(t(r,a));else if(1===u)for(;l.length<=i;)for(a=e.readUint16(),s=e.readUint8(),o=0;o<=s;o+=1)l.push(t(r,a)),a+=1;else if(2===u)for(;l.length<=i;)for(a=e.readUint16(),s=e.readUint16(),o=0;o<=s;o+=1)l.push(t(r,a)),a+=1;else throw new Error("Unknown charset format "+u);return l}var t=require("./getCFFString");return e}),define("fonteditor-core/ttf/table/cff/parseCFFEncoding",["require"],function(require){function e(e,t){if(null!=t)e.seek(t);var n,i,r={},o=e.readUint8();if(0===o){var a=e.readUint8();for(n=0;n<a;n+=1)i=e.readUint8(),r[i]=n}else if(1===o){var s=e.readUint8();for(i=1,n=0;n<s;n+=1)for(var l=e.readUint8(),u=e.readUint8(),f=l;f<=l+u;f+=1)r[f]=i,i+=1}else console.warn("unknown encoding format:"+o);return r}return e}),define("fonteditor-core/ttf/table/CFF",["require","./table","../util/string","./cff/encoding","./cff/parseCFFDict","./cff/parseCFFGlyph","./cff/parseCFFCharset","./cff/parseCFFEncoding","../reader"],function(require){function e(e,t){for(var n=0,i=0;i<t;i++)n<<=8,n+=e.readUint8();return n}function t(e){var t={};return t.startOffset=e.offset,t.endOffset=t.startOffset+4,t.formatMajor=e.readUint8(),t.formatMinor=e.readUint8(),t.size=e.readUint8(),t.offsetSize=e.readUint8(),t}function n(t,n,i){if(n)t.seek(n);var r,o,a=t.offset,s=[],l=[],u=t.readUint16();if(0!==u){var f=t.readUint8();for(r=0,o=u+1;r<o;r++)s.push(e(t,f));for(r=0,o=u;r<o;r++){var c=t.readBytes(s[r+1]-s[r]);if(i)c=i(c);l.push(c)}}return{objects:l,startOffset:a,endOffset:t.offset}}function i(e){var t;if(e.length<1240)t=107;else if(e.length<33900)t=1131;else t=32768;return t}var r=require("./table"),o=require("../util/string"),a=require("./cff/encoding"),s=require("./cff/parseCFFDict"),l=require("./cff/parseCFFGlyph"),u=require("./cff/parseCFFCharset"),f=require("./cff/parseCFFEncoding"),c=require("../reader");return r.create("cff",[],{read:function(e,r){var d=this.offset;e.seek(d);var h=t(e),p=n(e,h.endOffset,o.getString),g=n(e,p.endOffset),m=n(e,g.endOffset,o.getString),y=n(e,m.endOffset),v={head:h};v.gsubrs=y.objects,v.gsubrsBias=i(y.objects);var x=new c(new Uint8Array(g.objects[0]).buffer),w=s.parseTopDict(x,0,x.length,m.objects);v.topDict=w;var b=w.private[0],C={};if(b){var S=d+w.private[1];C=s.parsePrivateDict(e,S,b,m.objects),v.defaultWidthX=C.defaultWidthX,v.nominalWidthX=C.nominalWidthX}else v.defaultWidthX=0,v.nominalWidthX=0;if(C.subrs){var _=S+C.subrs,M=n(e,_);v.subrs=M.objects,v.subrsBias=i(v.subrs)}else v.subrs=[],v.subrsBias=0;v.privateDict=C;var E=n(e,d+w.charStrings),k=E.objects.length;if(v.charset=u(e,d+w.charset,k,m.objects),0===w.encoding)v.encoding=a.standardEncoding;else if(1===w.encoding)v.encoding=a.expertEncoding;else v.encoding=f(e,d+w.encoding);v.glyf=[];var P=r.readOptions.subset;if(P&&P.length>0){var L={0:!0},B=r.cmap;Object.keys(B).forEach(function(e){if(P.indexOf(+e)>-1){var t=B[e];L[t]=!0}}),r.subsetMap=L,Object.keys(L).forEach(function(e){e=+e;var t=l(E.objects[e],v,e);t.name=v.charset[e],v.glyf[e]=t})}else for(var U=0,q=k;U<q;U++){var A=l(E.objects[U],v,U);A.name=v.charset[U],v.glyf.push(A)}return v},write:function(e,t){throw new Error("not support write cff table")},size:function(e){throw new Error("not support get cff table size")}})}),define("fonteditor-core/ttf/table/support-otf",["require","./head","./maxp","./cmap","./name","./hhea","./hmtx","./post","./OS2","./CFF"],function(require){return{head:require("./head"),maxp:require("./maxp"),cmap:require("./cmap"),name:require("./name"),hhea:require("./hhea"),hmtx:require("./hmtx"),post:require("./post"),"OS/2":require("./OS2"),CFF:require("./CFF")}}),define("fonteditor-core/ttf/otfreader",["require","./table/directory","./table/support-otf","./reader","./error"],function(require){function e(e){var t=new a(e,0,e.byteLength,!1),n={};if(n.version=t.readString(0,4),"OTTO"!==n.version)s.raise(10301);if(n.numTables=t.readUint16(),n.numTables<=0||n.numTables>100)s.raise(10302);if(n.searchRenge=t.readUint16(),n.entrySelector=t.readUint16(),n.rengeShift=t.readUint16(),n.tables=new r(t.offset).read(t,n),!n.tables.head||!n.tables.cmap||!n.tables.CFF)s.raise(10302);if(n.readOptions=this.options,Object.keys(o).forEach(function(e){if(n.tables[e]){var i=n.tables[e].offset;n[e]=new o[e](i).read(t,n)}}),!n.CFF.glyf)s.raise(10303);return t.dispose(),n}function t(e){var t=e.cmap,n=e.CFF.glyf,i=e.readOptions.subset?e.subsetMap:null;if(Object.keys(t).forEach(function(e){var r=t[e];if(!i||i[r]){if(!n[r].unicode)n[r].unicode=[];n[r].unicode.push(+e)}}),e.hmtx.forEach(function(e,t){if(!i||i[t])n[t].advanceWidth=n[t].advanceWidth||e.advanceWidth||0,n[t].leftSideBearing=e.leftSideBearing}),i){var r=[];Object.keys(i).forEach(function(e){r.push(n[+e])}),n=r}e.glyf=n}function n(e){delete e.readOptions,delete e.tables,delete e.hmtx,delete e.post.glyphNameIndex,delete e.post.names,delete e.subsetMap;var t=e.CFF;delete t.glyf,delete t.charset,delete t.encoding,delete t.gsubrs,delete t.gsubrsBias,delete t.subrs,delete t.subrsBias}function i(e){e=e||{},e.subset=e.subset||[],this.options=e}var r=require("./table/directory"),o=require("./table/support-otf"),a=require("./reader"),s=require("./error");return i.prototype.read=function(i){return this.font=e.call(this,i),t.call(this,this.font),n.call(this,this.font),this.font},i.prototype.dispose=function(){delete this.font,delete this.options},i}),define("fonteditor-core/ttf/util/otfContours2ttfContours",["require","../../math/bezierCubic2Q2","../../graphics/pathCeil"],function(require){function e(e){var t,r,o,a,s=[];s.push(t=e[0]);for(var l=1,u=e.length;l<u;l++)if(r=e[l],r.onCurve)s.push(r),t=r;else{o=e[l+1],a=l===u-2?e[0]:e[l+2];var f=n(t,r,o,a);if(f[0][2].onCurve=!0,s.push(f[0][1]),s.push(f[0][2]),f[1])f[1][2].onCurve=!0,s.push(f[1][1]),s.push(f[1][2]);t=a,l+=2}return i(s)}function t(t){if(!t||!t.length)return t;for(var n=[],i=0,r=t.length;i<r;i++)if(t[i][0])n.push(e(t[i]));return n}var n=require("../../math/bezierCubic2Q2"),i=require("../../graphics/pathCeil");return t}),define("fonteditor-core/ttf/otf2ttfobject",["require","./error","./otfreader","./util/otfContours2ttfContours","../graphics/computeBoundingBox"],function(require){function e(e,o){var a;if(e instanceof ArrayBuffer){var s=new n(o);a=s.read(e),s.dispose()}else if(e.head&&e.glyf&&e.cmap)a=e;else t.raise(10111);return a.glyf.forEach(function(e){e.contours=i(e.contours);var t=r.computePathBox.apply(null,e.contours);if(t)e.xMin=t.x,e.xMax=t.x+t.width,e.yMin=t.y,e.yMax=t.y+t.height,e.leftSideBearing=e.xMin;else e.xMin=0,e.xMax=0,e.yMin=0,e.yMax=0,e.leftSideBearing=0}),a.version=1,a.maxp.version=1,a.maxp.maxZones=a.maxp.maxTwilightPoints?2:1,delete a.CFF,delete a.VORG,a}var t=require("./error"),n=require("./otfreader"),i=require("./util/otfContours2ttfContours"),r=require("../graphics/computeBoundingBox");return e}),define("fonteditor-core/ttf/eot2ttf",["require","./reader","./error","./writer"],function(require){function e(e,i){i=i||{};var r=new t(e,0,e.byteLength,!0);if(20556!==r.readUint16(34))n.raise(10110);var o=r.readUint32(8);if(131073!==o&&65536!==o&&131074!==o)n.raise(10110);var a=e.byteLength||e.length,s=r.readUint32(4),l=82;if(l+=4+r.readUint16(l),l+=4+r.readUint16(l),l+=4+r.readUint16(l),l+=2+r.readUint16(l),131073===o||131074===o)l+=4+r.readUint16(l+2);if(131074===o){l+=10;l+=2+r.readUint16(l),l+=4;l+=4+r.readUint32(l)}if(l+s>a)n.raise(10001);if(e.slice)return e.slice(l,l+s);var u=require("./writer"),f=r.readBytes(l,s);return new u(new ArrayBuffer(s)).writeBytes(f).getBuffer()}var t=require("./reader"),n=require("./error");return e}),"undefined"!=typeof exports)module.exports=require("xmldom").DOMParser;else define("fonteditor-core/common/DOMParser",["require"],function(require){return window.DOMParser});define("fonteditor-core/ttf/svg/oval2contour",["require","../../graphics/computeBoundingBox","../../graphics/pathAdjust","../../graphics/path/circle","../../common/lang"],function(require){function e(e,o,a,s){if(void 0===s)s=a;var l=t.computePath(i),u=2*+a/l.width,f=2*+s/l.height,c=l.width*u/2,d=l.height*f/2,h=r.clone(i);return n(h,u,f),n(h,1,1,+e-c,+o-d),h}var t=require("../../graphics/computeBoundingBox"),n=require("../../graphics/pathAdjust"),i=require("../../graphics/path/circle"),r=require("../../common/lang");return e}),define("fonteditor-core/ttf/svg/polygon2contour",["require","./parseParams"],function(require){function e(e){if(!e||!e.length)return null;for(var n=[],i=t(e),r=0,o=i.length;r<o;r+=2)n.push({x:i[r],y:i[r+1],onCurve:!0});return n}var t=require("./parseParams");return e}),define("fonteditor-core/ttf/svg/rect2contour",["require"],function(require){function e(e,t,n,i){return e=+e,t=+t,n=+n,i=+i,[{x:e,y:t,onCurve:!0},{x:e+n,y:t,onCurve:!0},{x:e+n,y:t+i,onCurve:!0},{x:e,y:t+i,onCurve:!0}]}return e}),define("fonteditor-core/ttf/svg/parseTransform",["require","./parseParams"],function(require){function e(e){if(!e)return!1;n.lastIndex=0;for(var i,r=[];i=n.exec(e);)r.push({name:i[1],params:t(i[2])});return r}var t=require("./parseParams"),n=/(\w+)\s*\(([\d-.,\s]*)\)/g;return e}),define("fonteditor-core/graphics/matrix",["require"],function(require){return{mul:function(e,t){if(e=e||[1,0,0,1],t=t||[1,0,0,1],4===e.length)return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3]];else return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]},multiply:function(){for(var e,t=Array.prototype.slice.call(arguments),n=t[0],i=1;e=t[i];i++)n=this.mul(n,e);return n}}}),define("fonteditor-core/ttf/svg/contoursTransform",["require","../../graphics/matrix","../../graphics/pathTransform"],function(require){function e(e,i){if(!(e&&e.length&&i&&i.length))return e;for(var r=[1,0,0,1,0,0],o=0,a=i.length;o<a;o++){var s=i[o],l=s.params;switch(s.name){case"translate":r=t.mul(r,[1,0,0,1,l[0],l[1]]);break;case"scale":r=t.mul(r,[l[0],0,0,l[1],0,0]);break;case"matrix":r=t.mul(r,[l[0],l[1],l[2],l[3],l[4],l[5]]);break;case"rotate":var u=l[0]*Math.PI/180;if(l.length>1)r=t.multiply(r,[1,0,0,1,-l[1],-l[2]],[Math.cos(u),Math.sin(u),-Math.sin(u),Math.cos(u),0,0],[1,0,0,1,l[1],l[2]]);else r=t.mul(r,[Math.cos(u),Math.sin(u),-Math.sin(u),Math.cos(u),0,0]);break;case"skewX":r=t.mul(r,[1,0,Math.tan(l[0]*Math.PI/180),1,0,0]);break;case"skewY":r=t.mul(r,[1,Math.tan(l[0]*Math.PI/180),0,1,0,0])}}return e.forEach(function(e){n(e,r[0],r[1],r[2],r[3],r[4],r[5])}),e}var t=require("../../graphics/matrix"),n=require("../../graphics/pathTransform");return e}),define("fonteditor-core/ttf/svg/svgnode2contours",["require","./path2contours","./oval2contour","./polygon2contour","./rect2contour","./parseTransform","./contoursTransform"],function(require){function e(e){var t,n,i,r,l,u=[];if(e.length)for(t=0,n=e.length;t<n;t++){var f=e[t],c=f.tagName;if(s[c]){var d=s[c].params,h=[];for(i=0,r=d.length;i<r;i++)h.push(f.getAttribute(d[i]));if(l={name:c,params:h,transform:o(f.getAttribute("transform"))},f.parentNode){for(var p,g=f.parentNode,m=l.transform||[],y=function(e){m.unshift(e)};null!==g&&"svg"!==g.tagName;){if(p=g.getAttribute("transform"))o(p).reverse().forEach(y);g=g.parentNode}l.transform=m.length?m:null}u.push(l)}}if(u.length){var v=[];for(t=0,n=u.length;t<n;t++){l=u[t];var x=s[l.name],w=x.parse.apply(null,l.params);if(w&&w.length){var b=x.contours?w:[w];if(l.transform)b=a(b,l.transform);for(i=0,r=b.length;i<r;i++)v.push(b[i])}}return v}return!1}var t=require("./path2contours"),n=require("./oval2contour"),i=require("./polygon2contour"),r=require("./rect2contour"),o=require("./parseTransform"),a=require("./contoursTransform"),s={path:{parse:t,params:["d"],contours:!0},circle:{parse:n,params:["cx","cy","r"]},ellipse:{parse:n,params:["cx","cy","rx","ry"]},rect:{parse:r,params:["x","y","width","height"]},polygon:{parse:i,params:["points"]},polyline:{parse:i,params:["points"]}};return e}),define("fonteditor-core/ttf/svg2ttfobject",["require","../common/string","../common/DOMParser","./svg/path2contours","./svg/svgnode2contours","../graphics/computeBoundingBox","../graphics/pathsUtil","./util/glyfAdjust","./error","./getEmptyttfObject","./util/reduceGlyf"],function(require){function e(e){if(d)try{return(new d).parseFromString(e,"text/xml")}catch(e){v.raise(10103)}v.raise(10004)}function t(e){return e=e.replace(/\s+xmlns(?:\:[\w-]+)?=("|')[^"']*\1/g," ").replace(/<defs[>\s][\s\S]+?\/defs>/g,function(e){if(e.indexOf("</font>")>=0)return e;else return""}).replace(/<use[>\s][\s\S]+?\/use>/g,"")}function n(){var e=x();return e.head.unitsPerEm=0,e.from="svgfont",e}function i(){return{from:"svg","OS/2":{},name:{},hhea:{},head:{},post:{},glyf:[]}}function r(e,t,n,i){var r=Math.ceil(Math.min(i-n,t-e));if(!r)return 1024;if(r<=128)return r;for(var o=128;o<16384;){if(r<=1.2*o)return o;o<<=1}return 1024}function o(e){if("svgfont"===e.from&&e.head.unitsPerEm>128)e.glyf.forEach(function(e){if(e.contours)y(e),w(e)});else{var t=16384,n=-16384,i=16384,o=-16384;e.glyf.forEach(function(e){if(e.contours){var r=g.computePathBox.apply(null,e.contours);if(r)t=Math.min(t,r.x),n=Math.max(n,r.x+r.width),i=Math.min(i,r.y),o=Math.max(o,r.y+r.height)}});var a=r(t,n,i,o),s=1024/a;e.glyf.forEach(function(e){y(e,s,s),w(e)}),e.head.unitsPerEm=1024}return e}function a(e,t){var n=e.getElementsByTagName("metadata")[0],i=e.getElementsByTagName("font")[0],r=e.getElementsByTagName("font-face")[0];if(n&&n.textContent)t.metadata=c.decodeHTML(n.textContent.trim());if(i)t.id=i.getAttribute("id")||"",t.hhea.advanceWidthMax=+(i.getAttribute("horiz-adv-x")||0),t.from="svgfont";if(r){var o=t["OS/2"];t.name.fontFamily=r.getAttribute("font-family")||"",o.usWeightClass=+(r.getAttribute("font-weight")||0),t.head.unitsPerEm=+(r.getAttribute("units-per-em")||0);var a=(r.getAttribute("panose-1")||"").split(" ");["bFamilyType","bSerifStyle","bWeight","bProportion","bContrast","bStrokeVariation","bArmStyle","bLetterform","bMidline","bXHeight"].forEach(function(e,t){o[e]=+(a[t]||0)}),t.hhea.ascent=+(r.getAttribute("ascent")||0),t.hhea.descent=+(r.getAttribute("descent")||0),o.bXHeight=+(r.getAttribute("x-height")||0);var s=(r.getAttribute("bbox")||"").split(" ");["xMin","yMin","xMax","yMax"].forEach(function(e,n){t.head[e]=+(s[n]||"")}),t.post.underlineThickness=+(r.getAttribute("underline-thickness")||0),t.post.underlinePosition=+(r.getAttribute("underline-position")||0);var l=r.getAttribute("unicode-range");if(l)l.replace(/u\+([0-9A-Z]+)(\-[0-9A-Z]+)?/i,function(e,t,n){o.usFirstCharIndex=Number("0x"+t),o.usLastCharIndex=n?Number("0x"+n.slice(1)):4294967295})}return t}function s(e,t){var n,i,r=e.getElementsByTagName("missing-glyph")[0];if(r){var o={name:".notdef"};if(r.getAttribute("horiz-adv-x"))o.advanceWidth=+r.getAttribute("horiz-adv-x");if(n=r.getAttribute("d"))o.contours=h(n);if(t.glyf[0]&&".notdef"===t.glyf[0].name)t.glyf.splice(0,1);t.glyf.unshift(o)}var a=e.getElementsByTagName("glyph");if(a.length)for(var s=function(e){return e.charCodeAt(0)},l=0,u=a.length;l<u;l++){var f=a[l],c={name:f.getAttribute("glyph-name")||f.getAttribute("name")||""};if(f.getAttribute("horiz-adv-x"))c.advanceWidth=+f.getAttribute("horiz-adv-x");if(i=f.getAttribute("unicode"))c.unicode=i.split("").map(s);if(n=f.getAttribute("d"))c.contours=h(n);t.glyf.push(c)}return t}function l(e,t){var n,i,r,o=e.getElementsByTagName("path");if(o.length)for(var a=0,s=o.length;a<s;a++)r=o[a],i={name:r.getAttribute("name")||""},n=p([r]),i.contours=n,t.glyf.push(i);if(n=p(Array.prototype.slice.call(e.getElementsByTagName("*")).filter(function(e){return"path"!==e.tagName})))i={name:""},i.contours=n,t.glyf.push(i)}function u(e,t){if(!e.getElementsByTagName("svg").length)v.raise(10106);var r;if(e.getElementsByTagName("font")[0])r=n(),a(e,r),s(e,r);else r=i(),l(e,r);if(!r.glyf.length)v.raise(10201);if("svg"===r.from){var o,u,f=r.glyf;if(t.combinePath){var c=[];for(o=0,u=f.length;o<u;o++)for(var d=f[o].contours,h=0,p=d.length;h<p;h++)c.push(d[h]);f[0].contours=c,f.splice(1)}for(o=0,u=f.length;o<u;o++)f[o].contours=m.flip(f[o].contours)}return r}function f(n,i){i=i||{combinePath:!1};var r=n;if("string"==typeof n)n=t(n),r=e(n);return o(u(r,i))}var c=require("../common/string"),d=require("../common/DOMParser"),h=require("./svg/path2contours"),p=require("./svg/svgnode2contours"),g=require("../graphics/computeBoundingBox"),m=require("../graphics/pathsUtil"),y=require("./util/glyfAdjust"),v=require("./error"),x=require("./getEmptyttfObject"),w=require("./util/reduceGlyf");return f}),define("fonteditor-core/ttf/table/loca",["require","./table","./struct"],function(require){var e=require("./table"),t=require("./struct");return e.create("loca",[],{read:function(e,n){var i=this.offset,r=n.head.indexToLocFormat,o=t.names[0===r?t.Uint16:t.Uint32],a=0===r?2:4,s=0===r?2:1,l=[];e.seek(i);for(var u=n.maxp.numGlyphs,f=0;f<u;++f)l.push(e.read(o,i,!1)*s),i+=a;return l},write:function(e,t){for(var n=t.support.glyf,i=t.support.glyf.offset||0,r=t.head.indexToLocFormat,o=0===r?.5:1,a=t.glyf.length,s=0;s<a;++s){if(r)e.writeUint32(i);else e.writeUint16(i);i+=n[s].size*o}if(r)e.writeUint32(i);else e.writeUint16(i);return e},size:function(e){var t=e.glyf.length+1;return e.head.indexToLocFormat?4*t:2*t}})}),define("fonteditor-core/ttf/enum/glyFlag",["require"],function(require){return{ONCURVE:1,XSHORT:2,YSHORT:4,REPEAT:8,XSAME:16,YSAME:32,Reserved1:64,Reserved2:128}}),define("fonteditor-core/ttf/enum/componentFlag",["require"],function(require){return{ARG_1_AND_2_ARE_WORDS:1,ARGS_ARE_XY_VALUES:2,ROUND_XY_TO_GRID:4,WE_HAVE_A_SCALE:8,RESERVED:16,MORE_COMPONENTS:32,WE_HAVE_AN_X_AND_Y_SCALE:64,WE_HAVE_A_TWO_BY_TWO:128,WE_HAVE_INSTRUCTIONS:256,USE_MY_METRICS:512,OVERLAP_COMPOUND:1024,SCALED_COMPONENT_OFFSET:2048,UNSCALED_COMPONENT_OFFSET:4096}}),define("fonteditor-core/ttf/table/glyf/parse",["require","../../enum/glyFlag","../../enum/componentFlag","../../error"],function(require){function e(e,t){var n=e.offset,r=t.endPtsOfContours[t.endPtsOfContours.length-1]+1;if(r>s)return console.warn("error read glyf coordinates:"+n),t;var o,a,l,u=[];for(o=0;o<r;)if(l=e.readUint8(),u.push(l),o++,l&i.REPEAT&&o<r)for(var f=e.readUint8(),c=0;c<f;c++)u.push(l),o++;var d,h=[],p=[],g=0;for(o=0,a=u.length;o<a;++o){if(d=0,(l=u[o])&i.XSHORT)d=e.readUint8(),d=l&i.XSAME?d:-1*d;else if(l&i.XSAME)d=0;else d=e.readInt16();if(g+=d,p[o]=g,h[o]={x:g,y:0},l&i.ONCURVE)h[o].onCurve=!0}var m,y=[],v=0;for(o=0,a=u.length;o<a;o++){if(m=0,(l=u[o])&i.YSHORT)m=e.readUint8(),m=l&i.YSAME?m:-1*m;else if(l&i.YSAME)m=0;else m=e.readInt16();if(v+=m,y[o]=v,h[o])h[o].y=v}if(h.length){var x=t.endPtsOfContours,w=[];for(w.push(h.slice(0,x[0]+1)),o=1,a=x.length;o<a;o++)w.push(h.slice(x[o-1]+1,x[o]+1));t.contours=w}return t}function t(e,t){t.compound=!0,t.glyfs=[];var n,i;do{n=e.readUint16(),i={},i.flags=n,i.glyphIndex=e.readUint16();var s=0,l=0,u=16384,f=16384,c=0,d=0;if(r.ARG_1_AND_2_ARE_WORDS&n)s=e.readInt16(),l=e.readInt16();else s=e.readInt8(),l=e.readInt8();if(r.ROUND_XY_TO_GRID&n)s=Math.round(s),l=Math.round(l);if(r.WE_HAVE_A_SCALE&n)u=e.readInt16(),f=u;else if(r.WE_HAVE_AN_X_AND_Y_SCALE&n)u=e.readInt16(),f=e.readInt16();else if(r.WE_HAVE_A_TWO_BY_TWO&n)u=e.readInt16(),c=e.readInt16(),d=e.readInt16(),f=e.readInt16();if(r.ARGS_ARE_XY_VALUES&n)i.useMyMetrics=!!n&r.USE_MY_METRICS,i.overlapCompound=!!n&r.OVERLAP_COMPOUND,i.transform={a:Math.round(1e4*u/16384)/1e4,b:Math.round(1e4*c/16384)/1e4,c:Math.round(1e4*d/16384)/1e4,d:Math.round(1e4*f/16384)/1e4,e:s,f:l};else o.raise(10202);t.glyfs.push(i)}while(r.MORE_COMPONENTS&n);if(r.WE_HAVE_INSTRUCTIONS&n){var h=e.readUint16();if(h<a){for(var p=[],g=0;g<h;++g)p.push(e.readUint8());t.instructions=p}else console.warn(h)}return t}function n(n,i,r){if(null!=r)n.seek(r);var o,s,l,u={},f=n.readInt16();if(u.xMin=n.readInt16(),u.yMin=n.readInt16(),u.xMax=n.readInt16(),u.yMax=n.readInt16(),f>=0){var c=[];if(f>=0){for(o=0;o<f;o++)c.push(n.readUint16());u.endPtsOfContours=c}if(s=n.readUint16())if(s<a){for(l=[],o=0;o<s;++o)l.push(n.readUint8());u.instructions=l}else console.warn(s);e(n,u),delete u.endPtsOfContours}else t(n,u);return u}var i=require("../../enum/glyFlag"),r=require("../../enum/componentFlag"),o=require("../../error"),a=5e3,s=2e4;return n}),define("fonteditor-core/ttf/table/glyf/write",["require","../../enum/componentFlag"],function(require){function e(e,n){var i=n.writeOptions?n.writeOptions.hinting:!1;return n.glyf.forEach(function(r,o){if(r.compound||r.contours&&0!==r.contours.length){e.writeInt16(r.compound?-1:r.contours.length),e.writeInt16(r.xMin),e.writeInt16(r.yMin),e.writeInt16(r.xMax),e.writeInt16(r.yMax);var a,s,l;if(r.compound)for(a=0,s=r.glyfs.length;a<s;a++){if(l=t.ARGS_ARE_XY_VALUES+t.ROUND_XY_TO_GRID,a<s-1)l+=t.MORE_COMPONENTS;var u=r.glyfs[a];l+=u.useMyMetrics?t.USE_MY_METRICS:0,l+=u.overlapCompound?t.OVERLAP_COMPOUND:0;var f=u.transform,c=f.a,d=f.b,h=f.c,p=f.d,g=f.e,m=f.f;if(g<0||g>127||m<0||m>127)l+=t.ARG_1_AND_2_ARE_WORDS;if(d||h)l+=t.WE_HAVE_A_TWO_BY_TWO;else if((1!==c||1!==p)&&c===p)l+=t.WE_HAVE_A_SCALE;else if(1!==c||1!==p)l+=t.WE_HAVE_AN_X_AND_Y_SCALE;if(e.writeUint16(l),e.writeUint16(u.glyphIndex),t.ARG_1_AND_2_ARE_WORDS&l)e.writeInt16(g),e.writeInt16(m);else e.writeUint8(g),e.writeUint8(m);if(t.WE_HAVE_A_SCALE&l)e.writeInt16(Math.round(16384*c));else if(t.WE_HAVE_AN_X_AND_Y_SCALE&l)e.writeInt16(Math.round(16384*c)),e.writeInt16(Math.round(16384*p));else if(t.WE_HAVE_A_TWO_BY_TWO&l)e.writeInt16(Math.round(16384*c)),e.writeInt16(Math.round(16384*d)),e.writeInt16(Math.round(16384*h)),e.writeInt16(Math.round(16384*p))}else{var y=-1;if(r.contours.forEach(function(t){y+=t.length,e.writeUint16(y)}),i&&r.instructions){var v=r.instructions;for(e.writeUint16(v.length),a=0,s=v.length;a<s;a++)e.writeUint8(v[a])}else e.writeUint16(0);for(l=n.support.glyf[o].flags,a=0,s=l.length;a<s;a++)e.writeUint8(l[a]);var x=n.support.glyf[o].xCoord;for(a=0,s=x.length;a<s;a++)if(0<=x[a]&&x[a]<=255)e.writeUint8(x[a]);else e.writeInt16(x[a]);var w=n.support.glyf[o].yCoord;for(a=0,s=w.length;a<s;a++)if(0<=w[a]&&w[a]<=255)e.writeUint8(w[a]);else e.writeInt16(w[a])}var b=n.support.glyf[o].glyfSize;if(b%4)e.writeEmpty(4-b%4)}}),e}var t=require("../../enum/componentFlag");return e}),define("fonteditor-core/ttf/table/glyf/sizeof",["require","../../enum/glyFlag"],function(require){function e(e,t,n){if(!e.contours||0===e.contours.length)return 0;var i=12+2*e.contours.length+t.flags.length;return t.xCoord.forEach(function(e){i+=0<=e&&e<=255?1:2}),t.yCoord.forEach(function(e){i+=0<=e&&e<=255?1:2}),i+(n&&e.instructions?e.instructions.length:0)}function t(e,t){var n,i=10;return e.glyfs.forEach(function(e){if(n=e.transform,i+=4,n.e<0||n.e>127||n.f<0||n.f>127)i+=4;else i+=2;if(n.b||n.c)i+=8;else if(1!==n.a||1!==n.d)i+=n.a===n.d?2:4}),i}function n(e,t){if(!e.contours||0===e.contours.length)return t;for(var n,i,o=[],a=[],s=[],l=e.contours,u=!0,f=0,c=l.length;f<c;f++){n=l[f];for(var d=0,h=n.length;d<h;d++){var p=n[d];if(u)a.push(p.x),s.push(p.y),u=!1;else a.push(p.x-i.x),s.push(p.y-i.y);o.push(p.onCurve?r.ONCURVE:0),i=p}}var g,m,y,v=[],x=[],w=[],b=-1;return o.forEach(function(e,t){if(g=a[t],m=s[t],0===t){if(-255<=g&&g<=255){if(e+=r.XSHORT,g>=0)e+=r.XSAME;g=Math.abs(g)}if(-255<=m&&m<=255){if(e+=r.YSHORT,m>=0)e+=r.YSAME;m=Math.abs(m)}v.push(y=e),x.push(g),w.push(m)}else{if(0===g)e+=r.XSAME;else{if(-255<=g&&g<=255){if(e+=r.XSHORT,g>0)e+=r.XSAME;g=Math.abs(g)}x.push(g)}if(0===m)e+=r.YSAME;else{if(-255<=m&&m<=255){if(e+=r.YSHORT,m>0)e+=r.YSAME;m=Math.abs(m)}w.push(m)}if(e===y)if(-1===b)b=v.length-1,v[b]|=r.REPEAT,v.push(1);else++v[b+1];else b=-1,v.push(y=e)}}),t.flags=v,t.xCoord=x,t.yCoord=w,t}function i(i){i.support.glyf=[];var r=0,o=i.writeOptions?i.writeOptions.hinting:!1;return i.glyf.forEach(function(a){var s={};s=a.compound?s:n(a,s);var l=a.compound?t(a,o):e(a,s,o),u=l;if(u%4)u+=4-u%4;s.glyfSize=l,s.size=u,i.support.glyf.push(s),r+=u}),i.support.glyf.tableSize=r,i.head.indexToLocFormat=r>65536?1:0,i.support.glyf.tableSize}var r=require("../../enum/glyFlag");return i}),define("fonteditor-core/ttf/table/glyf",["require","./table","./glyf/parse","./glyf/write","./glyf/sizeof","../../common/lang"],function(require){var e=require("./table"),t=require("./glyf/parse"),n=require("./glyf/write"),i=require("./glyf/sizeof"),r=require("../../common/lang");return e.create("glyf",[],{read:function(e,n){var i=this.offset,o=n.loca,a=n.maxp.numGlyphs,s=[];e.seek(i);var l=n.readOptions.subset;if(l&&l.length>0){var u={0:!0};u[0]=!0;var f=n.cmap;Object.keys(f).forEach(function(e){if(l.indexOf(+e)>-1){var t=f[e];u[t]=!0}}),n.subsetMap=u;var c={};return function a(l){var u={};if(Object.keys(l).forEach(function(r){var a=+r;if(c[a]=!0,o[a]===o[a+1])s[a]={contours:[]};else s[a]=t(e,n,i+o[a]);if(s[a].compound)s[a].glyfs.forEach(function(e){if(!c[e.glyphIndex])u[e.glyphIndex]=!0})}),!r.isEmptyObject(u))a(u)}(u),s}for(var d=0,h=a-1;d<h;d++)if(o[d]===o[d+1])s[d]={contours:[]};else s[d]=t(e,n,i+o[d]);if(n.tables.glyf.length-o[d]<5)s[d]={contours:[]};else s[d]=t(e,n,i+o[d]);return s},write:n,size:i})}),define("fonteditor-core/ttf/table/fpgm",["require","./table"],function(require){return require("./table").create("fpgm",[],{read:function(e,t){var n=t.tables.fpgm.length;return e.readBytes(this.offset,n)},write:function(e,t){if(t.fpgm)e.writeBytes(t.fpgm,t.fpgm.length)},size:function(e){return e.fpgm?e.fpgm.length:0}})}),define("fonteditor-core/ttf/table/cvt",["require","./table"],function(require){return require("./table").create("cvt",[],{read:function(e,t){var n=t.tables.cvt.length;return e.readBytes(this.offset,n)},write:function(e,t){if(t.cvt)e.writeBytes(t.cvt,t.cvt.length)},size:function(e){return e.cvt?e.cvt.length:0}})}),define("fonteditor-core/ttf/table/prep",["require","./table"],function(require){return require("./table").create("prep",[],{read:function(e,t){var n=t.tables.prep.length;return e.readBytes(this.offset,n)},write:function(e,t){if(t.prep)e.writeBytes(t.prep,t.prep.length)},size:function(e){return e.prep?e.prep.length:0}})}),define("fonteditor-core/ttf/table/gasp",["require","./table"],function(require){return require("./table").create("gasp",[],{read:function(e,t){var n=t.tables.gasp.length;return e.readBytes(this.offset,n)},write:function(e,t){if(t.gasp)e.writeBytes(t.gasp,t.gasp.length)},size:function(e){return e.gasp?e.gasp.length:0}})}),define("fonteditor-core/ttf/table/support",["require","./head","./maxp","./loca","./cmap","./glyf","./name","./hhea","./hmtx","./post","./OS2","./fpgm","./cvt","./prep","./gasp"],function(require){return{head:require("./head"),maxp:require("./maxp"),loca:require("./loca"),cmap:require("./cmap"),glyf:require("./glyf"),name:require("./name"),hhea:require("./hhea"),hmtx:require("./hmtx"),post:require("./post"),"OS/2":require("./OS2"),fpgm:require("./fpgm"),cvt:require("./cvt"),prep:require("./prep"),gasp:require("./gasp")}}),define("fonteditor-core/ttf/ttfreader",["require","./table/directory","./table/support","./reader","./enum/postName","./error","./util/compound2simpleglyf"],function(require){function e(e){var t=new a(e,0,e.byteLength,!1),n={};if(n.version=t.readFixed(0),1!==n.version)l.raise(10101);if(n.numTables=t.readUint16(),n.numTables<=0||n.numTables>100)l.raise(10101);if(n.searchRenge=t.readUint16(),n.entrySelector=t.readUint16(),n.rengeShift=t.readUint16(),n.tables=new r(t.offset).read(t,n),!(n.tables.glyf&&n.tables.head&&n.tables.cmap&&n.tables.hmtx))l.raise(10204);if(n.readOptions=this.options,Object.keys(o).forEach(function(e){if(n.tables[e]){var i=n.tables[e].offset;n[e]=new o[e](i).read(t,n)}}),!n.glyf)l.raise(10201);return t.dispose(),n}function t(e){var t=e.cmap,n=e.glyf,i=e.readOptions.subset?e.subsetMap:null;if(Object.keys(t).forEach(function(e){var r=t[e];if(!i||i[r]){if(!n[r].unicode)n[r].unicode=[];n[r].unicode.push(+e)}}),e.hmtx.forEach(function(e,t){if(!i||i[t])n[t].advanceWidth=e.advanceWidth,n[t].leftSideBearing=e.leftSideBearing}),e.post&&2===e.post.format){var r=e.post.nameIndex,o=e.post.names;r.forEach(function(e,t){if(!i||i[t])if(e<=257)n[t].name=s[e];else n[t].name=o[e-258]||""})}if(i){var a=[];Object.keys(i).forEach(function(t){if(t=+t,n[t].compound)u(t,e,!0);a.push(n[t])}),e.glyf=a,e.maxp.maxComponentElements=0,e.maxp.maxComponentDepth=0}}function n(e){if(delete e.readOptions,delete e.tables,delete e.hmtx,delete e.loca,e.post)delete e.post.nameIndex,delete e.post.names;if(delete e.subsetMap,!this.options.hinting)delete e.fpgm,delete e.cvt,delete e.prep,e.glyf.forEach(function(e){delete e.instructions});if(this.options.compound2simple&&e.maxp.maxComponentElements)e.glyf.forEach(function(t,n){if(t.compound)u(n,e,!0)}),e.maxp.maxComponentElements=0,e.maxp.maxComponentDepth=0}function i(e){e=e||{},e.subset=e.subset||[],e.hinting=e.hinting||!1,e.compound2simple=e.compound2simple||!1,this.options=e}var r=require("./table/directory"),o=require("./table/support"),a=require("./reader"),s=require("./enum/postName"),l=require("./error"),u=require("./util/compound2simpleglyf");return i.prototype.read=function(i){return this.ttf=e.call(this,i),t.call(this,this.ttf),n.call(this,this.ttf),this.ttf},i.prototype.dispose=function(){delete this.ttf,delete this.options},i}),define("fonteditor-core/ttf/util/checkSum",["require"],function(require){function e(e,t,n){if(t=t||0,n=n||e.byteLength,t+n>e.byteLength)throw new Error("check sum out of bound");for(var i=Math.floor(n/4),r=new DataView(e,t,n),o=0,a=0;a<i;)o+=r.getUint32(4*a++,!1);var s=n-4*i;if(s)for(t=4*i;s>0;)o+=r.getUint8(t,!1)<<8*s,t++,s--;return o%4294967296}function t(e,t,n){if(t=t||0,n=n||e.length,t+n>e.length)throw new Error("check sum out of bound");for(var i=Math.floor(n/4),r=0,o=0;o<i;)r+=(e[o++]<<24)+(e[o++]<<16)+(e[o++]<<8)+e[o++];var a=n-4*i;if(a)for(t=4*i;a>0;)r+=e[t]<<8*a,t++,a--;return r%4294967296}function n(n,i,r){if(n instanceof ArrayBuffer)return e(n,i,r);else if(n instanceof Array)return t(n,i,r);throw new Error("not support checksum buffer type")}return n}),define("fonteditor-core/ttf/ttfwriter",["require","./writer","./table/directory","./table/support","./util/checkSum","./error"],function(require){function e(e){if(!e.glyf||0===e.glyf.length)l.raise(10201);if(!e["OS/2"]||!e.head||!e.name)l.raise(10204);var t=u.slice(0);if(e.writeOptions={},this.options.hinting)["cvt","fpgm","prep","gasp"].forEach(function(n){if(e[n])t.push(n)});e.writeOptions.hinting=!!this.options.hinting,e.writeOptions.tables=t.sort()}function t(e){if(e.version=e.version||1,e.numTables=e.writeOptions.tables.length,e.entrySelector=Math.floor(Math.log(e.numTables)/Math.LN2),e.searchRange=16*Math.pow(2,e.entrySelector),e.rangeShift=16*e.numTables-e.searchRange,e.head.checkSumAdjustment=0,e.head.magickNumber=1594834165,"string"==typeof e.head.created)e.head.created=/^\d+$/.test(e.head.created)?+e.head.created:Date.parse(e.head.created);if("string"==typeof e.head.modified)e.head.modified=/^\d+$/.test(e.head.modified)?+e.head.modified:Date.parse(e.head.modified);if(!e.head.created)e.head.created=Date.now();if(!e.head.modified)e.head.modified=e.head.created;var t={};e.glyf.forEach(function(e,n){if(e.unicode)e.unicode=e.unicode.sort(),e.unicode.forEach(function(e){if(t[e])l.raise({number:10200,data:n},n);else t[e]=!0})})}function n(e){e.support={};var t=12+16*e.numTables,n=0;e.support.tables=[],e.writeOptions.tables.forEach(function(i){var r=t,o=(new a[i]).size(e),s=o;if("head"===i)n=r;if(s%4)s+=4-s%4;e.support.tables.push({name:i,checkSum:0,offset:r,length:o,size:s}),t+=s});var i=new r(new ArrayBuffer(t));i.writeFixed(e.version),i.writeUint16(e.numTables),i.writeUint16(e.searchRange),i.writeUint16(e.entrySelector),i.writeUint16(e.rangeShift),(new o).write(i,e),e.support.tables.forEach(function(t){var n=i.offset;if((new a[t.name]).write(i,e),t.length%4)i.writeEmpty(4-t.length%4);t.checkSum=s(i.getBuffer(),n,t.size)}),e.support.tables.forEach(function(e,t){var n=12+16*t+4;i.writeUint32(e.checkSum,n)});var l=(2981146554-s(i.getBuffer())+4294967296)%4294967296;i.writeUint32(l,n+8),delete e.writeOptions,delete e.support;var u=i.getBuffer();return i.dispose(),u}function i(e){e=e||{},this.options={hinting:e.hinting||!1}}var r=require("./writer"),o=require("./table/directory"),a=require("./table/support"),s=require("./util/checkSum"),l=require("./error"),u=["OS/2","cmap","glyf","head","hhea","hmtx","loca","maxp","name","post"];return i.prototype.write=function(i){return e.call(this,i),t.call(this,i),n.call(this,i)},i.prototype.dispose=function(){delete this.options},i}),define("fonteditor-core/ttf/ttf2eot",["require","./reader","./writer","./util/string","./error","./table/table","./table/struct","./table/name"],function(require){function e(e,o){o=o||{};var a=new l,u=a.size(),f={};f.head=a.read(new t(new ArrayBuffer(u))),f.head.FontDataSize=e.byteLength||e.length,f.head.Version=131073,f.head.Flags=0,f.head.Charset=1,f.head.MagicNumber=20556,f.head.Padding1=0;var c=new t(e),d=c.readUint16(4);if(d<=0||d>100)r.raise(10101);c.seek(12);for(var h=0,p=0;p<d&&7!==h;++p){var g={tag:c.readString(c.offset,4),checkSum:c.readUint32(),offset:c.readUint32(),length:c.readUint32()},m=c.offset;if("head"===g.tag)f.head.CheckSumAdjustment=c.readUint32(g.offset+8),h+=1;else if("OS/2"===g.tag)f.head.PANOSE=c.readBytes(g.offset+32,10),f.head.Italic=c.readUint16(g.offset+62),f.head.Weight=c.readUint16(g.offset+4),f.head.fsType=c.readUint16(g.offset+8),f.head.UnicodeRange=c.readBytes(g.offset+42,16),f.head.CodePageRange=c.readBytes(g.offset+78,8),h+=2;else if("name"===g.tag){var y=new s(g.offset).read(c);f.FamilyName=i.toUCS2Bytes(y.fontFamily||""),f.FamilyNameSize=f.FamilyName.length,f.StyleName=i.toUCS2Bytes(y.fontStyle||""),f.StyleNameSize=f.StyleName.length,f.VersionName=i.toUCS2Bytes(y.version||""),f.VersionNameSize=f.VersionName.length,f.FullName=i.toUCS2Bytes(y.fullName||""),f.FullNameSize=f.FullName.length,h+=3}c.seek(m)}f.head.EOTSize=u+4+f.FamilyNameSize+4+f.StyleNameSize+4+f.VersionNameSize+4+f.FullNameSize+2+f.head.FontDataSize;var v=new n(new ArrayBuffer(f.head.EOTSize),0,f.head.EOTSize,!0);return a.write(v,f),v.writeUint16(f.FamilyNameSize),v.writeBytes(f.FamilyName,f.FamilyNameSize),v.writeUint16(0),v.writeUint16(f.StyleNameSize),v.writeBytes(f.StyleName,f.StyleNameSize),v.writeUint16(0),v.writeUint16(f.VersionNameSize),v.writeBytes(f.VersionName,f.VersionNameSize),v.writeUint16(0),v.writeUint16(f.FullNameSize),v.writeBytes(f.FullName,f.FullNameSize),v.writeUint16(0),v.writeUint16(0),v.writeBytes(e,f.head.FontDataSize),v.getBuffer()}var t=require("./reader"),n=require("./writer"),i=require("./util/string"),r=require("./error"),o=require("./table/table"),a=require("./table/struct"),s=require("./table/name"),l=o.create("head",[["EOTSize",a.Uint32],["FontDataSize",a.Uint32],["Version",a.Uint32],["Flags",a.Uint32],["PANOSE",a.Bytes,10],["Charset",a.Uint8],["Italic",a.Uint8],["Weight",a.Uint32],["fsType",a.Uint16],["MagicNumber",a.Uint16],["UnicodeRange",a.Bytes,16],["CodePageRange",a.Bytes,8],["CheckSumAdjustment",a.Uint32],["Reserved",a.Bytes,16],["Padding1",a.Uint16]]);return e}),define("fonteditor-core/ttf/ttf2woff",["require","./reader","./writer","../common/string","./error","./data/default","./util/string"],function(require){function e(e){var t='<?xml version="1.0" encoding="UTF-8"?><metadata version="1.0">';if(e.uniqueid=e.uniqueid||a.fontId+"."+Date.now(),t+='<uniqueid id="'+r.encodeHTML(e.uniqueid)+'" />',e.vendor)t+='<vendor name="'+r.encodeHTML(e.vendor.name)+'" url="'+r.encodeHTML(e.vendor.url)+'" />';if(e.credit){t+="<credits>";(e.credit instanceof Array?e.credit:[e.credit]).forEach(function(e){t+='<credit name="'+r.encodeHTML(e.name)+'" url="'+r.encodeHTML(e.url)+'" role="'+r.encodeHTML(e.role||"Contributor")+'" />'}),t+="</credits>"}if(e.description)t+='<description><text xml:lang="en">'+r.encodeHTML(e.description)+"</text></description>";if(e.license)t+='<license url="'+r.encodeHTML(e.license.url)+'" id="'+r.encodeHTML(e.license.id)+'"><text xml:lang="en">',t+=r.encodeHTML(e.license.text),t+="</text></license>";if(e.copyright)t+='<copyright><text xml:lang="en">',t+=r.encodeHTML(e.copyright),t+="</text></copyright>";if(e.trademark)t+='<trademark><text xml:lang="en">'+r.encodeHTML(e.trademark)+"</text></trademark>";if(e.licensee)t+='<licensee name="'+r.encodeHTML(e.licensee)+'"/>';return t+="</metadata>"}function t(t,r){r=r||{};var a,s,l,u,f={signature:2001684038,flavor:65536,length:0,numTables:0,reserved:0,totalSfntSize:0,majorVersion:0,minorVersion:0,metaOffset:0,metaLength:0,metaOrigLength:0,privOffset:0,privLength:0},c=new n(t),d=[],h=c.readUint16(4);if(h<=0||h>100)o.raise(10101);for(c.seek(12),l=0;l<h;++l){a={tag:c.readString(c.offset,4),checkSum:c.readUint32(),offset:c.readUint32(),length:c.readUint32()};var p=c.offset;if("head"===a.tag)f.majorVersion=c.readUint16(a.offset+4),f.minorVersion=c.readUint16(a.offset+6);var g=c.readBytes(a.offset,a.length);if(r.deflate)if(s=r.deflate(g),s.length<g.length)a.data=s,a.deflated=!0;else a.data=g;else a.data=g;a.compLength=a.data.length,d.push(a),c.seek(p)}if(!d.length)o.raise(10204);d=d.sort(function(e,t){return e.tag===t.tag?0:e.tag<t.tag?-1:1});var m=44+20*h,y=12+16*h;for(l=0,u=d.length;l<u;++l)a=d[l],a.offset=m,m+=a.compLength+(a.compLength%4?4-a.compLength%4:0),y+=a.length+(a.length%4?4-a.length%4:0);var v=null;if(r.metadata){var x=require("./util/string").toUTF8Bytes(e(r.metadata));if(r.deflate)if(s=r.deflate(x),s.length<x.length)v=s;else v=x;else v=x;f.metaLength=v.length,f.metaOrigLength=x.length,f.metaOffset=m,m+=f.metaLength+(f.metaLength%4?4-f.metaLength%4:0)}f.numTables=d.length,f.length=m,f.totalSfntSize=y;var w=new i(new ArrayBuffer(m));for(w.writeUint32(f.signature),w.writeUint32(f.flavor),w.writeUint32(f.length),w.writeUint16(f.numTables),w.writeUint16(f.reserved),w.writeUint32(f.totalSfntSize),w.writeUint16(f.majorVersion),w.writeUint16(f.minorVersion),w.writeUint32(f.metaOffset),w.writeUint32(f.metaLength),w.writeUint32(f.metaOrigLength),w.writeUint32(f.privOffset),w.writeUint32(f.privLength),l=0,u=d.length;l<u;++l)a=d[l],w.writeString(a.tag),w.writeUint32(a.offset),w.writeUint32(a.compLength),w.writeUint32(a.length),w.writeUint32(a.checkSum);for(l=0,u=d.length;l<u;++l)if(a=d[l],w.writeBytes(a.data),a.compLength%4)w.writeEmpty(4-a.compLength%4);if(v)if(w.writeBytes(v),f.metaLength%4)w.writeEmpty(4-f.metaLength%4);return w.getBuffer()}var n=require("./reader"),i=require("./writer"),r=require("../common/string"),o=require("./error"),a=require("./data/default");return t}),define("fonteditor-core/ttf/util/unicode2xml",["require","../../common/string"],function(require){function e(e){if("number"==typeof e)e=[e];return e.map(function(e){if(e<32)return"";else return e>=32&&e<=255?t.encodeHTML(String.fromCharCode(e).toLowerCase()):"&#x"+e.toString(16)+";"}).join("")}var t=require("../../common/string");return e}),define("fonteditor-core/ttf/ttf2svg",["require","../common/string","./util/string","./ttfreader","./util/contours2svg","./util/unicode2xml","./error","./data/default"],function(require){function e(e,t){var r=e["OS/2"],s={id:e.name.uniqueSubFamily||u,metadata:n.encodeHTML(t.metadata||""),advanceWidth:e.hhea.advanceWidthMax,fontFamily:e.name.fontFamily,fontWeight:r.usWeightClass,unitsPerEm:e.head.unitsPerEm,panose:[r.bFamilyType,r.bSerifStyle,r.bWeight,r.bProportion,r.bContrast,r.bStrokeVariation,r.bArmStyle,r.bLetterform,r.bMidline,r.bXHeight].join(" "),ascent:e.hhea.ascent,descent:e.hhea.descent,xHeight:r.bXHeight,bbox:[e.head.xMin,e.head.yMin,e.head.xMax,e.head.yMax].join(" "),underlineThickness:e.post.underlineThickness,underlinePosition:e.post.underlinePosition,unicodeRange:"U+"+n.pad(r.usFirstCharIndex.toString(16),4)+"-"+n.pad(r.usLastCharIndex.toString(16),4)};s.missing={},s.missing.advanceWidth=e.glyf[0].advanceWidth||0,s.missing.d=e.glyf[0].contours&&e.glyf[0].contours.length?'d="'+o(e.glyf[0].contours)+'"':"";for(var l="",d=1,h=e.glyf.length;d<h;d++){var p=e.glyf[d];if(!p.compound&&p.contours&&p.unicode&&p.unicode.length){var g={name:i(p.name),unicode:a(p.unicode),d:o(p.contours)};l+=n.format(c,g)}}return s.glyphList=l,n.format(f,s)}function t(t,n){if(n=n||{},t instanceof ArrayBuffer){var i=new r,o=i.read(t);return i.dispose(),e(o,n)}else if(t.version&&t.glyf)return e(t,n);s.raise(10109)}var n=require("../common/string"),i=require("./util/string").escape,r=require("./ttfreader"),o=require("./util/contours2svg"),a=require("./util/unicode2xml"),s=require("./error"),l=require("./data/default"),u=l.fontId,f='<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd" ><svg xmlns="http://www.w3.org/2000/svg"><metadata>${metadata}</metadata><defs><font id="${id}" horiz-adv-x="${advanceWidth}"><font-face font-family="${fontFamily}" font-weight="${fontWeight}" font-stretch="normal" units-per-em="${unitsPerEm}" panose-1="${panose}" ascent="${ascent}" descent="${descent}" x-height="${xHeight}" bbox="${bbox}" underline-thickness="${underlineThickness}" underline-position="${underlinePosition}" unicode-range="${unicodeRange}" /><missing-glyph horiz-adv-x="${missing.advanceWidth}" ${missing.d} />${glyphList}</font></defs></svg>',c='<glyph glyph-name="${name}" unicode="${unicode}" d="${d}" />';return t}),define("fonteditor-core/ttf/ttf2symbol",["require","../common/string","./ttfreader","./util/contours2svg","../graphics/pathsUtil","./util/unicode2xml","./error"],function(require){function e(e,t){if(e.name)return e.name;if(e.unicode&&e.unicode.length)return"uni-"+e.unicode[0];else return"symbol-"+t}function t(t,n){for(var r={},s=t.head.unitsPerEm,f=t.hhea.descent,c="",d=1,h=t.glyf.length;d<h;d++){var p=t.glyf[d];if(!p.compound&&p.contours){var g=a.flip(p.contours),m={descent:f,unitsPerEm:s,id:e(p,d),d:o(g)};c+=i.format(u,m)}}return r.symbolList=c,i.format(l,r)}function n(e,n){if(n=n||{},e instanceof ArrayBuffer){var i=new r,o=i.read(e);return i.dispose(),t(o,n)}else if(e.version&&e.glyf)return t(e,n);s.raise(10112)}var i=require("../common/string"),r=require("./ttfreader"),o=require("./util/contours2svg"),a=require("../graphics/pathsUtil"),s=(require("./util/unicode2xml"),require("./error")),l='<svg style="position: absolute; width: 0; height: 0;" width="0" height="0" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs>${symbolList}</defs></svg>',u='<symbol id="${id}" viewBox="0 ${descent} ${unitsPerEm} ${unitsPerEm}"><path d="${d}"></path></symbol>';return n.getSymbolId=e,n}),define("fonteditor-core/ttf/ttf2base64",["require","./util/bytes2base64"],function(require){function e(e){return"data:font/ttf;charset=utf-8;base64,"+t(e)}var t=require("./util/bytes2base64");return e}),define("fonteditor-core/ttf/eot2base64",["require","./util/bytes2base64"],function(require){function e(e){return"data:font/eot;charset=utf-8;base64,"+t(e)}var t=require("./util/bytes2base64");return e}),define("fonteditor-core/ttf/woff2base64",["require","./util/bytes2base64"],function(require){function e(e){return"data:font/woff;charset=utf-8;base64,"+t(e)}var t=require("./util/bytes2base64");return e}),define("fonteditor-core/ttf/font",["require","../nodejs/buffer","./getEmptyttfObject","./ttf","./woff2ttf","./otf2ttfobject","./eot2ttf","./svg2ttfobject","./ttfreader","./ttfwriter","./ttf2eot","./ttf2woff","./ttf2svg","./ttf2symbol","./ttf2base64","./eot2base64","./woff2base64","./svg2base64","./util/bytes2base64","./util/optimizettf"],function(require){function e(e,t){if(t=t||{type:"ttf"},"object"==typeof e&&e.glyf)this.set(e);else if(e)this.read(e,t);else this.readEmpty()}var t=require("../nodejs/buffer"),n=require("./getEmptyttfObject"),i=require("./ttf"),r=require("./woff2ttf"),o=require("./otf2ttfobject"),a=require("./eot2ttf"),s=require("./svg2ttfobject"),l=require("./ttfreader"),u=require("./ttfwriter"),f=require("./ttf2eot"),c=require("./ttf2woff"),d=require("./ttf2svg"),h=require("./ttf2symbol"),p=require("./ttf2base64"),g=require("./eot2base64"),m=require("./woff2base64"),y=require("./svg2base64"),v=require("./util/bytes2base64"),x=require("./util/optimizettf"),w="object"==typeof process&&"object"==typeof process.versions&&void 0!==process.versions.node&&"function"==typeof Buffer;return e.prototype.readEmpty=function(){return this.data=n(),this},e.prototype.read=function(e,n){if(w)if(e instanceof Buffer)e=t.toArrayBuffer(e);if("ttf"===n.type)this.data=new l(n).read(e);else if("otf"===n.type)this.data=o(e,n);else if("eot"===n.type)e=a(e,n),this.data=new l(n).read(e);else if("woff"===n.type)e=r(e,n),this.data=new l(n).read(e);else if("svg"===n.type)this.data=s(e,n);else throw new Error("not support font type"+n.type);return this.type=n.type,this},e.prototype.write=function(e){if(e=e||{},!e.type)e.type=this.type;var n=null;if("ttf"===e.type)n=new u(e).write(this.data);else if("eot"===e.type)n=new u(e).write(this.data),n=f(n,e);else if("woff"===e.type)n=new u(e).write(this.data),n=c(n,e);else if("svg"===e.type)n=d(this.data,e);else if("symbol"===e.type)n=h(this.data,e);else throw new Error("not support font type"+e.type);if(w)if(!1!==e.toBuffer&&n instanceof ArrayBuffer)n=t.toBuffer(n);return n},e.prototype.toBase64=function(e,n){if(e=e||{},!e.type)e.type=this.type;if(n){if(w)if(n instanceof Buffer)n=t.toArrayBuffer(n)}else e.toBuffer=!1,n=this.write(e);var i;if("ttf"===e.type)i=p(n);else if("eot"===e.type)i=g(n);else if("woff"===e.type)i=m(n);else if("svg"===e.type)i=y(n);else if("symbol"===e.type)i=y(n,"image/svg+xml");else throw new Error("not support font type"+e.type);return i},e.prototype.set=function(e){return this.data=e,this},e.prototype.get=function(){return this.data},e.prototype.optimize=function(e){var t=x(this.data);if(e)e.result=t;return this},e.prototype.compound2simple=function(){var e=new i(this.data);return e.compound2simple(),this.data=e.get(),this},e.prototype.sort=function(){var e=new i(this.data);return e.sortGlyf(),this.data=e.get(),this},e.prototype.find=function(e){var t=new i(this.data),n=t.findGlyf(e);return n.length?t.getGlyf(n):n},e.prototype.merge=function(e,t){var n=new i(this.data);return n.mergeGlyf(e.get(),t),this.data=n.get(),this},e.create=function(t,n){return new e(t,n)},e.toBase64=function(e){if("string"==typeof e)if(!btoa)return new Buffer(e,"binary").toString("base64");else return btoa(e);else return v(e)},e}),define("fonteditor/widget/loader",["require","../i18n/i18n","fonteditor-core/ttf/font","inflate","./loading","./program"],function(require){function e(e){var t=f.setting.get("ie").import;return t.type="svg",s.create(e,t).data}function t(e,t){if("woff"===t.type)t.inflate=l.inflate;var n=s.create(e,t).data;return delete t.inflate,n}function n(e,n){u.show();var i=new FileReader;i.onload=function(e){try{n.success&&n.success(t(e.target.result,n))}catch(e){throw alert(e.message),e}u.hide()},i.onerror=function(e){u.hide(),i=null,alert(a.lang.msg_error_read_file),n.error&&n.error(e)},i.readAsArrayBuffer(e)}function i(e,n){u.show();try{n.success&&n.success(t(e,n))}catch(e){throw alert(e.message),e}u.hide()}function r(t,n){u.show();var i=new FileReader,r=t.name.replace(/\.\w+$/,"");i.onload=function(t){try{var o=t.target.result,a=e(o);if(a.glyf&&1===a.glyf.length)a.glyf[0].name=r;i=null,n.success&&n.success(a)}catch(e){throw alert(e.message),e}u.hide()},i.onerror=function(e){u.hide(),i=null,alert(a.lang.msg_error_read_file),n.error&&n.error(e)},i.readAsText(t)}function o(t,n){u.show();try{var i=e(t);u.hide(),n.success&&n.success(i)}catch(e){throw u.hide(),alert(e.message),e}}var a=require("../i18n/i18n"),s=require("fonteditor-core/ttf/font"),l=require("inflate"),u=require("./loading"),f=require("./program");return{load:function(e,t){if("svg"===t.type)if("string"==typeof e||e instanceof window.XMLDocument)o(e,t);else r(e,t);else if("ttf"===t.type||"woff"===t.type||"eot"===t.type||"otf"===t.type)if(e instanceof ArrayBuffer)i(e,t);else n(e,t);else t.error&&t.error({message:a.lang.msg_not_support_file_type})},supportLoad:function(e){return!!e.match(/(\.ttf|\.woff|\.eot|\.otf)$/i)},supportImport:function(e){return!!e.match(/(\.ttf|\.woff|\.svg|\.eot|\.otf)$/i)}}}),define("fonteditor/widget/util/resolvettf",["require","fonteditor-core/ttf/font","../program"],function(require){function e(e,n){n=n||{};var i=t.setting.get("ie");if(e.post=e.post||{},i&&i.export.saveWithGlyfName)e.post.format=2;else e.post.format=3;return e}var t=(require("fonteditor-core/ttf/font"),require("../program"));return e}),define("fonteditor-core/ttf/ttf2icon",["require","./ttfreader","./error","./data/default","./ttf2symbol"],function(require){function e(e){return e.map(function(e){return"\\"+e.toString(16)}).join(",")}function t(t,n){var i=[];return t.glyf.filter(function(e){return".notdef"!==e.name&&".null"!==e.name&&"nonmarkingreturn"!==e.name&&e.unicode&&e.unicode.length}).forEach(function(t,n){i.push({code:"&#x"+t.unicode[0].toString(16)+";",codeName:e(t.unicode),name:t.name,id:a(t,n)})}),{fontFamily:t.name.fontFamily||o.name.fontFamily,iconPrefix:n.iconPrefix||"icon",glyfList:i}}function n(e,n){if(n=n||{},e instanceof ArrayBuffer){var o=new i,a=o.read(e);return o.dispose(),t(a,n)}else if(e.version&&e.glyf)return t(e,n);r.raise(10101)}var i=require("./ttfreader"),r=require("./error"),o=require("./data/default"),a=require("./ttf2symbol").getSymbolId;return n}),define("fonteditor/template/export/icon-example.tpl",[],function(){return'<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <title>icon example</title>\n    <link rel="stylesheet" href="./page.css">\n    <link rel="stylesheet" href="./icon.css">\n</head>\n<body>\n    <div class="main">\n        <h1>{%=fontFamily%} example</h1>\n        <ul class="iconfont-list">\n            {%_.each(glyfList, function(glyf) {%}\n            <li>\n            <i class="icon icon-{%=glyf.name%}"></i>\n                <div class="code">{%=glyf.codeName%}</div>\n                <div class="name">{%=glyf.name%}</div>\n            </li>\n            {%});%}\n        </ul>\n    </div>\n\n</body>\n</html>\n'}),define("fonteditor/template/export/symbol-example.tpl",[],function(){return'<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <title>symbol example</title>\n    <link rel="stylesheet" href="./page.css">\n    <style>\n        .iconfont-list .icon {\n            width: 42px;\n            height: 42px;\n            transform: scale(1);\n            -webkit-transition: transform .25s ease-out 0s;\n            transition: transform .25s ease-out 0s;\n        }\n        .iconfont-list .icon:hover {\n            transform: scale(1.5);\n        }\n    </style>\n</head>\n<body>\n\n{%=symbolText%}\n    <div class="main">\n        <h1>{%=fontFamily%} symbol example</h1>\n        <ul class="iconfont-list">\n            {%_.each(glyfList, function(glyf) {%}\n            <li>\n                <svg class="icon"><use xlink:href="#{%=glyf.id%}"/></svg>\n                <div class="code">symbol</div>\n                <div class="name">{%=glyf.id%}</div>\n            </li>\n            {%});%}\n        </ul>\n    </div>\n</body>\n</html>\n'}),define("fonteditor/template/export/icon-css.tpl",[],function(){return'/**\n * @file icon.css\n */\n\n@font-face {\n    font-family: "{%=fontFamily%}";\n    src: url("{%=fontFamily%}.eot"); /* IE9 */\n    src: url("{%=fontFamily%}.eot?#iefix") format("embedded-opentype"), /* IE6-IE8 */\n    url("{%=fontFamily%}.woff") format("woff"), /* chrome、firefox */\n    url("{%=fontFamily%}.ttf") format("truetype"), /* chrome、firefox、opera、Safari, Android, iOS 4.2+ */\n    url("{%=fontFamily%}.svg#uxfonteditor") format("svg"); /* iOS 4.1- */\n}\n\n\n.{%=iconPrefix%} {\n    font-family: "{%=fontFamily%}" !important;\n    speak: none;\n    font-style: normal;\n    font-weight: normal;\n    font-variant: normal;\n    text-transform: none;\n    line-height: 1;\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n}\n\n{% _.each(glyfList, function(glyf) { %}\n.icon-{%=glyf.name%}:before {\n  content: "{%=glyf.codeName%}";\n}\n{% }); %}\n\n\n'}),define("fonteditor/template/export-render",["require","utpl","./export/icon-example.tpl","./export/symbol-example.tpl","./export/icon-css.tpl"],function(require){var e=require("utpl"),t=null,n=null,i=null,r=null;return $.get("./css/preview.css",function(e){i=e}),{renderFontExample:function(n){return(t=t||e.template(require("./export/icon-example.tpl")))(n)},renderSymbolExample:function(t){return(r=r||e.template(require("./export/symbol-example.tpl")))(t)},renderFontCss:function(t){return(n=n||e.template(require("./export/icon-css.tpl")))(t)},renderPreviewCss:function(){return i}}}),define("fonteditor/widget/exporter",["require","fonteditor-core/ttf/font","./util/resolvettf","fonteditor-core/ttf/ttf2icon","fonteditor-core/ttf/data/default","../template/export-render","./util/download","JSZip"],function(require){function e(e,t){return t.type=t.type||"ttf",e=i(e,t),n.create(e).write(t)}function t(t,i){if(t)try{var u="",f=i.fileName||t.name.fontFamily||"export";if("zip"===i.type){var c,d=new l,h=d.folder(o.fontId);["woff","eot","svg","ttf","symbol"].forEach(function(n){var i=f+"."+n,r=e(t,{type:n});if("symbol"===n)i=f+"-symbol.svg",c=r;h.file(i,r)});var p=r(t);h.file("icon.css",a.renderFontCss(p)),h.file("page.css",a.renderPreviewCss()),h.file("example.html",a.renderFontExample(p)),p.symbolText=c,h.file("example-symbol.html",a.renderSymbolExample(p)),u="data:application/zip;base64,"+d.generate({type:"base64"})}else{var g=e(t,i);u=n.toBase64(g),u="data:font/"+i.type+";charset=utf-8;base64,"+u}if(s(f+"."+i.type,u),i.success)i.success(u)}catch(e){if(i.error)i.error(e);throw alert(e.message),e}}var n=require("fonteditor-core/ttf/font"),i=require("./util/resolvettf"),r=require("fonteditor-core/ttf/ttf2icon"),o=require("fonteditor-core/ttf/data/default"),a=require("../template/export-render"),s=require("./util/download"),l=require("JSZip");return{export:t}}),define("fonteditor/template/export/preview-ttf.tpl",[],function(){return"<style>{%=previewCss%}</style>\n<style>\n    @font-face {\n        font-family: '{%=fontFamily%}';\n        {%if(fontFormat=='eot'){%}\n        src: url({%=fontData%});\n        {%} else if(fontFormat=='ttf') {%}\n        src: url({%=fontData%}) format('truetype');\n        {%} else {%}\n        src: url({%=fontData%}) format('{%=fontFormat%}');\n        {%}%}\n    }\n    .icon {\n        font-family: '{%=fontFamily%}';\n    }\n</style>\n<div class=\"main\">\n    <h1>${lang.preview_title}</h1>\n    <ul class=\"iconfont-list\">\n        {%glyfList.forEach(function(glyf) {%}\n        <li>\n            <i class=\"icon\">{%=glyf.code%}</i>\n            <div class=\"code\">{%=glyf.codeName%}</div>\n            <div class=\"name\">{%=glyf.name%}</div>\n        </li>\n        {%});%}\n    </ul>\n    <div class=\"helps\">${lang.preview_first_step}\n<pre>\n@font-face {\n    font-family: '{%=fontFamily%}';\n    src: url('{%=fontFamily%}.eot'); /* IE9*/\n    src: url('{%=fontFamily%}.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */\n    url('{%=fontFamily%}.woff') format('woff'), /* chrome、firefox */\n    url('{%=fontFamily%}.ttf') format('truetype'), /* chrome、firefox、opera、Safari, Android, iOS 4.2+*/\n    url('{%=fontFamily%}.svg#ux{%=fontFamily%}') format('svg'); /* iOS 4.1- */\n}\n</pre>\n${lang.preview_second_step}\n<pre>\n.{%=fontFamily%} {\n    font-family: \"{%=fontFamily%}\" !important;\n    speak: none;\n    font-style: normal;\n    font-weight: normal;\n    font-variant: normal;\n    text-transform: none;\n    line-height: 1;\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n}\n\n.icon-tree:after {content: '\\33';}\n</pre>\n${lang.preview_third_step}\n<pre>\n    &lt;i class=\"{%=fontFamily%}\"&gt;&amp;#x33&lt;/i&gt;\n\nor\n\n    &lt;i class=\"{%=fontFamily%} icon-three\"&gt;&lt;/i&gt;\n</pre>\n</div>\n</div>\n"}),define("fonteditor/template/preview-render",["require","common/string","../i18n/i18n","utpl","./export-render","./export/preview-ttf.tpl"],function(require){var e=require("common/string"),t=require("../i18n/i18n"),n=require("utpl"),i=require("./export-render"),r=null;return{renderPreview:function(o){o.previewCss=i.renderPreviewCss();var a=e.format(require("./export/preview-ttf.tpl"),t);return(r=r||n.template(a))(o)}}}),define("fonteditor/widget/previewer",["require","./util/resolvettf","fonteditor-core/ttf/ttf2icon","fonteditor-core/ttf/font","./program","../template/preview-render","common/lang"],function(require){function e(e,s){var l={type:s||"ttf"};e=t(e);try{var u=i.create(e).toBase64(l)}catch(e){throw r.fire("font-error",e),e}var f=a({fontData:u,fontFormat:l.type},n(e));return o.renderPreview(f)}var t=require("./util/resolvettf"),n=require("fonteditor-core/ttf/ttf2icon"),i=require("fonteditor-core/ttf/font"),r=require("./program"),o=require("../template/preview-render"),a=require("common/lang").extend,s=!!window.ActiveXObject||"ActiveXObject"in window;return{load:function(t,n){try{var i=e(t,n),r=window.open("./empty.html");if(s&&r.document&&r.document.body)r.document.body.innerHTML=i,r.focus();else r.onload=function(){r.document.body.innerHTML=i,r.focus(),r=null,i=null}}catch(e){throw alert(e.message),e}}}}),define("fonteditor-core/ttf/util/base642bytes",["require"],function(require){function e(e){for(var t=atob(e),n=[],i=0,r=t.length;i<r;i++)n.push(t[i].charCodeAt(0));return n}return e}),define("fonteditor/widget/sync-status",["require"],function(require){return{serviceNotAvailable:1,pullNoResponse:2,pushNoResponse:4,parseDataError:1001,parseFontError:1002,noHasNew:1003,cancelSync:1004}}),define("fonteditor/widget/SyncForm",["require","common/lang","common/promise","./program","./sync-status"],function(require){function e(e){var t=document.createElement("form");return t.id="form_sync_"+s++,t.target="sync-frame",t.method="post",t.action=this.url+(~this.url.indexOf("?")?"&":"?")+"action=push",e.callbackUrl=o.config.proxyUrl+"?callback="+this.callback,Object.keys(e).forEach(function(n){var i=document.createElement("input");i.type="hidden",i.name=n,i.value=e[n],t.appendChild(i)}),document.body.appendChild(t),t}function t(e){this.resolver&&this.resolver.resolve(e),this.dispose()}function n(){this.resolver&&this.resolver.reject({status:a.pushNoResponse,reason:"sync time out!"}),this.dispose()}function i(e,t){t=t||{},this.url=e,this.serviceStatus=t.serviceStatus||0}var r=(require("common/lang"),require("common/promise")),o=require("./program"),a=require("./sync-status"),s=0;return i.prototype.submit=function(i){this.callback="script_sync_"+s++,window[this.callback]=$.proxy(t,this);var o=e.call(this,i);if(o.submit(),document.body.removeChild(o),this.serviceStatus&a.pushNoResponse)return delete window[this.callback],r.resolved({status:0});else return this.timer=setTimeout($.proxy(n,this),1e4),this.resolver=new r,this.resolver.promise()},i.prototype.reset=function(){if(clearTimeout(this.timer),this.callback)delete window[this.callback],delete this.callback;return delete this.resolver,this},i.prototype.dispose=function(){this.reset()},i}),define("fonteditor/widget/sync",["require","../i18n/i18n","common/promise","common/string","./project","./program","./util/resolvettf","fonteditor-core/ttf/font","fonteditor-core/ttf/ttf2woff","fonteditor-core/ttf/ttf2eot","fonteditor-core/ttf/util/base642bytes","./loader","./SyncForm","./sync-status"],function(require){function e(e,t){if(b[e]=(b[e]||65535)&t,!t)delete b[e]}function t(e){return b[e]||0}function n(t){var n={action:"pull",encode:"base64",fontName:t.name,fontType:C,timestamp:t.timestamp||0},i=new u;return $.ajax({url:t.url,dataType:"jsonp",data:n}).then(function(n){if(n&&0===n.status)i.resolve(n.data);else e(t.url,w.pullNoResponse),i.resolve({status:w.parseDataError})},function(n){if(e(t.url,w.pullNoResponse),200===n.status)i.resolve({status:w.pullNoResponse});else e(t.url,w.serviceNotAvailable),i.reject({status:w.serviceNotAvailable,reason:"sync no response"}),alert(l.lang.msg_error_sync_font_address)}),i.promise()}function i(e){var t=new u;if(e.hasNew&&e.fontType===C&&e[e.fontType])if(window.confirm(f.format(l.lang.msg_has_new_font_version,e.fontName))){var n=new Int8Array(y(e[e.fontType])).buffer;v.load(n,{type:e.fontType,success:function(n){t.resolve({status:0,hasNew:1,newData:n,timestamp:e.timestamp})},error:function(){e.status=w.parseFontError,t.reject(e),alert(l.lang.msg_error_sync_font_version)}})}else e.status=w.cancelSync,t.reject(e);else e.status=w.noHasNew,t.reject(e);return t.promise()}function r(e,t){var n=[],i={};if(e.woff||e.ttf||e.eot){t=h(t);try{var r=p.create(t).write({type:"ttf"})}catch(e){throw d.fire("font-error",e),alert(e.message),e}if(e.ttf)n.push("ttf"),i.ttf=p.toBase64(r);if(e.woff)n.push("woff"),i.woff=p.toBase64(g(r));if(e.eot)n.push("eot"),i.eot=p.toBase64(m(r));r=null}if(e.svg){n.push("svg");var o=p.create(t).write({type:"svg"});i.svg=p.toBase64(o)}return i.encode="base64",i.fontName=e.name,i.fontType=n.join(","),i}function o(n,i,o){var a=new x(n.url,{serviceStatus:t(n.url)}),s=r(n,i);a.submit(s).then(function(e){if(0===e.status)o.resolve(e.data);else e.status=w.parseDataError,o.reject(e)},function(t){if(t.status===w.pushNoResponse)e(n.url,w.pushNoResponse);o.reject(t)})}function a(e,t,n){if(!e.pushUrl)return void n.resolve({});var i=new x(e.pushUrl,{serviceStatus:w.pushNoResponse}),o=r(e,t);i.submit(o).then(function(e){n.resolve(e)},function(e){n.reject(e)})}function s(e,t,n){if(!n)n=c.getConfig(e).sync;n.timestamp=t||0,c.updateConfig(e,{sync:n})}var l=require("../i18n/i18n"),u=require("common/promise"),f=require("common/string"),c=require("./project"),d=require("./program"),h=require("./util/resolvettf"),p=require("fonteditor-core/ttf/font"),g=require("fonteditor-core/ttf/ttf2woff"),m=require("fonteditor-core/ttf/ttf2eot"),y=require("fonteditor-core/ttf/util/base642bytes"),v=require("./loader"),x=require("./SyncForm"),w=require("./sync-status"),b={},C="ttf",exports={};return exports.addTask=function(e){var t=e.type||"push",r=e.projectId,f=e.ttf,d=e.config;if(e=null,!d)d=c.getConfig(r).sync;if(!d||!d.url&&!d.pushUrl)return u.rejected({status:2,statusInfo:l.lang.msg_not_set_sync_info});var h=new u,p=h.promise();if("push"===t&&!d.url&&d.pushUrl)return a(d,f,h),p;if("pull"===t)n(d).then(i).then(function(e){h.resolve(e)},function(e){h.reject(e)});else n(d).then(i).then(function(e){h.resolve(e)},function(e){if(e.status===w.serviceNotAvailable)return void h.reject(e);if(!f)h.reject({status:2,statusInfo:l.lang.msg_no_sync_font});else if(o(d,f,h),d.pushUrl&&d.pushUrl!==d.url)setTimeout(function(){a(d,f,new u)},200)});return p.then(function(e){if(e&&e.timestamp)s(r,e.timestamp,d)}),p},exports}),define("fonteditor/main",["require","./i18n/i18n","./widget/program","./controller/default","./controller/actions","common/lang","./widget/settingmanager","./config","./widget/Spliter","./widget/Toolbar","./menu/viewer","./widget/Pager","./widget/glyfviewer/GLYFViewer","./menu/editor","./widget/GLYFEditor","./widget/ProjectViewer","./widget/project","./widget/TTFManager","./widget/loader","./widget/exporter","./widget/previewer","./widget/sync"],function(require){function e(e){var t=e[0];if("open"===s.data.action&&s.loader.supportLoad(t.name))s.loader.load(t,{type:t.name.slice(t.name.lastIndexOf(".")+1).toLowerCase(),success:function(e){s.viewer.clearSelected(),s.ttfManager.set(e),s.data.projectId=null}});else if("import"===s.data.action&&s.loader.supportImport(t.name)){if(s.ttfManager.get()){var n=t.name.slice(t.name.lastIndexOf(".")+1).toLowerCase(),i=new RegExp("."+n+"$","i"),e=Array.prototype.slice.call(e).filter(function(e){return i.test(e.name)});e.forEach(function(e){s.loader.load(e,{type:n,success:function(e){if(e.glyf.length)s.ttfManager.merge(e,{scale:!0,adjustGlyf:"svg"===e.from?!0:!1})}})})}}else alert(a.lang.msg_not_support_file_type)}function t(t){e(t.target.files),t.target.value=""}function n(t){t.stopPropagation(),t.preventDefault();var n=t.dataTransfer.files[0],i=n.name.slice(n.name.lastIndexOf(".")+1).toLowerCase();s.data.action="svg"===i?"import":"open",e(t.dataTransfer.files)}function i(){$(".action-groups").delegate("[data-action]","click",function(e){var t=this.getAttribute("data-action");if("1"!==this.getAttribute("data-disabled")&&u[t])s.data.action=t,u[t].call(this,e)}),document.getElementById("font-import").addEventListener("change",t),$(document).on("dragleave drop dragenter dragover",function(e){e.preventDefault()}),document.getElementById("glyf-list").addEventListener("drop",n)}function r(e){if(s.project.getConfig(e))s.project.ready().then(function(){s.projectViewer.select(e),s.projectViewer.fire("open",{projectId:e})})}function o(){var e=null;if(location.search){var t=require("common/lang").parseQuery(location.search.slice(1));if(t.project)e=t.project}if(!e)e=window.localStorage.getItem("project-cur");return e}var a=require("./i18n/i18n"),s=require("./widget/program"),l=require("./controller/default"),u=require("./controller/actions"),f={init:function(){i(),s.setting=require("./widget/settingmanager"),s.config=require("./config");var e=require("./widget/Spliter");s.spliter=new e($("#glyf-list-spliter"));var t=require("./widget/Toolbar"),n=new t($("#glyf-list-commandmenu"),{commands:require("./menu/viewer")}),a=require("./widget/Pager");s.viewerPager=new a($("#glyf-list-pager"));var u=require("./widget/glyfviewer/GLYFViewer");s.viewer=new u($("#glyf-list"),{commandMenu:n});var f=new t($("#editor-commandmenu"),{commands:require("./menu/editor")}),c=require("./widget/GLYFEditor");s.editor=new c($("#glyf-editor"),{commandMenu:f});var d=require("./widget/ProjectViewer");s.project=require("./widget/project"),s.projectViewer=new d($("#project-list"));var h=require("./widget/TTFManager");if(s.ttfManager=new h,s.loader=require("./widget/loader"),s.exporter=require("./widget/exporter"),s.previewer=require("./widget/previewer"),s.sync=require("./widget/sync"),l.init(s),s.setting.isStored("editor")){var p=s.setting.get("editor");s.viewer.setSetting(p.viewer),s.editor.setSetting(p.editor)}s.projectViewer.show(s.project.items());var g=o();if(g)r(g)}};return f.init(),f});