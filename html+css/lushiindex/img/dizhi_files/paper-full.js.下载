var paper=new function(t){var e=new function(){function i(t,i,n,r,a){function o(s,o){if("string"==typeof(o=o||(o=u(i,s))&&(o.get?o:o.value))&&"#"===o[0])o=t[o.substring(1)]||o;var l,f="function"==typeof o,d=o,_=a||f&&!o.base?o&&o.get?s in t:t[s]:null;if(!a||!_){if(f&&_)o.base=_;if(f&&!1!==r&&(l=s.match(/^([gs]et|is)(([A-Z])(.*))$/)))h[l[3].toLowerCase()+l[4]]=l[2];if(!d||f||!d.get||"function"!=typeof d.get||!e.isPlainObject(d))d={value:d,writable:!0};if((u(t,s)||{configurable:!0}).configurable)d.configurable=!0,d.enumerable=n;c(t,s,d)}}var h={};if(i){for(var l in i)if(i.hasOwnProperty(l)&&!s.test(l))o(l);for(var l in h){var f=h[l],d=t["set"+f],_=t["get"+f]||d&&t["is"+f];if(_&&(!0===r||0===_.length))o(l,{get:_,set:d})}}return t}function n(t,e,i){if(t)("length"in t&&!t.getLength&&"number"==typeof t.length?a:o).call(t,e,i=i||t);return i}function r(t,e,i){for(var n in e)if(e.hasOwnProperty(n)&&(!i||!i[n]))t[n]=e[n];return t}var s=/^(statics|enumerable|beans|preserve)$/,a=[].forEach||function(t,e){for(var i=0,n=this.length;i<n;i++)t.call(e,this[i],i,this)},o=function(t,e){for(var i in this)if(this.hasOwnProperty(i))t.call(e,this[i],i,this)},h=Object.create||function(t){return{__proto__:t}},u=Object.getOwnPropertyDescriptor||function(t,e){var i=t.__lookupGetter__&&t.__lookupGetter__(e);return i?{get:i,set:t.__lookupSetter__(e),enumerable:!0,configurable:!0}:t.hasOwnProperty(e)?{value:t[e],enumerable:!0,configurable:!0,writable:!0}:null},l=Object.defineProperty||function(t,e,i){if((i.get||i.set)&&t.__defineGetter__){if(i.get)t.__defineGetter__(e,i.get);if(i.set)t.__defineSetter__(e,i.set)}else t[e]=i.value;return t},c=function(t,e,i){return delete t[e],l(t,e,i)};return i(function(){for(var t=0,e=arguments.length;t<e;t++)r(this,arguments[t])},{inject:function(t){if(t){var e=!0===t.statics?t:t.statics,n=t.beans,r=t.preserve;if(e!==t)i(this.prototype,t,t.enumerable,n,r);i(this,e,!0,n,r)}for(var s=1,a=arguments.length;s<a;s++)this.inject(arguments[s]);return this},extend:function(){for(var t,e,n=this,r=0,s=arguments.length;r<s&&!(t=arguments[r].initialize);r++);if(t=t||function(){n.apply(this,arguments)},e=t.prototype=h(this.prototype),c(e,"constructor",{value:t,writable:!0,configurable:!0}),i(t,this,!0),arguments.length)this.inject.apply(t,arguments);return t.base=n,t}},!0).inject({inject:function(){for(var t=0,e=arguments.length;t<e;t++){var n=arguments[t];if(n)i(this,n,n.enumerable,n.beans,n.preserve)}return this},extend:function(){var t=h(this);return t.inject.apply(t,arguments)},each:function(t,e){return n(this,t,e)},set:function(t){return r(this,t)},clone:function(){return new this.constructor(this)},statics:{each:n,create:h,define:c,describe:u,set:r,clone:function(t){return r(new t.constructor,t)},isPlainObject:function(t){var i=null!=t&&t.constructor;return i&&(i===Object||i===e||"Object"===i.name)},pick:function(e,i){return e!==t?e:i}}})};if("undefined"!=typeof module)module.exports=e;e.inject({toString:function(){return null!=this._id?(this._class||"Object")+(this._name?" '"+this._name+"'":" @"+this._id):"{ "+e.each(this,function(t,e){if(!/^_/.test(e)){var i=typeof t;this.push(e+": "+("number"===i?s.instance.number(t):"string"===i?"'"+t+"'":t))}},[]).join(", ")+" }"},getClassName:function(){return this._class||""},exportJSON:function(t){return e.exportJSON(this,t)},toJSON:function(){return e.serialize(this)},_set:function(i,n,r){if(i&&(r||e.isPlainObject(i))){for(var s=Object.keys(i._filtering||i),a=0,o=s.length;a<o;a++){var h=s[a];if(!n||!n[h]){var u=i[h];if(u!==t)this[h]=u}}return!0}},statics:{exports:{enumerable:!0},extend:function t(){var i=t.base.apply(this,arguments),n=i.prototype._class;if(n&&!e.exports[n])e.exports[n]=i;return i},equals:function(t,i){if(t===i)return!0;if(t&&t.equals)return t.equals(i);if(i&&i.equals)return i.equals(t);if(t&&i&&"object"==typeof t&&"object"==typeof i){if(Array.isArray(t)&&Array.isArray(i)){var n=t.length;if(n!==i.length)return!1;for(;n--;)if(!e.equals(t[n],i[n]))return!1}else{var r=Object.keys(t),n=r.length;if(n!==Object.keys(i).length)return!1;for(;n--;){var s=r[n];if(!i.hasOwnProperty(s)||!e.equals(t[s],i[s]))return!1}}return!0}return!1},read:function(i,n,r,s){if(this===e){var a=this.peek(i,n);return i.__index++,a}var o=this.prototype,h=o._readIndex,u=n||h&&i.__index||0;if(!s)s=i.length-u;var l=i[u];if(l instanceof this||r&&r.readNull&&null==l&&s<=1){if(h)i.__index=u+1;return l&&r&&r.clone?l.clone():l}if(l=e.create(this.prototype),h)l.__read=!0;if(l=l.initialize.apply(l,u>0||s<i.length?Array.prototype.slice.call(i,u,u+s):i)||l,h)i.__index=u+l.__read,l.__read=t;return l},peek:function(t,e){return t[t.__index=e||t.__index||0]},remain:function(t){return t.length-(t.__index||0)},readAll:function(t,e,i){for(var n,r=[],s=e||0,a=t.length;s<a;s++)r.push(Array.isArray(n=t[s])?this.read(n,0,i):this.read(t,s,i,1));return r},readNamed:function(i,n,r,s,a){var o=this.getNamed(i,n),h=o!==t;if(h){var u=i._filtered;if(!u)u=i._filtered=e.create(i[0]),u._filtering=i[0];u[n]=t}return this.read(h?[o]:i,r,s,a)},getNamed:function(i,n){var r=i[0];if(i._hasObject===t)i._hasObject=1===i.length&&e.isPlainObject(r);if(i._hasObject)return n?r[n]:i._filtered||r},hasNamed:function(t,e){return!!this.getNamed(t,e)},isPlainValue:function(t,e){return this.isPlainObject(t)||Array.isArray(t)||e&&"string"==typeof t},serialize:function(t,i,n,r){i=i||{};var a,o=!r;if(o)i.formatter=new s(i.precision),r={length:0,definitions:{},references:{},add:function(t,e){var i="#"+t._id,n=this.references[i];if(!n){this.length++;var r=e.call(t),s=t._class;if(s&&r[0]!==s)r.unshift(s);this.definitions[i]=r,n=this.references[i]=[i]}return n}};if(t&&t._serialize){a=t._serialize(i,r);var h=t._class;if(h&&!n&&!a._compact&&a[0]!==h)a.unshift(h)}else if(Array.isArray(t)){a=[];for(var u=0,l=t.length;u<l;u++)a[u]=e.serialize(t[u],i,n,r);if(n)a._compact=!0}else if(e.isPlainObject(t)){a={};for(var c=Object.keys(t),u=0,l=c.length;u<l;u++){var f=c[u];a[f]=e.serialize(t[f],i,n,r)}}else if("number"==typeof t)a=i.formatter.number(t,i.precision);else a=t;return o&&r.length>0?[["dictionary",r.definitions],a]:a},deserialize:function(t,i,n,r){var s=t,a=!n;if(n=n||{},Array.isArray(t)){var o=t[0],h="dictionary"===o;if(1==t.length&&/^#/.test(o))return n.dictionary[o];if(o=e.exports[o],s=[],r)n.dictionary=s;for(var u=o?1:0,l=t.length;u<l;u++)s.push(e.deserialize(t[u],i,n,h));if(o){var c=s;if(i)s=i(o,c);else s=e.create(o.prototype),o.apply(s,c)}}else if(e.isPlainObject(t)){if(s={},r)n.dictionary=s;for(var f in t)s[f]=e.deserialize(t[f],i,n)}return a&&t&&t.length&&"dictionary"===t[0][0]?s[1]:s},exportJSON:function(t,i){var n=e.serialize(t,i);return i&&!1===i.asString?n:JSON.stringify(n)},importJSON:function(t,i){return e.deserialize("string"==typeof t?JSON.parse(t):t,function(t,n){var r=i&&i.constructor===t?i:e.create(t.prototype),s=r===i;if(1===n.length&&r instanceof m&&(s||!(r instanceof w))){var a=n[0];if(e.isPlainObject(a))a.insert=!1}if(t.apply(r,n),s)i=null;return r})},splice:function(e,i,n,r){var s=i&&i.length,a=n===t;if((n=a?e.length:n)>e.length)n=e.length;for(var o=0;o<s;o++)i[o]._index=n+o;if(a)return e.push.apply(e,i),[];else{var h=[n,r];if(i)h.push.apply(h,i);for(var u=e.splice.apply(e,h),o=0,l=u.length;o<l;o++)u[o]._index=t;for(var o=n+s,l=e.length;o<l;o++)e[o]._index=o;return u}},capitalize:function(t){return t.replace(/\b[a-z]/g,function(t){return t.toUpperCase()})},camelize:function(t){return t.replace(/-(.)/g,function(t,e){return e.toUpperCase()})},hyphenate:function(t){return t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}}});var i={on:function(t,i){if("string"!=typeof t)e.each(t,function(t,e){this.on(e,t)},this);else{var n=this._eventTypes,r=n&&n[t],s=this._callbacks=this._callbacks||{};if(s=s[t]=s[t]||[],-1===s.indexOf(i))if(s.push(i),r&&r.install&&1===s.length)r.install.call(this,t)}return this},off:function(t,i){if("string"!=typeof t)return void e.each(t,function(t,e){this.off(e,t)},this);var n,r=this._eventTypes,s=r&&r[t],a=this._callbacks&&this._callbacks[t];if(a)if(!i||-1!==(n=a.indexOf(i))&&1===a.length){if(s&&s.uninstall)s.uninstall.call(this,t);delete this._callbacks[t]}else if(-1!==n)a.splice(n,1);return this},once:function(t,e){return this.on(t,function(){e.apply(this,arguments),this.off(t,e)})},emit:function(t,e){var i=this._callbacks&&this._callbacks[t];if(!i)return!1;var n=[].slice.call(arguments,1);i=i.slice();for(var r=0,s=i.length;r<s;r++)if(!1===i[r].apply(this,n)){if(e&&e.stop)e.stop();break}return!0},responds:function(t){return!(!this._callbacks||!this._callbacks[t])},attach:"#on",detach:"#off",fire:"#emit",_installEvents:function(t){var e=this._callbacks,i=t?"install":"uninstall";for(var n in e)if(e[n].length>0){var r=this._eventTypes,s=r&&r[n],a=s&&s[i];if(a)a.call(this,n)}},statics:{inject:function t(i){var n=i._events;if(n){var r={};e.each(n,function(t,n){var s="string"==typeof t,a=s?t:n,o=e.capitalize(a),h=a.substring(2).toLowerCase();r[h]=s?{}:t,a="_"+a,i["get"+o]=function(){return this[a]},i["set"+o]=function(t){var e=this[a];if(e)this.off(h,e);if(t)this.on(h,t);this[a]=t}}),i._eventTypes=r}return t.base.apply(this,arguments)}}},n=e.extend({_class:"PaperScope",initialize:function t(){paper=this,this.settings=new e({applyMatrix:!0,handleSize:4,hitTolerance:0}),this.project=null,this.projects=[],this.tools=[],this.palettes=[],this._id=t._id++,t._scopes[this._id]=this;var i=t.prototype;if(!this.support){var n=Y.getContext(1,1);i.support={nativeDash:"setLineDash"in n||"mozDash"in n,nativeBlendModes:K.nativeModes},Y.release(n)}if(!this.browser){var r=navigator.userAgent.toLowerCase(),s=(/(win)/.exec(r)||/(mac)/.exec(r)||/(linux)/.exec(r)||[])[0],a=i.browser={platform:s};if(s)a[s]=!0;if(r.replace(/(opera|chrome|safari|webkit|firefox|msie|trident|atom)\/?\s*([.\d]+)(?:.*version\/([.\d]+))?(?:.*rv\:([.\d]+))?/g,function(t,e,i,n,r){if(!a.chrome){var s="opera"===e?n:i;if("trident"===e)s=r,e="msie";a.version=s,a.versionNumber=parseFloat(s),a.name=e,a[e]=!0}}),a.chrome)delete a.webkit;if(a.atom)delete a.chrome}},version:"0.9.25",getView:function(){return this.project&&this.project.getView()},getPaper:function(){return this},execute:function(t,e,i){paper.PaperScript.execute(t,this,e,i),V.updateFocus()},install:function(t){var i=this;e.each(["project","view","tool"],function(n){e.define(t,n,{configurable:!0,get:function(){return i[n]}})});for(var n in this)if(!/^_/.test(n)&&this[n])t[n]=this[n]},setup:function(t){return paper=this,this.project=new v(t),this},activate:function(){paper=this},clear:function(){for(var t=this.projects.length-1;t>=0;t--)this.projects[t].remove();for(var t=this.tools.length-1;t>=0;t--)this.tools[t].remove();for(var t=this.palettes.length-1;t>=0;t--)this.palettes[t].remove()},remove:function(){this.clear(),delete n._scopes[this._id]},statics:new function(){function t(t){return t+="Attribute",function(e,i){return e[t](i)||e[t]("data-paper-"+i)}}return{_scopes:{},_id:0,get:function(t){return this._scopes[t]||null},getAttribute:t("get"),hasAttribute:t("has")}}}),r=e.extend(i,{initialize:function(t){if(this._scope=paper,this._index=this._scope[this._list].push(this)-1,t||!this._scope[this._reference])this.activate()},activate:function(){if(!this._scope)return!1;var t=this._scope[this._reference];if(t&&t!==this)t.emit("deactivate");return this._scope[this._reference]=this,this.emit("activate",t),!0},isActive:function(){return this._scope[this._reference]===this},remove:function(){if(null==this._index)return!1;if(e.splice(this._scope[this._list],null,this._index,1),this._scope[this._reference]==this)this._scope[this._reference]=null;return this._scope=null,!0}}),s=e.extend({initialize:function(t){this.precision=t||5,this.multiplier=Math.pow(10,this.precision)},number:function(t){return Math.round(t*this.multiplier)/this.multiplier},pair:function(t,e,i){return this.number(t)+(i||",")+this.number(e)},point:function(t,e){return this.number(t.x)+(e||",")+this.number(t.y)},size:function(t,e){return this.number(t.width)+(e||",")+this.number(t.height)},rectangle:function(t,e){return this.point(t,e)+(e||",")+this.size(t,e)}});s.instance=new s;var a=new function(){function t(t,e,i){return t<e?e:t>i?i:t}var e=[[.5773502691896257],[0,.7745966692414834],[.33998104358485626,.8611363115940526],[0,.5384693101056831,.906179845938664],[.2386191860831969,.6612093864662645,.932469514203152],[0,.4058451513773972,.7415311855993945,.9491079123427585],[.1834346424956498,.525532409916329,.7966664774136267,.9602898564975363],[0,.3242534234038089,.6133714327005904,.8360311073266358,.9681602395076261],[.14887433898163122,.4333953941292472,.6794095682990244,.8650633666889845,.9739065285171717],[0,.26954315595234496,.5190961292068118,.7301520055740494,.8870625997680953,.978228658146057],[.1252334085114689,.3678314989981802,.5873179542866175,.7699026741943047,.9041172563704749,.9815606342467192],[0,.2304583159551348,.44849275103644687,.6423493394403402,.8015780907333099,.9175983992229779,.9841830547185881],[.10805494870734367,.31911236892788974,.5152486363581541,.6872929048116855,.827201315069765,.9284348836635735,.9862838086968123],[0,.20119409399743451,.3941513470775634,.5709721726085388,.7244177313601701,.8482065834104272,.937273392400706,.9879925180204854],[.09501250983763744,.2816035507792589,.45801677765722737,.6178762444026438,.755404408355003,.8656312023878318,.9445750230732326,.9894009349916499]],i=[[1],[.8888888888888888,.5555555555555556],[.6521451548625461,.34785484513745385],[.5688888888888889,.47862867049936647,.23692688505618908],[.46791393457269104,.3607615730481386,.17132449237917036],[.4179591836734694,.3818300505051189,.27970539148927664,.1294849661688697],[.362683783378362,.31370664587788727,.22238103445337448,.10122853629037626],[.3302393550012598,.31234707704000286,.26061069640293544,.1806481606948574,.08127438836157441],[.29552422471475287,.26926671930999635,.21908636251598204,.1494513491505806,.06667134430868814],[.2729250867779006,.26280454451024665,.23319376459199048,.18629021092773426,.1255803694649046,.05566856711617366],[.24914704581340277,.2334925365383548,.20316742672306592,.16007832854334622,.10693932599531843,.04717533638651183],[.2325515532308739,.22628318026289723,.2078160475368885,.17814598076194574,.13887351021978725,.09212149983772845,.04048400476531588],[.2152638534631578,.2051984637212956,.18553839747793782,.15720316715819355,.12151857068790319,.08015808715976021,.03511946033175186],[.2025782419255613,.19843148532711158,.1861610000155622,.16626920581699392,.13957067792615432,.10715922046717194,.07036604748810812,.03075324199611727],[.1894506104550685,.18260341504492358,.16915651939500254,.14959598881657674,.12462897125553388,.09515851168249279,.062253523938647894,.027152459411754096]],n=Math.abs,r=Math.sqrt,s=Math.pow,o=1e-12,h=1.12e-16;return{TOLERANCE:1e-6,EPSILON:o,MACHINE_EPSILON:h,CURVETIME_EPSILON:4e-7,GEOMETRIC_EPSILON:2e-7,WINDING_EPSILON:2e-7,TRIGONOMETRIC_EPSILON:1e-7,CLIPPING_EPSILON:1e-7,KAPPA:4*(r(2)-1)/3,isZero:function(t){return t>=-o&&t<=o},integrate:function(t,n,r,s){for(var a=e[s-2],o=i[s-2],h=.5*(r-n),u=h+n,l=0,c=s+1>>1,f=1&s?o[l++]*t(u):0;l<c;){var d=h*a[l];f+=o[l++]*(t(u+d)+t(u-d))}return h*f},findRoot:function(t,e,i,r,s,a,o){for(var h=0;h<a;h++){var u=t(i),l=u/e(i),c=i-l;if(n(l)<o)return c;if(u>0)s=i,i=c<=r?.5*(r+s):c;else r=i,i=c>=s?.5*(r+s):c}return i},solveQuadratic:function(e,i,a,u,l,c){var f,d,_=0,g=l-o,v=c+o,p=1/0,m=i;if(i/=-2,0!==(d=i*i-e*a)&&n(d)<h){var y=s(n(e*i*a),1/3);if(y<1e-8){var w=s(10,n(Math.floor(Math.log(y)*Math.LOG10E)));if(!isFinite(w))w=0;e*=w,i*=w,a*=w,d=i*i-e*a}}if(n(e)<o){if(n(m)<o)return n(a)<o?-1:0;f=-a/m}else if(d>=-h){var x=d<0?0:r(d),b=i+(i<0?-x:x);if(0===b)f=a/e,p=-f;else f=b/e,p=a/b}if(isFinite(f)&&(null==l||f>g&&f<v))u[_++]=null==l?f:t(f,l,c);if(p!==f&&isFinite(p)&&(null==l||p>g&&p<v))u[_++]=null==l?p:t(p,l,c);return _},solveCubic:function(e,i,u,l,c,f,d){var _,g,v,p=0;if(n(e)<o)e=i,g=u,v=l,_=1/0;else if(n(l)<o)g=i,v=u,_=0;else{var m,y,w,x,b,C,S,P=1+h;if(_=-i/e/3,S=e*_,g=S+i,v=g*_+u,w=(S+g)*_+v,y=v*_+l,x=y/e,b=s(n(x),1/3),C=x<0?-1:1,x=-w/e,b=x>0?1.3247179572*Math.max(b,r(x)):b,(m=_-C*b)!==_){do{if(_=m,S=e*_,g=S+i,v=g*_+u,w=(S+g)*_+v,y=v*_+l,(m=0===w?_:_-y/w/P)===_){_=m;break}}while(C*m>C*_);if(n(e)*_*_>n(l/_))v=-l/_,g=(v-u)/_}}var p=a.solveQuadratic(e,g,v,c,f,d);if(isFinite(_)&&(0===p||_!==c[p-1])&&(null==f||_>f-o&&_<d+o))c[p++]=null==f?_:t(_,f,d);return p}}},o={_id:1,_pools:{},get:function(t){if(t){var e=t._class,i=this._pools[e];if(!i)i=this._pools[e]={_id:1};return i._id++}else return this._id++}},h=e.extend({_class:"Point",_readIndex:!0,initialize:function(t,e){var i=typeof t;if("number"===i){var n="number"==typeof e;if(this.x=t,this.y=n?e:t,this.__read)this.__read=n?2:1}else if("undefined"===i||null===t){if(this.x=this.y=0,this.__read)this.__read=null===t?1:0}else{if(Array.isArray(t))this.x=t[0],this.y=t.length>1?t[1]:t[0];else if(null!=t.x)this.x=t.x,this.y=t.y;else if(null!=t.width)this.x=t.width,this.y=t.height;else if(null!=t.angle)this.x=t.length,this.y=0,this.setAngle(t.angle);else if(this.x=this.y=0,this.__read)this.__read=0;if(this.__read)this.__read=1}},set:function(t,e){return this.x=t,this.y=e,this},equals:function(t){return this===t||t&&(this.x===t.x&&this.y===t.y||Array.isArray(t)&&this.x===t[0]&&this.y===t[1])||!1},clone:function(){return new h(this.x,this.y)},toString:function(){var t=s.instance;return"{ x: "+t.number(this.x)+", y: "+t.number(this.y)+" }"},_serialize:function(t){var e=t.formatter;return[e.number(this.x),e.number(this.y)]},getLength:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},setLength:function(t){if(this.isZero()){var e=this._angle||0;this.set(Math.cos(e)*t,Math.sin(e)*t)}else{var i=t/this.getLength();if(a.isZero(i))this.getAngle();this.set(this.x*i,this.y*i)}},getAngle:function(){return 180*this.getAngleInRadians.apply(this,arguments)/Math.PI},setAngle:function(t){this.setAngleInRadians.call(this,t*Math.PI/180)},getAngleInDegrees:"#getAngle",setAngleInDegrees:"#setAngle",getAngleInRadians:function(){if(!arguments.length)return this.isZero()?this._angle||0:this._angle=Math.atan2(this.y,this.x);else{var t=h.read(arguments),e=this.getLength()*t.getLength();if(a.isZero(e))return NaN;else{var i=this.dot(t)/e;return Math.acos(i<-1?-1:i>1?1:i)}}},setAngleInRadians:function(t){if(this._angle=t,!this.isZero()){var e=this.getLength();this.set(Math.cos(t)*e,Math.sin(t)*e)}},getQuadrant:function(){return this.x>=0?this.y>=0?1:4:this.y>=0?2:3}},{beans:!1,getDirectedAngle:function(){var t=h.read(arguments);return 180*Math.atan2(this.cross(t),this.dot(t))/Math.PI},getDistance:function(){var t=h.read(arguments),i=t.x-this.x,n=t.y-this.y,r=i*i+n*n;return e.read(arguments)?r:Math.sqrt(r)},normalize:function(e){if(e===t)e=1;var i=this.getLength(),n=0!==i?e/i:0,r=new h(this.x*n,this.y*n);if(n>=0)r._angle=this._angle;return r},rotate:function(t,e){if(0===t)return this.clone();t=t*Math.PI/180;var i=e?this.subtract(e):this,n=Math.sin(t),r=Math.cos(t);return i=new h(i.x*r-i.y*n,i.x*n+i.y*r),e?i.add(e):i},transform:function(t){return t?t._transformPoint(this):this},add:function(){var t=h.read(arguments);return new h(this.x+t.x,this.y+t.y)},subtract:function(){var t=h.read(arguments);return new h(this.x-t.x,this.y-t.y)},multiply:function(){var t=h.read(arguments);return new h(this.x*t.x,this.y*t.y)},divide:function(){var t=h.read(arguments);return new h(this.x/t.x,this.y/t.y)},modulo:function(){var t=h.read(arguments);return new h(this.x%t.x,this.y%t.y)},negate:function(){return new h(-this.x,-this.y)},isInside:function(){return f.read(arguments).contains(this)},isClose:function(){var t=h.read(arguments),i=e.read(arguments);return this.getDistance(t)<i},isCollinear:function(){var t=h.read(arguments);return h.isCollinear(this.x,this.y,t.x,t.y)},isColinear:"#isCollinear",isOrthogonal:function(){var t=h.read(arguments);return h.isOrthogonal(this.x,this.y,t.x,t.y)},isZero:function(){return a.isZero(this.x)&&a.isZero(this.y)},isNaN:function(){return isNaN(this.x)||isNaN(this.y)},dot:function(){var t=h.read(arguments);return this.x*t.x+this.y*t.y},cross:function(){var t=h.read(arguments);return this.x*t.y-this.y*t.x},project:function(){var t=h.read(arguments),e=t.isZero()?0:this.dot(t)/t.dot(t);return new h(t.x*e,t.y*e)},statics:{min:function(){var t=h.read(arguments),e=h.read(arguments);return new h(Math.min(t.x,e.x),Math.min(t.y,e.y))},max:function(){var t=h.read(arguments),e=h.read(arguments);return new h(Math.max(t.x,e.x),Math.max(t.y,e.y))},random:function(){return new h(Math.random(),Math.random())},isCollinear:function(t,e,i,n){return Math.abs(t*n-e*i)<=1e-7*Math.sqrt((t*t+e*e)*(i*i+n*n))},isOrthogonal:function(t,e,i,n){return Math.abs(t*i+e*n)<=1e-7*Math.sqrt((t*t+e*e)*(i*i+n*n))}}},e.each(["round","ceil","floor","abs"],function(t){var e=Math[t];this[t]=function(){return new h(e(this.x),e(this.y))}},{})),u=h.extend({initialize:function(t,e,i,n){this._x=t,this._y=e,this._owner=i,this._setter=n},set:function(t,e,i){if(this._x=t,this._y=e,!i)this._owner[this._setter](this);return this},getX:function(){return this._x},setX:function(t){this._x=t,this._owner[this._setter](this)},getY:function(){return this._y},setY:function(t){this._y=t,this._owner[this._setter](this)}}),l=e.extend({_class:"Size",_readIndex:!0,initialize:function(t,e){var i=typeof t;if("number"===i){var n="number"==typeof e;if(this.width=t,this.height=n?e:t,this.__read)this.__read=n?2:1}else if("undefined"===i||null===t){if(this.width=this.height=0,this.__read)this.__read=null===t?1:0}else{if(Array.isArray(t))this.width=t[0],this.height=t.length>1?t[1]:t[0];else if(null!=t.width)this.width=t.width,this.height=t.height;else if(null!=t.x)this.width=t.x,this.height=t.y;else if(this.width=this.height=0,this.__read)this.__read=0;if(this.__read)this.__read=1}},set:function(t,e){return this.width=t,this.height=e,this},equals:function(t){return t===this||t&&(this.width===t.width&&this.height===t.height||Array.isArray(t)&&this.width===t[0]&&this.height===t[1])||!1},clone:function(){return new l(this.width,this.height)},toString:function(){var t=s.instance;return"{ width: "+t.number(this.width)+", height: "+t.number(this.height)+" }"},_serialize:function(t){var e=t.formatter;return[e.number(this.width),e.number(this.height)]},add:function(){var t=l.read(arguments);return new l(this.width+t.width,this.height+t.height)},subtract:function(){var t=l.read(arguments);return new l(this.width-t.width,this.height-t.height)},multiply:function(){var t=l.read(arguments);return new l(this.width*t.width,this.height*t.height)},divide:function(){var t=l.read(arguments);return new l(this.width/t.width,this.height/t.height)},modulo:function(){var t=l.read(arguments);return new l(this.width%t.width,this.height%t.height)},negate:function(){return new l(-this.width,-this.height)},isZero:function(){return a.isZero(this.width)&&a.isZero(this.height)},isNaN:function(){return isNaN(this.width)||isNaN(this.height)},statics:{min:function(t,e){return new l(Math.min(t.width,e.width),Math.min(t.height,e.height))},max:function(t,e){return new l(Math.max(t.width,e.width),Math.max(t.height,e.height))},random:function(){return new l(Math.random(),Math.random())}}},e.each(["round","ceil","floor","abs"],function(t){var e=Math[t];this[t]=function(){return new l(e(this.width),e(this.height))}},{})),c=l.extend({initialize:function(t,e,i,n){this._width=t,this._height=e,this._owner=i,this._setter=n},set:function(t,e,i){if(this._width=t,this._height=e,!i)this._owner[this._setter](this);return this},getWidth:function(){return this._width},setWidth:function(t){this._width=t,this._owner[this._setter](this)},getHeight:function(){return this._height},setHeight:function(t){this._height=t,this._owner[this._setter](this)}}),f=e.extend({_class:"Rectangle",_readIndex:!0,beans:!0,initialize:function(i,n,r,s){var a=typeof i,o=0;if("number"===a)this.x=i,this.y=n,this.width=r,this.height=s,o=4;else if("undefined"===a||null===i)this.x=this.y=this.width=this.height=0,o=null===i?1:0;else if(1===arguments.length)if(Array.isArray(i))this.x=i[0],this.y=i[1],this.width=i[2],this.height=i[3],o=1;else if(i.x!==t||i.width!==t)this.x=i.x||0,this.y=i.y||0,this.width=i.width||0,this.height=i.height||0,o=1;else if(i.from===t&&i.to===t)this.x=this.y=this.width=this.height=0,this._set(i),o=1;if(!o){var u=h.readNamed(arguments,"from"),c=e.peek(arguments);if(this.x=u.x,this.y=u.y,c&&c.x!==t||e.hasNamed(arguments,"to")){var f=h.readNamed(arguments,"to");if(this.width=f.x-u.x,this.height=f.y-u.y,this.width<0)this.x=f.x,this.width=-this.width;if(this.height<0)this.y=f.y,this.height=-this.height}else{var d=l.read(arguments);this.width=d.width,this.height=d.height}o=arguments.__index}if(this.__read)this.__read=o},set:function(t,e,i,n){return this.x=t,this.y=e,this.width=i,this.height=n,this},clone:function(){return new f(this.x,this.y,this.width,this.height)},equals:function(t){var i=e.isPlainValue(t)?f.read(arguments):t;return i===this||i&&this.x===i.x&&this.y===i.y&&this.width===i.width&&this.height===i.height||!1},toString:function(){var t=s.instance;return"{ x: "+t.number(this.x)+", y: "+t.number(this.y)+", width: "+t.number(this.width)+", height: "+t.number(this.height)+" }"},_serialize:function(t){var e=t.formatter;return[e.number(this.x),e.number(this.y),e.number(this.width),e.number(this.height)]},getPoint:function(t){return new(t?h:u)(this.x,this.y,this,"setPoint")},setPoint:function(){var t=h.read(arguments);this.x=t.x,this.y=t.y},getSize:function(t){return new(t?l:c)(this.width,this.height,this,"setSize")},setSize:function(){var t=l.read(arguments);if(this._fixX)this.x+=(this.width-t.width)*this._fixX;if(this._fixY)this.y+=(this.height-t.height)*this._fixY;this.width=t.width,this.height=t.height,this._fixW=1,this._fixH=1},getLeft:function(){return this.x},setLeft:function(t){if(!this._fixW)this.width-=t-this.x;this.x=t,this._fixX=0},getTop:function(){return this.y},setTop:function(t){if(!this._fixH)this.height-=t-this.y;this.y=t,this._fixY=0},getRight:function(){return this.x+this.width},setRight:function(e){if(this._fixX!==t&&1!==this._fixX)this._fixW=0;if(this._fixW)this.x=e-this.width;else this.width=e-this.x;this._fixX=1},getBottom:function(){return this.y+this.height},setBottom:function(e){if(this._fixY!==t&&1!==this._fixY)this._fixH=0;if(this._fixH)this.y=e-this.height;else this.height=e-this.y;this._fixY=1},getCenterX:function(){return this.x+.5*this.width},setCenterX:function(t){this.x=t-.5*this.width,this._fixX=.5},getCenterY:function(){return this.y+.5*this.height},setCenterY:function(t){this.y=t-.5*this.height,this._fixY=.5},getCenter:function(t){return new(t?h:u)(this.getCenterX(),this.getCenterY(),this,"setCenter")},setCenter:function(){var t=h.read(arguments);return this.setCenterX(t.x),this.setCenterY(t.y),this},getArea:function(){return this.width*this.height},isEmpty:function(){return 0===this.width||0===this.height},contains:function(e){return e&&e.width!==t||4==(Array.isArray(e)?e:arguments).length?this._containsRectangle(f.read(arguments)):this._containsPoint(h.read(arguments))},_containsPoint:function(t){var e=t.x,i=t.y;return e>=this.x&&i>=this.y&&e<=this.x+this.width&&i<=this.y+this.height},_containsRectangle:function(t){var e=t.x,i=t.y;return e>=this.x&&i>=this.y&&e+t.width<=this.x+this.width&&i+t.height<=this.y+this.height},intersects:function(){var t=f.read(arguments);return t.x+t.width>this.x&&t.y+t.height>this.y&&t.x<this.x+this.width&&t.y<this.y+this.height},touches:function(){var t=f.read(arguments);return t.x+t.width>=this.x&&t.y+t.height>=this.y&&t.x<=this.x+this.width&&t.y<=this.y+this.height},intersect:function(){var t=f.read(arguments),e=Math.max(this.x,t.x),i=Math.max(this.y,t.y),n=Math.min(this.x+this.width,t.x+t.width),r=Math.min(this.y+this.height,t.y+t.height);return new f(e,i,n-e,r-i)},unite:function(){var t=f.read(arguments),e=Math.min(this.x,t.x),i=Math.min(this.y,t.y),n=Math.max(this.x+this.width,t.x+t.width),r=Math.max(this.y+this.height,t.y+t.height);return new f(e,i,n-e,r-i)},include:function(){var t=h.read(arguments),e=Math.min(this.x,t.x),i=Math.min(this.y,t.y),n=Math.max(this.x+this.width,t.x),r=Math.max(this.y+this.height,t.y);return new f(e,i,n-e,r-i)},expand:function(){var t=l.read(arguments),e=t.width,i=t.height;return new f(this.x-e/2,this.y-i/2,this.width+e,this.height+i)},scale:function(e,i){return this.expand(this.width*e-this.width,this.height*(i===t?e:i)-this.height)}},e.each([["Top","Left"],["Top","Right"],["Bottom","Left"],["Bottom","Right"],["Left","Center"],["Top","Center"],["Right","Center"],["Bottom","Center"]],function(t,e){var i=t.join(""),n=/^[RL]/.test(i);if(e>=4)t[1]+=n?"Y":"X";var r=t[n?0:1],s=t[n?1:0],a="get"+r,o="get"+s,l="set"+r,c="set"+s,f="get"+i,d="set"+i;this[f]=function(t){return new(t?h:u)(this[a](),this[o](),this,d)},this[d]=function(){var t=h.read(arguments);this[l](t.x),this[c](t.y)}},{beans:!0})),d=f.extend({initialize:function(t,e,i,n,r,s){this.set(t,e,i,n,!0),this._owner=r,this._setter=s},set:function(t,e,i,n,r){if(this._x=t,this._y=e,this._width=i,this._height=n,!r)this._owner[this._setter](this);return this}},new function(){var t=f.prototype;return e.each(["x","y","width","height"],function(t){var i=e.capitalize(t),n="_"+t;this["get"+i]=function(){return this[n]},this["set"+i]=function(t){if(this[n]=t,!this._dontNotify)this._owner[this._setter](this)}},e.each(["Point","Size","Center","Left","Top","Right","Bottom","CenterX","CenterY","TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],function(e){var i="set"+e;this[i]=function(){this._dontNotify=!0,t[i].apply(this,arguments),this._dontNotify=!1,this._owner[this._setter](this)}},{isSelected:function(){return this._owner._boundsSelected},setSelected:function(t){var e=this._owner;if(e.setSelected)e._boundsSelected=t,e.setSelected(t||e._selectedSegmentState>0)}}))}),_=e.extend({_class:"Matrix",initialize:function t(e){var i=arguments.length,n=!0;if(6===i)this.set.apply(this,arguments);else if(1===i)if(e instanceof t)this.set(e._a,e._c,e._b,e._d,e._tx,e._ty);else if(Array.isArray(e))this.set.apply(this,e);else n=!1;else if(0===i)this.reset();else n=!1;if(!n)throw new Error("Unsupported matrix parameters")},set:function(t,e,i,n,r,s,a){if(this._a=t,this._c=e,this._b=i,this._d=n,this._tx=r,this._ty=s,!a)this._changed();return this},_serialize:function(t){return e.serialize(this.getValues(),t)},_changed:function(){var t=this._owner;if(t)if(t._applyMatrix)t.transform(null,!0);else t._changed(9)},clone:function(){return new _(this._a,this._c,this._b,this._d,this._tx,this._ty)},equals:function(t){return t===this||t&&this._a===t._a&&this._b===t._b&&this._c===t._c&&this._d===t._d&&this._tx===t._tx&&this._ty===t._ty||!1},toString:function(){var t=s.instance;return"[["+[t.number(this._a),t.number(this._b),t.number(this._tx)].join(", ")+"], ["+[t.number(this._c),t.number(this._d),t.number(this._ty)].join(", ")+"]]"},reset:function(t){if(this._a=this._d=1,this._c=this._b=this._tx=this._ty=0,!t)this._changed();return this},apply:function(t,i){var n=this._owner;if(n)return n.transform(null,!0,e.pick(t,!0),i),this.isIdentity();else return!1},translate:function(){var t=h.read(arguments),e=t.x,i=t.y;return this._tx+=e*this._a+i*this._b,this._ty+=e*this._c+i*this._d,this._changed(),this},scale:function(){var t=h.read(arguments),e=h.read(arguments,0,{readNull:!0});if(e)this.translate(e);if(this._a*=t.x,this._c*=t.x,this._b*=t.y,this._d*=t.y,e)this.translate(e.negate());return this._changed(),this},rotate:function(t){t*=Math.PI/180;var e=h.read(arguments,1),i=e.x,n=e.y,r=Math.cos(t),s=Math.sin(t),a=i-i*r+n*s,o=n-i*s-n*r,u=this._a,l=this._b,c=this._c,f=this._d;return this._a=r*u+s*l,this._b=-s*u+r*l,this._c=r*c+s*f,this._d=-s*c+r*f,this._tx+=a*u+o*l,this._ty+=a*c+o*f,this._changed(),this},shear:function(){var t=h.read(arguments),e=h.read(arguments,0,{readNull:!0});if(e)this.translate(e);var i=this._a,n=this._c;if(this._a+=t.y*this._b,this._c+=t.y*this._d,this._b+=t.x*i,this._d+=t.x*n,e)this.translate(e.negate());return this._changed(),this},skew:function(){var t=h.read(arguments),e=h.read(arguments,0,{readNull:!0}),i=Math.PI/180,n=new h(Math.tan(t.x*i),Math.tan(t.y*i));return this.shear(n,e)},concatenate:function(t){var e=this._a,i=this._b,n=this._c,r=this._d,s=t._a,a=t._b,o=t._c,h=t._d,u=t._tx,l=t._ty;return this._a=s*e+o*i,this._b=a*e+h*i,this._c=s*n+o*r,this._d=a*n+h*r,this._tx+=u*e+l*i,this._ty+=u*n+l*r,this._changed(),this},preConcatenate:function(t){var e=this._a,i=this._b,n=this._c,r=this._d,s=this._tx,a=this._ty,o=t._a,h=t._b,u=t._c,l=t._d,c=t._tx,f=t._ty;return this._a=o*e+h*n,this._b=o*i+h*r,this._c=u*e+l*n,this._d=u*i+l*r,this._tx=o*s+h*a+c,this._ty=u*s+l*a+f,this._changed(),this},chain:function(t){var e=this._a,i=this._b,n=this._c,r=this._d,s=this._tx,a=this._ty,o=t._a,h=t._b,u=t._c,l=t._d,c=t._tx,f=t._ty;return new _(o*e+u*i,o*n+u*r,h*e+l*i,h*n+l*r,s+c*e+f*i,a+c*n+f*r)},isIdentity:function(){return 1===this._a&&0===this._c&&0===this._b&&1===this._d&&0===this._tx&&0===this._ty},orNullIfIdentity:function(){return this.isIdentity()?null:this},isInvertible:function(){return!!this._getDeterminant()},isSingular:function(){return!this._getDeterminant()},transform:function(t,e,i){return arguments.length<3?this._transformPoint(h.read(arguments)):this._transformCoordinates(t,e,i)},_transformPoint:function(t,e,i){var n=t.x,r=t.y;if(!e)e=new h;return e.set(n*this._a+r*this._b+this._tx,n*this._c+r*this._d+this._ty,i)},_transformCoordinates:function(t,e,i){for(var n=0,r=0,s=2*i;n<s;){var a=t[n++],o=t[n++];e[r++]=a*this._a+o*this._b+this._tx,e[r++]=a*this._c+o*this._d+this._ty}return e},_transformCorners:function(t){var e=t.x,i=t.y,n=e+t.width,r=i+t.height,s=[e,i,n,i,n,r,e,r];return this._transformCoordinates(s,s,4)},_transformBounds:function(t,e,i){for(var n=this._transformCorners(t),r=n.slice(0,2),s=r.slice(),a=2;a<8;a++){var o=n[a],h=1&a;if(o<r[h])r[h]=o;else if(o>s[h])s[h]=o}if(!e)e=new f;return e.set(r[0],r[1],s[0]-r[0],s[1]-r[1],i)},inverseTransform:function(){return this._inverseTransform(h.read(arguments))},_getDeterminant:function(){var t=this._a*this._d-this._b*this._c;return isFinite(t)&&!a.isZero(t)&&isFinite(this._tx)&&isFinite(this._ty)?t:null},_inverseTransform:function(t,e,i){var n=this._getDeterminant();if(!n)return null;var r=t.x-this._tx,s=t.y-this._ty;if(!e)e=new h;return e.set((r*this._d-s*this._b)/n,(s*this._a-r*this._c)/n,i)},decompose:function(){var t=this._a,e=this._b,i=this._c,n=this._d;if(a.isZero(t*n-e*i))return null;var r=Math.sqrt(t*t+e*e);t/=r,e/=r;var s=t*i+e*n;i-=t*s,n-=e*s;var o=Math.sqrt(i*i+n*n);if(i/=o,n/=o,s/=o,t*n<e*i)t=-t,e=-e,s=-s,r=-r;return{scaling:new h(r,o),rotation:180*-Math.atan2(e,t)/Math.PI,shearing:s}},getValues:function(){return[this._a,this._c,this._b,this._d,this._tx,this._ty]},getTranslation:function(){return new h(this._tx,this._ty)},getScaling:function(){return(this.decompose()||{}).scaling},getRotation:function(){return(this.decompose()||{}).rotation},inverted:function(){var t=this._getDeterminant();return t&&new _(this._d/t,-this._c/t,-this._b/t,this._a/t,(this._b*this._ty-this._d*this._tx)/t,(this._c*this._tx-this._a*this._ty)/t)},shiftless:function(){return new _(this._a,this._c,this._b,this._d,0,0)},applyToContext:function(t){t.transform(this._a,this._c,this._b,this._d,this._tx,this._ty)}},e.each(["a","c","b","d","tx","ty"],function(t){var i=e.capitalize(t),n="_"+t;this["get"+i]=function(){return this[n]},this["set"+i]=function(t){this[n]=t,this._changed()}},{})),g=e.extend({_class:"Line",initialize:function(t,e,i,n,r){var s=!1;if(arguments.length>=4)this._px=t,this._py=e,this._vx=i,this._vy=n,s=r;else this._px=t.x,this._py=t.y,this._vx=e.x,this._vy=e.y,s=i;if(!s)this._vx-=this._px,this._vy-=this._py},getPoint:function(){return new h(this._px,this._py)},getVector:function(){return new h(this._vx,this._vy)},getLength:function(){return this.getVector().getLength()},intersect:function(t,e){return g.intersect(this._px,this._py,this._vx,this._vy,t._px,t._py,t._vx,t._vy,!0,e)},getSide:function(t,e){return g.getSide(this._px,this._py,this._vx,this._vy,t.x,t.y,!0,e)},getDistance:function(t){return Math.abs(g.getSignedDistance(this._px,this._py,this._vx,this._vy,t.x,t.y,!0))},isCollinear:function(t){return h.isCollinear(this._vx,this._vy,t._vx,t._vy)},isOrthogonal:function(t){return h.isOrthogonal(this._vx,this._vy,t._vx,t._vy)},statics:{intersect:function(t,e,i,n,r,s,o,u,l,c){if(!l)i-=t,n-=e,o-=r,u-=s;var f=i*u-n*o;if(!a.isZero(f)){var d=t-r,_=e-s,g=(o*_-u*d)/f,v=(i*_-n*d)/f,p=1e-12,m=-p,y=1+p;if(c||m<g&&g<y&&m<v&&v<y){if(!c)g=g<=0?0:g>=1?1:g;return new h(t+g*i,e+g*n)}}},getSide:function(t,e,i,n,r,s,a,o){if(!a)i-=t,n-=e;var h=r-t,u=s-e,l=h*n-u*i;if(0===l&&!o)if((l=(h*i+h*i)/(i*i+n*n))>=0&&l<=1)l=0;return l<0?-1:l>0?1:0},getSignedDistance:function(t,e,i,n,r,s,a){if(!a)i-=t,n-=e;return 0===i?n>0?r-t:t-r:0===n?i<0?s-e:e-s:((r-t)*n-(s-e)*i)/Math.sqrt(i*i+n*n)}}}),v=r.extend({_class:"Project",_list:"projects",_reference:"project",initialize:function(t){r.call(this,!0),this.layers=[],this._activeLayer=null,this.symbols=[],this._currentStyle=new D(null,null,this),this._view=V.create(this,t||Y.getCanvas(1,1)),this._selectedItems={},this._selectedItemCount=0,this._updateVersion=0},_serialize:function(t,i){return e.serialize(this.layers,t,!0,i)},clear:function(){for(var t=this.layers.length-1;t>=0;t--)this.layers[t].remove();this.symbols=[]},isEmpty:function(){return 0===this.layers.length},remove:function t(){if(!t.base.call(this))return!1;if(this._view)this._view.remove();return!0},getView:function(){return this._view},getCurrentStyle:function(){return this._currentStyle},setCurrentStyle:function(t){this._currentStyle.initialize(t)},getIndex:function(){return this._index},getOptions:function(){return this._scope.settings},getActiveLayer:function(){return this._activeLayer||new w({project:this})},getSelectedItems:function(){var t=[];for(var e in this._selectedItems){var i=this._selectedItems[e];if(i.isInserted())t.push(i)}return t},insertChild:function(t,i,n){if(i instanceof w){if(i._remove(!1,!0),e.splice(this.layers,[i],t,0),i._setProject(this,!0),this._changes)i._changed(5);if(!this._activeLayer)this._activeLayer=i}else if(i instanceof m)(this._activeLayer||this.insertChild(t,new w(m.NO_INSERT))).insertChild(t,i,n);else i=null;return i},addChild:function(e,i){return this.insertChild(t,e,i)},_updateSelection:function(t){var e=t._id,i=this._selectedItems;if(t._selected){if(i[e]!==t)this._selectedItemCount++,i[e]=t}else if(i[e]===t)this._selectedItemCount--,delete i[e]},selectAll:function(){for(var t=this.layers,e=0,i=t.length;e<i;e++)t[e].setFullySelected(!0)},deselectAll:function(){var t=this._selectedItems;for(var e in t)t[e].setFullySelected(!1)},hitTest:function(){for(var t=h.read(arguments),i=S.getOptions(e.read(arguments)),n=this.layers.length-1;n>=0;n--){var r=this.layers[n]._hitTest(t,i);if(r)return r}return null},getItems:function(t){return m._getItems(this.layers,t)},getItem:function(t){return m._getItems(this.layers,t,null,null,!0)[0]||null},importJSON:function(t){this.activate();var i=this._activeLayer;return e.importJSON(t,i&&i.isEmpty()&&i)},draw:function(t,i,n){this._updateVersion++,t.save(),i.applyToContext(t);for(var r=new e({offset:new h(0,0),pixelRatio:n,viewMatrix:i.isIdentity()?null:i,matrices:[new _],updateMatrix:!0}),s=0,a=this.layers,o=a.length;s<o;s++)a[s].draw(t,r);if(t.restore(),this._selectedItemCount>0){t.save(),t.strokeWidth=1;var u=this._selectedItems,l=this._scope.settings.handleSize,c=this._updateVersion;for(var f in u)u[f]._drawSelection(t,i,l,u,c);t.restore()}}}),p=e.extend({_class:"Symbol",initialize:function(t,e){if(this._id=o.get(),this.project=paper.project,this.project.symbols.push(this),t)this.setDefinition(t,e)},_serialize:function(t,i){return i.add(this,function(){return e.serialize([this._class,this._definition],t,!1,i)})},_changed:function(t){if(8&t)m._clearBoundsCache(this);if(1&t)this.project._needsUpdate=!0},getDefinition:function(){return this._definition},setDefinition:function(t,e){if(t._parentSymbol)t=t.clone();if(this._definition)this._definition._parentSymbol=null;if(this._definition=t,t.remove(),t.setSelected(!1),!e)t.setPosition(new h);t._parentSymbol=this,this._changed(9)},place:function(t){return new C(this,t)},clone:function(){return new p(this._definition.clone(!1))},equals:function(t){return t===this||t&&this.definition.equals(t.definition)||!1}}),m=e.extend(i,{statics:{extend:function t(i){if(i._serializeFields)i._serializeFields=new e(this.prototype._serializeFields,i._serializeFields);return t.base.apply(this,arguments)},NO_INSERT:{insert:!1}},_class:"Item",_applyMatrix:!0,_canApplyMatrix:!0,_boundsSelected:!1,_selectChildren:!1,_serializeFields:{name:null,applyMatrix:null,matrix:new _,pivot:null,locked:!1,visible:!0,blendMode:"normal",opacity:1,guide:!1,selected:!1,clipMask:!1,data:{}},initialize:function(){},_initialize:function(t,i){var n=t&&e.isPlainObject(t),r=n&&!0===t.internal,s=this._matrix=new _,a=n&&t.project||paper.project;if(!r)this._id=o.get();if(this._applyMatrix=this._canApplyMatrix&&paper.settings.applyMatrix,i)s.translate(i);if(s._owner=this,this._style=new D(a._currentStyle,this,a),!this._project)if(r||n&&!1===t.insert)this._setProject(a);else if(n&&t.parent)this.setParent(t.parent);else(a._activeLayer||new w).addChild(this);if(n&&t!==m.NO_INSERT)this._set(t,{insert:!0,project:!0,parent:!0},!0);return n},_events:e.each(["onMouseDown","onMouseUp","onMouseDrag","onClick","onDoubleClick","onMouseMove","onMouseEnter","onMouseLeave"],function(t){this[t]={install:function(t){this.getView()._installEvent(t)},uninstall:function(t){this.getView()._uninstallEvent(t)}}},{onFrame:{install:function(){this.getView()._animateItem(this,!0)},uninstall:function(){this.getView()._animateItem(this,!1)}},onLoad:{}}),_serialize:function(t,i){function n(n){for(var a in n){var o=s[a];if(!e.equals(o,"leading"===a?1.2*n.fontSize:n[a]))r[a]=e.serialize(o,t,"data"!==a,i)}}var r={},s=this;if(n(this._serializeFields),!(this instanceof y))n(this._style._defaults);return[this._class,r]},_changed:function(e){var i=this._parentSymbol,n=this._parent||i,r=this._project;if(8&e)this._bounds=this._position=this._decomposed=this._globalMatrix=this._currentPath=t;if(n&&40&e)m._clearBoundsCache(n);if(2&e)m._clearBoundsCache(this);if(r){if(1&e)r._needsUpdate=!0;if(r._changes){var s=r._changesById[this._id];if(s)s.flags|=e;else s={item:this,flags:e},r._changesById[this._id]=s,r._changes.push(s)}}if(i)i._changed(e)},set:function(t){if(t)this._set(t);return this},getId:function(){return this._id},getName:function(){return this._name},setName:function(e,i){if(this._name)this._removeNamed();if(e===+e+"")throw new Error("Names consisting only of numbers are not supported.");var n=this._parent;if(e&&n){for(var r=n._children,s=n._namedChildren,a=e,o=1;i&&r[e];)e=a+" "+o++;(s[e]=s[e]||[]).push(this),r[e]=this}this._name=e||t,this._changed(128)},getStyle:function(){return this._style},setStyle:function(t){this.getStyle().set(t)}},e.each(["locked","visible","blendMode","opacity","guide"],function(t){var i=e.capitalize(t),t="_"+t;this["get"+i]=function(){return this[t]},this["set"+i]=function(e){if(e!=this[t])this[t]=e,this._changed("_locked"===t?128:129)}},{}),{beans:!0,_locked:!1,_visible:!0,_blendMode:"normal",_opacity:1,_guide:!1,isSelected:function(){if(this._selectChildren)for(var t=this._children,e=0,i=t.length;e<i;e++)if(t[e].isSelected())return!0;return this._selected},setSelected:function(t,e){if(!e&&this._selectChildren)for(var i=this._children,n=0,r=i.length;n<r;n++)i[n].setSelected(t);if((t=!!t)^this._selected)this._selected=t,this._project._updateSelection(this),this._changed(129)},_selected:!1,isFullySelected:function(){var t=this._children;if(t&&this._selected){for(var e=0,i=t.length;e<i;e++)if(!t[e].isFullySelected())return!1;return!0}return this._selected},setFullySelected:function(t){var e=this._children;if(e)for(var i=0,n=e.length;i<n;i++)e[i].setFullySelected(t);this.setSelected(t,!0)},isClipMask:function(){return this._clipMask},setClipMask:function(t){if(this._clipMask!=(t=!!t)){if(this._clipMask=t,t)this.setFillColor(null),this.setStrokeColor(null);if(this._changed(129),this._parent)this._parent._changed(1024)}},_clipMask:!1,getData:function(){if(!this._data)this._data={};return this._data},setData:function(t){this._data=t},getPosition:function(t){var e=this._position,i=t?h:u;if(!e){var n=this._pivot;e=this._position=n?this._matrix._transformPoint(n):this.getBounds().getCenter(!0)}return new i(e.x,e.y,this,"setPosition")},setPosition:function(){this.translate(h.read(arguments).subtract(this.getPosition(!0)))},getPivot:function(t){var e=this._pivot;if(e){e=new(t?h:u)(e.x,e.y,this,"setPivot")}return e},setPivot:function(){this._pivot=h.read(arguments,0,{clone:!0,readNull:!0}),this._position=t},_pivot:null},e.each(["bounds","strokeBounds","handleBounds","roughBounds","internalBounds","internalRoughBounds"],function(t){var i="get"+e.capitalize(t),n=t.match(/^internal(.*)$/),r=n?"get"+n[1]:null;this[i]=function(e){var n=this._boundsGetter,s=!r&&("string"==typeof n?n:n&&n[i])||i,a=this._getCachedBounds(s,e,this,r);return"bounds"===t?new d(a.x,a.y,a.width,a.height,this,"setBounds"):a}},{beans:!0,_getBounds:function(t,e,i){var n=this._children;if(!n||0==n.length)return new f;m._updateBoundsCache(this,i);for(var r=1/0,s=-r,a=r,o=s,h=0,u=n.length;h<u;h++){var l=n[h];if(l._visible&&!l.isEmpty()){var c=l._getCachedBounds(t,e&&e.chain(l._matrix),i);r=Math.min(c.x,r),a=Math.min(c.y,a),s=Math.max(c.x+c.width,s),o=Math.max(c.y+c.height,o)}}return isFinite(r)?new f(r,a,s-r,o-a):new f},setBounds:function(){var t=f.read(arguments),e=this.getBounds(),i=new _,n=t.getCenter();if(i.translate(n),t.width!=e.width||t.height!=e.height)i.scale(0!=e.width?t.width/e.width:1,0!=e.height?t.height/e.height:1);n=e.getCenter(),i.translate(-n.x,-n.y),this.transform(i)},_getCachedBounds:function(t,e,i,n){e=e&&e.orNullIfIdentity();var r=n?null:this._matrix.orNullIfIdentity(),s=(!e||e.equals(r))&&t;if(m._updateBoundsCache(this._parent||this._parentSymbol,i),s&&this._bounds&&this._bounds[s])return this._bounds[s].clone();var a=this._getBounds(n||t,e||r,i);if(s){if(!this._bounds)this._bounds={};(this._bounds[s]=a.clone())._internal=!!n}return a},statics:{_updateBoundsCache:function(t,e){if(t){var i=e._id,n=t._boundsCache=t._boundsCache||{ids:{},list:[]};if(!n.ids[i])n.list.push(e),n.ids[i]=e}},_clearBoundsCache:function(e){var i=e._boundsCache;if(i){e._bounds=e._position=e._boundsCache=t;for(var n=0,r=i.list,s=r.length;n<s;n++){var a=r[n];if(a!==e)if(a._bounds=a._position=t,a._boundsCache)m._clearBoundsCache(a)}}}}}),{beans:!0,_decompose:function(){return this._decomposed=this._matrix.decompose()},getRotation:function(){var t=this._decomposed||this._decompose();return t&&t.rotation},setRotation:function(t){var e=this.getRotation();if(null!=e&&null!=t){var i=this._decomposed;this.rotate(t-e),i.rotation=t,this._decomposed=i}},getScaling:function(t){var e=this._decomposed||this._decompose(),i=e&&e.scaling,n=t?h:u;return i&&new n(i.x,i.y,this,"setScaling")},setScaling:function(){var t=this.getScaling();if(t){var e=h.read(arguments,0,{clone:!0}),i=this._decomposed;this.scale(e.x/t.x,e.y/t.y),i.scaling=e,this._decomposed=i}},getMatrix:function(){return this._matrix},setMatrix:function(){var t=this._matrix;if(t.initialize.apply(t,arguments),this._applyMatrix)this.transform(null,!0);else this._changed(9)},getGlobalMatrix:function(t){var e=this._globalMatrix,i=this._project._updateVersion;if(e&&e._updateVersion!==i)e=null;if(!e){e=this._globalMatrix=this._matrix.clone();var n=this._parent;if(n)e.preConcatenate(n.getGlobalMatrix(!0));e._updateVersion=i}return t?e:e.clone()},getApplyMatrix:function(){return this._applyMatrix},setApplyMatrix:function(t){if(this._applyMatrix=this._canApplyMatrix&&!!t)this.transform(null,!0)},getTransformContent:"#getApplyMatrix",setTransformContent:"#setApplyMatrix"},{getProject:function(){return this._project},_setProject:function(t,e){if(this._project!==t){if(this._project)this._installEvents(!1);this._project=t;for(var i=this._children,n=0,r=i&&i.length;n<r;n++)i[n]._setProject(t);e=!0}if(e)this._installEvents(!0)},getView:function(){return this._project.getView()},_installEvents:function t(e){t.base.call(this,e);for(var i=this._children,n=0,r=i&&i.length;n<r;n++)i[n]._installEvents(e)},getLayer:function(){for(var t=this;t=t._parent;)if(t instanceof w)return t;return null},getParent:function(){return this._parent},setParent:function(t){return t.addChild(this)},getChildren:function(){return this._children},setChildren:function(t){this.removeChildren(),this.addChildren(t)},getFirstChild:function(){return this._children&&this._children[0]||null},getLastChild:function(){return this._children&&this._children[this._children.length-1]||null},getNextSibling:function(){return this._parent&&this._parent._children[this._index+1]||null},getPreviousSibling:function(){return this._parent&&this._parent._children[this._index-1]||null},getIndex:function(){return this._index},equals:function(t){return t===this||t&&this._class===t._class&&this._style.equals(t._style)&&this._matrix.equals(t._matrix)&&this._locked===t._locked&&this._visible===t._visible&&this._blendMode===t._blendMode&&this._opacity===t._opacity&&this._clipMask===t._clipMask&&this._guide===t._guide&&this._equals(t)||!1},_equals:function(t){return e.equals(this._children,t._children)},clone:function(t){return this._clone(new this.constructor(m.NO_INSERT),t)},_clone:function(i,n,r){var s=["_locked","_visible","_blendMode","_opacity","_clipMask","_guide"],a=this._children;i.setStyle(this._style);for(var o=0,h=a&&a.length;o<h;o++)i.addChild(a[o].clone(!1),!0);for(var o=0,h=s.length;o<h;o++){var u=s[o];if(this.hasOwnProperty(u))i[u]=this[u]}if(!1!==r)i._matrix.initialize(this._matrix);if(i.setApplyMatrix(this._applyMatrix),i.setPivot(this._pivot),i.setSelected(this._selected),i._data=this._data?e.clone(this._data):null,n||n===t)i.insertAbove(this);if(this._name)i.setName(this._name,!0);return i},copyTo:function(t){return t.addChild(this.clone(!1))},rasterize:function(t){var i=this.getStrokeBounds(),n=(t||this.getView().getResolution())/72,r=i.getTopLeft().floor(),s=i.getBottomRight().ceil(),a=new l(s.subtract(r)),o=Y.getCanvas(a.multiply(n)),h=o.getContext("2d"),u=(new _).scale(n).translate(r.negate());h.save(),u.applyToContext(h),this.draw(h,new e({matrices:[u]})),h.restore();var c=new b(m.NO_INSERT);return c.setCanvas(o),c.transform((new _).translate(r.add(a.divide(2))).scale(1/n)),c.insertAbove(this),c},contains:function(){return!!this._contains(this._matrix._inverseTransform(h.read(arguments)))},_contains:function(t){if(this._children){for(var e=this._children.length-1;e>=0;e--)if(this._children[e].contains(t))return!0;return!1}return t.isInside(this.getInternalBounds())},isInside:function(){return f.read(arguments).contains(this.getBounds())},_asPathItem:function(){return new A.Rectangle({rectangle:this.getInternalBounds(),matrix:this._matrix,insert:!1})},intersects:function(t,e){if(!(t instanceof m))return!1;else return this._asPathItem().getIntersections(t._asPathItem(),null,e||t._matrix,!0).length>0},hitTest:function(){return this._hitTest(h.read(arguments),S.getOptions(e.read(arguments)))},_hitTest:function(t,i){function n(i,n){var r=d["get"+n]();if(t.subtract(r).divide(h).length<=1)return new S(i,f,{name:e.hyphenate(n),point:r})}if(this._locked||!this._visible||this._guide&&!i.guides||this.isEmpty())return null;var r=this._matrix,s=i._totalMatrix,a=this.getView(),o=i._totalMatrix=s?s.chain(r):this.getGlobalMatrix().preConcatenate(a._matrix),h=i._tolerancePadding=new l(A._getPenPadding(1,o.inverted())).multiply(Math.max(i.tolerance,1e-6));if(t=r._inverseTransform(t),!this._children&&!this.getInternalRoughBounds().expand(h.multiply(2))._containsPoint(t))return null;var u,c=!(i.guides&&!this._guide||i.selected&&!this._selected||i.type&&i.type!==e.hyphenate(this._class)||i.class&&!(this instanceof i.class)),f=this;if(c&&(i.center||i.bounds)&&this._parent){var d=this.getInternalBounds();if(i.center)u=n("center","Center");if(!u&&i.bounds)for(var _=["TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],g=0;g<8&&!u;g++)u=n("bounds",_[g])}var v=!u&&this._children;if(v)for(var p=this._getChildHitTestOptions(i),g=v.length-1;g>=0&&!u;g--)u=v[g]._hitTest(t,p);if(!u&&c)u=this._hitTestSelf(t,i);if(u&&u.point)u.point=r.transform(u.point);return i._totalMatrix=s,u},_getChildHitTestOptions:function(t){return t},_hitTestSelf:function(t,e){if(e.fill&&this.hasFill()&&this._contains(t))return new S("fill",this)},matches:function(t,i){function n(t,i){for(var r in t)if(t.hasOwnProperty(r)){var s=t[r],a=i[r];if(e.isPlainObject(s)&&e.isPlainObject(a)){if(!n(s,a))return!1}else if(!e.equals(s,a))return!1}return!0}var r=typeof t;if("object"===r){for(var s in t)if(t.hasOwnProperty(s)&&!this.matches(s,t[s]))return!1}else if("function"===r)return t(this);else{var a=/^(empty|editable)$/.test(t)?this["is"+e.capitalize(t)]():"type"===t?e.hyphenate(this._class):this[t];if(/^(constructor|class)$/.test(t)){if(!(this instanceof i))return!1}else if(i instanceof RegExp){if(!i.test(a))return!1}else if("function"==typeof i){if(!i(a))return!1}else if(e.isPlainObject(i)){if(!n(i,a))return!1}else if(!e.equals(a,i))return!1}return!0},getItems:function(t){return m._getItems(this._children,t,this._matrix)},getItem:function(t){return m._getItems(this._children,t,this._matrix,null,!0)[0]||null},statics:{_getItems:function t(i,n,r,s,a){if(!s&&"object"==typeof n){var o=n.overlapping,h=n.inside,u=o||h,l=u&&f.read([u]);if(s={items:[],inside:!!h,overlapping:!!o,rect:l,path:o&&new A.Rectangle({rectangle:l,insert:!1})},u)n=e.set({},n,{inside:!0,overlapping:!0})}var c=s&&s.items,l=s&&s.rect;r=l&&(r||new _);for(var d=0,g=i&&i.length;d<g;d++){var v=i[d],p=r&&r.chain(v._matrix),m=!0;if(l){var u=v.getBounds(p);if(!l.intersects(u))continue;if(!(s.inside&&l.contains(u)||s.overlapping&&(u.contains(l)||s.path.intersects(v,p))))m=!1}if(m&&v.matches(n))if(c.push(v),a)break;if(t(v._children,n,p,s,a),a&&c.length>0)break}return c}}},{importJSON:function(t){var i=e.importJSON(t,this);return i!==this?this.addChild(i):i},addChild:function(e,i){return this.insertChild(t,e,i)},insertChild:function(t,e,i){var n=e?this.insertChildren(t,[e],i):null;return n&&n[0]},addChildren:function(t,e){return this.insertChildren(this._children.length,t,e)},insertChildren:function(t,i,n,r){var s=this._children;if(s&&i&&i.length>0){i=Array.prototype.slice.apply(i);for(var a=i.length-1;a>=0;a--){var o=i[a];if(r&&!(o instanceof r))i.splice(a,1);else{var h=o._parent===this&&o._index<t;if(o._remove(!1,!0)&&h)t--}}e.splice(s,i,t,0);for(var u=this._project,l=u&&u._changes,a=0,c=i.length;a<c;a++){var o=i[a];if(o._parent=this,o._setProject(this._project,!0),o._name)o.setName(o._name);if(l)this._changed(5)}this._changed(11)}else i=null;return i},_insertSibling:function(t,e,i){return this._parent?this._parent.insertChild(t,e,i):null},insertAbove:function(t,e){return t._insertSibling(t._index+1,this,e)},insertBelow:function(t,e){return t._insertSibling(t._index,this,e)},sendToBack:function(){return(this._parent||this instanceof w&&this._project).insertChild(0,this)},bringToFront:function(){return(this._parent||this instanceof w&&this._project).addChild(this)},appendTop:"#addChild",appendBottom:function(t){return this.insertChild(0,t)},moveAbove:"#insertAbove",moveBelow:"#insertBelow",reduce:function(){if(this._children&&1===this._children.length){var t=this._children[0].reduce();return t.insertAbove(this),t.setStyle(this._style),this.remove(),t}return this},_removeNamed:function(){var t=this._parent;if(t){var e=t._children,i=t._namedChildren,n=this._name,r=i[n],s=r?r.indexOf(this):-1;if(-1!==s){if(e[n]==this)delete e[n];if(r.splice(s,1),r.length)e[n]=r[r.length-1];else delete i[n]}}},_remove:function(t,i){var n=this._parent;if(n){if(this._name)this._removeNamed();if(null!=this._index)e.splice(n._children,null,this._index,1);if(this._installEvents(!1),t){var r=this._project;if(r&&r._changes)this._changed(5)}if(i)n._changed(11);return this._parent=null,!0}return!1},remove:function(){return this._remove(!0,!0)},replaceWith:function(t){var e=t&&t.insertBelow(this);if(e)this.remove();return e},removeChildren:function(t,i){if(!this._children)return null;t=t||0,i=e.pick(i,this._children.length);for(var n=e.splice(this._children,null,t,i-t),r=n.length-1;r>=0;r--)n[r]._remove(!0,!1);if(n.length>0)this._changed(11);return n},clear:"#removeChildren",reverseChildren:function(){if(this._children){this._children.reverse();for(var t=0,e=this._children.length;t<e;t++)this._children[t]._index=t;this._changed(11)}},isEmpty:function(){return!this._children||0===this._children.length},isEditable:function(){for(var t=this;t;){if(!t._visible||t._locked)return!1;t=t._parent}return!0},hasFill:function(){return this.getStyle().hasFill()},hasStroke:function(){return this.getStyle().hasStroke()},hasShadow:function(){return this.getStyle().hasShadow()},_getOrder:function(t){function e(t){var e=[];do{e.unshift(t)}while(t=t._parent);return e}for(var i=e(this),n=e(t),r=0,s=Math.min(i.length,n.length);r<s;r++)if(i[r]!=n[r])return i[r]._index<n[r]._index?1:-1;return 0},hasChildren:function(){return this._children&&this._children.length>0},isInserted:function(){return this._parent?this._parent.isInserted():!1},isAbove:function(t){return-1===this._getOrder(t)},isBelow:function(t){return 1===this._getOrder(t)},isParent:function(t){return this._parent===t},isChild:function(t){return t&&t._parent===this},isDescendant:function(t){for(var e=this;e=e._parent;)if(e==t)return!0;return!1},isAncestor:function(t){return t?t.isDescendant(this):!1},isSibling:function(t){return this._parent===t._parent},isGroupedWith:function(t){for(var e=this._parent;e;){if(e._parent&&/^(Group|Layer|CompoundPath)$/.test(e._class)&&t.isDescendant(e))return!0;e=e._parent}return!1},translate:function(){var t=new _;return this.transform(t.translate.apply(t,arguments))},rotate:function(t){return this.transform((new _).rotate(t,h.read(arguments,1,{readNull:!0})||this.getPosition(!0)))}},e.each(["scale","shear","skew"],function(t){this[t]=function(){var e=h.read(arguments),i=h.read(arguments,0,{readNull:!0});return this.transform((new _)[t](e,i||this.getPosition(!0)))}},{}),{transform:function(t,e,i,n){if(t&&t.isIdentity())t=null;var r=this._matrix,s=(e||this._applyMatrix)&&(!r.isIdentity()||t||e&&i&&this._children);if(!t&&!s)return this;if(t)r.preConcatenate(t);if(s=s&&this._transformContent(r,i,n)){var a=this._pivot,o=this._style,h=o.getFillColor(!0),u=o.getStrokeColor(!0);if(a)r._transformPoint(a,a,!0);if(h)h.transform(r);if(u)u.transform(r);if(r.reset(!0),n&&this._canApplyMatrix)this._applyMatrix=!0}var l=this._bounds,c=this._position;this._changed(9);var f=l&&t&&t.decompose();if(f&&!f.shearing&&f.rotation%90==0){for(var d in l){var _=l[d];if(s||!_._internal)t._transformBounds(_,_)}var g=this._boundsGetter,_=l[g&&g.getBounds||g||"getBounds"];if(_)this._position=_.getCenter(!0);this._bounds=l}else if(t&&c)this._position=t._transformPoint(c,c);return this},_transformContent:function(t,e,i){var n=this._children;if(n){for(var r=0,s=n.length;r<s;r++)n[r].transform(t,!0,e,i);return!0}},globalToLocal:function(){return this.getGlobalMatrix(!0)._inverseTransform(h.read(arguments))},localToGlobal:function(){return this.getGlobalMatrix(!0)._transformPoint(h.read(arguments))},parentToLocal:function(){return this._matrix._inverseTransform(h.read(arguments))},localToParent:function(){return this._matrix._transformPoint(h.read(arguments))},fitBounds:function(t,e){t=f.read(arguments);var i=this.getBounds(),n=i.height/i.width,r=t.height/t.width,s=(e?n>r:n<r)?t.width/i.width:t.height/i.height,a=new f(new h,new l(i.width*s,i.height*s));a.setCenter(t.getCenter()),this.setBounds(a)},_setStyles:function(t){var e=this._style,i=e.getFillColor(),n=e.getStrokeColor(),r=e.getShadowColor();if(i)t.fillStyle=i.toCanvasStyle(t);if(n){var s=e.getStrokeWidth();if(s>0){t.strokeStyle=n.toCanvasStyle(t),t.lineWidth=s;var a=e.getStrokeJoin(),o=e.getStrokeCap(),h=e.getMiterLimit();if(a)t.lineJoin=a;if(o)t.lineCap=o;if(h)t.miterLimit=h;if(paper.support.nativeDash){var u=e.getDashArray(),l=e.getDashOffset();if(u&&u.length)if("setLineDash"in t)t.setLineDash(u),t.lineDashOffset=l;else t.mozDash=u,t.mozDashOffset=l}}}if(r){var c=e.getShadowBlur();if(c>0){t.shadowColor=r.toCanvasStyle(t),t.shadowBlur=c;var f=this.getShadowOffset();t.shadowOffsetX=f.x,t.shadowOffsetY=f.y}}},draw:function(t,e,i){function n(t){return a?a.chain(t):t}var r=this._updateVersion=this._project._updateVersion;if(this._visible&&0!==this._opacity){var s=e.matrices,a=e.viewMatrix,o=this._matrix,h=s[s.length-1].chain(o);if(h.isInvertible()){if(s.push(h),e.updateMatrix)h._updateVersion=r,this._globalMatrix=h;var u,l,c,f=this._blendMode,d=this._opacity,_="normal"===f,g=K.nativeModes[f],v=_&&1===d||e.dontStart||e.clip||(g||_&&d<1)&&this._canComposite(),p=e.pixelRatio||1;if(!v){var m=this.getStrokeBounds(n(h));if(!m.width||!m.height)return;if(c=e.offset,l=e.offset=m.getTopLeft().floor(),u=t,t=Y.getContext(m.getSize().ceil().add(1).multiply(p)),1!==p)t.scale(p,p)}t.save();var y=i?i.chain(o):!this.getStrokeScaling(!0)&&n(h),w=!v&&e.clipItem,x=!y||w;if(v){if(t.globalAlpha=d,g)t.globalCompositeOperation=f}else if(x)t.translate(-l.x,-l.y);if(x)(v?o:n(h)).applyToContext(t);if(w)e.clipItem.draw(t,e.extend({clip:!0}));if(y){t.setTransform(p,0,0,p,0,0);var b=e.offset;if(b)t.translate(-b.x,-b.y)}if(this._draw(t,e,y),t.restore(),s.pop(),e.clip&&!e.dontFinish)t.clip();if(!v)K.process(f,t,u,d,l.subtract(c).multiply(p)),Y.release(t),e.offset=c}}},_isUpdated:function(t){var e=this._parent;if(e instanceof O)return e._isUpdated(t);var i=this._updateVersion===t;if(!i&&e&&e._visible&&e._isUpdated(t))this._updateVersion=t,i=!0;return i},_drawSelection:function(t,e,i,n,r){if((this._drawSelected||this._boundsSelected)&&this._isUpdated(r)){var s=this.getSelectedColor(!0)||this.getLayer().getSelectedColor(!0),a=e.chain(this.getGlobalMatrix(!0));if(t.strokeStyle=t.fillStyle=s?s.toCanvasStyle(t):"#009dec",this._drawSelected)this._drawSelected(t,a,n);if(this._boundsSelected){var o=i/2,h=a._transformCorners(this.getInternalBounds());t.beginPath();for(var u=0;u<8;u++)t[0===u?"moveTo":"lineTo"](h[u],h[++u]);t.closePath(),t.stroke();for(var u=0;u<8;u++)t.fillRect(h[u]-o,h[++u]-o,i,i)}}},_canComposite:function(){return!1}},e.each(["down","drag","up","move"],function(t){this["removeOn"+e.capitalize(t)]=function(){var e={};return e[t]=!0,this.removeOn(e)}},{removeOn:function(t){for(var e in t)if(t[e]){var i="mouse"+e,n=this._project,r=n._removeSets=n._removeSets||{};r[i]=r[i]||{},r[i][this._id]=this}return this}})),y=m.extend({_class:"Group",_selectChildren:!0,_serializeFields:{children:[]},initialize:function(t){if(this._children=[],this._namedChildren={},!this._initialize(t))this.addChildren(Array.isArray(t)?t:arguments)},_changed:function e(i){if(e.base.call(this,i),1026&i)this._clipItem=t},_getClipItem:function(){var e=this._clipItem;if(e===t){e=null;for(var i=0,n=this._children.length;i<n;i++){var r=this._children[i];if(r._clipMask){e=r;break}}this._clipItem=e}return e},isClipped:function(){return!!this._getClipItem()},setClipped:function(t){var e=this.getFirstChild();if(e)e.setClipMask(t)},_draw:function(t,e){var i=e.clip,n=!i&&this._getClipItem(),r=!0;if(e=e.extend({clipItem:n,clip:!1}),i)if(this._currentPath)t.currentPath=this._currentPath,r=!1;else t.beginPath(),e.dontStart=e.dontFinish=!0;else if(n)n.draw(t,e.extend({clip:!0}));if(r)for(var s=0,a=this._children.length;s<a;s++){var o=this._children[s];if(o!==n)o.draw(t,e)}if(i)this._currentPath=t.currentPath}}),w=y.extend({_class:"Layer",initialize:function(i){var n=e.isPlainObject(i)?new e(i):{children:Array.isArray(i)?i:arguments},r=n.insert;if(n.insert=!1,y.call(this,n),r||r===t)this._project.addChild(this),this.activate()},_remove:function t(i,n){if(this._parent)return t.base.call(this,i,n);if(null!=this._index){var r=this._project;if(r._activeLayer===this)r._activeLayer=this.getNextSibling()||this.getPreviousSibling();if(e.splice(r.layers,null,this._index,1),this._installEvents(!1),i&&r._changes)this._changed(5);if(n)r._needsUpdate=!0;return!0}return!1},getNextSibling:function t(){return this._parent?t.base.call(this):this._project.layers[this._index+1]||null},getPreviousSibling:function t(){return this._parent?t.base.call(this):this._project.layers[this._index-1]||null},isInserted:function t(){return this._parent?t.base.call(this):null!=this._index},activate:function(){this._project._activeLayer=this},_insertSibling:function t(e,i,n){return!this._parent?this._project.insertChild(e,i,n):t.base.call(this,e,i,n)}}),x=m.extend({_class:"Shape",_applyMatrix:!1,_canApplyMatrix:!1,_boundsSelected:!0,_serializeFields:{type:null,size:null,radius:null},initialize:function(t){this._initialize(t)},_equals:function(t){return this._type===t._type&&this._size.equals(t._size)&&e.equals(this._radius,t._radius)},clone:function(t){var e=new x(m.NO_INSERT);return e.setType(this._type),e.setSize(this._size),e.setRadius(this._radius),this._clone(e,t)},getType:function(){return this._type},setType:function(t){this._type=t},getShape:"#getType",setShape:"#setType",getSize:function(){var t=this._size;return new c(t.width,t.height,this,"setSize")},setSize:function(){var t=l.read(arguments);if(!this._size)this._size=t.clone();else if(!this._size.equals(t)){var e=this._type,i=t.width,n=t.height;if("rectangle"===e){var r=l.min(this._radius,t.divide(2));this._radius.set(r.width,r.height)}else if("circle"===e)i=n=(i+n)/2,this._radius=i/2;else if("ellipse"===e)this._radius.set(i/2,n/2);this._size.set(i,n),this._changed(9)}},getRadius:function(){var t=this._radius;return"circle"===this._type?t:new c(t.width,t.height,this,"setRadius")},setRadius:function(t){var e=this._type;if("circle"===e){if(t===this._radius)return;var i=2*t;this._radius=t,this._size.set(i,i)}else if(t=l.read(arguments),!this._radius)this._radius=t.clone();else{if(this._radius.equals(t))return;if(this._radius.set(t.width,t.height),"rectangle"===e){var i=l.max(this._size,t.multiply(2));this._size.set(i.width,i.height)}else if("ellipse"===e)this._size.set(2*t.width,2*t.height)}this._changed(9)},isEmpty:function(){return!1},toPath:function(t){var i=this._clone(new(A[e.capitalize(this._type)])({center:new h,size:this._size,radius:this._radius,insert:!1}),t);if(paper.settings.applyMatrix)i.setApplyMatrix(!0);return i},_draw:function(t,e,i){var n=this._style,r=n.hasFill(),s=n.hasStroke(),a=e.dontFinish||e.clip,o=!i;if(r||s||a){var h=this._type,u=this._radius,l="circle"===h;if(!e.dontStart)t.beginPath();if(o&&l)t.arc(0,0,u,0,2*Math.PI,!0);else{var c=l?u:u.width,f=l?u:u.height,d=this._size,_=d.width,g=d.height;if(o&&"rectangle"===h&&0===c&&0===f)t.rect(-_/2,-g/2,_,g);else{var v=_/2,p=g/2,m=.44771525016920644,y=c*m,w=f*m,x=[-v,-p+f,-v,-p+w,-v+y,-p,-v+c,-p,v-c,-p,v-y,-p,v,-p+w,v,-p+f,v,p-f,v,p-w,v-y,p,v-c,p,-v+c,p,-v+y,p,-v,p-w,-v,p-f];if(i)i.transform(x,x,32);if(t.moveTo(x[0],x[1]),t.bezierCurveTo(x[2],x[3],x[4],x[5],x[6],x[7]),v!==c)t.lineTo(x[8],x[9]);if(t.bezierCurveTo(x[10],x[11],x[12],x[13],x[14],x[15]),p!==f)t.lineTo(x[16],x[17]);if(t.bezierCurveTo(x[18],x[19],x[20],x[21],x[22],x[23]),v!==c)t.lineTo(x[24],x[25]);t.bezierCurveTo(x[26],x[27],x[28],x[29],x[30],x[31])}}t.closePath()}if(!a&&(r||s)){if(this._setStyles(t),r)t.fill(n.getWindingRule()),t.shadowColor="rgba(0,0,0,0)";if(s)t.stroke()}},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_getBounds:function(t,e){var i=new f(this._size).setCenter(0,0);if("getBounds"!==t&&this.hasStroke())i=i.expand(this.getStrokeWidth());return e?e._transformBounds(i):i}},new function(){function t(t,e,i){var n=t._radius;if(!n.isZero())for(var r=t._size.divide(2),s=0;s<4;s++){var a=new h(1&s?1:-1,s>1?1:-1),o=a.multiply(r),u=o.subtract(a.multiply(n)),l=new f(o,u);if((i?l.expand(i):l).contains(e))return u}}function e(t,e){var i=t.getAngleInRadians(),n=2*e.width,r=2*e.height,s=n*Math.sin(i),a=r*Math.cos(i);return n*r/(2*Math.sqrt(s*s+a*a))}return{_contains:function e(i){if("rectangle"===this._type){var n=t(this,i);return n?i.subtract(n).divide(this._radius).getLength()<=1:e.base.call(this,i)}else return i.divide(this.size).getLength()<=.5},_hitTestSelf:function i(n,r){var s=!1;if(this.hasStroke()){var a=this._type,o=this._radius,h=this.getStrokeWidth()+2*r.tolerance;if("rectangle"===a){var u=t(this,n,h);if(u){var l=n.subtract(u);s=2*Math.abs(l.getLength()-e(l,o))<=h}else{var c=new f(this._size).setCenter(0,0),d=c.expand(h),_=c.expand(-h);s=d._containsPoint(n)&&!_._containsPoint(n)}}else{if("ellipse"===a)o=e(n,o);s=2*Math.abs(n.getLength()-o)<=h}}return s?new S("stroke",this):i.base.apply(this,arguments)}}},{statics:new function(){function t(t,i,n,r,s){var a=new x(e.getNamed(s));return a._type=t,a._size=n,a._radius=r,a.translate(i)}return{Circle:function(){var i=h.readNamed(arguments,"center"),n=e.readNamed(arguments,"radius");return t("circle",i,new l(2*n),n,arguments)},Rectangle:function(){var e=f.readNamed(arguments,"rectangle"),i=l.min(l.readNamed(arguments,"radius"),e.getSize(!0).divide(2));return t("rectangle",e.getCenter(!0),e.getSize(!0),i,arguments)},Ellipse:function(){var e=x._readEllipse(arguments),i=e.radius;return t("ellipse",e.center,i.multiply(2),i,arguments)},_readEllipse:function(t){var i,n;if(e.hasNamed(t,"radius"))i=h.readNamed(t,"center"),n=l.readNamed(t,"radius");else{var r=f.readNamed(t,"rectangle");i=r.getCenter(!0),n=r.getSize(!0).divide(2)}return{center:i,radius:n}}}}}),b=m.extend({_class:"Raster",_applyMatrix:!1,_canApplyMatrix:!1,_boundsGetter:"getBounds",_boundsSelected:!0,_serializeFields:{crossOrigin:null,source:null},initialize:function(e,i){if(!this._initialize(e,i!==t&&h.read(arguments,1)))if("string"==typeof e)this.setSource(e);else this.setImage(e);if(!this._size)this._size=new l,this._loaded=!1},_equals:function(t){return this.getSource()===t.getSource()},clone:function(t){var e=new b(m.NO_INSERT),i=this._image,n=this._canvas;if(i)e.setImage(i);else if(n){var r=Y.getCanvas(this._size);r.getContext("2d").drawImage(n,0,0),e.setImage(r)}return e._crossOrigin=this._crossOrigin,this._clone(e,t)},getSize:function(){var t=this._size;return new c(t?t.width:0,t?t.height:0,this,"setSize")},setSize:function(){var t=l.read(arguments);if(!t.equals(this._size))if(t.width>0&&t.height>0){var e=this.getElement();if(this.setImage(Y.getCanvas(t)),e)this.getContext(!0).drawImage(e,0,0,t.width,t.height)}else{if(this._canvas)Y.release(this._canvas);this._size=t.clone()}},getWidth:function(){return this._size?this._size.width:0},setWidth:function(t){this.setSize(t,this.getHeight())},getHeight:function(){return this._size?this._size.height:0},setHeight:function(t){this.setSize(this.getWidth(),t)},isEmpty:function(){var t=this._size;return!t||0===t.width&&0===t.height},getResolution:function(){var t=this._matrix,e=new h(0,0).transform(t),i=new h(1,0).transform(t).subtract(e),n=new h(0,1).transform(t).subtract(e);return new l(72/i.getLength(),72/n.getLength())},getPpi:"#getResolution",getImage:function(){return this._image},setImage:function(t){if(this._canvas)Y.release(this._canvas);if(t&&t.getContext)this._image=null,this._canvas=t,this._loaded=!0;else this._image=t,this._canvas=null,this._loaded=t&&t.complete;this._size=new l(t?t.naturalWidth||t.width:0,t?t.naturalHeight||t.height:0),this._context=null,this._changed(521)},getCanvas:function(){if(!this._canvas){var t=Y.getContext(this._size);try{if(this._image)t.drawImage(this._image,0,0);this._canvas=t.canvas}catch(e){Y.release(t)}}return this._canvas},setCanvas:"#setImage",getContext:function(t){if(!this._context)this._context=this.getCanvas().getContext("2d");if(t)this._image=null,this._changed(513);return this._context},setContext:function(t){this._context=t},getSource:function(){return this._image&&this._image.src||this.toDataURL()},setSource:function(t){function e(){var t=n.getView();if(t)paper=t._scope,n.setImage(i),n.emit("load"),t.update()}var i,n=this,r=this._crossOrigin;if(i=document.getElementById(t)||new Image,r)i.crossOrigin=r;if(i.naturalWidth&&i.naturalHeight)setTimeout(e,0);else if(q.add(i,{load:e}),!i.src)i.src=t;this.setImage(i)},getCrossOrigin:function(){return this._image&&this._image.crossOrigin||this._crossOrigin||""},setCrossOrigin:function(t){if(this._crossOrigin=t,this._image)this._image.crossOrigin=t},getElement:function(){return this._canvas||this._loaded&&this._image}},{beans:!1,getSubCanvas:function(){var t=f.read(arguments),e=Y.getContext(t.getSize());return e.drawImage(this.getCanvas(),t.x,t.y,t.width,t.height,0,0,t.width,t.height),e.canvas},getSubRaster:function(){var t=f.read(arguments),e=new b(m.NO_INSERT);return e.setImage(this.getSubCanvas(t)),e.translate(t.getCenter().subtract(this.getSize().divide(2))),e._matrix.preConcatenate(this._matrix),e.insertAbove(this),e},toDataURL:function(){var t=this._image&&this._image.src;if(/^data:/.test(t))return t;var e=this.getCanvas();return e?e.toDataURL.apply(e,arguments):null},drawImage:function(t){var e=h.read(arguments,1);this.getContext(!0).drawImage(t,e.x,e.y)},getAverageColor:function(t){var i,n;if(!t)i=this.getBounds();else if(t instanceof z)n=t,i=t.getBounds();else if(t.width)i=new f(t);else if(t.x)i=new f(t.x-.5,t.y-.5,1,1);var r=32,s=Math.min(i.width,r),a=Math.min(i.height,r),o=b._sampleContext;if(!o)o=b._sampleContext=Y.getContext(new l(r));else o.clearRect(0,0,r+1,r+1);o.save();var h=(new _).scale(s/i.width,a/i.height).translate(-i.x,-i.y);if(h.applyToContext(o),n)n.draw(o,new e({clip:!0,matrices:[h]}));this._matrix.applyToContext(o);var u=this.getElement(),c=this._size;if(u)o.drawImage(u,-c.width/2,-c.height/2);o.restore();for(var d=o.getImageData(.5,.5,Math.ceil(s),Math.ceil(a)).data,g=[0,0,0],v=0,p=0,m=d.length;p<m;p+=4){var y=d[p+3];v+=y,y/=255,g[0]+=d[p]*y,g[1]+=d[p+1]*y,g[2]+=d[p+2]*y}for(var p=0;p<3;p++)g[p]/=v;return v?j.read(g):null},getPixel:function(){var t=h.read(arguments),e=this.getContext().getImageData(t.x,t.y,1,1).data;return new j("rgb",[e[0]/255,e[1]/255,e[2]/255],e[3]/255)},setPixel:function(){var t=h.read(arguments),e=j.read(arguments),i=e._convert("rgb"),n=e._alpha,r=this.getContext(!0),s=r.createImageData(1,1),a=s.data;a[0]=255*i[0],a[1]=255*i[1],a[2]=255*i[2],a[3]=null!=n?255*n:255,r.putImageData(s,t.x,t.y)},createImageData:function(){var t=l.read(arguments);return this.getContext().createImageData(t.width,t.height)},getImageData:function(){var t=f.read(arguments);if(t.isEmpty())t=new f(this._size);return this.getContext().getImageData(t.x,t.y,t.width,t.height)},setImageData:function(t){var e=h.read(arguments,1);this.getContext(!0).putImageData(t,e.x,e.y)},_getBounds:function(t,e){var i=new f(this._size).setCenter(0,0);return e?e._transformBounds(i):i},_hitTestSelf:function(t){if(this._contains(t)){var e=this;return new S("pixel",e,{offset:t.add(e._size.divide(2)).round(),color:{get:function(){return e.getPixel(this.offset)}}})}},_draw:function(t){var e=this.getElement();if(e)t.globalAlpha=this._opacity,t.drawImage(e,-this._size.width/2,-this._size.height/2)},_canComposite:function(){return!0}}),C=m.extend({_class:"PlacedSymbol",_applyMatrix:!1,_canApplyMatrix:!1,_boundsGetter:{getBounds:"getStrokeBounds"},_boundsSelected:!0,_serializeFields:{symbol:null},initialize:function(e,i){if(!this._initialize(e,i!==t&&h.read(arguments,1)))this.setSymbol(e instanceof p?e:new p(e))},_equals:function(t){return this._symbol===t._symbol},getSymbol:function(){return this._symbol},setSymbol:function(t){this._symbol=t,this._changed(9)},clone:function(t){var e=new C(m.NO_INSERT);return e.setSymbol(this._symbol),this._clone(e,t)},isEmpty:function(){return this._symbol._definition.isEmpty()},_getBounds:function(t,e,i){var n=this.symbol._definition;return n._getCachedBounds(t,e&&e.chain(n._matrix),i)},_hitTestSelf:function(t,e){var i=this._symbol._definition._hitTest(t,e);if(i)i.item=this;return i},_draw:function(t,e){this.symbol._definition.draw(t,e)}}),S=e.extend({_class:"HitResult",initialize:function(t,e,i){if(this.type=t,this.item=e,i)i.enumerable=!0,this.inject(i)},statics:{getOptions:function(t){return new e({type:null,tolerance:paper.settings.hitTolerance,fill:!t,stroke:!t,segments:!t,handles:!1,ends:!1,center:!1,bounds:!1,guides:!1,selected:!1},t)}}}),P=e.extend({_class:"Segment",beans:!0,initialize:function(e,i,n,r,s,a){var o,h,u,l=arguments.length;if(0===l);else if(1===l)if("point"in e)o=e.point,h=e.handleIn,u=e.handleOut;else o=e;else if(2===l&&"number"==typeof e)o=arguments;else if(l<=3)o=e,h=i,u=n;else o=e!==t?[e,i]:null,h=n!==t?[n,r]:null,u=s!==t?[s,a]:null;new k(o,this,"_point"),new k(h,this,"_handleIn"),new k(u,this,"_handleOut")},_serialize:function(t){return e.serialize(this.hasHandles()?[this._point,this._handleIn,this._handleOut]:this._point,t,!0)},_changed:function(t){var e=this._path;if(e){var i,n=e._curves,r=this._index;if(n){if((!t||t===this._point||t===this._handleIn)&&(i=r>0?n[r-1]:e._closed?n[n.length-1]:null))i._changed();if((!t||t===this._point||t===this._handleOut)&&(i=n[r]))i._changed()}e._changed(25)}},getPoint:function(){return this._point},setPoint:function(){var t=h.read(arguments);this._point.set(t.x,t.y)},getHandleIn:function(){return this._handleIn},setHandleIn:function(){var t=h.read(arguments);this._handleIn.set(t.x,t.y)},getHandleOut:function(){return this._handleOut},setHandleOut:function(){var t=h.read(arguments);this._handleOut.set(t.x,t.y)},hasHandles:function(){return!this._handleIn.isZero()||!this._handleOut.isZero()},clearHandles:function(){this._handleIn.set(0,0),this._handleOut.set(0,0)},_selectionState:0,isSelected:function(t){var e=this._selectionState;return!t?!!(7&e):t===this._point?!!(4&e):t===this._handleIn?!!(1&e):t===this._handleOut?!!(2&e):!1},setSelected:function(t,e){var i=this._path,t=!!t,n=this._selectionState,r=n,s=!e?7:e===this._point?4:e===this._handleIn?1:e===this._handleOut?2:0;if(t)n|=s;else n&=~s;if(this._selectionState=n,i&&n!==r)i._updateSelection(this,r,n),i._changed(129)},getIndex:function(){return this._index!==t?this._index:null},getPath:function(){return this._path||null},getCurve:function(){var t=this._path,e=this._index;if(t){if(e>0&&!t._closed&&e===t._segments.length-1)e--;return t.getCurves()[e]||null}return null},getLocation:function(){var t=this.getCurve();return t?new M(t,this===t._segment1?0:1):null},getNext:function(){var t=this._path&&this._path._segments;return t&&(t[this._index+1]||this._path._closed&&t[0])||null},getPrevious:function(){var t=this._path&&this._path._segments;return t&&(t[this._index-1]||this._path._closed&&t[t.length-1])||null},isFirst:function(){return 0===this._index},isLast:function(){var t=this._path;return t&&this._index===t._segments.length-1||!1},reverse:function(){var t=this._handleIn,e=this._handleOut,i=t._x,n=t._y;t.set(e._x,e._y),e.set(i,n)},reversed:function(){return new P(this._point,this._handleOut,this._handleIn)},remove:function(){return this._path?!!this._path.removeSegment(this._index):!1},clone:function(){return new P(this._point,this._handleIn,this._handleOut)},equals:function(t){return t===this||t&&this._class===t._class&&this._point.equals(t._point)&&this._handleIn.equals(t._handleIn)&&this._handleOut.equals(t._handleOut)||!1},toString:function(){var t=["point: "+this._point];if(!this._handleIn.isZero())t.push("handleIn: "+this._handleIn);if(!this._handleOut.isZero())t.push("handleOut: "+this._handleOut);return"{ "+t.join(", ")+" }"},transform:function(t){this._transformCoordinates(t,new Array(6),!0),this._changed()},_transformCoordinates:function(t,e,i){var n=this._point,r=!i||!this._handleIn.isZero()?this._handleIn:null,s=!i||!this._handleOut.isZero()?this._handleOut:null,a=n._x,o=n._y,h=2;if(e[0]=a,e[1]=o,r)e[h++]=r._x+a,e[h++]=r._y+o;if(s)e[h++]=s._x+a,e[h++]=s._y+o;if(t)if(t._transformCoordinates(e,e,h/2),a=e[0],o=e[1],i){if(n._x=a,n._y=o,h=2,r)r._x=e[h++]-a,r._y=e[h++]-o;if(s)s._x=e[h++]-a,s._y=e[h++]-o}else{if(!r)e[h++]=a,e[h++]=o;if(!s)e[h++]=a,e[h++]=o}return e}}),k=h.extend({initialize:function(e,i,n){var r,s,a;if(!e)r=s=0;else if((r=e[0])!==t)s=e[1];else{var o=e;if((r=o.x)===t)o=h.read(arguments),r=o.x;s=o.y,a=o.selected}if(this._x=r,this._y=s,this._owner=i,i[n]=this,a)this.setSelected(!0)},set:function(t,e){return this._x=t,this._y=e,this._owner._changed(this),this},_serialize:function(t){var e=t.formatter,i=e.number(this._x),n=e.number(this._y);return this.isSelected()?{x:i,y:n,selected:!0}:[i,n]},getX:function(){return this._x},setX:function(t){this._x=t,this._owner._changed(this)},getY:function(){return this._y},setY:function(t){this._y=t,this._owner._changed(this)},isZero:function(){return a.isZero(this._x)&&a.isZero(this._y)},setSelected:function(t){this._owner.setSelected(t,this)},isSelected:function(){return this._owner.isSelected(this)}}),I=e.extend({_class:"Curve",initialize:function(t,e,i,n,r,s,a,o){var h,u,l,c,f,d,_=arguments.length;if(3===_)this._path=t,h=e,u=i;else if(0===_)h=new P,u=new P;else if(1===_){if("segment1"in t)h=new P(t.segment1),u=new P(t.segment2);else if("point1"in t)l=t.point1,f=t.handle1,d=t.handle2,c=t.point2;else if(Array.isArray(t))l=[t[0],t[1]],c=[t[6],t[7]],f=[t[2]-t[0],t[3]-t[1]],d=[t[4]-t[6],t[5]-t[7]]}else if(2===_)h=new P(t),u=new P(e);else if(4===_)l=t,f=e,d=i,c=n;else if(8===_)l=[t,e],c=[a,o],f=[i-t,n-e],d=[r-a,s-o];this._segment1=h||new P(l,null,f),this._segment2=u||new P(c,d,null)},_serialize:function(t){return e.serialize(this.hasHandles()?[this.getPoint1(),this.getHandle1(),this.getHandle2(),this.getPoint2()]:[this.getPoint1(),this.getPoint2()],t,!0)},_changed:function(){this._length=this._bounds=t},clone:function(){return new I(this._segment1,this._segment2)},toString:function(){var t=["point1: "+this._segment1._point];if(!this._segment1._handleOut.isZero())t.push("handle1: "+this._segment1._handleOut);if(!this._segment2._handleIn.isZero())t.push("handle2: "+this._segment2._handleIn);return t.push("point2: "+this._segment2._point),"{ "+t.join(", ")+" }"},remove:function(){var t=!1;if(this._path){var e=this._segment2,i=e._handleOut;if(t=e.remove())this._segment1._handleOut.set(i.x,i.y)}return t},getPoint1:function(){return this._segment1._point},setPoint1:function(){var t=h.read(arguments);this._segment1._point.set(t.x,t.y)},getPoint2:function(){return this._segment2._point},setPoint2:function(){var t=h.read(arguments);this._segment2._point.set(t.x,t.y)},getHandle1:function(){return this._segment1._handleOut},setHandle1:function(){var t=h.read(arguments);this._segment1._handleOut.set(t.x,t.y)},getHandle2:function(){return this._segment2._handleIn},setHandle2:function(){var t=h.read(arguments);this._segment2._handleIn.set(t.x,t.y)},getSegment1:function(){return this._segment1},getSegment2:function(){return this._segment2},getPath:function(){return this._path},getIndex:function(){return this._segment1._index},getNext:function(){var t=this._path&&this._path._curves;return t&&(t[this._segment1._index+1]||this._path._closed&&t[0])||null},getPrevious:function(){var t=this._path&&this._path._curves;return t&&(t[this._segment1._index-1]||this._path._closed&&t[t.length-1])||null},isFirst:function(){return 0===this._segment1._index},isLast:function(){var t=this._path;return t&&this._segment1._index===t._curves.length-1||!1},isSelected:function(){return this.getPoint1().isSelected()&&this.getHandle2().isSelected()&&this.getHandle2().isSelected()&&this.getPoint2().isSelected()},setSelected:function(t){this.getPoint1().setSelected(t),this.getHandle1().setSelected(t),this.getHandle2().setSelected(t),this.getPoint2().setSelected(t)},getValues:function(t){return I.getValues(this._segment1,this._segment2,t)},getPoints:function(){for(var t=this.getValues(),e=[],i=0;i<8;i+=2)e.push(new h(t[i],t[i+1]));return e},getLength:function(){if(null==this._length)this._length=I.getLength(this.getValues(),0,1);return this._length},getArea:function(){return I.getArea(this.getValues())},getLine:function(){return new g(this._segment1._point,this._segment2._point)},getPart:function(t,e){return new I(I.getPart(this.getValues(),t,e))},getPartLength:function(t,e){return I.getLength(this.getValues(),t,e)},getIntersections:function(t){return I._getIntersections(this.getValues(),t&&t!==this?t.getValues():null,this,t,[],{})},_getParameter:function(e,i){return i?e:e&&e.curve===this?e.parameter:e===t&&i===t?.5:this.getParameterAt(e,0)},divide:function(t,e,i){var n=this._getParameter(t,e),r=4e-7,s=1-r,a=null;if(n>=r&&n<=s){var o=I.subdivide(this.getValues(),n),u=o[0],l=o[1],c=i||this.hasHandles(),f=this._segment1,d=this._segment2,_=this._path;if(c)f._handleOut.set(u[2]-u[0],u[3]-u[1]),d._handleIn.set(l[4]-l[6],l[5]-l[7]);var g=u[6],v=u[7],p=new P(new h(g,v),c&&new h(u[4]-g,u[5]-v),c&&new h(l[2]-g,l[3]-v));if(_)_.insert(f._index+1,p),a=this.getNext();else this._segment2=p,a=new I(p,d)}return a},split:function(t,e){return this._path?this._path.split(this._segment1._index,this._getParameter(t,e)):null},reversed:function(){return new I(this._segment2.reversed(),this._segment1.reversed())},clearHandles:function(){this._segment1._handleOut.set(0,0),this._segment2._handleIn.set(0,0)},statics:{getValues:function(t,e,i){var n=t._point,r=t._handleOut,s=e._handleIn,a=e._point,o=[n._x,n._y,n._x+r._x,n._y+r._y,a._x+s._x,a._y+s._y,a._x,a._y];if(i)i._transformCoordinates(o,o,4);return o},subdivide:function(e,i){var n=e[0],r=e[1],s=e[2],a=e[3],o=e[4],h=e[5],u=e[6],l=e[7];if(i===t)i=.5;var c=1-i,f=c*n+i*s,d=c*r+i*a,_=c*s+i*o,g=c*a+i*h,v=c*o+i*u,p=c*h+i*l,m=c*f+i*_,y=c*d+i*g,w=c*_+i*v,x=c*g+i*p,b=c*m+i*w,C=c*y+i*x;return[[n,r,f,d,m,y,b,C],[b,C,w,x,v,p,u,l]]},solveCubic:function(t,e,i,n,r,s){var o=t[e],h=t[e+2],u=t[e+4],l=t[e+6],c=3*(h-o),f=3*(u-h)-c,d=l-o-c-f;return a.solveCubic(d,f,c,o-i,n,r,s)},getParameterOf:function(t,e){var i=new h(t[0],t[1]),n=new h(t[6],t[7]),r=1e-12,s=e.isClose(i,r)?0:e.isClose(n,r)?1:null;if(null!==s)return s;for(var a=[e.x,e.y],o=[],u=2e-7,l=0;l<2;l++)for(var c=I.solveCubic(t,l,a[l],o,0,1),f=0;f<c;f++)if(s=o[f],e.isClose(I.getPoint(t,s),u))return s;return e.isClose(i,u)?0:e.isClose(n,u)?1:null},getNearestParameter:function(t,e){function i(i){if(i>=0&&i<=1){var n=e.getDistance(I.getPoint(t,i),!0);if(n<d)return d=n,_=i,!0}}if(I.isStraight(t)){var n=t[0],r=t[1],s=t[6],a=t[7],o=s-n,u=a-r,l=o*o+u*u;if(0===l)return 0;var c=((e.x-n)*o+(e.y-r)*u)/l;return c<1e-12?0:c>.999999999999?1:I.getParameterOf(t,new h(n+c*o,r+c*u))}for(var f=100,d=1/0,_=0,g=0;g<=f;g++)i(g/f);for(var v=1/(2*f);v>4e-7;)if(!i(_-v)&&!i(_+v))v/=2;return _},getPart:function(t,e,i){var n=e>i;if(n){var r=e;e=i,i=r}if(e>0)t=I.subdivide(t,e)[1];if(i<1)t=I.subdivide(t,(i-e)/(1-e))[0];return n?[t[6],t[7],t[4],t[5],t[2],t[3],t[0],t[1]]:t},hasHandles:function(t){var e=a.isZero;return!(e(t[0]-t[2])&&e(t[1]-t[3])&&e(t[4]-t[6])&&e(t[5]-t[7]))},isFlatEnough:function(t,e){var i=t[0],n=t[1],r=t[2],s=t[3],a=t[4],o=t[5],h=t[6],u=t[7],l=3*r-2*i-h,c=3*s-2*n-u,f=3*a-2*h-i,d=3*o-2*u-n;return Math.max(l*l,f*f)+Math.max(c*c,d*d)<10*e*e},getArea:function(t){var e=t[0],i=t[1],n=t[6],r=t[7],s=(t[2]+e)/2,a=(t[3]+i)/2,o=(t[4]+t[6])/2,h=(t[5]+t[7])/2;return 6*((e-s)*(a+i)+(s-o)*(h+a)+(o-n)*(r+h))/10},getBounds:function(t){for(var e=t.slice(0,2),i=e.slice(),n=[0,0],r=0;r<2;r++)I._addBounds(t[r],t[r+2],t[r+4],t[r+6],r,0,e,i,n);return new f(e[0],e[1],i[0]-e[0],i[1]-e[1])},_addBounds:function(t,e,i,n,r,s,o,h,u){function l(t,e){var i=t-e,n=t+e;if(i<o[r])o[r]=i;if(n>h[r])h[r]=n}var c=3*(e-i)-t+n,f=2*(t+i)-4*e,d=e-t,_=a.solveQuadratic(c,f,d,u),g=4e-7,v=1-g;l(n,0);for(var p=0;p<_;p++){var m=u[p],y=1-m;if(g<m&&m<v)l(y*y*y*t+3*y*y*m*e+3*y*m*m*i+m*m*m*n,s)}}}},e.each(["getBounds","getStrokeBounds","getHandleBounds","getRoughBounds"],function(t){this[t]=function(){if(!this._bounds)this._bounds={};var e=this._bounds[t];if(!e){var i=this._path;e=this._bounds[t]=A[t]([this._segment1,this._segment2],!1,i&&i.getStyle())}return e.clone()}},{}),e.each({isStraight:function(t,e,i){if(e.isZero()&&i.isZero())return!0;else if(t.isZero())return!1;else if(e.isCollinear(t)&&i.isCollinear(t)){var n=t.dot(t),r=t.dot(e)/n,s=t.dot(i)/n;return r>=0&&r<=1&&s<=0&&s>=-1}return!1},isLinear:function(t,e,i){var n=t.divide(3);return e.equals(n)&&i.negate().equals(n)}},function(t,e){this[e]=function(){var e=this._segment1,i=this._segment2;return t(i._point.subtract(e._point),e._handleOut,i._handleIn)},this.statics[e]=function(e){var i=e[0],n=e[1],r=e[6],s=e[7];return t(new h(r-i,s-n),new h(e[2]-i,e[3]-n),new h(e[4]-r,e[5]-s))}},{statics:{},hasHandles:function(){return!this._segment1._handleOut.isZero()||!this._segment2._handleIn.isZero()},isCollinear:function(t){return t&&this.isStraight()&&t.isStraight()&&this.getLine().isCollinear(t.getLine())},isHorizontal:function(){return this.isStraight()&&Math.abs(this.getTangentAt(.5,!0).y)<1e-7},isVertical:function(){return this.isStraight()&&Math.abs(this.getTangentAt(.5,!0).x)<1e-7}}),{beans:!1,getParameterAt:function(t,e){return I.getParameterAt(this.getValues(),t,e)},getParameterOf:function(){return I.getParameterOf(this.getValues(),h.read(arguments))},getLocationAt:function(t,e){var i=e?t:this.getParameterAt(t);return null!=i&&i>=0&&i<=1?new M(this,i):null},getLocationOf:function(){return this.getLocationAt(this.getParameterOf(h.read(arguments)),!0)},getOffsetOf:function(){var t=this.getLocationOf.apply(this,arguments);return t?t.getOffset():null},getNearestLocation:function(){var t=h.read(arguments),e=this.getValues(),i=I.getNearestParameter(e,t),n=I.getPoint(e,i);return new M(this,i,n,null,t.getDistance(n))},getNearestPoint:function(){return this.getNearestLocation.apply(this,arguments).getPoint()}},new function(){var t=["getPoint","getTangent","getNormal","getWeightedTangent","getWeightedNormal","getCurvature"];return e.each(t,function(t){this[t+"At"]=function(e,i){var n=this.getValues();return I[t](n,i?e:I.getParameterAt(n,e,0))}},{statics:{evaluateMethods:t}})},new function(){function e(t){var e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],a=t[5],o=t[6],h=t[7],u=9*(n-s)+3*(o-e),l=6*(e+s)-12*n,c=3*(n-e),f=9*(r-a)+3*(h-i),d=6*(i+a)-12*r,_=3*(r-i);return function(t){var e=(u*t+l)*t+c,i=(f*t+d)*t+_;return Math.sqrt(e*e+i*i)}}function i(t,e){return Math.max(2,Math.min(16,Math.ceil(32*Math.abs(e-t))))}function n(t,e,i,n){if(null==e||e<0||e>1)return null;var r,s,a=t[0],o=t[1],u=t[2],l=t[3],c=t[4],f=t[5],d=t[6],_=t[7],g=4e-7,v=1-g;if(0===i&&(e<g||e>v)){var p=e<g;r=p?a:d,s=p?o:_}else{var m=3*(u-a),y=3*(c-u)-m,w=d-a-m-y,x=3*(l-o),b=3*(f-l)-x,C=_-o-x-b;if(0===i)r=((w*e+y)*e+m)*e+a,s=((C*e+b)*e+x)*e+o;else{if(e<g)r=m,s=x;else if(e>v)r=3*(d-c),s=3*(_-f);else r=(3*w*e+2*y)*e+m,s=(3*C*e+2*b)*e+x;if(n){if(0===r&&0===s&&(e<g||e>v))r=c-u,s=f-l;var S=Math.sqrt(r*r+s*s);if(S)r/=S,s/=S}if(3===i){var P=6*w*e+2*y,k=6*C*e+2*b,I=Math.pow(r*r+s*s,1.5);r=0!==I?(r*k-s*P)/I:0,s=0}}}return 2===i?new h(s,-r):new h(r,s)}return{statics:{getLength:function(n,r,s){if(r===t)r=0;if(s===t)s=1;if(0===r&&1===s&&I.isStraight(n)){var o=n[6]-n[0],h=n[7]-n[1];return Math.sqrt(o*o+h*h)}var u=e(n);return a.integrate(u,r,s,i(r,s))},getParameterAt:function(n,r,s){function o(t){return g+=a.integrate(f,s,t,i(s,t)),s=t,g-r}if(s===t)s=r<0?1:0;if(0===r)return s;var h=Math.abs,u=r>0,l=u?s:0,c=u?1:s,f=e(n),d=a.integrate(f,l,c,i(l,c));if(h(r-d)<1e-12)return u?c:l;else if(h(r)>d)return null;var _=r/d,g=0;return a.findRoot(o,f,s+_,l,c,32,1e-12)},getPoint:function(t,e){return n(t,e,0,!1)},getTangent:function(t,e){return n(t,e,1,!0)},getWeightedTangent:function(t,e){return n(t,e,1,!1)},getNormal:function(t,e){return n(t,e,2,!0)},getWeightedNormal:function(t,e){return n(t,e,2,!1)},getCurvature:function(t,e){return n(t,e,3,!1).x}}}},new function(){function t(t,e,i,n,r,s,a,o,h,u,l){var c=e.startConnected,f=e.endConnected,d=4e-7,_=1-d;if(null==r)r=I.getParameterOf(i,s);if(null!==r&&r>=(c?d:0)&&r<=(f?_:1)){if(null==h)h=I.getParameterOf(a,u);if(null!==h&&h>=(f?d:0)&&h<=(c?_:1)){var g=e.renormalize;if(g){var v=g(r,h);r=v[0],h=v[1]}var p=new M(n,r,s||I.getPoint(i,r),l),m=new M(o,h,u||I.getPoint(a,h),l),y=p.getPath()===m.getPath()&&p.getIndex()>m.getIndex(),w=y?m:p,x=e.include;if(p._intersection=m,m._intersection=p,!x||x(w))M.insert(t,w,!0)}}}function e(r,s,a,o,h,u,l,c,f,d,_,v,p){if(!(++p>=24)){var m,y,w=s[0],x=s[1],b=s[6],C=s[7],S=g.getSignedDistance,P=S(w,x,b,C,s[2],s[3]),k=S(w,x,b,C,s[4],s[5]),M=P*k>0?.75:4/9,z=M*Math.min(0,P,k),A=M*Math.max(0,P,k),O=S(w,x,b,C,r[0],r[1]),T=S(w,x,b,C,r[2],r[3]),E=S(w,x,b,C,r[4],r[5]),L=S(w,x,b,C,r[6],r[7]),N=i(O,T,E,L),j=N[0],B=N[1];if(null!=(m=n(j,B,z,A))&&null!=(y=n(j.reverse(),B.reverse(),z,A))){r=I.getPart(r,m,y);var R=y-m,D=l+(c-l)*m,F=l+(c-l)*y;if(_>.5&&R>.5)if(F-D>d-f){var q=I.subdivide(r,.5),V=D+(F-D)/2;e(s,q[0],o,a,h,u,f,d,D,V,R,!v,p),e(s,q[1],o,a,h,u,f,d,V,F,R,!v,p)}else{var q=I.subdivide(s,.5),V=f+(d-f)/2;e(q[0],r,o,a,h,u,f,V,D,F,R,!v,p),e(q[1],r,o,a,h,u,V,d,D,F,R,!v,p)}else if(Math.max(d-f,F-D)<1e-7){var H=D+(F-D)/2,Z=f+(d-f)/2;r=a.getValues(),s=o.getValues(),t(h,u,v?s:r,v?o:a,v?Z:H,null,v?r:s,v?a:o,v?H:Z,null)}else if(R>1e-12)e(s,r,o,a,h,u,f,d,D,F,R,!v,p)}}}function i(t,e,i,n){var r,s=[0,t],a=[1/3,e],o=[2/3,i],h=[1,n],u=e-(2*t+n)/3,l=i-(t+2*n)/3;if(u*l<0)r=[[s,a,h],[s,o,h]];else{var c=u/l;r=[c>=2?[s,a,h]:c<=.5?[s,o,h]:[s,a,o,h],[s,h]]}return(u||l)<0?r.reverse():r}function n(t,e,i,n){if(t[0][1]<i)return r(t,!0,i);else if(e[0][1]>n)return r(e,!1,n);else return t[0][0]}function r(t,e,i){for(var n=t[0][0],r=t[0][1],s=1,a=t.length;s<a;s++){var o=t[s][0],h=t[s][1];if(e?h>=i:h<=i)return h===i?o:n+(i-r)*(o-n)/(h-r);n=o,r=h}return null}function s(e,i,n,r,s,o){for(var h=I.isStraight(e),u=h?i:e,l=h?e:i,c=l[0],f=l[1],d=l[6],_=l[7],g=d-c,v=_-f,p=Math.atan2(-v,g),m=Math.sin(p),y=Math.cos(p),w=[],x=0;x<8;x+=2){var b=u[x]-c,C=u[x+1]-f;w.push(b*y-C*m,b*m+C*y)}for(var S=[],P=I.solveCubic(w,1,0,S,0,1),x=0;x<P;x++){var k=S[x],M=I.getPoint(u,k),z=I.getParameterOf(l,M);if(null!==z){var A=I.getPoint(l,z),O=h?z:k,T=h?k:z;if(!o.endConnected||T>a.CURVETIME_EPSILON)t(s,o,e,n,O,h?A:M,i,r,T,h?M:A)}}}function o(e,i,n,r,s,a){var o=g.intersect(e[0],e[1],e[6],e[7],i[0],i[1],i[6],i[7]);if(o)t(s,a,e,n,null,o,i,r,null,o)}return{statics:{_getIntersections:function(i,n,r,a,u,l){if(!n)return I._getSelfIntersection(i,r,u,l);var c=i[0],f=i[1],d=i[6],_=i[7],g=n[0],v=n[1],p=n[6],m=n[7],y=(3*i[2]+c)/4,w=(3*i[3]+f)/4,x=(3*i[4]+d)/4,b=(3*i[5]+_)/4,C=(3*n[2]+g)/4,S=(3*n[3]+v)/4,P=(3*n[4]+p)/4,k=(3*n[5]+m)/4,M=Math.min,z=Math.max;if(!(z(c,y,x,d)>=M(g,C,P,p)&&M(c,y,x,d)<=z(g,C,P,p)&&z(f,w,b,_)>=M(v,S,k,m)&&M(f,w,b,_)<=z(v,S,k,m)))return u;if(!l.startConnected&&!l.endConnected){var A=I.getOverlaps(i,n);if(A){for(var O=0;O<2;O++){var T=A[O];t(u,l,i,r,T[0],null,n,a,T[1],null,!0)}return u}}var E=I.isStraight(i),L=I.isStraight(n),N=E&&L,j=1e-12,B=u.length;if((N?o:E||L?s:e)(i,n,r,a,u,l,0,1,0,1,0,!1,0),N&&u.length>B)return u;var R=new h(c,f),D=new h(d,_),F=new h(g,v),q=new h(p,m);if(R.isClose(F,j))t(u,l,i,r,0,R,n,a,0,F);if(!l.startConnected&&R.isClose(q,j))t(u,l,i,r,0,R,n,a,1,q);if(!l.endConnected&&D.isClose(F,j))t(u,l,i,r,1,D,n,a,0,F);if(D.isClose(q,j))t(u,l,i,r,1,D,n,a,1,q);return u},_getSelfIntersection:function(t,e,i,n){var r=t[0],s=t[1],o=t[2],u=t[3],l=t[4],c=t[5],f=t[6],d=t[7],_=new g(r,s,f,d,!1),v=_.getSide(new h(o,u),!0);if(v===_.getSide(new h(l,c),!0))if(((r-l)*(u-d)+(o-f)*(c-s))*v>0)return i;var p=f-3*l+3*o-r,m=l-2*o+r,y=o-r,w=d-3*c+3*u-s,x=c-2*u+s,b=u-s,C=w*y-p*b;if(C*C-4*(w*m-p*x)*(x*y-m*b)<0){var S,P=[],k=a.solveCubic(p*p+w*w,3*(p*m+w*x),2*(m*m+x*x)+p*y+w*b,m*y+x*b,P,0,1);if(k>0){for(var M=0,z=0;M<k;M++){var A=Math.abs(e.getCurvatureAt(P[M],!0));if(A>z)z=A,S=P[M]}var O=I.subdivide(t,S);n.endConnected=!0,n.renormalize=function(t,e){return[t*S,e*(1-S)+S]},I._getIntersections(O[0],O[1],e,e,i,n)}}return i},getOverlaps:function(t,e){function i(t){var e=t[6]-t[0],i=t[7]-t[1];return e*e+i*i}var n=Math.abs,r=4e-7,s=2e-7,a=I.isStraight(t),o=I.isStraight(e),u=a&&o;if(u){var l=i(t)<i(e),c=l?e:t,f=l?t:e,d=new g(c[0],c[1],c[6],c[7]);if(d.getDistance(new h(f[0],f[1]))>s||d.getDistance(new h(f[6],f[7]))>s)return null}else if(a^o)return null;for(var _=[t,e],v=[],p=0,m=0;p<2&&v.length<2;p+=0===m?0:1,m^=1){var y=I.getParameterOf(_[1^p],new h(_[p][0===m?0:6],_[p][0===m?1:7]));if(null!=y){var w=0===p?[m,y]:[y,m];if(0===v.length||n(w[0]-v[0][0])>r&&n(w[1]-v[0][1])>r)v.push(w)}if(1===p&&0===v.length)break}if(2!==v.length)v=null;else if(!u){var x=I.getPart(t,v[0][0],v[1][0]),b=I.getPart(e,v[0][1],v[1][1]);if(n(b[2]-x[2])>s||n(b[3]-x[3])>s||n(b[4]-x[4])>s||n(b[5]-x[5])>s)v=null}return v}}}}),M=e.extend({_class:"CurveLocation",beans:!0,initialize:function t(e,i,n,r,s){if(i>.9999996){var a=e.getNext();if(a)i=0,e=a}this._id=o.get(t),this._setCurve(e),this._parameter=i,this._point=n||e.getPointAt(i,!0),this._overlap=r,this._distance=s,this._intersection=this._next=this._prev=null},_setCurve:function(t){var e=t._path;this._version=e?e._version:0,this._curve=t,this._segment=null,this._segment1=t._segment1,this._segment2=t._segment2},_setSegment:function(t){this._setCurve(t.getCurve()),this._segment=t,this._parameter=t===this._segment1?0:1,this._point=t._point.clone()},getSegment:function(){var t=this.getCurve(),e=this._segment;if(!e){var i=this.getParameter();if(0===i)e=t._segment1;else if(1===i)e=t._segment2;else if(null!=i)e=t.getPartLength(0,i)<t.getPartLength(i,1)?t._segment1:t._segment2;this._segment=e}return e},getCurve:function(){function t(t){var e=t&&t.getCurve();if(e&&null!=(n._parameter=e.getParameterOf(n._point)))return n._setCurve(e),n._segment=t,e}var e=this._curve,i=e&&e._path,n=this;if(i&&i._version!==this._version)e=this._parameter=this._curve=this._offset=null;return e||t(this._segment)||t(this._segment1)||t(this._segment2.getPrevious())},getPath:function(){var t=this.getCurve();return t&&t._path},getIndex:function(){var t=this.getCurve();return t&&t.getIndex()},getParameter:function(){var t=this.getCurve(),e=this._parameter;return t&&null==e?this._parameter=t.getParameterOf(this._point):e},getPoint:function(){return this._point},getOffset:function(){var t=this._offset;if(null==t){t=0;var e=this.getPath(),i=this.getIndex();if(e&&null!=i)for(var n=e.getCurves(),r=0;r<i;r++)t+=n[r].getLength();this._offset=t+=this.getCurveOffset()}return t},getCurveOffset:function(){var t=this.getCurve(),e=this.getParameter();return null!=e&&t&&t.getPartLength(0,e)},getIntersection:function(){return this._intersection},getDistance:function(){return this._distance},divide:function(){var t=this.getCurve(),e=null;if(t)if(e=t.divide(this.getParameter(),!0))this._setSegment(e._segment1);return e},split:function(){var t=this.getCurve();return t?t.split(this.getParameter(),!0):null},equals:function(t,e){var i=this===t,n=2e-7;if(!i&&t instanceof M&&this.getPath()===t.getPath()&&this.getPoint().isClose(t.getPoint(),n)){var r=this.getCurve(),s=t.getCurve(),a=Math.abs,o=a((r.isLast()&&s.isFirst()?-1:r.getIndex())+this.getParameter()-((s.isLast()&&r.isFirst()?-1:s.getIndex())+t.getParameter()));i=(o<4e-7||(o=a(this.getOffset()-t.getOffset()))<n||a(this.getPath().getLength()-o)<n)&&(e||!this._intersection&&!t._intersection||this._intersection&&this._intersection.equals(t._intersection,!0))}return i},toString:function(){var t=[],e=this.getPoint(),i=s.instance;if(e)t.push("point: "+e);var n=this.getIndex();if(null!=n)t.push("index: "+n);var r=this.getParameter();if(null!=r)t.push("parameter: "+i.number(r));if(null!=this._distance)t.push("distance: "+i.number(this._distance));return"{ "+t.join(", ")+" }"},isTouching:function(){var t=this._intersection;if(t&&this.getTangent().isCollinear(t.getTangent())){var e=this.getCurve(),i=t.getCurve();return!(e.isStraight()&&i.isStraight()&&e.getLine().intersect(i.getLine()))}return!1},isCrossing:function(){function t(t,e,i){return e<i?t>e&&t<i:t>e&&t<=l||t>=-l&&t<i}var e=this._intersection;if(!e)return!1;var i=this.getParameter(),n=e.getParameter(),r=4e-7,s=1-r;if(i>=r&&i<=s||n>=r&&n<=s)return!this.isTouching();var a=this.getCurve(),o=a.getPrevious(),h=e.getCurve(),u=h.getPrevious(),l=Math.PI;if(!o||!u)return!1;var c=o.getTangentAt(s,!0).negate().getAngleInRadians(),f=a.getTangentAt(r,!0).getAngleInRadians(),d=u.getTangentAt(s,!0).negate().getAngleInRadians(),_=h.getTangentAt(r,!0).getAngleInRadians();return t(d,c,f)^t(_,c,f)&&t(d,f,c)^t(_,f,c)},isOverlap:function(){return!!this._overlap}},e.each(I.evaluateMethods,function(t){var e=t+"At";this[t]=function(){var t=this.getParameter(),i=this.getCurve();return null!=t&&i&&i[e](t,!0)}},{preserve:!0}),new function(){function t(t,e,i){function n(i,n){for(var s=i+n;s>=-1&&s<=r;s+=n){var a=t[(s%r+r)%r];if(!e.getPoint().isClose(a.getPoint(),2e-7))break;if(e.equals(a))return a}return null}for(var r=t.length,s=0,a=r-1;s<=a;){var o,h=s+a>>>1,u=t[h];if(i&&(o=e.equals(u)?u:n(h,-1)||n(h,1))){if(e._overlap)o._overlap=o._intersection._overlap=!0;return o}var l=e.getPath(),c=u.getPath();if((l===c?e.getIndex()+e.getParameter()-(u.getIndex()+u.getParameter()):l._id-c._id)<0)a=h-1;else s=h+1}return t.splice(s,0,e),e}return{statics:{insert:t,expand:function(e){for(var i=e.slice(),n=0,r=e.length;n<r;n++)t(i,e[n]._intersection,!1);return i}}}}),z=m.extend({_class:"PathItem",initialize:function(){},getIntersections:function(t,e,i,n){var r=this===t||!t,s=this._matrix.orNullIfIdentity(),a=r?s:(i||t._matrix).orNullIfIdentity();if(!r&&!this.getBounds(s).touches(t.getBounds(a)))return[];for(var o,t,h=this.getCurves(),u=r?h:t.getCurves(),l=h.length,c=r?l:u.length,f=[],d=[],_=0;_<c;_++)f[_]=u[_].getValues(a);for(var _=0;_<l;_++){var g=h[_],v=r?f[_]:g.getValues(s),p=g.getPath();if(p!==t)t=p,o=[],d.push(o);if(r)I._getSelfIntersection(v,g,o,{include:e,startConnected:1===l&&g.getPoint1().equals(g.getPoint2())});for(var m=r?_+1:0;m<c;m++){if(n&&o.length)return o;var y=u[m];I._getIntersections(v,f[m],g,y,o,{include:e,startConnected:r&&g.getPrevious()===y,endConnected:r&&g.getNext()===y})}}o=[];for(var _=0,w=d.length;_<w;_++)o.push.apply(o,d[_]);return o},getCrossings:function(t){return this.getIntersections(t,function(t){return t.isCrossing()})},_asPathItem:function(){return this},setPathData:function(t){function e(t,e){var i=+n[t];if(o)i+=u[e];return i}function i(t){return new h(e(t,"x"),e(t+1,"y"))}var n,r,s,a=t.match(/[mlhvcsqtaz][^mlhvcsqtaz]*/gi),o=!1,u=new h,c=new h;this.clear();for(var f=0,d=a&&a.length;f<d;f++){var _=a[f],g=_[0],v=g.toLowerCase();n=_.match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g);var p=n&&n.length;if(o=g===v,"z"===r&&!/[mz]/.test(v))this.moveTo(u=c);switch(v){case"m":case"l":for(var m="m"===v,y=0;y<p;y+=2)this[0===y&&m?"moveTo":"lineTo"](u=i(y));if(s=u,m)c=u;break;case"h":case"v":for(var w="h"===v?"x":"y",y=0;y<p;y++)u[w]=e(y,w),this.lineTo(u);s=u;break;case"c":for(var y=0;y<p;y+=6)this.cubicCurveTo(i(y),s=i(y+2),u=i(y+4));break;case"s":for(var y=0;y<p;y+=4)this.cubicCurveTo(/[cs]/.test(r)?u.multiply(2).subtract(s):u,s=i(y),u=i(y+2)),r=v;break;case"q":for(var y=0;y<p;y+=4)this.quadraticCurveTo(s=i(y),u=i(y+2));break;case"t":for(var y=0;y<p;y+=2)this.quadraticCurveTo(s=/[qt]/.test(r)?u.multiply(2).subtract(s):u,u=i(y)),r=v;break;case"a":for(var y=0;y<p;y+=7)this.arcTo(u=i(y+5),new l(+n[y],+n[y+1]),+n[y+2],+n[y+4],+n[y+3]);break;case"z":this.closePath(!0)}r=v}},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_contains:function(t){var e=this._getWinding(t,!1,!0);return!!("evenodd"===this.getWindingRule()?1&e:e)}}),A=z.extend({_class:"Path",_serializeFields:{segments:[],closed:!1},initialize:function(e){this._closed=!1,this._segments=[],this._version=0;var i=Array.isArray(e)?"object"==typeof e[0]?e:arguments:e&&e.size===t&&(e.x!==t||e.point!==t)?arguments:null;if(i&&i.length>0)this.setSegments(i);else if(this._curves=t,this._selectedSegmentState=0,!i&&"string"==typeof e)this.setPathData(e),e=null;this._initialize(!i&&e)},_equals:function(t){return this._closed===t._closed&&e.equals(this._segments,t._segments)},clone:function(e){var i=new A(m.NO_INSERT);if(i.setSegments(this._segments),i._closed=this._closed,this._clockwise!==t)i._clockwise=this._clockwise;return this._clone(i,e)},_changed:function e(i){if(e.base.call(this,i),8&i){var n=this._parent;if(n)n._currentPath=t;if(this._length=this._area=this._clockwise=this._monoCurves=t,16&i)this._version++;else if(this._curves)for(var r=0,s=this._curves.length;r<s;r++)this._curves[r]._changed()}else if(32&i)this._bounds=t},getStyle:function(){var t=this._parent;return(t instanceof O?t:this)._style},getSegments:function(){return this._segments},setSegments:function(e){var i=this.isFullySelected();if(this._segments.length=0,this._selectedSegmentState=0,this._curves=t,e&&e.length>0)this._add(P.readAll(e));if(i)this.setFullySelected(!0)},getFirstSegment:function(){return this._segments[0]},getLastSegment:function(){return this._segments[this._segments.length-1]},getCurves:function(){var t=this._curves,e=this._segments;if(!t){var i=this._countCurves();t=this._curves=new Array(i);for(var n=0;n<i;n++)t[n]=new I(this,e[n],e[n+1]||e[0])}return t},getFirstCurve:function(){return this.getCurves()[0]},getLastCurve:function(){var t=this.getCurves();return t[t.length-1]},isClosed:function(){return this._closed},setClosed:function(t){if(this._closed!=(t=!!t)){if(this._closed=t,this._curves){var e=this._curves.length=this._countCurves();if(t)this._curves[e-1]=new I(this,this._segments[e-1],this._segments[0])}this._changed(25)}}},{beans:!0,getPathData:function(t,e){function i(e,i){if(e._transformCoordinates(t,g,!1),n=g[0],r=g[1],v)p.push("M"+_.pair(n,r)),v=!1;else if(h=g[2],u=g[3],h===n&&u===r&&l===a&&c===o){if(!i)p.push("l"+_.pair(n-a,r-o))}else p.push("c"+_.pair(l-a,c-o)+" "+_.pair(h-a,u-o)+" "+_.pair(n-a,r-o));a=n,o=r,l=g[4],c=g[5]}var n,r,a,o,h,u,l,c,f=this._segments,d=f.length,_=new s(e),g=new Array(6),v=!0,p=[];if(0===d)return"";for(var m=0;m<d;m++)i(f[m]);if(this._closed&&d>0)i(f[0],!0),p.push("z");return p.join("")}},{isEmpty:function(){return 0===this._segments.length},_transformContent:function(t){for(var e=new Array(6),i=0,n=this._segments.length;i<n;i++)this._segments[i]._transformCoordinates(t,e,!0);return!0},_add:function(t,e){for(var i=this._segments,n=this._curves,r=t.length,s=null==e,e=s?i.length:e,a=0;a<r;a++){var o=t[a];if(o._path)o=t[a]=o.clone();if(o._path=this,o._index=e+a,o._selectionState)this._updateSelection(o,0,o._selectionState)}if(s)i.push.apply(i,t);else{i.splice.apply(i,[e,0].concat(t));for(var a=e+r,h=i.length;a<h;a++)i[a]._index=a}if(n){var u=this._countCurves(),l=e+r-1===u?e-1:e,c=l,f=Math.min(l+r,u);if(t._curves)n.splice.apply(n,[l,0].concat(t._curves)),c+=t._curves.length;for(var a=c;a<f;a++)n.splice(a,0,new I(this,null,null));this._adjustCurves(l,f)}return this._changed(25),t},_adjustCurves:function(t,e){for(var i,n=this._segments,r=this._curves,s=t;s<e;s++)i=r[s],i._path=this,i._segment1=n[s],i._segment2=n[s+1]||n[0],i._changed();if(i=r[this._closed&&0===t?n.length-1:t-1])i._segment2=n[t]||n[0],i._changed();if(i=r[e])i._segment1=n[e],i._changed()},_countCurves:function(){var t=this._segments.length;return!this._closed&&t>0?t-1:t},add:function(t){return arguments.length>1&&"number"!=typeof t?this._add(P.readAll(arguments)):this._add([P.read(arguments)])[0]},insert:function(t,e){return arguments.length>2&&"number"!=typeof e?this._add(P.readAll(arguments,1),t):this._add([P.read(arguments,1)],t)[0]},addSegment:function(){return this._add([P.read(arguments)])[0]},insertSegment:function(t){return this._add([P.read(arguments,1)],t)[0]},addSegments:function(t){return this._add(P.readAll(t))},insertSegments:function(t,e){return this._add(P.readAll(e),t)},removeSegment:function(t){return this.removeSegments(t,t+1)[0]||null},removeSegments:function(t,i,n){t=t||0,i=e.pick(i,this._segments.length);var r=this._segments,s=this._curves,a=r.length,o=r.splice(t,i-t),h=o.length;if(!h)return o;for(var u=0;u<h;u++){var l=o[u];if(l._selectionState)this._updateSelection(l,l._selectionState,0);l._index=l._path=null}for(var u=t,c=r.length;u<c;u++)r[u]._index=u;if(s){var f=t>0&&i===a+(this._closed?1:0)?t-1:t,s=s.splice(f,h);if(n)o._curves=s.slice(1);this._adjustCurves(f,f)}return this._changed(25),o},clear:"#removeSegments",hasHandles:function(){for(var t=this._segments,e=0,i=t.length;e<i;e++)if(t[e].hasHandles())return!0;return!1},clearHandles:function(){for(var t=this._segments,e=0,i=t.length;e<i;e++)t[e].clearHandles()},getLength:function(){if(null==this._length){for(var t=this.getCurves(),e=0,i=0,n=t.length;i<n;i++)e+=t[i].getLength();this._length=e}return this._length},getArea:function(){if(null==this._area){for(var t=this._segments,e=t.length,i=e-1,n=0,r=0,s=this._closed?e:i;r<s;r++)n+=I.getArea(I.getValues(t[r],t[r<i?r+1:0]));this._area=n}return this._area},isClockwise:function(){if(this._clockwise!==t)return this._clockwise;else return this.getArea()>=0},setClockwise:function(t){if(this.isClockwise()!=(t=!!t))this.reverse();this._clockwise=t},isFullySelected:function(){var t=this._segments.length;return this._selected&&t>0&&this._selectedSegmentState===7*t},setFullySelected:function(t){if(t)this._selectSegments(!0);this.setSelected(t)},setSelected:function t(e){if(!e)this._selectSegments(!1);t.base.call(this,e)},_selectSegments:function(t){var e=this._segments.length;this._selectedSegmentState=t?7*e:0;for(var i=0;i<e;i++)this._segments[i]._selectionState=t?7:0},_updateSelection:function(t,e,i){if(t._selectionState=i,(this._selectedSegmentState+=i-e)>0)this.setSelected(!0)},flatten:function(t){for(var e=new T(this,64,.1),i=0,n=e.length/Math.ceil(e.length/t),r=e.length+(this._closed?-n:n)/2,s=[];i<=r;)s.push(new P(e.getPointAt(i))),i+=n;this.setSegments(s)},reduce:function(){for(var t=this.getCurves(),e=t.length-1;e>=0;e--){var i=t[e];if(!i.hasHandles()&&(0===i.getLength()||i.isCollinear(i.getNext())))i.remove()}return this},simplify:function(t){if(this._segments.length>2){var e=new E(this,t||2.5);this.setSegments(e.fit())}},split:function(t,e){if(null===e)return null;if(1===arguments.length){var i=t;if("number"==typeof i)i=this.getLocationAt(i);if(!i)return null;t=i.index,e=i.parameter}var n=4e-7;if(e>=1-n)t++,e--;var r=this.getCurves();if(t>=0&&t<r.length){if(e>=n)r[t++].divide(e,!0);var s,a=this.removeSegments(t,this._segments.length,!0);if(this._closed)this.setClosed(!1),s=this;else s=new A(m.NO_INSERT),s.insertAbove(this,!0),this._clone(s);return s._add(a,0),this.addSegment(a[0]),s}return null},reverse:function(){this._segments.reverse();for(var e=0,i=this._segments.length;e<i;e++){var n=this._segments[e],r=n._handleIn;n._handleIn=n._handleOut,n._handleOut=r,n._index=e}if(this._curves=null,this._clockwise!==t)this._clockwise=!this._clockwise;this._changed(9)},join:function(t){if(t){var e=t._segments,i=this.getLastSegment(),n=t.getLastSegment();if(!n)return this;if(i&&i._point.equals(n._point))t.reverse();var r=t.getFirstSegment();if(i&&i._point.equals(r._point))i.setHandleOut(r._handleOut),this._add(e.slice(1));else{var s=this.getFirstSegment();if(s&&s._point.equals(r._point))t.reverse();if(n=t.getLastSegment(),s&&s._point.equals(n._point))s.setHandleIn(n._handleIn),this._add(e.slice(0,e.length-1),0);else this._add(e.slice())}if(t._closed)this._add([e[0]]);t.remove()}var a=this.getFirstSegment(),o=this.getLastSegment();if(a!==o&&a._point.equals(o._point))a.setHandleIn(o._handleIn),o.remove(),this.setClosed(!0);return this},toShape:function(t){function e(t,e){var i=c[t],n=i.getNext(),r=c[e],s=r.getNext();return i._handleOut.isZero()&&n._handleIn.isZero()&&r._handleOut.isZero()&&s._handleIn.isZero()&&n._point.subtract(i._point).isCollinear(s._point.subtract(r._point))}function i(t){var e=c[t],i=e.getPrevious(),n=e.getNext();return i._handleOut.isZero()&&e._handleIn.isZero()&&e._handleOut.isZero()&&n._handleIn.isZero()&&e._point.subtract(i._point).isOrthogonal(n._point.subtract(e._point))}function n(t){var e=c[t],i=e.getNext(),n=e._handleOut,r=i._handleIn,s=.5522847498307936;if(n.isOrthogonal(r)){var o=e._point,h=i._point,u=new g(o,n,!0).intersect(new g(h,r,!0),!0);return u&&a.isZero(n.getLength()/u.subtract(o).getLength()-s)&&a.isZero(r.getLength()/u.subtract(h).getLength()-s)}return!1}function r(t,e){return c[t]._point.getDistance(c[e]._point)}if(!this._closed)return null;var s,o,h,u,c=this._segments;if(!this.hasHandles()&&4===c.length&&e(0,2)&&e(1,3)&&i(1))s=x.Rectangle,o=new l(r(0,3),r(0,1)),u=c[1]._point.add(c[2]._point).divide(2);else if(8===c.length&&n(0)&&n(2)&&n(4)&&n(6)&&e(1,5)&&e(3,7))s=x.Rectangle,o=new l(r(1,6),r(0,3)),h=o.subtract(new l(r(0,7),r(1,2))).divide(2),u=c[3]._point.add(c[4]._point).divide(2);else if(4===c.length&&n(0)&&n(1)&&n(2)&&n(3)){if(a.isZero(r(0,2)-r(1,3)))s=x.Circle,h=r(0,2)/2;else s=x.Ellipse,h=new l(r(2,0)/2,r(3,1)/2);u=c[1]._point}if(s){var f=this.getPosition(!0),d=this._clone(new s({center:f,size:o,radius:h,insert:!1}),t,!1);return d.rotate(u.subtract(f).getAngle()+90),d}return null},_hitTestSelf:function(t,e){function i(e,i){return t.subtract(e).divide(i).length<=1}function n(t,n,r){if(!e.selected||n.isSelected()){var s=t._point;if(n!==s)n=n.add(s);if(i(n,w))return new S(r,_,{segment:t,point:n})}}function r(t,i){return(i||e.segments)&&n(t,t._point,"segment")||!i&&e.handles&&(n(t,t._handleIn,"handle-in")||n(t,t._handleOut,"handle-out"))}function s(t){c.add(t)}function a(e){if("round"!==o||"round"!==u){if(c=new A({internal:!0,closed:!0}),m||e._index>0&&e._index<p-1){if("round"!==o&&(e._handleIn.isZero()||e._handleOut.isZero()))A._addBevelJoin(e,o,P,l,s,!0)}else if("round"!==u)A._addSquareCap(e,u,P,s,!0);if(!c.isEmpty()){var n;return c.contains(t)||(n=c.getNearestLocation(t))&&i(n.getPoint(),y)}}return i(e._point,w)}var o,u,l,c,f,d,_=this,g=this.getStyle(),v=this._segments,p=v.length,m=this._closed,y=e._tolerancePadding,w=y,x=e.stroke&&g.hasStroke(),b=e.fill&&g.hasFill(),C=e.curves,P=x?g.getStrokeWidth()/2:b&&e.tolerance>0||C?0:null;if(null!==P)if(P>0)o=g.getStrokeJoin(),u=g.getStrokeCap(),l=P*g.getMiterLimit(),w=y.add(new h(P,P));else o=u="round";if(e.ends&&!e.segments&&!m){if(d=r(v[0],!0)||r(v[p-1],!0))return d}else if(e.segments||e.handles)for(var k=0;k<p;k++)if(d=r(v[k]))return d;if(null!==P){if(f=this.getNearestLocation(t)){var I=f.getParameter();if(0===I||1===I&&p>1){if(!a(f.getSegment()))f=null}else if(!i(f.getPoint(),w))f=null}if(!f&&"miter"===o&&p>1)for(var k=0;k<p;k++){var M=v[k];if(t.getDistance(M._point)<=l&&a(M)){f=M.getLocation();break}}}return!f&&b&&this._contains(t)||f&&!x&&!C?new S("fill",this):f?new S(x?"stroke":"curve",this,{location:f,point:f.getPoint()}):null}},e.each(I.evaluateMethods,function(t){this[t+"At"]=function(e,i){var n=this.getLocationAt(e,i);return n&&n[t]()}},{beans:!1,getLocationOf:function(){for(var t=h.read(arguments),e=this.getCurves(),i=0,n=e.length;i<n;i++){var r=e[i].getLocationOf(t);if(r)return r}return null},getOffsetOf:function(){var t=this.getLocationOf.apply(this,arguments);return t?t.getOffset():null},getLocationAt:function(t,e){var i=this.getCurves(),n=0;if(e){var r=~~t,s=i[r];return s?s.getLocationAt(t-r,!0):null}for(var a=0,o=i.length;a<o;a++){var h=n,s=i[a];if((n+=s.getLength())>t)return s.getLocationAt(t-h)}if(i.length>0&&t<=this.getLength())return new M(i[i.length-1],1);else return null},getNearestLocation:function(){for(var t=h.read(arguments),e=this.getCurves(),i=1/0,n=null,r=0,s=e.length;r<s;r++){var a=e[r].getNearestLocation(t);if(a._distance<i)i=a._distance,n=a}return n},getNearestPoint:function(){return this.getNearestLocation.apply(this,arguments).getPoint()}}),new function(){function t(t,e,i,n){function r(e){var i=a[e],n=a[e+1];if(c!=i||f!=n)t.beginPath(),t.moveTo(c,f),t.lineTo(i,n),t.stroke(),t.beginPath(),t.arc(i,n,s,0,2*Math.PI,!0),t.fill()}for(var s=n/2,a=new Array(6),o=0,h=e.length;o<h;o++){var u=e[o];u._transformCoordinates(i,a,!1);var l=u._selectionState,c=a[0],f=a[1];if(1&l)r(2);if(2&l)r(4);if(t.fillRect(c-s,f-s,n,n),!(4&l)){var d=t.fillStyle;t.fillStyle="#ffffff",t.fillRect(c-s+1,f-s+1,n-2,n-2),t.fillStyle=d}}}function e(t,e,i){function n(e){if(i)e._transformCoordinates(i,_,!1),r=_[0],s=_[1];else{var n=e._point;r=n._x,s=n._y}if(g)t.moveTo(r,s),g=!1;else{if(i)h=_[2],u=_[3];else{var f=e._handleIn;h=r+f._x,u=s+f._y}if(h===r&&u===s&&l===a&&c===o)t.lineTo(r,s);else t.bezierCurveTo(l,c,h,u,r,s)}if(a=r,o=s,i)l=_[4],c=_[5];else{var f=e._handleOut;l=a+f._x,c=o+f._y}}for(var r,s,a,o,h,u,l,c,f=e._segments,d=f.length,_=new Array(6),g=!0,v=0;v<d;v++)n(f[v]);if(e._closed&&d>0)n(f[0])}return{_draw:function(t,i,n){function r(t){return l[(t%c+c)%c]}var s=i.dontStart,a=i.dontFinish||i.clip,o=this.getStyle(),h=o.hasFill(),u=o.hasStroke(),l=o.getDashArray(),c=!paper.support.nativeDash&&u&&l&&l.length;if(!s)t.beginPath();if(!s&&this._currentPath)t.currentPath=this._currentPath;else if(h||u&&!c||a){if(e(t,this,n),this._closed)t.closePath();if(!s)this._currentPath=t.currentPath}if(!a&&(h||u)){if(this._setStyles(t),h)t.fill(o.getWindingRule()),t.shadowColor="rgba(0,0,0,0)";if(u){if(c){if(!s)t.beginPath();var f,d=new T(this,32,.25,n),_=d.length,g=-o.getDashOffset(),v=0;for(g%=_;g>0;)g-=r(v--)+r(v--);for(;g<_;){if(f=g+r(v++),g>0||f>0)d.drawPart(t,Math.max(g,0),Math.max(f,0));g=f+r(v++)}}t.stroke()}}},_drawSelected:function(i,n){i.beginPath(),e(i,this,n),i.stroke(),t(i,this._segments,n,paper.settings.handleSize)}}},new function(){function t(t){var e=t.length,i=[],n=[],r=2;i[0]=t[0]/r;for(var s=1;s<e;s++)n[s]=1/r,r=(s<e-1?4:2)-n[s],i[s]=(t[s]-i[s-1])/r;for(var s=1;s<e;s++)i[e-s-1]-=n[e-s]*i[e-s];return i}return{smooth:function(){var e=this._segments,i=e.length,n=this._closed,r=i,s=0;if(!(i<=2)){if(n)s=Math.min(i,4),r+=2*Math.min(i,s);for(var a=[],o=0;o<i;o++)a[o+s]=e[o]._point;if(n)for(var o=0;o<s;o++)a[o]=e[o+i-s]._point,a[o+i+s]=e[o]._point;else r--;for(var u=[],o=1;o<r-1;o++)u[o]=4*a[o]._x+2*a[o+1]._x;u[0]=a[0]._x+2*a[1]._x,u[r-1]=3*a[r-1]._x;for(var l=t(u),o=1;o<r-1;o++)u[o]=4*a[o]._y+2*a[o+1]._y;u[0]=a[0]._y+2*a[1]._y,u[r-1]=3*a[r-1]._y;var c=t(u);if(n){for(var o=0,f=i;o<s;o++,f++){var d=o/s,_=1-d,g=o+s,v=f+s;l[f]=l[o]*d+l[f]*_,c[f]=c[o]*d+c[f]*_,l[v]=l[g]*_+l[v]*d,c[v]=c[g]*_+c[v]*d}r--}for(var p=null,o=s;o<=r-s;o++){var m=e[o-s];if(p)m.setHandleIn(p.subtract(m._point));if(o<r)m.setHandleOut(new h(l[o],c[o]).subtract(m._point)),p=o<r-1?new h(2*a[o+1]._x-l[o+1],2*a[o+1]._y-c[o+1]):new h((a[r]._x+l[r-1])/2,(a[r]._y+c[r-1])/2)}if(n&&p){var m=this._segments[0];m.setHandleIn(p.subtract(m._point))}}}}},new function(){function t(t){var e=t._segments;if(0===e.length)throw new Error("Use a moveTo() command first");return e[e.length-1]}return{moveTo:function(){var t=this._segments;if(1===t.length)this.removeSegment(0);if(!t.length)this._add([new P(h.read(arguments))])},moveBy:function(){throw new Error("moveBy() is unsupported on Path items.")},lineTo:function(){this._add([new P(h.read(arguments))])},cubicCurveTo:function(){var e=h.read(arguments),i=h.read(arguments),n=h.read(arguments),r=t(this);r.setHandleOut(e.subtract(r._point)),this._add([new P(n,i.subtract(n))])},quadraticCurveTo:function(){var e=h.read(arguments),i=h.read(arguments),n=t(this)._point;this.cubicCurveTo(e.add(n.subtract(e).multiply(1/3)),e.add(i.subtract(e).multiply(1/3)),i)},curveTo:function(){var i=h.read(arguments),n=h.read(arguments),r=e.pick(e.read(arguments),.5),s=1-r,a=t(this)._point,o=i.subtract(a.multiply(s*s)).subtract(n.multiply(r*r)).divide(2*r*s);if(o.isNaN())throw new Error("Cannot put a curve through points with parameter = "+r);this.quadraticCurveTo(o,n)},arcTo:function(){var i,n,r,s,a,o=t(this),u=o._point,c=h.read(arguments),f=e.peek(arguments),d=e.pick(f,!0);if("boolean"==typeof d)var v=u.add(c).divide(2),i=v.add(v.subtract(u).rotate(d?-90:90));else if(e.remain(arguments)<=2)i=c,c=h.read(arguments);else{var p=l.read(arguments);if(p.isZero())return this.lineTo(c);var m=e.read(arguments),d=!!e.read(arguments),y=!!e.read(arguments),v=u.add(c).divide(2),w=u.subtract(v).rotate(-m),x=w.x,b=w.y,C=Math.abs,S=C(p.width),k=C(p.height),I=S*S,M=k*k,z=x*x,A=b*b,O=Math.sqrt(z/I+A/M);if(O>1)S*=O,k*=O,I=S*S,M=k*k;if(O=(I*M-I*A-M*z)/(I*A+M*z),C(O)<1e-12)O=0;if(O<0)throw new Error("Cannot create an arc with the given arguments");if(n=new h(S*b/k,-k*x/S).multiply((y===d?-1:1)*Math.sqrt(O)).rotate(m).add(v),a=(new _).translate(n).rotate(m).scale(S,k),s=a._inverseTransform(u),r=s.getDirectedAngle(a._inverseTransform(c)),!d&&r>0)r-=360;else if(d&&r<0)r+=360}if(i){var T=new g(u.add(i).divide(2),i.subtract(u).rotate(90),!0),E=new g(i.add(c).divide(2),c.subtract(i).rotate(90),!0),L=new g(u,c),N=L.getSide(i);if(!(n=T.intersect(E,!0))){if(!N)return this.lineTo(c);throw new Error("Cannot create an arc with the given arguments")}s=u.subtract(n),r=s.getDirectedAngle(c.subtract(n));var j=L.getSide(n);if(0===j)r=N*Math.abs(r);else if(N===j)r+=r<0?360:-360}for(var B=Math.abs(r),R=B>=360?4:Math.ceil(B/90),D=r/R,F=D*Math.PI/360,q=4/3*Math.sin(F)/(1+Math.cos(F)),V=[],H=0;H<=R;H++){var w=c,Z=null;if(H<R)if(Z=s.rotate(90).multiply(q),a)w=a._transformPoint(s),Z=a._transformPoint(s.add(Z)).subtract(w);else w=n.add(s);if(0===H)o.setHandleOut(Z);else{var U=s.rotate(-90).multiply(q);if(a)U=a._transformPoint(s.add(U)).subtract(w);V.push(new P(w,U,Z))}s=s.rotate(D)}this._add(V)},lineBy:function(){var e=h.read(arguments),i=t(this)._point;this.lineTo(i.add(e))},curveBy:function(){var i=h.read(arguments),n=h.read(arguments),r=e.read(arguments),s=t(this)._point;this.curveTo(s.add(i),s.add(n),r)},cubicCurveBy:function(){var e=h.read(arguments),i=h.read(arguments),n=h.read(arguments),r=t(this)._point;this.cubicCurveTo(r.add(e),r.add(i),r.add(n))},quadraticCurveBy:function(){var e=h.read(arguments),i=h.read(arguments),n=t(this)._point;this.quadraticCurveTo(n.add(e),n.add(i))},arcBy:function(){var i=t(this)._point,n=i.add(h.read(arguments)),r=e.pick(e.peek(arguments),!0);if("boolean"==typeof r)this.arcTo(n,r);else this.arcTo(n,i.add(h.read(arguments)))},closePath:function(t){if(this.setClosed(!0),t)this.join()}}},{_getBounds:function(t,e){return A[t](this._segments,this._closed,this.getStyle(),e)},statics:{getBounds:function(t,e,i,n,r){function s(t){t._transformCoordinates(n,o,!1);for(var e=0;e<2;e++)I._addBounds(h[e],h[e+4],o[e+2],o[e],e,r?r[e]:0,u,l,c);var i=h;h=o,o=i}var a=t[0];if(!a)return new f;for(var o=new Array(6),h=a._transformCoordinates(n,new Array(6),!1),u=h.slice(0,2),l=u.slice(),c=new Array(2),d=1,_=t.length;d<_;d++)s(t[d]);if(e)s(a);return new f(u[0],u[1],l[0]-u[0],l[1]-u[1])},getStrokeBounds:function(t,e,i,n){function r(t){d=d.include(n?n._transformPoint(t,t):t)}function s(t){d=d.unite(p.setCenter(n?n._transformPoint(t._point):t._point))}function a(t,e){var i=t._handleIn,n=t._handleOut;if("round"===e||!i.isZero()&&!n.isZero()&&i.isCollinear(n))s(t);else A._addBevelJoin(t,e,u,v,r)}function o(t,e){if("round"===e)s(t);else A._addSquareCap(t,e,u,r)}if(!i.hasStroke())return A.getBounds(t,e,i,n);for(var h=t.length-(e?0:1),u=i.getStrokeWidth()/2,c=A._getPenPadding(u,n),d=A.getBounds(t,e,i,n,c),_=i.getStrokeJoin(),g=i.getStrokeCap(),v=u*i.getMiterLimit(),p=new f(new l(c).multiply(2)),m=1;m<h;m++)a(t[m],_);if(e)a(t[0],_);else if(h>0)o(t[0],g),o(t[t.length-1],g);return d},_getPenPadding:function(t,e){if(!e)return[t,t];var i=e.shiftless(),n=i.transform(new h(t,0)),r=i.transform(new h(0,t)),s=n.getAngleInRadians(),a=n.getLength(),o=r.getLength(),u=Math.sin(s),l=Math.cos(s),c=Math.tan(s),f=-Math.atan(o*c/a),d=Math.atan(o/(c*a));return[Math.abs(a*Math.cos(f)*l-o*Math.sin(f)*u),Math.abs(o*Math.sin(d)*l+a*Math.cos(d)*u)]},_addBevelJoin:function(t,e,i,n,r,s){var a=t.getCurve(),o=a.getPrevious(),u=a.getPointAt(0,!0),l=o.getNormalAt(1,!0),c=a.getNormalAt(0,!0),f=l.getDirectedAngle(c)<0?-i:i;if(l.setLength(f),c.setLength(f),s)r(u),r(u.add(l));if("miter"===e){var d=new g(u.add(l),new h(-l.y,l.x),!0).intersect(new g(u.add(c),new h(-c.y,c.x),!0),!0);if(d&&u.getDistance(d)<=n)if(r(d),!s)return}if(!s)r(u.add(l));r(u.add(c))},_addSquareCap:function(t,e,i,n,r){var s=t._point,a=t.getLocation(),o=a.getNormal().multiply(i);if(r)n(s.subtract(o)),n(s.add(o));if("square"===e)s=s.add(o.rotate(0===a.getParameter()?-90:90));n(s.add(o)),n(s.subtract(o))},getHandleBounds:function(t,e,i,n,r,s){for(var a=new Array(6),o=1/0,h=-o,u=o,l=h,c=0,d=t.length;c<d;c++){t[c]._transformCoordinates(n,a,!1);for(var _=0;_<6;_+=2){var g=0===_?s:r,v=g?g[0]:0,p=g?g[1]:0,m=a[_],y=a[_+1],w=m-v,x=m+v,b=y-p,C=y+p;if(w<o)o=w;if(x>h)h=x;if(b<u)u=b;if(C>l)l=C}}return new f(o,u,h-o,l-u)},getRoughBounds:function(t,e,i,n){var r=i.hasStroke()?i.getStrokeWidth()/2:0,s=r;if(r>0){if("miter"===i.getStrokeJoin())s=r*i.getMiterLimit();if("square"===i.getStrokeCap())s=Math.max(s,r*Math.sqrt(2))}return A.getHandleBounds(t,e,i,n,A._getPenPadding(r,n),A._getPenPadding(s,n))}}});A.inject({statics:new function(){function t(t,i,n){var r=e.getNamed(n),s=new A(r&&!1===r.insert&&m.NO_INSERT);return s._add(t),s._closed=i,s.set(r)}function i(e,i,n){for(var s=new Array(4),a=0;a<4;a++){var o=r[a];s[a]=new P(o._point.multiply(i).add(e),o._handleIn.multiply(i),o._handleOut.multiply(i))}return t(s,!0,n)}var n=.5522847498307936,r=[new P([-1,0],[0,n],[0,-n]),new P([0,-1],[-n,0],[n,0]),new P([1,0],[0,-n],[0,n]),new P([0,1],[n,0],[-n,0])];return{Line:function(){return t([new P(h.readNamed(arguments,"from")),new P(h.readNamed(arguments,"to"))],!1,arguments)},Circle:function(){var t=h.readNamed(arguments,"center"),n=e.readNamed(arguments,"radius");return i(t,new l(n),arguments)},Rectangle:function(){var e,i=f.readNamed(arguments,"rectangle"),r=l.readNamed(arguments,"radius",0,{readNull:!0}),s=i.getBottomLeft(!0),a=i.getTopLeft(!0),o=i.getTopRight(!0),h=i.getBottomRight(!0);if(!r||r.isZero())e=[new P(s),new P(a),new P(o),new P(h)];else{r=l.min(r,i.getSize(!0).divide(2));var u=r.width,c=r.height,d=u*n,_=c*n;e=[new P(s.add(u,0),null,[-d,0]),new P(s.subtract(0,c),[0,_]),new P(a.add(0,c),null,[0,-_]),new P(a.add(u,0),[-d,0],null),new P(o.subtract(u,0),null,[d,0]),new P(o.add(0,c),[0,-_],null),new P(h.subtract(0,c),null,[0,_]),new P(h.subtract(u,0),[d,0])]}return t(e,!0,arguments)},RoundRectangle:"#Rectangle",Ellipse:function(){var t=x._readEllipse(arguments);return i(t.center,t.radius,arguments)},Oval:"#Ellipse",Arc:function(){var t=h.readNamed(arguments,"from"),i=h.readNamed(arguments,"through"),n=h.readNamed(arguments,"to"),r=e.getNamed(arguments),s=new A(r&&!1===r.insert&&m.NO_INSERT);return s.moveTo(t),s.arcTo(i,n),s.set(r)},RegularPolygon:function(){for(var i=h.readNamed(arguments,"center"),n=e.readNamed(arguments,"sides"),r=e.readNamed(arguments,"radius"),s=360/n,a=!(n%3),o=new h(0,a?-r:r),u=a?-1:.5,l=new Array(n),c=0;c<n;c++)l[c]=new P(i.add(o.rotate((c+u)*s)));return t(l,!0,arguments)},Star:function(){for(var i=h.readNamed(arguments,"center"),n=2*e.readNamed(arguments,"points"),r=e.readNamed(arguments,"radius1"),s=e.readNamed(arguments,"radius2"),a=360/n,o=new h(0,-1),u=new Array(n),l=0;l<n;l++)u[l]=new P(i.add(o.rotate(a*l).multiply(l%2?s:r)));return t(u,!0,arguments)}}}});var O=z.extend({_class:"CompoundPath",_serializeFields:{children:[]},initialize:function(t){if(this._children=[],this._namedChildren={},!this._initialize(t))if("string"==typeof t)this.setPathData(t);else this.addChildren(Array.isArray(t)?t:arguments)},insertChildren:function e(i,n,r){for(var s=n.length-1;s>=0;s--){var a=n[s];if(a instanceof O)n.splice.apply(n,[s,1].concat(a.removeChildren())),a.remove()}n=e.base.call(this,i,n,r,A);for(var s=0,o=!r&&n&&n.length;s<o;s++){var a=n[s];if(a._clockwise===t)a.setClockwise(0===a._index)}return n},reverse:function(){for(var t=this._children,e=0,i=t.length;e<i;e++)t[e].reverse()},smooth:function(){for(var t=0,e=this._children.length;t<e;t++)this._children[t].smooth()},reduce:function t(){for(var e=this._children,i=e.length-1;i>=0;i--){var n=e[i].reduce();if(n.isEmpty())e.splice(i,1)}if(0===e.length){var n=new A(m.NO_INSERT);return n.insertAbove(this),n.setStyle(this._style),this.remove(),n}return t.base.call(this)},isClockwise:function(){var t=this.getFirstChild();return t&&t.isClockwise()},setClockwise:function(t){if(this.isClockwise()!==!!t)this.reverse()},getFirstSegment:function(){var t=this.getFirstChild();return t&&t.getFirstSegment()},getLastSegment:function(){var t=this.getLastChild();return t&&t.getLastSegment()},getCurves:function(){for(var t=this._children,e=[],i=0,n=t.length;i<n;i++)e.push.apply(e,t[i].getCurves());return e},getFirstCurve:function(){var t=this.getFirstChild();return t&&t.getFirstCurve()},getLastCurve:function(){var t=this.getLastChild();return t&&t.getFirstCurve()},getArea:function(){for(var t=this._children,e=0,i=0,n=t.length;i<n;i++)e+=t[i].getArea();return e}},{beans:!0,getPathData:function(t,e){for(var i=this._children,n=[],r=0,s=i.length;r<s;r++){var a=i[r],o=a._matrix;n.push(a.getPathData(t&&!o.isIdentity()?t.chain(o):t,e))}return n.join(" ")}},{_getChildHitTestOptions:function(t){return t.class===A||"path"===t.type?t:new e(t,{fill:!1})},_draw:function(t,e,i){var n=this._children;if(0!==n.length){if(this._currentPath)t.currentPath=this._currentPath;else{e=e.extend({dontStart:!0,dontFinish:!0}),t.beginPath();for(var r=0,s=n.length;r<s;r++)n[r].draw(t,e,i);this._currentPath=t.currentPath}if(!e.clip){this._setStyles(t);var a=this._style;if(a.hasFill())t.fill(a.getWindingRule()),t.shadowColor="rgba(0,0,0,0)";if(a.hasStroke())t.stroke()}}},_drawSelected:function(t,e,i){for(var n=this._children,r=0,s=n.length;r<s;r++){var a=n[r],o=a._matrix;if(!i[a._id])a._drawSelected(t,o.isIdentity()?e:e.chain(o))}}},new function(){function t(t,e){var i=t._children;if(e&&0===i.length)throw new Error("Use a moveTo() command first");return i[i.length-1]}var i={moveTo:function(){var e=t(this),i=e&&e.isEmpty()?e:new A(m.NO_INSERT);if(i!==e)this.addChild(i);i.moveTo.apply(i,arguments)},moveBy:function(){var e=t(this,!0),i=e&&e.getLastSegment(),n=h.read(arguments);this.moveTo(i?n.add(i._point):n)},closePath:function(e){t(this,!0).closePath(e)}};return e.each(["lineTo","cubicCurveTo","quadraticCurveTo","curveTo","arcTo","lineBy","cubicCurveBy","quadraticCurveBy","curveBy","arcBy"],function(e){i[e]=function(){var i=t(this,!0);i[e].apply(i,arguments)}}),i});z.inject(new function(){function t(t,e){var i=t.clone(!1).reduce().transform(null,!0,!0);return e?i.resolveCrossings().reorient():i}function e(t,e,i,n,r){var s=new t(m.NO_INSERT);if(s.addChildren(e,!0),r)s=s.reduce();return s.insertAbove(n&&i.isSibling(n)&&i.getIndex()<n.getIndex()?n:i),s.setStyle(i._style),s}function i(i,r,a){function o(t){for(var e=0,i=t.length;e<i;e++){var n=t[e];d.push.apply(d,n._segments),_.push.apply(_,n._getMonoCurves())}}if(!i._children&&!i._closed)return n(i,r,a);var h=t(i,!0),c=r&&i!==r&&t(r,!0);if(c&&/^(subtract|exclude)$/.test(a)^c.isClockwise()!==h.isClockwise())c.reverse();var f=M.expand(h.getIntersections(c,function(t){return c&&t.isOverlap()||t.isCrossing()}));s(f);var d=[],_=[];if(o(h._children||[h]),c)o(c._children||[c]);for(var g=0,v=f.length;g<v;g++)u(f[g]._segment,h,c,_,a);for(var g=0,v=d.length;g<v;g++){var p=d[g];if(null==p._winding)u(p,h,c,_,a)}return e(O,l(d,a),i,r,!0)}function n(i,n,r){function s(t){if(o.contains(t.getPointAt(t.getLength()/2))^u)return l.unshift(t),!0}if(!n||!n._children&&!n._closed||!/^(subtract|intersect)$/.test(r))return null;for(var a=t(i,!1),o=t(n,!1),h=a.getIntersections(o,function(t){return t.isOverlap()||t.isCrossing()}),u="subtract"===r,l=[],c=h.length-1;c>=0;c--){var f=h[c].split();if(f){if(s(f))f.getFirstSegment().setHandleIn(0,0);a.getLastSegment().setHandleOut(0,0)}}return s(a),e(y,l,i,n)}function r(t,e){for(var i=t;i;){if(i===e)return;i=i._prev}for(;t._next&&t._next!==e;)t=t._next;if(!t._next){for(;e._prev;)e=e._prev;t._next=e,e._prev=t}}function s(t){for(var e,i,n=4e-7,s=1-n,a=!1,o=[],h=t.length-1;h>=0;h--){var u=t[h],l=u._curve,c=u._parameter,f=c;if(l!==e)a=!l.hasHandles();else if(i>0)c/=i;var d;if(c<n)d=l._segment1;else if(c>s)d=l._segment2;else if(d=l.divide(c,!0,!0)._segment1,a)o.push(d);u._setSegment(d);var _=d._intersection,g=u._intersection;if(_){r(_,g);for(var v=_;v;)r(v._intersection,_),v=v._next}else d._intersection=g;e=l,i=f}for(var h=0,p=o.length;h<p;h++)o[h].clearHandles()}function o(t,e,i,n){var r=2e-7,s=4e-7,u=1-s,l=t.x,c=t.y,f=0,d=0,_=[],g=Math.abs;if(i){for(var v=-1/0,p=1/0,m=c-r,y=c+r,w=0,x=e.length;w<x;w++){var b=e[w].values;if(I.solveCubic(b,0,l,_,0,1)>0)for(var C=_.length-1;C>=0;C--){var S=I.getPoint(b,_[C]).y;if(S<m&&S>v)v=S;else if(S>y&&S<p)p=S}}if(v=(v+c)/2,p=(p+c)/2,v>-1/0)f=o(new h(l,v),e,!1,n);if(p<1/0)d=o(new h(l,p),e,!1,n)}else for(var P,k,M=l-r,z=l+r,A=!1,w=0,x=e.length;w<x;w++){var O=e[w],b=O.values,T=O.winding;if(T&&(1===T&&c>=b[1]&&c<=b[7]||c>=b[7]&&c<=b[1])&&1===I.solveCubic(b,1,c,_,0,1)){var E=_[0];if(!(E>u&&A&&O.next!==e[w+1]||E<s&&k>u&&O.previous===P)){var L=I.getPoint(b,E).x,N=I.getTangent(b,E).y,j=!1;if(a.isZero(N)&&!I.isStraight(b)||E<s&&N*I.getTangent(O.previous.values,1).y<0||E>u&&N*I.getTangent(O.next.values,0).y<0){if(n&&L>=M&&L<=z)++f,++d,j=!0}else if(L<=M)f+=T,j=!0;else if(L>=z)d+=T,j=!0;if(O.previous!==e[w-1])A=E<s&&j}P=O,k=E}}return Math.max(g(f),g(d))}function u(t,e,i,n,r){var s=2e-7,a=[],h=t,u=0,l=0;do{var c=t.getCurve(),f=c.getLength();a.push({segment:t,curve:c,length:f}),u+=f,t=t.getNext()}while(t&&!t._intersection&&t!==h);for(var d=0;d<3;d++)for(var f=u*(d+1)/4,_=0,g=a.length;_<g;_++){var v=a[_],p=v.length;if(f<=p){if(f<s||p-f<s)f=p/2;var c=v.curve,m=c._path,y=m._parent,w=c.getPointAt(f),x=c.isHorizontal();if(y instanceof O)m=y;l+="subtract"===r&&i&&(m===e&&i._getWinding(w,x)||m===i&&!e._getWinding(w,x))?0:o(w,n,x);break}f-=p}for(var b=Math.round(l/3),C=a.length-1;C>=0;C--)a[C].segment._winding=b}function l(t,e){function i(t,e){if(t._visited)return!1;if(!l)return!0;var i=t._winding,n=t._intersection;if(n&&e&&f&&n.isOverlap())i=f[i]||i;return l(i)}function n(t){return t===o||t===h}function r(t,e){if(!t._next)return t;for(;t;){var r=t._segment,s=r.getNext(),a=s._intersection;if(n(s)||!r._visited&&!s._visited&&(!l||(!e||i(r))&&(!(e&&a&&a.isOverlap())&&i(s)||!e&&a&&i(a._segment))))return t;t=t._next}return null}function s(t,e){for(;t;){var i=t._segment;if(n(i))return i;t=t[e?"_next":"_prev"]}}for(var o,h,u=[],l=c[e],f={unite:{1:2},intersect:{2:1}}[e],d=0,_=t.length;d<_;d++){var g=t[d],v=null,p=!1;if(i(g,!0)){for(o=h=null;!p;){var y=g._intersection,w=v&&g._handleIn;y=y&&(r(y,!0)||r(y,!1))||y;var x=y&&y._segment;if(x&&i(x))g=x;if(g._visited){if(!(p=n(g))&&y){var b=s(y,!0)||s(y,!1);if(b)g=b,p=!0}break}if(!v)v=new A(m.NO_INSERT),o=g,h=x;v.add(new P(g._point,w,g._handleOut)),g._visited=!0,g=g.getNext(),p=n(g)}if(p)v.firstSegment.setHandleIn(g._handleIn),v.setClosed(!0);else if(v)console.error("Boolean operation resulted in open path","segments =",v._segments.length,"length =",v.getLength()),v=null;if(v&&(v._segments.length>8||!a.isZero(v.getArea())))u.push(v),v=null}}return u}var c={unite:function(t){return 1===t||0===t},intersect:function(t){return 2===t},subtract:function(t){return 1===t},exclude:function(t){return 1===t}};return{_getWinding:function(t,e,i){return o(t,this._getMonoCurves(),e,i)},unite:function(t){return i(this,t,"unite")},intersect:function(t){return i(this,t,"intersect")},subtract:function(t){return i(this,t,"subtract")},exclude:function(t){return i(this,t,"exclude")},divide:function(t){return e(y,[this.subtract(t),this.intersect(t)],this,t,!0)},resolveCrossings:function(){var t=this.getCrossings();if(!t.length)return this;s(M.expand(t));for(var i=this._children||[this],n=[],r=0,a=i.length;r<a;r++)n.push.apply(n,i[r]._segments);return e(O,l(n),this,null,!1)}}}),A.inject({_getMonoCurves:function(){function t(t){var e=t[1],r=t[7],s={values:t,winding:e===r?0:e>r?-1:1,previous:i,next:null};if(i)i.next=s;n.push(s),i=s}function e(e){if(0!==I.getLength(e)){var i=e[1],n=e[3],r=e[5],s=e[7];if(I.isStraight(e))t(e);else{var o=3*(n-r)-i+s,h=2*(i+r)-4*n,u=n-i,l=4e-7,c=1-l,f=[],d=a.solveQuadratic(o,h,u,f,l,c);if(0===d)t(e);else{f.sort();var _=f[0],g=I.subdivide(e,_);if(t(g[0]),d>1)_=(f[1]-_)/(1-_),g=I.subdivide(g[1],_),t(g[0]);t(g[1])}}}}var i,n=this._monoCurves;if(!n){n=this._monoCurves=[];for(var r=this.getCurves(),s=this._segments,o=0,h=r.length;o<h;o++)e(r[o].getValues());if(!this._closed&&s.length>1){var u=s[s.length-1]._point,l=s[0]._point,c=u._x,f=u._y,d=l._x,_=l._y;e([c,f,c,f,d,_,d,_])}if(n.length>0){var g=n[0],v=n[n.length-1];g.previous=v,v.next=g}}return n},getInteriorPoint:function(){var t=this.getBounds(),e=t.getCenter(!0);if(!this.contains(e)){for(var i=this._getMonoCurves(),n=[],r=e.y,s=[],a=0,o=i.length;a<o;a++){var h=i[a].values;if((1===i[a].winding&&r>=h[1]&&r<=h[7]||r>=h[7]&&r<=h[1])&&I.solveCubic(h,1,r,n,0,1)>0)for(var u=n.length-1;u>=0;u--)s.push(I.getPoint(h,n[u]).x);if(s.length>1)break}e.x=(s[0]+s[1])/2}return e},reorient:function(){return this.setClockwise(!0),this}}),O.inject({_getMonoCurves:function(){for(var t=this._children,e=[],i=0,n=t.length;i<n;i++)e.push.apply(e,t[i]._getMonoCurves());return e},reorient:function(){var t=this.removeChildren().sort(function(t,e){return e.getBounds().getArea()-t.getBounds().getArea()});if(t.length>0){this.addChildren(t);for(var e=t[0].isClockwise(),i=1,n=t.length;i<n;i++){for(var r=t[i].getInteriorPoint(),s=0,a=i-1;a>=0;a--)if(t[a].contains(r))s++;t[i].setClockwise(s%2==0&&e)}}return this}});var T=e.extend({_class:"PathIterator",initialize:function(t,e,i,n){function r(t,e){var i=I.getValues(t,e,n);o.push(i),s(i,t._index,0,1)}function s(t,e,n,r){if(r-n>l&&!I.isFlatEnough(t,i||.25)){var a=I.subdivide(t,.5),o=(n+r)/2;s(a[0],e,n,o),s(a[1],e,o,r)}else{var c=t[6]-t[0],f=t[7]-t[1],d=Math.sqrt(c*c+f*f);if(d>1e-6)u+=d,h.push({offset:u,value:r,index:e})}}for(var a,o=[],h=[],u=0,l=1/(e||32),c=t._segments,f=c[0],d=1,_=c.length;d<_;d++)a=c[d],r(f,a),f=a;if(t._closed)r(a,c[0]);this.curves=o,this.parts=h,this.length=u,this.index=0},getParameterAt:function(t){for(var e,i=this.index;e=i,!(0==i||this.parts[--i].offset<t););for(var n=this.parts.length;e<n;e++){var r=this.parts[e];if(r.offset>=t){this.index=e;var s=this.parts[e-1],a=s&&s.index==r.index?s.value:0,o=s?s.offset:0;return{value:a+(r.value-a)*(t-o)/(r.offset-o),index:r.index}}}var r=this.parts[this.parts.length-1];return{value:1,index:r.index}},drawPart:function(t,e,i){e=this.getParameterAt(e),i=this.getParameterAt(i);for(var n=e.index;n<=i.index;n++){var r=I.getPart(this.curves[n],n==e.index?e.value:0,n==i.index?i.value:1);if(n==e.index)t.moveTo(r[0],r[1]);t.bezierCurveTo.apply(t,r.slice(2))}}},e.each(I.evaluateMethods,function(t){this[t+"At"]=function(e,i){var n=this.getParameterAt(e);return I[t](this.curves[n.index],n.value,i)}},{})),E=e.extend({initialize:function(t,e){for(var i,n=this.points=[],r=t._segments,s=0,a=r.length;s<a;s++){var o=r[s].point.clone();if(!i||!i.equals(o))n.push(o),i=o}if(t._closed)this.closed=!0,n.unshift(n[n.length-1]),n.push(n[1]);this.error=e},fit:function(){var t=this.points,e=t.length,i=this.segments=e>0?[new P(t[0])]:[];if(e>1)this.fitCubic(0,e-1,t[1].subtract(t[0]).normalize(),t[e-2].subtract(t[e-1]).normalize());if(this.closed)i.shift(),i.pop();return i},fitCubic:function(t,e,i,n){if(e-t==1){var r=this.points[t],s=this.points[e],a=r.getDistance(s)/3;return void this.addCurve([r,r.add(i.normalize(a)),s.add(n.normalize(a)),s])}for(var o,h=this.chordLengthParameterize(t,e),u=Math.max(this.error,this.error*this.error),l=!0,c=0;c<=4;c++){var f=this.generateBezier(t,e,h,i,n),d=this.findMaxError(t,e,f,h);if(d.error<this.error&&l)return void this.addCurve(f);if(o=d.index,d.error>=u)break;l=this.reparameterize(t,e,h,f),u=d.error}var _=this.points[o-1].subtract(this.points[o]),g=this.points[o].subtract(this.points[o+1]),v=_.add(g).divide(2).normalize();this.fitCubic(t,o,i,v),this.fitCubic(o,e,v.negate(),n)},addCurve:function(t){this.segments[this.segments.length-1].setHandleOut(t[1].subtract(t[0])),this.segments.push(new P(t[3],t[2].subtract(t[3])))},generateBezier:function(t,e,i,n,r){for(var s=1e-12,a=this.points[t],o=this.points[e],h=[[0,0],[0,0]],u=[0,0],l=0,c=e-t+1;l<c;l++){var f=i[l],d=1-f,_=3*f*d,g=d*d*d,v=_*d,p=_*f,m=f*f*f,y=n.normalize(v),w=r.normalize(p),x=this.points[t+l].subtract(a.multiply(g+v)).subtract(o.multiply(p+m));h[0][0]+=y.dot(y),h[0][1]+=y.dot(w),h[1][0]=h[0][1],h[1][1]+=w.dot(w),u[0]+=y.dot(x),u[1]+=w.dot(x)}var b,C,S=h[0][0]*h[1][1]-h[1][0]*h[0][1];if(Math.abs(S)>s){var P=h[0][0]*u[1]-h[1][0]*u[0];b=(u[0]*h[1][1]-u[1]*h[0][1])/S,C=P/S}else{var k=h[0][0]+h[0][1],I=h[1][0]+h[1][1];if(Math.abs(k)>s)b=C=u[0]/k;else if(Math.abs(I)>s)b=C=u[1]/I;else b=C=0}var M,z,A=o.getDistance(a),O=s*A;if(b<O||C<O)b=C=A/3;else{var T=o.subtract(a);if(M=n.normalize(b),z=r.normalize(C),M.dot(T)-z.dot(T)>A*A)b=C=A/3,M=z=null}return[a,a.add(M||n.normalize(b)),o.add(z||r.normalize(C)),o]},reparameterize:function(t,e,i,n){for(var r=t;r<=e;r++)i[r-t]=this.findRoot(n,this.points[r],i[r-t]);for(var r=1,s=i.length;r<s;r++)if(i[r]<=i[r-1])return!1;return!0},findRoot:function(t,e,i){for(var n=[],r=[],s=0;s<=2;s++)n[s]=t[s+1].subtract(t[s]).multiply(3);for(var s=0;s<=1;s++)r[s]=n[s+1].subtract(n[s]).multiply(2);var a=this.evaluate(3,t,i),o=this.evaluate(2,n,i),h=this.evaluate(1,r,i),u=a.subtract(e),l=o.dot(o)+u.dot(h);if(Math.abs(l)<1e-6)return i;else return i-u.dot(o)/l},evaluate:function(t,e,i){for(var n=e.slice(),r=1;r<=t;r++)for(var s=0;s<=t-r;s++)n[s]=n[s].multiply(1-i).add(n[s+1].multiply(i));return n[0]},chordLengthParameterize:function(t,e){for(var i=[0],n=t+1;n<=e;n++)i[n-t]=i[n-t-1]+this.points[n].getDistance(this.points[n-1]);for(var n=1,r=e-t;n<=r;n++)i[n]/=i[r];return i},findMaxError:function(t,e,i,n){for(var r=Math.floor((e-t+1)/2),s=0,a=t+1;a<e;a++){var o=this.evaluate(3,i,n[a-t]),h=o.subtract(this.points[a]),u=h.x*h.x+h.y*h.y;if(u>=s)s=u,r=a}return{error:s,index:r}}}),L=m.extend({_class:"TextItem",_boundsSelected:!0,_applyMatrix:!1,_canApplyMatrix:!1,_serializeFields:{content:null},_boundsGetter:"getBounds",initialize:function(i){this._content="",this._lines=[];var n=i&&e.isPlainObject(i)&&i.x===t&&i.y===t;this._initialize(n&&i,!n&&h.read(arguments))},_equals:function(t){return this._content===t._content},_clone:function t(e,i,n){return e.setContent(this._content),t.base.call(this,e,i,n)},getContent:function(){return this._content},setContent:function(t){this._content=""+t,this._lines=this._content.split(/\r\n|\n|\r/gm),this._changed(265)},isEmpty:function(){return!this._content},getCharacterStyle:"#getStyle",setCharacterStyle:"#setStyle",getParagraphStyle:"#getStyle",setParagraphStyle:"#setStyle"}),N=L.extend({_class:"PointText",initialize:function(){L.apply(this,arguments)},clone:function(t){return this._clone(new N(m.NO_INSERT),t)},getPoint:function(){var t=this._matrix.getTranslation();return new u(t.x,t.y,this,"setPoint")},setPoint:function(){var t=h.read(arguments);this.translate(t.subtract(this._matrix.getTranslation()))},_draw:function(t){if(this._content){this._setStyles(t);var e=this._style,i=this._lines,n=e.getLeading(),r=t.shadowColor;t.font=e.getFontStyle(),t.textAlign=e.getJustification();for(var s=0,a=i.length;s<a;s++){t.shadowColor=r;var o=i[s];if(e.hasFill())t.fillText(o,0,0),t.shadowColor="rgba(0,0,0,0)";if(e.hasStroke())t.strokeText(o,0,0);t.translate(0,n)}}},_getBounds:function(t,e){var i=this._style,n=this._lines,r=n.length,s=i.getJustification(),a=i.getLeading(),o=this.getView().getTextWidth(i.getFontStyle(),n),h=0;if("left"!==s)h-=o/("center"===s?2:1);var u=new f(h,r?-.75*a:0,o,r*a);return e?e._transformBounds(u,u):u}}),j=e.extend(new function(){function t(t){var e,n=t.match(/^#(\w{1,2})(\w{1,2})(\w{1,2})$/);if(n){e=[0,0,0];for(var r=0;r<3;r++){var s=n[r+1];e[r]=parseInt(1==s.length?s+s:s,16)/255}}else if(n=t.match(/^rgba?\((.*)\)$/)){e=n[1].split(",");for(var r=0,o=e.length;r<o;r++){var s=+e[r];e[r]=r<3?s/255:s}}else{var h=a[t];if(!h){if(!i)i=Y.getContext(1,1),i.globalCompositeOperation="copy";i.fillStyle="rgba(0,0,0,0)",i.fillStyle=t,i.fillRect(0,0,1,1);var u=i.getImageData(0,0,1,1).data;h=a[t]=[u[0]/255,u[1]/255,u[2]/255]}e=h.slice()}return e}var i,n={gray:["gray"],rgb:["red","green","blue"],hsb:["hue","saturation","brightness"],hsl:["hue","saturation","lightness"],gradient:["gradient","origin","destination","highlight"]},r={},a={},u=[[0,3,1],[2,0,1],[1,0,3],[1,2,0],[3,1,0],[0,1,2]],l={"rgb-hsb":function(t,e,i){var n=Math.max(t,e,i),r=Math.min(t,e,i),s=n-r;return[0===s?0:60*(n==t?(e-i)/s+(e<i?6:0):n==e?(i-t)/s+2:(t-e)/s+4),0===n?0:s/n,n]},"hsb-rgb":function(t,e,i){t=(t/60%6+6)%6;var n=Math.floor(t),r=t-n,n=u[n],s=[i,i*(1-e),i*(1-e*r),i*(1-e*(1-r))];return[s[n[0]],s[n[1]],s[n[2]]]},"rgb-hsl":function(t,e,i){var n=Math.max(t,e,i),r=Math.min(t,e,i),s=n-r,a=0===s,o=a?0:60*(n==t?(e-i)/s+(e<i?6:0):n==e?(i-t)/s+2:(t-e)/s+4),h=(n+r)/2;return[o,a?0:h<.5?s/(n+r):s/(2-n-r),h]},"hsl-rgb":function(t,e,i){if(t=(t/360%1+1)%1,0===e)return[i,i,i];for(var n=[t+1/3,t,t-1/3],r=i<.5?i*(1+e):i+e-i*e,s=2*i-r,a=[],o=0;o<3;o++){var h=n[o];if(h<0)h+=1;if(h>1)h-=1;a[o]=6*h<1?s+6*(r-s)*h:2*h<1?r:3*h<2?s+(r-s)*(2/3-h)*6:s}return a},"rgb-gray":function(t,e,i){return[.2989*t+.587*e+.114*i]},"gray-rgb":function(t){return[t,t,t]},"gray-hsb":function(t){return[0,0,t]},"gray-hsl":function(t){return[0,0,t]},"gradient-rgb":function(){return[]},"rgb-gradient":function(){return[]}};return e.each(n,function(t,i){r[i]=[],e.each(t,function(t,s){var a=e.capitalize(t),o=/^(hue|saturation)$/.test(t),u=r[i][s]="gradient"===t?function(t){var e=this._components[0];if(t=B.read(Array.isArray(t)?t:arguments,0,{readNull:!0}),e!==t){if(e)e._removeOwner(this);if(t)t._addOwner(this)}return t}:"gradient"===i?function(){return h.read(arguments,0,{readNull:"highlight"===t,clone:!0})}:function(t){return null==t||isNaN(t)?0:t};this["get"+a]=function(){return this._type===i||o&&/^hs[bl]$/.test(this._type)?this._components[s]:this._convert(i)[s]},this["set"+a]=function(t){if(!(this._type===i||o&&/^hs[bl]$/.test(this._type)))this._components=this._convert(i),this._properties=n[i],this._type=i;this._components[s]=u.call(this,t),this._changed()}},this)},{_class:"Color",_readIndex:!0,initialize:function e(i){var s,a,h,u,l=Array.prototype.slice,c=arguments,f=0;if(Array.isArray(i))c=i,i=c[0];var d=null!=i&&typeof i;if("string"===d&&i in n)if(s=i,i=c[1],Array.isArray(i))a=i,h=c[2];else{if(this.__read)f=1;c=l.call(c,1),d=typeof i}if(!a){if(u="number"===d?c:"object"===d&&null!=i.length?i:null){if(!s)s=u.length>=3?"rgb":"gray";var _=n[s].length;if(h=u[_],this.__read)f+=u===arguments?_+(null!=h?1:0):1;if(u.length>_)u=l.call(u,0,_)}else if("string"===d){if(s="rgb",a=t(i),4===a.length)h=a[3],a.length--}else if("object"===d)if(i.constructor===e){if(s=i._type,a=i._components.slice(),h=i._alpha,"gradient"===s)for(var g=1,v=a.length;g<v;g++){var p=a[g];if(p)a[g]=p.clone()}}else if(i.constructor===B)s="gradient",u=c;else{s="hue"in i?"lightness"in i?"hsl":"hsb":"gradient"in i||"stops"in i||"radial"in i?"gradient":"gray"in i?"gray":"rgb";var m=n[s],y=r[s];this._components=a=[];for(var g=0,v=m.length;g<v;g++){var w=i[m[g]];if(null==w&&0===g&&"gradient"===s&&"stops"in i)w={stops:i.stops,radial:i.radial};if(null!=(w=y[g].call(this,w)))a[g]=w}h=i.alpha}if(this.__read&&s)f=1}if(this._type=s||"rgb",this._id=o.get(e),!a){this._components=a=[];for(var y=r[this._type],g=0,v=y.length;g<v;g++){var w=y[g].call(this,u&&u[g]);if(null!=w)a[g]=w}}if(this._components=a,this._properties=n[this._type],this._alpha=h,this.__read)this.__read=f},_serialize:function(t,i){var n=this.getComponents();return e.serialize(/^(gray|rgb)$/.test(this._type)?n:[this._type].concat(n),t,!0,i)},_changed:function(){if(this._canvasStyle=null,this._owner)this._owner._changed(65)},_convert:function(t){var e;return this._type===t?this._components.slice():(e=l[this._type+"-"+t])?e.apply(this,this._components):l["rgb-"+t].apply(this,l[this._type+"-rgb"].apply(this,this._components))},convert:function(t){return new j(t,this._convert(t),this._alpha)},getType:function(){return this._type},setType:function(t){this._components=this._convert(t),this._properties=n[t],this._type=t},getComponents:function(){var t=this._components.slice();if(null!=this._alpha)t.push(this._alpha);return t},getAlpha:function(){return null!=this._alpha?this._alpha:1},setAlpha:function(t){this._alpha=null==t?null:Math.min(Math.max(t,0),1),this._changed()},hasAlpha:function(){return null!=this._alpha},equals:function(t){var i=e.isPlainValue(t,!0)?j.read(arguments):t;return i===this||i&&this._class===i._class&&this._type===i._type&&this._alpha===i._alpha&&e.equals(this._components,i._components)||!1},toString:function(){for(var t=this._properties,e=[],i="gradient"===this._type,n=s.instance,r=0,a=t.length;r<a;r++){var o=this._components[r];if(null!=o)e.push(t[r]+": "+(i?o:n.number(o)))}if(null!=this._alpha)e.push("alpha: "+n.number(this._alpha));return"{ "+e.join(", ")+" }"},toCSS:function(t){function e(t){return Math.round(255*(t<0?0:t>1?1:t))}var i=this._convert("rgb"),n=t||null==this._alpha?1:this._alpha;if(i=[e(i[0]),e(i[1]),e(i[2])],n<1)i.push(n<0?0:n);return t?"#"+((1<<24)+(i[0]<<16)+(i[1]<<8)+i[2]).toString(16).slice(1):(4==i.length?"rgba(":"rgb(")+i.join(",")+")"},toCanvasStyle:function(t){if(this._canvasStyle)return this._canvasStyle;if("gradient"!==this._type)return this._canvasStyle=this.toCSS();var e,i=this._components,n=i[0],r=n._stops,s=i[1],a=i[2];if(n._radial){var o=a.getDistance(s),h=i[3];if(h){var u=h.subtract(s);if(u.getLength()>o)h=s.add(u.normalize(o-.1))}var l=h||s;e=t.createRadialGradient(l.x,l.y,0,s.x,s.y,o)}else e=t.createLinearGradient(s.x,s.y,a.x,a.y);for(var c=0,f=r.length;c<f;c++){var d=r[c];e.addColorStop(d._rampPoint,d._color.toCanvasStyle())}return this._canvasStyle=e},transform:function(t){if("gradient"===this._type){for(var e=this._components,i=1,n=e.length;i<n;i++){var r=e[i];t._transformPoint(r,r,!0)}this._changed()}},statics:{_types:n,random:function(){var t=Math.random;return new j(t(),t(),t())}}})},new function(){var t={add:function(t,e){return t+e},subtract:function(t,e){return t-e},multiply:function(t,e){return t*e},divide:function(t,e){return t/e}};return e.each(t,function(t,e){this[e]=function(e){e=j.read(arguments);for(var i=this._type,n=this._components,r=e._convert(i),s=0,a=n.length;s<a;s++)r[s]=t(n[s],r[s]);return new j(i,r,null!=this._alpha?t(this._alpha,e.getAlpha()):null)}},{})}),B=e.extend({_class:"Gradient",initialize:function(t,e){if(this._id=o.get(),t&&this._set(t))t=e=null;if(!this._stops)this.setStops(t||["white","black"]);if(null==this._radial)this.setRadial("string"==typeof e&&"radial"===e||e||!1)},_serialize:function(t,i){return i.add(this,function(){return e.serialize([this._stops,this._radial],t,!0,i)})},_changed:function(){for(var t=0,e=this._owners&&this._owners.length;t<e;t++)this._owners[t]._changed()},_addOwner:function(t){if(!this._owners)this._owners=[];this._owners.push(t)},_removeOwner:function(e){var i=this._owners?this._owners.indexOf(e):-1;if(-1!=i)if(this._owners.splice(i,1),0===this._owners.length)this._owners=t},clone:function(){for(var t=[],e=0,i=this._stops.length;e<i;e++)t[e]=this._stops[e].clone();return new B(t,this._radial)},getStops:function(){return this._stops},setStops:function(e){if(this.stops)for(var i=0,n=this._stops.length;i<n;i++)this._stops[i]._owner=t;if(e.length<2)throw new Error("Gradient stop list needs to contain at least two stops.");this._stops=R.readAll(e,0,{clone:!0});for(var i=0,n=this._stops.length;i<n;i++){var r=this._stops[i];if(r._owner=this,r._defaultRamp)r.setRampPoint(i/(n-1))}this._changed()},getRadial:function(){return this._radial},setRadial:function(t){this._radial=t,this._changed()},equals:function(t){if(t===this)return!0;if(t&&this._class===t._class&&this._stops.length===t._stops.length){for(var e=0,i=this._stops.length;e<i;e++)if(!this._stops[e].equals(t._stops[e]))return!1;return!0}return!1}}),R=e.extend({_class:"GradientStop",initialize:function(e,i){if(e){var n,r;if(i===t&&Array.isArray(e))n=e[0],r=e[1];else if(e.color)n=e.color,r=e.rampPoint;else n=e,r=i;this.setColor(n),this.setRampPoint(r)}},clone:function(){return new R(this._color.clone(),this._rampPoint)},_serialize:function(t,i){return e.serialize([this._color,this._rampPoint],t,!0,i)},_changed:function(){if(this._owner)this._owner._changed(65)},getRampPoint:function(){return this._rampPoint},setRampPoint:function(t){this._defaultRamp=null==t,this._rampPoint=t||0,this._changed()},getColor:function(){return this._color},setColor:function(t){if(this._color=j.read(arguments),this._color===t)this._color=t.clone();this._color._owner=this,this._changed()},equals:function(t){return t===this||t&&this._class===t._class&&this._color.equals(t._color)&&this._rampPoint==t._rampPoint||!1}}),D=e.extend(new function(){var i={fillColor:t,strokeColor:t,strokeWidth:1,strokeCap:"butt",strokeJoin:"miter",strokeScaling:!0,miterLimit:10,dashOffset:0,dashArray:[],windingRule:"nonzero",shadowColor:t,shadowBlur:0,shadowOffset:new h,selectedColor:t,fontFamily:"sans-serif",fontWeight:"normal",fontSize:12,font:"sans-serif",leading:null,justification:"left"},n={strokeWidth:97,strokeCap:97,strokeJoin:97,strokeScaling:105,miterLimit:97,fontFamily:9,fontWeight:9,fontSize:9,font:9,leading:9,justification:9},r={beans:!0},s={_defaults:i,_textDefaults:new e(i,{fillColor:new j}),beans:!0};return e.each(i,function(i,a){var o=/Color$/.test(a),u="shadowOffset"===a,l=e.capitalize(a),c=n[a],f="set"+l,d="get"+l;s[f]=function(e){var i=this._owner,n=i&&i._children;if(n&&n.length>0&&!(i instanceof O))for(var r=0,s=n.length;r<s;r++)n[r]._style[f](e);else{var h=this._values[a];if(h!==e){if(o){if(h)h._owner=t;if(e&&e.constructor===j){if(e._owner)e=e.clone();e._owner=i}}if(this._values[a]=e,i)i._changed(c||65)}}},s[d]=function(i){var n,r=this._owner,s=r&&r._children;if(!s||0===s.length||i||r instanceof O){var n=this._values[a];if(n===t){if((n=this._defaults[a])&&n.clone)n=n.clone()}else{var l=o?j:u?h:null;if(l&&(!n||n.constructor!==l))if(this._values[a]=n=l.read([n],0,{readNull:!0,clone:!0}),n&&o)n._owner=r}return n}for(var c=0,f=s.length;c<f;c++){var _=s[c]._style[d]();if(0===c)n=_;else if(!e.equals(n,_))return t}return n},r[d]=function(t){return this._style[d](t)},r[f]=function(t){this._style[f](t)}}),m.inject(r),s},{_class:"Style",initialize:function(t,e,i){if(this._values={},this._owner=e,this._project=e&&e._project||i||paper.project,e instanceof L)this._defaults=this._textDefaults;if(t)this.set(t)},set:function(t){var e=t instanceof D,i=e?t._values:t;if(i)for(var n in i)if(n in this._defaults){var r=i[n];this[n]=r&&e&&r.clone?r.clone():r}},equals:function(t){return t===this||t&&this._class===t._class&&e.equals(this._values,t._values)||!1},hasFill:function(){return!!this.getFillColor()},hasStroke:function(){return!!this.getStrokeColor()&&this.getStrokeWidth()>0},hasShadow:function(){return!!this.getShadowColor()&&this.getShadowBlur()>0},getView:function(){return this._project.getView()},getFontStyle:function(){var t=this.getFontSize();return this.getFontWeight()+" "+t+(/[a-z]/i.test(t+"")?" ":"px ")+this.getFontFamily()},getFont:"#getFontFamily",setFont:"#setFontFamily",getLeading:function t(){var e=t.base.call(this),i=this.getFontSize();if(/pt|em|%|px/.test(i))i=this.getView().getPixelSize(i);return null!=e?e:1.2*i}}),F=new function(){function t(t,e,i,n){for(var r=["","webkit","moz","Moz","ms","o"],s=e[0].toUpperCase()+e.substring(1),a=0;a<6;a++){var o=r[a],h=o?o+s:e;if(h in t){if(i)t[h]=n;else return t[h];break}}}return{getStyles:function(t){var e=t&&9!==t.nodeType?t.ownerDocument:t,i=e&&e.defaultView;return i&&i.getComputedStyle(t,"")},getBounds:function(t,e){var i,n=t.ownerDocument,r=n.body,s=n.documentElement;try{i=t.getBoundingClientRect()}catch(t){i={left:0,top:0,width:0,height:0}}var a=i.left-(s.clientLeft||r.clientLeft||0),o=i.top-(s.clientTop||r.clientTop||0);if(!e){var h=n.defaultView;a+=h.pageXOffset||s.scrollLeft||r.scrollLeft,o+=h.pageYOffset||s.scrollTop||r.scrollTop}return new f(a,o,i.width,i.height)},getViewportBounds:function(t){var e=t.ownerDocument,i=e.defaultView,n=e.documentElement;return new f(0,0,i.innerWidth||n.clientWidth,i.innerHeight||n.clientHeight)},getOffset:function(t,e){return F.getBounds(t,e).getPoint()},getSize:function(t){return F.getBounds(t,!0).getSize()},isInvisible:function(t){return F.getSize(t).equals(new l(0,0))},isInView:function(t){return!F.isInvisible(t)&&F.getViewportBounds(t).intersects(F.getBounds(t,!0))},getPrefixed:function(e,i){return t(e,i)},setPrefixed:function(e,i,n){if("object"==typeof i)for(var r in i)t(e,r,!0,i[r]);else t(e,i,!0,n)}}},q={add:function(t,e){for(var i in e)for(var n=e[i],r=i.split(/[\s,]+/g),s=0,a=r.length;s<a;s++)t.addEventListener(r[s],n,!1)},remove:function(t,e){for(var i in e)for(var n=e[i],r=i.split(/[\s,]+/g),s=0,a=r.length;s<a;s++)t.removeEventListener(r[s],n,!1)},getPoint:function(t){var e=t.targetTouches?t.targetTouches.length?t.targetTouches[0]:t.changedTouches[0]:t;return new h(e.pageX||e.clientX+document.documentElement.scrollLeft,e.pageY||e.clientY+document.documentElement.scrollTop)},getTarget:function(t){return t.target||t.srcElement},getRelatedTarget:function(t){return t.relatedTarget||t.toElement},getOffset:function(t,e){return q.getPoint(t).subtract(F.getOffset(e||q.getTarget(t)))},stop:function(t){t.stopPropagation(),t.preventDefault()}};q.requestAnimationFrame=new function(){function t(){for(var e=s.length-1;e>=0;e--){var o=s[e],h=o[0],u=o[1];if(!u||("true"==n.getAttribute(u,"keepalive")||a)&&F.isInView(u))s.splice(e,1),h()}if(i)if(s.length)i(t);else r=!1}var e,i=F.getPrefixed(window,"requestAnimationFrame"),r=!1,s=[],a=!0;return q.add(window,{focus:function(){a=!0},blur:function(){a=!1}}),function(n,a){if(s.push([n,a]),i){if(!r)i(t),r=!0}else if(!e)e=setInterval(t,1e3/60)}};var V=e.extend(i,{_class:"View",initialize:function t(e,i){function r(t){return i[t]||parseInt(i.getAttribute(t),10)}function s(){var t=F.getSize(i);return t.isNaN()||t.isZero()?new l(r("width"),r("height")):t}this._project=e,this._scope=e._scope,this._element=i;var a;if(!this._pixelRatio)this._pixelRatio=window.devicePixelRatio||1;if(this._id=i.getAttribute("id"),null==this._id)i.setAttribute("id",this._id="view-"+t._id++);q.add(i,this._viewEvents);var o="none";if(F.setPrefixed(i.style,{userSelect:o,touchAction:o,touchCallout:o,contentZooming:o,userDrag:o,tapHighlightColor:"rgba(0,0,0,0)"}),n.hasAttribute(i,"resize")){var h=this;q.add(window,this._windowEvents={resize:function(){h.setViewSize(s())}})}if(this._setViewSize(a=s()),n.hasAttribute(i,"stats")&&"undefined"!=typeof Stats){this._stats=new Stats;var u=this._stats.domElement,c=u.style,f=F.getOffset(i);c.position="absolute",c.left=f.x+"px",c.top=f.y+"px",document.body.appendChild(u)}if(t._views.push(this),t._viewsById[this._id]=this,this._viewSize=a,(this._matrix=new _)._owner=this,this._zoom=1,!t._focused)t._focused=this;this._frameItems={},this._frameItemCount=0},remove:function(){if(!this._project)return!1;if(V._focused===this)V._focused=null;if(V._views.splice(V._views.indexOf(this),1),delete V._viewsById[this._id],this._project._view===this)this._project._view=null;return q.remove(this._element,this._viewEvents),q.remove(window,this._windowEvents),this._element=this._project=null,this.off("frame"),this._animate=!1,this._frameItems={},!0},_events:e.each(["onResize","onMouseDown","onMouseUp","onMouseMove"],function(t){this[t]={install:function(t){this._installEvent(t)},uninstall:function(t){this._uninstallEvent(t)}}},{onFrame:{install:function(){this.play()},uninstall:function(){this.pause()}}}),_animate:!1,_time:0,_count:0,_requestFrame:function(){var t=this;q.requestAnimationFrame(function(){if(t._requested=!1,t._animate)t._requestFrame(),t._handleFrame()},this._element),this._requested=!0},_handleFrame:function(){paper=this._scope;var t=Date.now()/1e3,i=this._before?t-this._before:0;if(this._before=t,this._handlingFrame=!0,this.emit("frame",new e({delta:i,time:this._time+=i,count:this._count++})),this._stats)this._stats.update();this._handlingFrame=!1,this.update()},_animateItem:function(t,e){var i=this._frameItems;if(e){if(i[t._id]={item:t,time:0,count:0},1==++this._frameItemCount)this.on("frame",this._handleFrameItems)}else if(delete i[t._id],0==--this._frameItemCount)this.off("frame",this._handleFrameItems)},_handleFrameItems:function(t){for(var i in this._frameItems){var n=this._frameItems[i];n.item.emit("frame",new e(t,{time:n.time+=t.delta,count:n.count++}))}},_update:function(){if(this._project._needsUpdate=!0,!this._handlingFrame)if(this._animate)this._handleFrame();else this.update()},_changed:function(t){if(1&t)this._project._needsUpdate=!0},_transform:function(t){this._matrix.concatenate(t),this._bounds=null,this._update()},getElement:function(){return this._element},getPixelRatio:function(){return this._pixelRatio},getResolution:function(){return 72*this._pixelRatio},getViewSize:function(){var t=this._viewSize;return new c(t.width,t.height,this,"setViewSize")},setViewSize:function(){var t=l.read(arguments),e=t.subtract(this._viewSize);if(!e.isZero())this._viewSize.set(t.width,t.height),this._setViewSize(t),this._bounds=null,this.emit("resize",{size:t,delta:e}),this._update()},_setViewSize:function(t){var e=this._element;e.width=t.width,e.height=t.height},getBounds:function(){if(!this._bounds)this._bounds=this._matrix.inverted()._transformBounds(new f(new h,this._viewSize));return this._bounds},getSize:function(){return this.getBounds().getSize()},getCenter:function(){return this.getBounds().getCenter()},setCenter:function(){var t=h.read(arguments);this.scrollBy(t.subtract(this.getCenter()))},getZoom:function(){return this._zoom},setZoom:function(t){this._transform((new _).scale(t/this._zoom,this.getCenter())),this._zoom=t},isVisible:function(){return F.isInView(this._element)},scrollBy:function(){this._transform((new _).translate(h.read(arguments).negate()))},play:function(){if(this._animate=!0,!this._requested)this._requestFrame()},pause:function(){this._animate=!1},draw:function(){this.update()},projectToView:function(){return this._matrix._transformPoint(h.read(arguments))},viewToProject:function(){return this._matrix._inverseTransform(h.read(arguments))}},{statics:{_views:[],_viewsById:{},_id:0,create:function(t,e){if("string"==typeof e)e=document.getElementById(e);return new H(t,e)}}},new function(){function t(t){var e=q.getTarget(t);return e.getAttribute&&V._viewsById[e.getAttribute("id")]}function e(t,e){return t.viewToProject(q.getOffset(e,t._element))}function i(){if(!V._focused||!V._focused.isVisible())for(var t=0,e=V._views.length;t<e;t++){var i=V._views[t];if(i&&i.isVisible()){V._focused=a=i;break}}}function n(t,e,i){t._handleEvent("mousemove",e,i);var n=t._scope.tool;if(n)n._handleEvent(l&&n.responds("mousedrag")?"mousedrag":"mousemove",e,i);return t.update(),n}var r,s,a,o,h,u,l=!1,c=window.navigator;if(c.pointerEnabled||c.msPointerEnabled)o="pointerdown MSPointerDown",h="pointermove MSPointerMove",u="pointerup pointercancel MSPointerUp MSPointerCancel";else if(o="touchstart",h="touchmove",u="touchend touchcancel",!("ontouchstart"in window&&c.userAgent.match(/mobile|tablet|ip(ad|hone|od)|android|silk/i)))o+=" mousedown",h+=" mousemove",u+=" mouseup";var f={"selectstart dragstart":function(t){if(l)t.preventDefault()}},d={mouseout:function(t){var i=V._focused,r=q.getRelatedTarget(t);if(i&&(!r||"HTML"===r.nodeName))n(i,e(i,t),t)},scroll:i};f[o]=function(i){var n=V._focused=t(i),s=e(n,i);if(l=!0,n._handleEvent("mousedown",s,i),r=n._scope.tool)r._handleEvent("mousedown",s,i);n.update()},d[h]=function(o){var h=V._focused;if(!l){var u=t(o);if(u){if(h!==u)n(h,e(h,o),o);s=h,h=V._focused=a=u}else if(a&&a===h)h=V._focused=s,i()}if(h){var c=e(h,o);if(l||h.getBounds().contains(c))r=n(h,c,o)}},d[u]=function(t){var i=V._focused;if(i&&l){var n=e(i,t);if(l=!1,i._handleEvent("mouseup",n,t),r)r._handleEvent("mouseup",n,t);i.update()}},q.add(document,d),q.add(window,{load:i});var _={mousedown:{mousedown:1,mousedrag:1,click:1,doubleclick:1},mouseup:{mouseup:1,mousedrag:1,click:1,doubleclick:1},mousemove:{mousedrag:1,mousemove:1,mouseenter:1,mouseleave:1}};return{_viewEvents:f,_handleEvent:function(){},_installEvent:function(t){var e=this._eventCounters;if(e)for(var i in _)e[i]=(e[i]||0)+(_[i][t]||0)},_uninstallEvent:function(t){var e=this._eventCounters;if(e)for(var i in _)e[i]-=_[i][t]||0},statics:{updateFocus:i}}}),H=V.extend({_class:"CanvasView",initialize:function(t,e){if(!(e instanceof HTMLCanvasElement)){var i=l.read(arguments,1);if(i.isZero())throw new Error("Cannot create CanvasView with the provided argument: "+[].slice.call(arguments,1));e=Y.getCanvas(i)}if(this._context=e.getContext("2d"),this._eventCounters={},this._pixelRatio=1,!/^off|false$/.test(n.getAttribute(e,"hidpi"))){var r=window.devicePixelRatio||1,s=F.getPrefixed(this._context,"backingStorePixelRatio")||1;this._pixelRatio=r/s}V.call(this,t,e)},_setViewSize:function(t){var e=this._element,i=this._pixelRatio,r=t.width,s=t.height;if(e.width=r*i,e.height=s*i,1!==i){if(!n.hasAttribute(e,"resize")){var a=e.style;a.width=r+"px",a.height=s+"px"}this._context.scale(i,i)}},getPixelSize:function(t){var e,i=paper.browser;if(i&&i.firefox){var n=this._element.parentNode,r=document.createElement("div");r.style.fontSize=t,n.appendChild(r),e=parseFloat(F.getStyles(r).fontSize),n.removeChild(r)}else{var s=this._context,a=s.font;s.font=t+" serif",e=parseFloat(s.font),s.font=a}return e},getTextWidth:function(t,e){var i=this._context,n=i.font,r=0;i.font=t;for(var s=0,a=e.length;s<a;s++)r=Math.max(r,i.measureText(e[s]).width);return i.font=n,r},update:function(t){var e=this._project;if(!e||!t&&!e._needsUpdate)return!1;var i=this._context,n=this._viewSize;return i.clearRect(0,0,n.width+1,n.height+1),e.draw(i,this._matrix,this._pixelRatio),e._needsUpdate=!1,!0}},new function(){function t(t,e,i,n,r,s){function a(t){if(t.responds(e)){if(!o)o=new G(e,i,n,r,s?n.subtract(s):null);if(t.emit(e,o)&&o.isStopped)return i.preventDefault(),!0}}for(var o,h=r;h;){if(a(h))return!0;h=h.getParent()}if(a(t))return!0;else return!1}var e,i,n,r,s,a,o,h,u;return{_handleEvent:function(l,c,f){if(this._eventCounters[l]){var d=this._project,_=d.hitTest(c,{tolerance:0,fill:!0,stroke:!0}),g=_&&_.item,v=!1;switch(l){case"mousedown":for(v=t(this,l,f,c,g),h=s==g&&Date.now()-u<300,r=s=g,e=i=n=c,o=!v&&g;o&&!o.responds("mousedrag");)o=o._parent;break;case"mouseup":if(v=t(this,l,f,c,g,e),o){if(i&&!i.equals(c))t(this,"mousedrag",f,c,o,i);if(g!==o)n=c,t(this,"mousemove",f,c,g,n)}if(!v&&g&&g===r)u=Date.now(),t(this,h&&r.responds("doubleclick")?"doubleclick":"click",f,e,g),h=!1;r=o=null;break;case"mousemove":if(o)v=t(this,"mousedrag",f,c,o,i);if(!v){if(g!==a)n=c;v=t(this,l,f,c,g,n)}if(i=n=c,g!==a)t(this,"mouseleave",f,c,a),a=g,t(this,"mouseenter",f,c,g)}return v}}}}),Z=e.extend({_class:"Event",initialize:function(t){this.event=t},isPrevented:!1,isStopped:!1,preventDefault:function(){this.isPrevented=!0,this.event.preventDefault()},stopPropagation:function(){this.isStopped=!0,this.event.stopPropagation()},stop:function(){this.stopPropagation(),this.preventDefault()},getModifiers:function(){return W.modifiers}}),U=Z.extend({_class:"KeyEvent",initialize:function(t,e,i,n){Z.call(this,n),this.type=t?"keydown":"keyup",this.key=e,this.character=i},toString:function(){return"{ type: '"+this.type+"', key: '"+this.key+"', character: '"+this.character+"', modifiers: "+this.getModifiers()+" }"}}),W=new function(){function t(n,s,u,l){var c,f=u?String.fromCharCode(u):"",d=r[s],_=d||f.toLowerCase(),g=n?"keydown":"keyup",v=V._focused,p=v&&v.isVisible()&&v._scope,m=p&&p.tool;if(h[_]=n,n)o[s]=u;else delete o[s];if(d&&(c=e.camelize(d))in a){a[c]=n;var y=paper.browser;if("command"===c&&y&&y.mac)if(n)i={};else{for(var w in i)if(w in o)t(!1,w,i[w],l);i=null}}else if(n&&i)i[s]=u;if(m&&m.responds(g))if(paper=p,m.emit(g,new U(n,_,f,l)),v)v.update()}var i,n,r={8:"backspace",9:"tab",13:"enter",16:"shift",17:"control",18:"option",19:"pause",20:"caps-lock",27:"escape",32:"space",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",46:"delete",91:"command",93:"command",224:"command"},s={9:!0,13:!0,32:!0},a=new e({shift:!1,control:!1,option:!1,command:!1,capsLock:!1,space:!1}),o={},h={};return q.add(document,{keydown:function(e){var i=e.which||e.keyCode;if(i in r||a.command)t(!0,i,i in s||a.command?i:0,e);else n=i},keypress:function(e){if(null!=n)t(!0,n,e.which||e.keyCode,e),n=null},keyup:function(e){var i=e.which||e.keyCode;if(i in o)t(!1,i,o[i],e)}}),q.add(window,{blur:function(e){for(var i in o)t(!1,i,o[i],e)}}),{modifiers:a,isDown:function(t){return!!h[t]}}},G=Z.extend({_class:"MouseEvent",initialize:function(t,e,i,n,r){Z.call(this,e),this.type=t,this.point=i,this.target=n,this.delta=r},toString:function(){return"{ type: '"+this.type+"', point: "+this.point+", target: "+this.target+(this.delta?", delta: "+this.delta:"")+", modifiers: "+this.getModifiers()+" }"}}),$=Z.extend({_class:"ToolEvent",_item:null,initialize:function(t,e,i){this.tool=t,this.type=e,this.event=i},_choosePoint:function(t,e){return t?t:e?e.clone():null},getPoint:function(){return this._choosePoint(this._point,this.tool._point)},setPoint:function(t){this._point=t},getLastPoint:function(){return this._choosePoint(this._lastPoint,this.tool._lastPoint)},setLastPoint:function(t){this._lastPoint=t},getDownPoint:function(){return this._choosePoint(this._downPoint,this.tool._downPoint)},setDownPoint:function(t){this._downPoint=t},getMiddlePoint:function(){if(!this._middlePoint&&this.tool._lastPoint)return this.tool._point.add(this.tool._lastPoint).divide(2);else return this._middlePoint},setMiddlePoint:function(t){this._middlePoint=t},getDelta:function(){return!this._delta&&this.tool._lastPoint?this.tool._point.subtract(this.tool._lastPoint):this._delta},setDelta:function(t){this._delta=t},getCount:function(){return/^mouse(down|up)$/.test(this.type)?this.tool._downCount:this.tool._count},setCount:function(t){this.tool[/^mouse(down|up)$/.test(this.type)?"downCount":"count"]=t},getItem:function(){if(!this._item){var t=this.tool._scope.project.hitTest(this.getPoint());if(t){for(var e=t.item,i=e._parent;/^(Group|CompoundPath)$/.test(i._class);)e=i,i=i._parent;this._item=e}}return this._item},setItem:function(t){this._item=t},toString:function(){return"{ type: "+this.type+", point: "+this.getPoint()+", count: "+this.getCount()+", modifiers: "+this.getModifiers()+" }"}}),X=r.extend({_class:"Tool",_list:"tools",_reference:"tool",_events:["onActivate","onDeactivate","onEditOptions","onMouseDown","onMouseUp","onMouseDrag","onMouseMove","onKeyDown","onKeyUp"],initialize:function(t){r.call(this),this._firstMove=!0,this._count=0,this._downCount=0,this._set(t)},getMinDistance:function(){return this._minDistance},setMinDistance:function(t){if(this._minDistance=t,null!=t&&null!=this._maxDistance&&t>this._maxDistance)this._maxDistance=t},getMaxDistance:function(){return this._maxDistance},setMaxDistance:function(t){if(this._maxDistance=t,null!=this._minDistance&&null!=t&&t<this._minDistance)this._minDistance=t},getFixedDistance:function(){return this._minDistance==this._maxDistance?this._minDistance:null},setFixedDistance:function(t){this._minDistance=this._maxDistance=t},_updateEvent:function(t,e,i,n,r,s,a){if(!r){if(null!=i||null!=n){var o=null!=i?i:0,h=e.subtract(this._point),u=h.getLength();if(u<o)return!1;if(null!=n&&0!=n)if(u>n)e=this._point.add(h.normalize(n));else if(a)return!1}if(s&&e.equals(this._point))return!1}switch(this._lastPoint=r&&"mousemove"==t?e:this._point,this._point=e,t){case"mousedown":this._lastPoint=this._downPoint,this._downPoint=this._point,this._downCount++;break;case"mouseup":this._lastPoint=this._downPoint}return this._count=r?0:this._count+1,!0},_fireEvent:function(t,e){var i=paper.project._removeSets;if(i){if("mouseup"===t)i.mousedrag=null;var n=i[t];if(n){for(var r in n){var s=n[r];for(var a in i){var o=i[a];if(o&&o!=n)delete o[s._id]}s.remove()}i[t]=null}}return this.responds(t)&&this.emit(t,new $(this,t,e))},_handleEvent:function(t,e,i){paper=this._scope;var n=!1;switch(t){case"mousedown":this._updateEvent(t,e,null,null,!0,!1,!1),n=this._fireEvent(t,i);break;case"mousedrag":for(var r=!1,s=!1;this._updateEvent(t,e,this.minDistance,this.maxDistance,!1,r,s);)n=this._fireEvent(t,i)||n,r=!0,s=!0;break;case"mouseup":if(!e.equals(this._point)&&this._updateEvent("mousedrag",e,this.minDistance,this.maxDistance,!1,!1,!1))n=this._fireEvent("mousedrag",i);this._updateEvent(t,e,null,this.maxDistance,!1,!1,!1),n=this._fireEvent(t,i)||n,this._updateEvent(t,e,null,null,!0,!1,!1),this._firstMove=!0;break;case"mousemove":for(;this._updateEvent(t,e,this.minDistance,this.maxDistance,this._firstMove,!0,!1);)n=this._fireEvent(t,i)||n,this._firstMove=!1}if(n)i.preventDefault();return n}}),J={request:function(e,i,n,r){r=r===t?!0:r;var s=new(window.ActiveXObject||XMLHttpRequest)("Microsoft.XMLHTTP");if(s.open(e.toUpperCase(),i,r),"overrideMimeType"in s)s.overrideMimeType("text/plain");return s.onreadystatechange=function(){if(4===s.readyState){var t=s.status;if(0===t||200===t)n.call(s,s.responseText);else throw new Error("Could not load "+i+" (Error "+t+")")}},s.send(null)}},Y={canvases:[],getCanvas:function(t,e){var i,n=!0;if("object"==typeof t)e=t.height,t=t.width;if(this.canvases.length)i=this.canvases.pop();else i=document.createElement("canvas");var r=i.getContext("2d");if(i.width===t&&i.height===e){if(n)r.clearRect(0,0,t+1,e+1)}else i.width=t,i.height=e;return r.save(),i},getContext:function(t,e){return this.getCanvas(t,e).getContext("2d")},release:function(t){var e=t.canvas?t.canvas:t;e.getContext("2d").restore(),this.canvases.push(e)}},K=new function(){function t(t,e,i){return.2989*t+.587*e+.114*i}function i(e,i,n,r){var s=r-t(e,i,n);d=e+s,_=i+s,g=n+s;var r=t(d,_,g),a=v(d,_,g),o=p(d,_,g);if(a<0){var h=r-a;d=r+(d-r)*r/h,_=r+(_-r)*r/h,g=r+(g-r)*r/h}if(o>255){var u=255-r,l=o-r;d=r+(d-r)*u/l,_=r+(_-r)*u/l,g=r+(g-r)*u/l}}function n(t,e,i){return p(t,e,i)-v(t,e,i)}function r(t,e,i,n){var r,s=[t,e,i],a=p(t,e,i),o=v(t,e,i);if(o=o===t?0:o===e?1:2,a=a===t?0:a===e?1:2,r=0===v(o,a)?1===p(o,a)?2:1:0,s[a]>s[o])s[r]=(s[r]-s[o])*n/(s[a]-s[o]),s[a]=n;else s[r]=s[a]=0;s[o]=0,d=s[0],_=s[1],g=s[2]}var s,a,o,h,u,l,c,f,d,_,g,v=Math.min,p=Math.max,m=Math.abs,y={multiply:function(){d=u*s/255,_=l*a/255,g=c*o/255},screen:function(){d=u+s-u*s/255,_=l+a-l*a/255,g=c+o-c*o/255},overlay:function(){d=u<128?2*u*s/255:255-2*(255-u)*(255-s)/255,_=l<128?2*l*a/255:255-2*(255-l)*(255-a)/255,g=c<128?2*c*o/255:255-2*(255-c)*(255-o)/255},"soft-light":function(){var t=s*u/255;d=t+u*(255-(255-u)*(255-s)/255-t)/255,t=a*l/255,_=t+l*(255-(255-l)*(255-a)/255-t)/255,t=o*c/255,g=t+c*(255-(255-c)*(255-o)/255-t)/255},"hard-light":function(){d=s<128?2*s*u/255:255-2*(255-s)*(255-u)/255,_=a<128?2*a*l/255:255-2*(255-a)*(255-l)/255,g=o<128?2*o*c/255:255-2*(255-o)*(255-c)/255},"color-dodge":function(){d=0===u?0:255===s?255:v(255,255*u/(255-s)),_=0===l?0:255===a?255:v(255,255*l/(255-a)),g=0===c?0:255===o?255:v(255,255*c/(255-o))},"color-burn":function(){d=255===u?255:0===s?0:p(0,255-255*(255-u)/s),_=255===l?255:0===a?0:p(0,255-255*(255-l)/a),g=255===c?255:0===o?0:p(0,255-255*(255-c)/o)},darken:function(){d=u<s?u:s,_=l<a?l:a,g=c<o?c:o},lighten:function(){d=u>s?u:s,_=l>a?l:a,g=c>o?c:o},difference:function(){if((d=u-s)<0)d=-d;if((_=l-a)<0)_=-_;if((g=c-o)<0)g=-g},exclusion:function(){d=u+s*(255-u-u)/255,_=l+a*(255-l-l)/255,g=c+o*(255-c-c)/255},hue:function(){r(s,a,o,n(u,l,c)),i(d,_,g,t(u,l,c))},saturation:function(){r(u,l,c,n(s,a,o)),i(d,_,g,t(u,l,c))},luminosity:function(){i(u,l,c,t(s,a,o))},color:function(){i(s,a,o,t(u,l,c))},add:function(){d=v(u+s,255),_=v(l+a,255),g=v(c+o,255)},subtract:function(){d=p(u-s,0),_=p(l-a,0),g=p(c-o,0)},average:function(){d=(u+s)/2,_=(l+a)/2,g=(c+o)/2},negation:function(){d=255-m(255-s-u),_=255-m(255-a-l),g=255-m(255-o-c)}},w=this.nativeModes=e.each(["source-over","source-in","source-out","source-atop","destination-over","destination-in","destination-out","destination-atop","lighter","darker","copy","xor"],function(t){this[t]=!0},{}),x=Y.getContext(1,1);e.each(y,function(t,e){var i="darken"===e,n=!1;x.save();try{if(x.fillStyle=i?"#300":"#a00",x.fillRect(0,0,1,1),x.globalCompositeOperation=e,x.globalCompositeOperation===e)x.fillStyle=i?"#a00":"#300",x.fillRect(0,0,1,1),n=x.getImageData(0,0,1,1).data[0]!==i?170:51}catch(t){}x.restore(),w[e]=n}),Y.release(x),this.process=function(t,e,i,n,r){var v=e.canvas,p="normal"===t;if(p||w[t]){if(i.save(),i.setTransform(1,0,0,1,0,0),i.globalAlpha=n,!p)i.globalCompositeOperation=t;i.drawImage(v,r.x,r.y),i.restore()}else{var m=y[t];if(!m)return;for(var x=i.getImageData(r.x,r.y,v.width,v.height),b=x.data,C=e.getImageData(0,0,v.width,v.height).data,S=0,P=b.length;S<P;S+=4){s=C[S],u=b[S],a=C[S+1],l=b[S+1],o=C[S+2],c=b[S+2],h=C[S+3],f=b[S+3],m();var k=h*n/255,I=1-k;b[S]=k*d+I*u,b[S+1]=k*_+I*l,b[S+2]=k*g+I*c,b[S+3]=h*n+I*f}i.putImageData(x,r.x,r.y)}}},Q=e.each({fillColor:["fill","color"],strokeColor:["stroke","color"],strokeWidth:["stroke-width","number"],strokeCap:["stroke-linecap","string"],strokeJoin:["stroke-linejoin","string"],strokeScaling:["vector-effect","lookup",{true:"none",false:"non-scaling-stroke"},function(t,e){return!e&&(t instanceof z||t instanceof x||t instanceof L)}],miterLimit:["stroke-miterlimit","number"],dashArray:["stroke-dasharray","array"],dashOffset:["stroke-dashoffset","number"],fontFamily:["font-family","string"],fontWeight:["font-weight","string"],fontSize:["font-size","number"],justification:["text-anchor","lookup",{left:"start",center:"middle",right:"end"}],opacity:["opacity","number"],blendMode:["mix-blend-mode","string"]},function(t,i){var n=e.capitalize(i),r=t[2];this[i]={type:t[1],property:i,attribute:t[0],toSVG:r,fromSVG:r&&e.each(r,function(t,e){this[t]=e},{}),exportFilter:t[3],get:"get"+n,set:"set"+n}},{}),tt={href:"http://www.w3.org/1999/xlink",xlink:"http://www.w3.org/2000/xmlns"};if(new function(){function t(t,e){for(var i in e){var n=e[i],r=tt[i];if("number"==typeof n)n=b.number(n);if(r)t.setAttributeNS(r,i,n);else t.setAttribute(i,n)}return t}function i(e,i){return t(document.createElementNS("http://www.w3.org/2000/svg",e),i)}function n(t,i,n){var r=new e,s=t.getTranslation();if(i){t=t.shiftless();var o=t._inverseTransform(s);r[n?"cx":"x"]=o.x,r[n?"cy":"y"]=o.y,s=null}if(!t.isIdentity()){var h=t.decompose();if(h&&!h.shearing){var u=[],l=h.rotation,c=h.scaling;if(s&&!s.isZero())u.push("translate("+b.point(s)+")");if(!a.isZero(c.x-1)||!a.isZero(c.y-1))u.push("scale("+b.point(c)+")");if(l)u.push("rotate("+b.number(l)+")");r.transform=u.join(" ")}else r.transform="matrix("+t.getValues().join(",")+")"}return r}function r(e,r){for(var s=n(e._matrix),a=e._children,o=i("g",s),h=0,u=a.length;h<u;h++){var l=a[h],c=w(l,r);if(c)if(l.isClipMask()){var f=i("clipPath");f.appendChild(c),p(l,f,"clip"),t(o,{"clip-path":"url(#"+f.id+")"})}else o.appendChild(c)}return o}function o(t,e){var r=n(t._matrix,!0),s=t.getSize(),a=t.getImage();return r.x-=s.width/2,r.y-=s.height/2,r.width=s.width,r.height=s.height,r.href=!1===e.embedImages&&a&&a.src||t.toDataURL(),i("image",r)}function h(t,e){var r=e.matchShapes;if(r){var s=t.toShape(!1);if(s)return u(s,e)}var a,o=t._segments,h=n(t._matrix);if(0===o.length)return null;if(r&&!t.hasHandles())if(o.length>=3){a=t._closed?"polygon":"polyline";for(var l=[],c=0,f=o.length;c<f;c++)l.push(b.point(o[c]._point));h.points=l.join(" ")}else{a="line";var d=o[0]._point,_=o[o.length-1]._point;h.set({x1:d.x,y1:d.y,x2:_.x,y2:_.y})}else a="path",h.d=t.getPathData(null,e.precision);return i(a,h)}function u(t){var e=t._type,r=t._radius,s=n(t._matrix,!0,"rectangle"!==e);if("rectangle"===e){e="rect";var a=t._size,o=a.width,h=a.height;if(s.x-=o/2,s.y-=h/2,s.width=o,s.height=h,r.isZero())r=null}if(r)if("circle"===e)s.r=r;else s.rx=r.width,s.ry=r.height;return i(e,s)}function l(t,e){var r=n(t._matrix),s=t.getPathData(null,e.precision);if(s)r.d=s;return i("path",r)}function c(t,e){var r=n(t._matrix,!0),s=t.getSymbol(),a=g(s,"symbol"),o=s.getDefinition(),h=o.getBounds();if(!a)a=i("symbol",{viewBox:b.rectangle(h)}),a.appendChild(w(o,e)),p(s,a,"symbol");return r.href="#"+a.id,r.x+=h.x,r.y+=h.y,r.width=b.number(h.width),r.height=b.number(h.height),r.overflow="visible",i("use",r)}function f(t){var e=g(t,"color");if(!e){var n,r=t.getGradient(),s=r._radial,a=t.getOrigin().transform(),o=t.getDestination().transform();if(s){n={cx:a.x,cy:a.y,r:a.getDistance(o)};var h=t.getHighlight();if(h)h=h.transform(),n.fx=h.x,n.fy=h.y}else n={x1:a.x,y1:a.y,x2:o.x,y2:o.y};n.gradientUnits="userSpaceOnUse",e=i((s?"radial":"linear")+"Gradient",n);for(var u=r._stops,l=0,c=u.length;l<c;l++){var f=u[l],d=f._color,_=d.getAlpha();if(n={offset:f._rampPoint,"stop-color":d.toCSS(!0)},_<1)n["stop-opacity"]=_;e.appendChild(i("stop",n))}p(t,e,"color")}return"url(#"+e.id+")"}function d(t){var e=i("text",n(t._matrix,!0));return e.textContent=t._content,e}function _(i,n,r){var s={},a=!r&&i.getParent();if(null!=i._name)s.id=i._name;if(e.each(Q,function(t){var n=t.get,r=t.type,o=i[n]();if(t.exportFilter?t.exportFilter(i,o):!a||!e.equals(a[n](),o)){if("color"===r&&null!=o){var h=o.getAlpha();if(h<1)s[t.attribute+"-opacity"]=h}s[t.attribute]=null==o?"none":"number"===r?b.number(o):"color"===r?o.gradient?f(o,i):o.toCSS(!0):"array"===r?o.join(","):"lookup"===r?t.toSVG[o]:o}}),1===s.opacity)delete s.opacity;if(!i._visible)s.visibility="hidden";return t(n,s)}function g(t,e){if(!C)C={ids:{},svgs:{}};return t&&C.svgs[e+"-"+t._id]}function p(t,e,i){if(!C)g();var n=C.ids[i]=(C.ids[i]||0)+1;e.id=i+"-"+n,C.svgs[i+"-"+t._id]=e}function y(t,e){var n=t,r=null;if(C){n="svg"===t.nodeName.toLowerCase()&&t;for(var s in C.svgs){if(!r){if(!n)n=i("svg"),n.appendChild(t);r=n.insertBefore(i("defs"),n.firstChild)}r.appendChild(C.svgs[s])}C=null}return e.asString?(new XMLSerializer).serializeToString(n):n}function w(t,e,i){var n=S[t._class],r=n&&n(t,e);if(r){var s=e.onExport;if(s)r=s(t,r,e)||r;var a=JSON.stringify(t._data);if(a&&"{}"!==a&&"null"!==a)r.setAttribute("data-paper-data",a)}return r&&_(t,r,i)}function x(t){if(!t)t={};return b=new s(t.precision),t}var b,C,S={Group:r,Layer:r,Raster:o,Path:h,Shape:u,CompoundPath:l,PlacedSymbol:c,PointText:d};m.inject({exportSVG:function(t){return t=x(t),y(w(this,t,!0),t)}}),v.inject({exportSVG:function(t){t=x(t);var e=this.layers,r=this.getView(),s=r.getViewSize(),a=i("svg",{x:0,y:0,width:s.width,height:s.height,version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"}),o=a,h=r._matrix;if(!h.isIdentity())o=a.appendChild(i("g",n(h)));for(var u=0,l=e.length;u<l;u++)o.appendChild(w(e[u],t,!0));return y(a,t)}})},new function(){function i(t,e,i,n){var r=tt[e],s=r?t.getAttributeNS(r,e):t.getAttribute(e);if("null"===s)s=null;return null==s?n?null:i?"":0:i?s:parseFloat(s)}function n(t,e,n,r){return e=i(t,e,!1,r),n=i(t,n,!1,r),r&&(null==e||null==n)?null:new h(e,n)}function r(t,e,n,r){return e=i(t,e,!1,r),n=i(t,n,!1,r),r&&(null==e||null==n)?null:new l(e,n)}function s(t,e,i){return"none"===t?null:"number"===e?parseFloat(t):"array"===e?t?t.split(/[\s,]+/g).map(parseFloat):[]:"color"===e?S(t)||t:"lookup"===e?i[t]:t}function a(t,e,i,n){var r=t.childNodes,s="clippath"===e,a=new y,o=a._project,h=o._currentStyle,u=[];if(!s)a=C(a,t,n),o._currentStyle=a._style.clone();if(n)for(var l=t.querySelectorAll("defs"),c=0,f=l.length;c<f;c++)P(l[c],i,!1);for(var c=0,f=r.length;c<f;c++){var d,_=r[c];if(1===_.nodeType&&"defs"!==_.nodeName.toLowerCase()&&(d=P(_,i,!1))&&!(d instanceof p))u.push(d)}if(a.addChildren(u),s)a=C(a.reduce(),t,n);if(o._currentStyle=h,s||"defs"===e)a.remove(),a=null;return a}function o(t,e){for(var i=t.getAttribute("points").match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g),n=[],r=0,s=i.length;r<s;r+=2)n.push(new h(parseFloat(i[r]),parseFloat(i[r+1])));var a=new A(n);if("polygon"===e)a.closePath();return a}function u(t){var e=t.getAttribute("d"),i={pathData:e};return(e.match(/m/gi)||[]).length>1||/z\S+/i.test(e)?new O(i):new A(i)}function c(t,e){var r,s=(i(t,"href",!0)||"").substring(1),a="radialgradient"===e;if(s)r=M[s].getGradient();else{for(var o=t.childNodes,h=[],u=0,l=o.length;u<l;u++){var c=o[u];if(1===c.nodeType)h.push(C(new R,c))}r=new B(h,a)}var f,d,_;if(a)f=n(t,"cx","cy"),d=f.add(i(t,"r"),0),_=n(t,"fx","fy",!0);else f=n(t,"x1","y1"),d=n(t,"x2","y2");return C(new j(r,f,d,_),t),null}function d(t,e,i,n){for(var r=(n.getAttribute(i)||"").split(/\)\s*/g),s=new _,a=0,o=r.length;a<o;a++){var h=r[a];if(!h)break;for(var u=h.split(/\(\s*/),l=u[0],c=u[1].split(/[\s,]+/g),f=0,d=c.length;f<d;f++)c[f]=parseFloat(c[f]);switch(l){case"matrix":s.concatenate(new _(c[0],c[1],c[2],c[3],c[4],c[5]));break;case"rotate":s.rotate(c[0],c[1],c[2]);break;case"translate":s.translate(c[0],c[1]);break;case"scale":s.scale(c);break;case"skewX":s.skew(c[0],0);break;case"skewY":s.skew(0,c[0])}}t.transform(s)}function g(t,e,i){var n=t["fill-opacity"===i?"getFillColor":"getStrokeColor"]();if(n)n.setAlpha(parseFloat(e))}function w(i,n,r){var s=i.attributes[n],a=s&&s.value;if(!a){var o=e.camelize(n);if(!(a=i.style[o])&&r.node[o]!==r.parent[o])a=r.node[o]}return!a?t:"none"===a?null:a}function C(i,n,r){var s={node:F.getStyles(n)||{},parent:!r&&F.getStyles(n.parentNode)||{}};return e.each(I,function(r,a){var o=w(n,a,s);if(o!==t)i=e.pick(r(i,o,a,n,s),i)}),i}function S(t){var e=t&&t.match(/\((?:#|)([^)']+)/);return e&&M[e[1]]}function P(t,i,n){function r(t){paper=a;var e=P(t,i,n),r=i.onLoad,s=a.project&&a.getView();if(r)r.call(this,e);s.update()}if(!t)return null;if(!i)i={};else if("function"==typeof i)i={onLoad:i};var s=t,a=paper;if(n)if("string"==typeof t&&!/^.*</.test(t))if(s=document.getElementById(t))t=null;else return J.request("get",t,r);else if("undefined"!=typeof File&&t instanceof File){var o=new FileReader;return o.onload=function(){r(o.result)},o.readAsText(t)}if("string"==typeof t)s=(new DOMParser).parseFromString(t,"image/svg+xml");if(!s.nodeName)throw new Error("Unsupported SVG source: "+t);var h,u=s.nodeName.toLowerCase(),l=k[u],c=s.getAttribute&&s.getAttribute("data-paper-data"),f=a.settings,d=f.applyMatrix;if(f.applyMatrix=!1,h=l&&l(s,u,i,n)||null,f.applyMatrix=d,h){if("#document"!==u&&!(h instanceof y))h=C(h,s,n);var _=i.onImport;if(_)h=_(s,h,i)||h;if(i.expandShapes&&h instanceof x)h.remove(),h=h.toPath();if(c)h._data=JSON.parse(c)}if(n)if(M={},h&&e.pick(i.applyMatrix,d))h.matrix.apply(!0,!0);return h}var k={"#document":function(t,e,i,n){for(var r=t.childNodes,s=0,a=r.length;s<a;s++){var o=r[s];if(1===o.nodeType){var h=o.nextSibling;document.body.appendChild(o);var u=P(o,i,n);if(h)t.insertBefore(o,h);else t.appendChild(o);return u}}},g:a,svg:a,clippath:a,polygon:o,polyline:o,path:u,lineargradient:c,radialgradient:c,image:function(t){var e=new b(i(t,"href",!0));return e.on("load",function(){var e=r(t,"width","height");this.setSize(e);var i=this._matrix._transformPoint(n(t,"x","y").add(e.divide(2)));this.translate(i)}),e},symbol:function(t,e,i,n){return new p(a(t,e,i,n),!0)},defs:a,use:function(t){var e=(i(t,"href",!0)||"").substring(1),r=M[e],s=n(t,"x","y");return r?r instanceof p?r.place(s):r.clone().translate(s):null},circle:function(t){return new x.Circle(n(t,"cx","cy"),i(t,"r"))},ellipse:function(t){return new x.Ellipse({center:n(t,"cx","cy"),radius:r(t,"rx","ry")})},rect:function(t){var e=n(t,"x","y"),i=r(t,"width","height"),s=r(t,"rx","ry");return new x.Rectangle(new f(e,i),s)},line:function(t){return new A.Line(n(t,"x1","y1"),n(t,"x2","y2"))},text:function(t){var e=new N(n(t,"x","y").add(n(t,"dx","dy")));return e.setContent(t.textContent.trim()||""),e}},I=e.set(e.each(Q,function(t){this[t.attribute]=function(e,i){if(e[t.set](s(i,t.type,t.fromSVG)),"color"===t.type&&e instanceof x){var n=e[t.get]();if(n)n.transform((new _).translate(e.getPosition(!0).negate()))}}},{}),{id:function(t,e){if(M[e]=t,t.setName)t.setName(e)},"clip-path":function(t,e){var i=S(e);if(i)if(i=i.clone(),i.setClipMask(!0),t instanceof y)t.insertChild(0,i);else return new y(i,t)},gradientTransform:d,transform:d,"fill-opacity":g,"stroke-opacity":g,visibility:function(t,e){t.setVisible("visible"===e)},display:function(t,e){t.setVisible(null!==e)},"stop-color":function(t,e){if(t.setColor)t.setColor(e)},"stop-opacity":function(t,e){if(t._color)t._color.setAlpha(parseFloat(e))},offset:function(t,e){var i=e.match(/(.*)%$/);t.setRampPoint(i?i[1]/100:parseFloat(e))},viewBox:function(t,e,i,n,a){var o=new f(s(e,"array")),h=r(n,"width","height",!0);if(t instanceof y){var u=h?o.getSize().divide(h):1,l=(new _).translate(o.getPoint()).scale(u);t.transform(l.inverted())}else if(t instanceof p){if(h)o.setSize(h);var c="visible"!=w(n,"overflow",a),d=t._definition;if(c&&!o.contains(d.getBounds()))c=new x.Rectangle(o).transform(d._matrix),c.setClipMask(!0),d.addChild(c)}}}),M={};m.inject({importSVG:function(t,e){return this.addChild(P(t,e,!0))}}),v.inject({importSVG:function(t,e){return this.activate(),P(t,e,!0)}})},e.exports.PaperScript=function(){function t(t,e,i){var n=_[e];if(t&&t[n]){var r=t[n](i);return"!="===e?!r:r}switch(e){case"+":return t+i;case"-":return t-i;case"*":return t*i;case"/":return t/i;case"%":return t%i;case"==":return t==i;case"!=":return t!=i}}function i(t,e){var i=g[t];if(i&&e&&e[i])return e[i]();switch(t){case"+":return+e;case"-":return-e}}function r(t,e){return d.acorn.parse(t,e)}function s(t,e,i){function n(t){for(var e=0,i=u.length;e<i;e++){var n=u[e];if(n[0]>=t)break;t+=n[1]}return t}function s(e){return t.substring(n(e.range[0]),n(e.range[1]))}function a(e,i){return t.substring(n(e.range[1]),n(i.range[0]))}function o(e,i){for(var r=n(e.range[0]),s=n(e.range[1]),a=0,o=u.length-1;o>=0;o--)if(r>u[o][0]){a=o+1;break}u.splice(a,0,[r,i.length-s+r]),t=t.substring(0,r)+i+t.substring(s)}function h(t,e){if(t){for(var i in t)if("range"!==i&&"loc"!==i){var n=t[i];if(Array.isArray(n))for(var r=0,u=n.length;r<u;r++)h(n[r],t);else if(n&&"object"==typeof n)h(n,t)}switch(t.type){case"UnaryExpression":if(t.operator in g&&"Literal"!==t.argument.type){var l=s(t.argument);o(t,'$__("'+t.operator+'", '+l+")")}break;case"BinaryExpression":if(t.operator in _&&"Literal"!==t.left.type){var c=s(t.left),f=s(t.right),d=a(t.left,t.right),v=t.operator;o(t,"__$__("+c+","+d.replace(new RegExp("\\"+v),'"'+v+'"')+", "+f+")")}break;case"UpdateExpression":case"AssignmentExpression":var p=e&&e.type;if(!("ForStatement"===p||"BinaryExpression"===p&&/^[=!<>]/.test(e.operator)||"MemberExpression"===p&&e.computed))if("UpdateExpression"===t.type){var l=s(t.argument),m="__$__("+l+', "'+t.operator[0]+'", 1)',y=l+" = "+m;if(!t.prefix&&("AssignmentExpression"===p||"VariableDeclarator"===p)){if(s(e.left||e.id)===l)y=m;y=l+"; "+y}o(t,y)}else if(/^.=$/.test(t.operator)&&"Literal"!==t.left.type){var c=s(t.left),f=s(t.right);o(t,c+" = __$__("+c+', "'+t.operator[0]+'", '+f+")")}}}}if(!t)return"";i=i||{},e=e||"";var u=[],l=null,c=paper.browser,f=c.versionNumber,d=/\r\n|\n|\r/gm;if(c.chrome&&f>=30||c.webkit&&f>=537.76||c.firefox&&f>=23){var v=0;if(0===window.location.href.indexOf(e)){var p=document.getElementsByTagName("html")[0].innerHTML;v=p.substr(0,p.indexOf(t)+1).match(d).length+1}var m=["AAAA"];m.length=(t.match(d)||[]).length+1+v,l={version:3,file:e,names:[],mappings:m.join(";AACA"),sourceRoot:"",sources:[e]};var y=i.source||!e&&t;if(y)l.sourcesContent=[y]}if(h(r(t,{ranges:!0})),l)t=new Array(v+1).join("\n")+t+"\n//# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(l))))+"\n//# sourceURL="+(e||"paperscript");return t}function a(n,r,a,o){function u(t,e){for(var i in t)if((e||!/^_/.test(i))&&new RegExp("([\\b\\s\\W]|^)"+i.replace(/\$/g,"\\$")+"\\b").test(n))g.push(i),v.push(t[i])}paper=r;var l,c=r.getView(),f=/\s+on(?:Key|Mouse)(?:Up|Down|Move|Drag)\b/.test(n)?new X:null,d=f?f._events:[],_=["onFrame","onResize"].concat(d),g=[],v=[];if(n=s(n,a,o),u({__$__:t,$__:i,paper:r,view:c,tool:f},!0),u(r),_=e.each(_,function(t){if(new RegExp("\\s+"+t+"\\b").test(n))g.push(t),this.push(t+": "+t)},[]).join(", "))n+="\nreturn { "+_+" };";var p=paper.browser;if(p.chrome||p.firefox){var m=document.createElement("script"),y=document.head||document.getElementsByTagName("head")[0];if(p.firefox)n="\n"+n;m.appendChild(document.createTextNode("paper._execute = function("+g+") {"+n+"\n}")),y.appendChild(m),l=paper._execute,delete paper._execute,y.removeChild(m)}else l=Function(g,n);var w=l.apply(r,v)||{};if(e.each(d,function(t){var e=w[t];if(e)f[t]=e}),c){if(w.onResize)c.setOnResize(w.onResize);if(c.emit("resize",{size:c.size,delta:new h}),w.onFrame)c.setOnFrame(w.onFrame);c.update()}}function o(t){if(/^text\/(?:x-|)paperscript$/.test(t.type)&&"true"!==n.getAttribute(t,"ignore")){var e=n.getAttribute(t,"canvas"),i=document.getElementById(e),r=t.src||t.getAttribute("data-src"),s=n.hasAttribute(t,"async"),o="data-paper-scope";if(!i)throw new Error('Unable to find canvas with id "'+e+'"');var h=n.get(i.getAttribute(o))||(new n).setup(i);if(i.setAttribute(o,h._id),r)J.request("get",r,function(t){a(t,h,r)},s);else a(t.innerHTML,h,t.baseURI);return t.setAttribute("data-paper-ignore","true"),h}}function u(){e.each(document.getElementsByTagName("script"),o)}function c(t){return t?o(t):u()}var exports,f,d=this;!function(t,e){"object"==typeof exports&&"object"==typeof module?e(exports):"function"==typeof f&&f.amd?f(["exports"],e):e(t.acorn||(t.acorn={}))}(this,function(t){"use strict";function e(t){ct=t||{};for(var e in gt)Object.prototype.hasOwnProperty.call(ct,e)||(ct[e]=gt[e]);_t=ct.sourceFile||null}function i(t,e){var i=vt(ft,t);e+=" ("+i.line+":"+i.column+")";var n=new SyntaxError(e);throw n.pos=t,n.loc=i,n.raisedAt=pt,n}function n(t){function e(t){if(1==t.length)return i+="return str === "+JSON.stringify(t[0])+";";i+="switch(str){";for(var e=0;e<t.length;++e)i+="case "+JSON.stringify(t[e])+":";i+="return true}return false;"}t=t.split(" ");var i="",n=[];t:for(var r=0;r<t.length;++r){for(var s=0;s<n.length;++s)if(n[s][0].length==t[r].length){n[s].push(t[r]);continue t}n.push([t[r]])}if(n.length>3){n.sort(function(t,e){return e.length-t.length}),i+="switch(str.length){";for(var r=0;r<n.length;++r){var a=n[r];i+="case "+a[0].length+":",e(a)}i+="}"}else e(t);return new Function("str",i)}function r(){this.line=Pt,this.column=pt-kt}function s(){Pt=1,pt=kt=0,St=!0,u()}function a(t,e){yt=pt,ct.locations&&(xt=new r),bt=t,u(),Ct=e,St=t.beforeExpr}function o(){var t=ct.onComment&&ct.locations&&new r,e=pt,n=ft.indexOf("*/",pt+=2);if(-1===n&&i(pt-2,"Unterminated comment"),pt=n+2,ct.locations){Je.lastIndex=e;for(var s;(s=Je.exec(ft))&&s.index<pt;)++Pt,kt=s.index+s[0].length}ct.onComment&&ct.onComment(!0,ft.slice(e+2,n),e,pt,t,ct.locations&&new r)}function h(){for(var t=pt,e=ct.onComment&&ct.locations&&new r,i=ft.charCodeAt(pt+=2);dt>pt&&10!==i&&13!==i&&8232!==i&&8233!==i;)++pt,i=ft.charCodeAt(pt);ct.onComment&&ct.onComment(!1,ft.slice(t+2,pt),t,pt,e,ct.locations&&new r)}function u(){for(;dt>pt;){var t=ft.charCodeAt(pt);if(32===t)++pt;else if(13===t){++pt;var e=ft.charCodeAt(pt);10===e&&++pt,ct.locations&&(++Pt,kt=pt)}else if(10===t||8232===t||8233===t)++pt,ct.locations&&(++Pt,kt=pt);else if(t>8&&14>t)++pt;else if(47===t){var e=ft.charCodeAt(pt+1);if(42===e)o();else{if(47!==e)break;h()}}else if(160===t)++pt;else{if(!(t>=5760&&Ze.test(String.fromCharCode(t))))break;++pt}}}function l(){var t=ft.charCodeAt(pt+1);return t>=48&&57>=t?S(!0):(++pt,a(we))}function c(){var t=ft.charCodeAt(pt+1);return St?(++pt,x()):61===t?w(Se,2):w(be,1)}function f(){return 61===ft.charCodeAt(pt+1)?w(Se,2):w(je,1)}function d(t){var e=ft.charCodeAt(pt+1);return e===t?w(124===t?Me:ze,2):61===e?w(Se,2):w(124===t?Ae:Te,1)}function _(){return 61===ft.charCodeAt(pt+1)?w(Se,2):w(Oe,1)}function g(t){var e=ft.charCodeAt(pt+1);return e===t?45==e&&62==ft.charCodeAt(pt+2)&&Xe.test(ft.slice(Mt,pt))?(pt+=3,h(),u(),y()):w(ke,2):61===e?w(Se,2):w(Pe,1)}function v(t){var e=ft.charCodeAt(pt+1),i=1;return e===t?(i=62===t&&62===ft.charCodeAt(pt+2)?3:2,61===ft.charCodeAt(pt+i)?w(Se,i+1):w(Ne,i)):33==e&&60==t&&45==ft.charCodeAt(pt+2)&&45==ft.charCodeAt(pt+3)?(pt+=4,h(),u(),y()):(61===e&&(i=61===ft.charCodeAt(pt+2)?3:2),w(Le,i))}function p(t){return 61===ft.charCodeAt(pt+1)?w(Ee,61===ft.charCodeAt(pt+2)?3:2):w(61===t?Ce:Ie,1)}function m(t){switch(t){case 46:return l();case 40:return++pt,a(ge);case 41:return++pt,a(ve);case 59:return++pt,a(me);case 44:return++pt,a(pe);case 91:return++pt,a(ce);case 93:return++pt,a(fe);case 123:return++pt,a(de);case 125:return++pt,a(_e);case 58:return++pt,a(ye);case 63:return++pt,a(xe);case 48:var e=ft.charCodeAt(pt+1);if(120===e||88===e)return C();case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return S(!1);case 34:case 39:return P(t);case 47:return c(t);case 37:case 42:return f();case 124:case 38:return d(t);case 94:return _();case 43:case 45:return g(t);case 60:case 62:return v(t);case 61:case 33:return p(t);case 126:return w(Ie,1)}return!1}function y(t){if(t?pt=mt+1:mt=pt,ct.locations&&(wt=new r),t)return x();if(pt>=dt)return a(Rt);var e=ft.charCodeAt(pt);if(Ye(e)||92===e)return M();var n=m(e);if(!1===n){var s=String.fromCharCode(e);if("\\"===s||Ge.test(s))return M();i(pt,"Unexpected character '"+s+"'")}return n}function w(t,e){var i=ft.slice(pt,pt+e);pt+=e,a(t,i)}function x(){for(var t,e,n="",r=pt;;){pt>=dt&&i(r,"Unterminated regular expression");var s=ft.charAt(pt);if(Xe.test(s)&&i(r,"Unterminated regular expression"),t)t=!1;else{if("["===s)e=!0;else if("]"===s&&e)e=!1;else if("/"===s&&!e)break;t="\\"===s}++pt}var n=ft.slice(r,pt);++pt;var o=I();return o&&!/^[gmsiy]*$/.test(o)&&i(r,"Invalid regexp flag"),a(Nt,new RegExp(n,o))}function b(t,e){for(var i=pt,n=0,r=0,s=null==e?1/0:e;s>r;++r){var a,o=ft.charCodeAt(pt);if((a=o>=97?o-97+10:o>=65?o-65+10:o>=48&&57>=o?o-48:1/0)>=t)break;++pt,n=n*t+a}return pt===i||null!=e&&pt-i!==e?null:n}function C(){pt+=2;var t=b(16);return null==t&&i(mt+2,"Expected hexadecimal number"),Ye(ft.charCodeAt(pt))&&i(pt,"Identifier directly after number"),a(Lt,t)}function S(t){var e=pt,n=!1,r=48===ft.charCodeAt(pt);t||null!==b(10)||i(e,"Invalid number"),46===ft.charCodeAt(pt)&&(++pt,b(10),n=!0);var s=ft.charCodeAt(pt);(69===s||101===s)&&(s=ft.charCodeAt(++pt),(43===s||45===s)&&++pt,null===b(10)&&i(e,"Invalid number"),n=!0),Ye(ft.charCodeAt(pt))&&i(pt,"Identifier directly after number");var o,h=ft.slice(e,pt);return n?o=parseFloat(h):r&&1!==h.length?/[89]/.test(h)||Tt?i(e,"Invalid number"):o=parseInt(h,8):o=parseInt(h,10),a(Lt,o)}function P(t){pt++;for(var e="";;){pt>=dt&&i(mt,"Unterminated string constant");var n=ft.charCodeAt(pt);if(n===t)return++pt,a(jt,e);if(92===n){n=ft.charCodeAt(++pt);var r=/^[0-7]+/.exec(ft.slice(pt,pt+3));for(r&&(r=r[0]);r&&parseInt(r,8)>255;)r=r.slice(0,r.length-1);if("0"===r&&(r=null),++pt,r)Tt&&i(pt-2,"Octal literal in strict mode"),e+=String.fromCharCode(parseInt(r,8)),pt+=r.length-1;else switch(n){case 110:e+="\n";break;case 114:e+="\r";break;case 120:e+=String.fromCharCode(k(2));break;case 117:e+=String.fromCharCode(k(4));break;case 85:e+=String.fromCharCode(k(8));break;case 116:e+="\t";break;case 98:e+="\b";break;case 118:e+="\v";break;case 102:e+="\f";break;case 48:e+="\0";break;case 13:10===ft.charCodeAt(pt)&&++pt;case 10:ct.locations&&(kt=pt,++Pt);break;default:e+=String.fromCharCode(n)}}else(13===n||10===n||8232===n||8233===n)&&i(mt,"Unterminated string constant"),e+=String.fromCharCode(n),++pt}}function k(t){var e=b(16,t);return null===e&&i(mt,"Bad character escape sequence"),e}function I(){Re=!1;for(var t,e=!0,n=pt;;){var r=ft.charCodeAt(pt);if(Ke(r))Re&&(t+=ft.charAt(pt)),++pt;else{if(92!==r)break;Re||(t=ft.slice(n,pt)),Re=!0,117!=ft.charCodeAt(++pt)&&i(pt,"Expecting Unicode escape sequence \\uXXXX"),++pt;var s=k(4),a=String.fromCharCode(s);a||i(pt-1,"Invalid Unicode escape"),(e?Ye(s):Ke(s))||i(pt-4,"Invalid Unicode escape"),t+=a}e=!1}return Re?t:ft.slice(n,pt)}function M(){var t=I(),e=Bt;return Re||(He(t)?e=le[t]:(ct.forbidReserved&&(3===ct.ecmaVersion?De:Fe)(t)||Tt&&qe(t))&&i(mt,"The keyword '"+t+"' is reserved")),a(e,t)}function z(){It=mt,Mt=yt,zt=xt,y()}function A(t){if(Tt=t,pt=Mt,ct.locations)for(;kt>pt;)kt=ft.lastIndexOf("\n",kt-2)+1,--Pt;u(),y()}function O(){this.type=null,this.start=mt,this.end=null}function T(){this.start=wt,this.end=null,null!==_t&&(this.source=_t)}function E(){var t=new O;return ct.locations&&(t.loc=new T),ct.ranges&&(t.range=[mt,0]),t}function L(t){var e=new O;return e.start=t.start,ct.locations&&(e.loc=new T,e.loc.start=t.loc.start),ct.ranges&&(e.range=[t.range[0],0]),e}function N(t,e){return t.type=e,t.end=Mt,ct.locations&&(t.loc.end=zt),ct.ranges&&(t.range[1]=Mt),t}function j(t){return ct.ecmaVersion>=5&&"ExpressionStatement"===t.type&&"Literal"===t.expression.type&&"use strict"===t.expression.value}function B(t){return bt===t?(z(),!0):void 0}function R(){return!ct.strictSemicolons&&(bt===Rt||bt===_e||Xe.test(ft.slice(Mt,mt)))}function D(){B(me)||R()||q()}function F(t){bt===t?z():q()}function q(){i(mt,"Unexpected token")}function V(t){"Identifier"!==t.type&&"MemberExpression"!==t.type&&i(t.start,"Assigning to rvalue"),Tt&&"Identifier"===t.type&&Ve(t.name)&&i(t.start,"Assigning to "+t.name+" in strict mode")}function H(t){It=Mt=pt,ct.locations&&(zt=new r),At=Tt=null,Ot=[],y();var e=t||E(),i=!0;for(t||(e.body=[]);bt!==Rt;){var n=Z();e.body.push(n),i&&j(n)&&A(!0),i=!1}return N(e,"Program")}function Z(){(bt===be||bt===Se&&"/="==Ct)&&y(!0);var t=bt,e=E();switch(t){case Dt:case Vt:z();var n=t===Dt;B(me)||R()?e.label=null:bt!==Bt?q():(e.label=lt(),D());for(var r=0;r<Ot.length;++r){var s=Ot[r];if(null==e.label||s.name===e.label.name){if(null!=s.kind&&(n||"loop"===s.kind))break;if(e.label&&n)break}}return r===Ot.length&&i(e.start,"Unsyntactic "+t.keyword),N(e,n?"BreakStatement":"ContinueStatement");case Ht:return z(),D(),N(e,"DebuggerStatement");case Ut:return z(),Ot.push(Qe),e.body=Z(),Ot.pop(),F(ie),e.test=U(),D(),N(e,"DoWhileStatement");case $t:if(z(),Ot.push(Qe),F(ge),bt===me)return G(e,null);if(bt===ee){var a=E();return z(),X(a,!0),N(a,"VariableDeclaration"),1===a.declarations.length&&B(ue)?$(e,a):G(e,a)}var a=J(!1,!0);return B(ue)?(V(a),$(e,a)):G(e,a);case Xt:return z(),ht(e,!0);case Jt:return z(),e.test=U(),e.consequent=Z(),e.alternate=B(Wt)?Z():null,N(e,"IfStatement");case Yt:return At||i(mt,"'return' outside of function"),z(),B(me)||R()?e.argument=null:(e.argument=J(),D()),N(e,"ReturnStatement");case Kt:z(),e.discriminant=U(),e.cases=[],F(de),Ot.push(ti);for(var o,h;bt!=_e;)if(bt===Ft||bt===Zt){var u=bt===Ft;o&&N(o,"SwitchCase"),e.cases.push(o=E()),o.consequent=[],z(),u?o.test=J():(h&&i(It,"Multiple default clauses"),h=!0,o.test=null),F(ye)}else o||q(),o.consequent.push(Z());return o&&N(o,"SwitchCase"),z(),Ot.pop(),N(e,"SwitchStatement");case Qt:return z(),Xe.test(ft.slice(Mt,mt))&&i(Mt,"Illegal newline after throw"),e.argument=J(),D(),N(e,"ThrowStatement");case te:if(z(),e.block=W(),e.handler=null,bt===qt){var l=E();z(),F(ge),l.param=lt(),Tt&&Ve(l.param.name)&&i(l.param.start,"Binding "+l.param.name+" in strict mode"),F(ve),l.guard=null,l.body=W(),e.handler=N(l,"CatchClause")}return e.guardedHandlers=Et,e.finalizer=B(Gt)?W():null,e.handler||e.finalizer||i(e.start,"Missing catch or finally clause"),N(e,"TryStatement");case ee:return z(),X(e),D(),N(e,"VariableDeclaration");case ie:return z(),e.test=U(),Ot.push(Qe),e.body=Z(),Ot.pop(),N(e,"WhileStatement");case ne:return Tt&&i(mt,"'with' in strict mode"),z(),e.object=U(),e.body=Z(),N(e,"WithStatement");case de:return W();case me:return z(),N(e,"EmptyStatement");default:var c=Ct,f=J();if(t===Bt&&"Identifier"===f.type&&B(ye)){for(var r=0;r<Ot.length;++r)Ot[r].name===c&&i(f.start,"Label '"+c+"' is already declared");var d=bt.isLoop?"loop":bt===Kt?"switch":null;return Ot.push({name:c,kind:d}),e.body=Z(),Ot.pop(),e.label=f,N(e,"LabeledStatement")}return e.expression=f,D(),N(e,"ExpressionStatement")}}function U(){F(ge);var t=J();return F(ve),t}function W(t){var e,i=E(),n=!0,r=!1;for(i.body=[],F(de);!B(_e);){var s=Z();i.body.push(s),n&&t&&j(s)&&(e=r,A(r=!0)),n=!1}return r&&!e&&A(!1),N(i,"BlockStatement")}function G(t,e){return t.init=e,F(me),t.test=bt===me?null:J(),F(me),t.update=bt===ve?null:J(),F(ve),t.body=Z(),Ot.pop(),N(t,"ForStatement")}function $(t,e){return t.left=e,t.right=J(),F(ve),t.body=Z(),Ot.pop(),N(t,"ForInStatement")}function X(t,e){for(t.declarations=[],t.kind="var";;){var n=E();if(n.id=lt(),Tt&&Ve(n.id.name)&&i(n.id.start,"Binding "+n.id.name+" in strict mode"),n.init=B(Ce)?J(!0,e):null,t.declarations.push(N(n,"VariableDeclarator")),!B(pe))break}return t}function J(t,e){var i=Y(e);if(!t&&bt===pe){var n=L(i);for(n.expressions=[i];B(pe);)n.expressions.push(Y(e));return N(n,"SequenceExpression")}return i}function Y(t){var e=K(t);if(bt.isAssign){var i=L(e);return i.operator=Ct,i.left=e,z(),i.right=Y(t),V(e),N(i,"AssignmentExpression")}return e}function K(t){var e=Q(t);if(B(xe)){var i=L(e);return i.test=e,i.consequent=J(!0),F(ye),i.alternate=J(!0,t),N(i,"ConditionalExpression")}return e}function Q(t){return tt(et(),-1,t)}function tt(t,e,i){var n=bt.binop;if(null!=n&&(!i||bt!==ue)&&n>e){var r=L(t);r.left=t,r.operator=Ct,z(),r.right=tt(et(),n,i);return tt(N(r,/&&|\|\|/.test(r.operator)?"LogicalExpression":"BinaryExpression"),e,i)}return t}function et(){if(bt.prefix){var t=E(),e=bt.isUpdate;return t.operator=Ct,t.prefix=!0,St=!0,z(),t.argument=et(),e?V(t.argument):Tt&&"delete"===t.operator&&"Identifier"===t.argument.type&&i(t.start,"Deleting local variable in strict mode"),N(t,e?"UpdateExpression":"UnaryExpression")}for(var n=it();bt.postfix&&!R();){var t=L(n);t.operator=Ct,t.prefix=!1,t.argument=n,V(n),z(),n=N(t,"UpdateExpression")}return n}function it(){return nt(rt())}function nt(t,e){if(B(we)){var i=L(t);return i.object=t,i.property=lt(!0),i.computed=!1,nt(N(i,"MemberExpression"),e)}if(B(ce)){var i=L(t);return i.object=t,i.property=J(),i.computed=!0,F(fe),nt(N(i,"MemberExpression"),e)}if(!e&&B(ge)){var i=L(t);return i.callee=t,i.arguments=ut(ve,!1),nt(N(i,"CallExpression"),e)}return t}function rt(){switch(bt){case se:var t=E();return z(),N(t,"ThisExpression");case Bt:return lt();case Lt:case jt:case Nt:var t=E();return t.value=Ct,t.raw=ft.slice(mt,yt),z(),N(t,"Literal");case ae:case oe:case he:var t=E();return t.value=bt.atomValue,t.raw=bt.keyword,z(),N(t,"Literal");case ge:var e=wt,i=mt;z();var n=J();return n.start=i,n.end=yt,ct.locations&&(n.loc.start=e,n.loc.end=xt),ct.ranges&&(n.range=[i,yt]),F(ve),n;case ce:var t=E();return z(),t.elements=ut(fe,!0,!0),N(t,"ArrayExpression");case de:return at();case Xt:var t=E();return z(),ht(t,!1);case re:return st();default:q()}}function st(){var t=E();return z(),t.callee=nt(rt(),!0),t.arguments=B(ge)?ut(ve,!1):Et,N(t,"NewExpression")}function at(){var t=E(),e=!0,n=!1;for(t.properties=[],z();!B(_e);){if(e)e=!1;else if(F(pe),ct.allowTrailingCommas&&B(_e))break;var r,s={key:ot()},a=!1;if(B(ye)?(s.value=J(!0),r=s.kind="init"):ct.ecmaVersion>=5&&"Identifier"===s.key.type&&("get"===s.key.name||"set"===s.key.name)?(a=n=!0,r=s.kind=s.key.name,s.key=ot(),bt!==ge&&q(),s.value=ht(E(),!1)):q(),"Identifier"===s.key.type&&(Tt||n))for(var o=0;o<t.properties.length;++o){var h=t.properties[o];if(h.key.name===s.key.name){var u=r==h.kind||a&&"init"===h.kind||"init"===r&&("get"===h.kind||"set"===h.kind);u&&!Tt&&"init"===r&&"init"===h.kind&&(u=!1),u&&i(s.key.start,"Redefinition of property")}}t.properties.push(s)}return N(t,"ObjectExpression")}function ot(){return bt===Lt||bt===jt?rt():lt(!0)}function ht(t,e){bt===Bt?t.id=lt():e?q():t.id=null,t.params=[];var n=!0;for(F(ge);!B(ve);)n?n=!1:F(pe),t.params.push(lt());var r=At,s=Ot;if(At=!0,Ot=[],t.body=W(!0),At=r,Ot=s,Tt||t.body.body.length&&j(t.body.body[0]))for(var a=t.id?-1:0;a<t.params.length;++a){var o=0>a?t.id:t.params[a];if((qe(o.name)||Ve(o.name))&&i(o.start,"Defining '"+o.name+"' in strict mode"),a>=0)for(var h=0;a>h;++h)o.name===t.params[h].name&&i(o.start,"Argument name clash in strict mode")}return N(t,e?"FunctionDeclaration":"FunctionExpression")}function ut(t,e,i){for(var n=[],r=!0;!B(t);){if(r)r=!1;else if(F(pe),e&&ct.allowTrailingCommas&&B(t))break;i&&bt===pe?n.push(null):n.push(J(!0))}return n}function lt(t){var e=E();return e.name=bt===Bt?Ct:t&&!ct.forbidReserved&&bt.keyword||q(),St=!1,z(),N(e,"Identifier")}t.version="0.4.0";var ct,ft,dt,_t;t.parse=function(t,i){return ft=String(t),dt=ft.length,e(i),s(),H(ct.program)};var gt=t.defaultOptions={ecmaVersion:5,strictSemicolons:!1,allowTrailingCommas:!0,forbidReserved:!1,locations:!1,onComment:null,ranges:!1,program:null,sourceFile:null},vt=t.getLineInfo=function(t,e){for(var i=1,n=0;;){Je.lastIndex=n;var r=Je.exec(t);if(!(r&&r.index<e))break;++i,n=r.index+r[0].length}return{line:i,column:e-n}};t.tokenize=function(t,i){function n(t){return y(t),r.start=mt,r.end=yt,r.startLoc=wt,r.endLoc=xt,r.type=bt,r.value=Ct,r}ft=String(t),dt=ft.length,e(i),s();var r={};return n.jumpTo=function(t,e){if(pt=t,ct.locations){Pt=1,kt=Je.lastIndex=0;for(var i;(i=Je.exec(ft))&&i.index<t;)++Pt,kt=i.index+i[0].length}St=e,u()},n};var pt,mt,yt,wt,xt,bt,Ct,St,Pt,kt,It,Mt,zt,At,Ot,Tt,Et=[],Lt={type:"num"},Nt={type:"regexp"},jt={type:"string"},Bt={type:"name"},Rt={type:"eof"},Dt={keyword:"break"},Ft={keyword:"case",beforeExpr:!0},qt={keyword:"catch"},Vt={keyword:"continue"},Ht={keyword:"debugger"},Zt={keyword:"default"},Ut={keyword:"do",isLoop:!0},Wt={keyword:"else",beforeExpr:!0},Gt={keyword:"finally"},$t={keyword:"for",isLoop:!0},Xt={keyword:"function"},Jt={keyword:"if"},Yt={keyword:"return",beforeExpr:!0},Kt={keyword:"switch"},Qt={keyword:"throw",beforeExpr:!0},te={keyword:"try"},ee={keyword:"var"},ie={keyword:"while",isLoop:!0},ne={keyword:"with"},re={keyword:"new",beforeExpr:!0},se={keyword:"this"},ae={keyword:"null",atomValue:null},oe={keyword:"true",atomValue:!0},he={keyword:"false",atomValue:!1},ue={keyword:"in",binop:7,beforeExpr:!0},le={break:Dt,case:Ft,catch:qt,continue:Vt,debugger:Ht,default:Zt,do:Ut,else:Wt,finally:Gt,for:$t,function:Xt,if:Jt,return:Yt,switch:Kt,throw:Qt,try:te,var:ee,while:ie,with:ne,null:ae,true:oe,false:he,new:re,in:ue,instanceof:{keyword:"instanceof",binop:7,beforeExpr:!0},this:se,typeof:{keyword:"typeof",prefix:!0,beforeExpr:!0},void:{keyword:"void",prefix:!0,beforeExpr:!0},delete:{keyword:"delete",prefix:!0,beforeExpr:!0}},ce={type:"[",beforeExpr:!0},fe={type:"]"},de={type:"{",beforeExpr:!0},_e={type:"}"},ge={type:"(",beforeExpr:!0},ve={type:")"},pe={type:",",beforeExpr:!0},me={type:";",beforeExpr:!0},ye={type:":",beforeExpr:!0},we={type:"."},xe={type:"?",beforeExpr:!0},be={binop:10,beforeExpr:!0},Ce={isAssign:!0,beforeExpr:!0},Se={isAssign:!0,beforeExpr:!0},Pe={binop:9,prefix:!0,beforeExpr:!0},ke={postfix:!0,prefix:!0,isUpdate:!0},Ie={prefix:!0,beforeExpr:!0},Me={binop:1,beforeExpr:!0},ze={binop:2,beforeExpr:!0},Ae={binop:3,beforeExpr:!0},Oe={binop:4,beforeExpr:!0},Te={binop:5,beforeExpr:!0},Ee={binop:6,beforeExpr:!0},Le={binop:7,beforeExpr:!0},Ne={binop:8,beforeExpr:!0},je={binop:10,beforeExpr:!0};t.tokTypes={bracketL:ce,bracketR:fe,braceL:de,braceR:_e,parenL:ge,parenR:ve,comma:pe,semi:me,colon:ye,dot:we,question:xe,slash:be,eq:Ce,name:Bt,eof:Rt,num:Lt,regexp:Nt,string:jt};for(var Be in le)t.tokTypes["_"+Be]=le[Be];var Re,De=n("abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile"),Fe=n("class enum extends super const export import"),qe=n("implements interface let package private protected public static yield"),Ve=n("eval arguments"),He=n("break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this"),Ze=/[\u1680\u180e\u2000-\u200a\u202f\u205f\u3000\ufeff]/,Ue="ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԧԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠࢢ-ࢬऄ-हऽॐक़-ॡॱ-ॷॹ-ॿঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-ళవ-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛰᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤜᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々-〇〡-〩〱-〵〸-〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚗꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞓꞠ-Ɦꟸ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꪀ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ",We="̀-ͯ҃-֑҇-ׇֽֿׁׂׅׄؐ-ؚؠ-ىٲ-ۓۧ-ۨۻ-ۼܰ-݊ࠀ-ࠔࠛ-ࠣࠥ-ࠧࠩ-࠭ࡀ-ࡗࣤ-ࣾऀ-ःऺ-़ा-ॏ॑-ॗॢ-ॣ०-९ঁ-ঃ়া-ৄেৈৗয়-ৠਁ-ਃ਼ਾ-ੂੇੈੋ-੍ੑ੦-ੱੵઁ-ઃ઼ા-ૅે-ૉો-્ૢ-ૣ૦-૯ଁ-ଃ଼ା-ୄେୈୋ-୍ୖୗୟ-ୠ୦-୯ஂா-ூெ-ைொ-்ௗ௦-௯ఁ-ఃె-ైొ-్ౕౖౢ-ౣ౦-౯ಂಃ಼ಾ-ೄೆ-ೈೊ-್ೕೖೢ-ೣ೦-೯ംഃെ-ൈൗൢ-ൣ൦-൯ංඃ්ා-ුූෘ-ෟෲෳิ-ฺเ-ๅ๐-๙ິ-ູ່-ໍ໐-໙༘༙༠-༩༹༵༷ཁ-ཇཱ-྄྆-྇ྍ-ྗྙ-ྼ࿆က-ဩ၀-၉ၧ-ၭၱ-ၴႂ-ႍႏ-ႝ፝-፟ᜎ-ᜐᜠ-ᜰᝀ-ᝐᝲᝳក-ឲ៝០-៩᠋-᠍᠐-᠙ᤠ-ᤫᤰ-᤻ᥑ-ᥭᦰ-ᧀᧈ-ᧉ᧐-᧙ᨀ-ᨕᨠ-ᩓ᩠-᩿᩼-᪉᪐-᪙ᭆ-ᭋ᭐-᭙᭫-᭳᮰-᮹᯦-᯳ᰀ-ᰢ᱀-᱉ᱛ-ᱽ᳐-᳒ᴀ-ᶾḁ-ἕ‌‍‿⁀⁔⃐-⃥⃜⃡-⃰ⶁ-ⶖⷠ-ⷿ〡-〨゙゚Ꙁ-ꙭꙴ-꙽ꚟ꛰-꛱ꟸ-ꠀ꠆ꠋꠣ-ꠧꢀ-ꢁꢴ-꣄꣐-꣙ꣳ-ꣷ꤀-꤉ꤦ-꤭ꤰ-ꥅꦀ-ꦃ꦳-꧀ꨀ-ꨧꩀ-ꩁꩌ-ꩍ꩐-꩙ꩻꫠ-ꫩꫲ-ꫳꯀ-ꯡ꯬꯭꯰-꯹ﬠ-ﬨ︀-️︠-︦︳︴﹍-﹏０-９＿",Ge=new RegExp("["+Ue+"]"),$e=new RegExp("["+Ue+We+"]"),Xe=/[\n\r\u2028\u2029]/,Je=/\r\n|[\n\r\u2028\u2029]/g,Ye=t.isIdentifierStart=function(t){return 65>t?36===t:91>t?!0:97>t?95===t:123>t?!0:t>=170&&Ge.test(String.fromCharCode(t))},Ke=t.isIdentifierChar=function(t){return 48>t?36===t:58>t?!0:65>t?!1:91>t?!0:97>t?95===t:123>t?!0:t>=170&&$e.test(String.fromCharCode(t))},Qe={kind:"loop"},ti={kind:"switch"}});var _={"+":"__add","-":"__subtract","*":"__multiply","/":"__divide","%":"__modulo","==":"equals","!=":"equals"},g={"-":"__negate","+":null},v=e.each(["add","subtract","multiply","divide","modulo","negate"],function(t){this["__"+t]="#"+t},{});if(h.inject(v),l.inject(v),j.inject(v),"complete"===document.readyState)setTimeout(u);else q.add(window,{load:u});return{compile:s,execute:a,load:c,parse:r}}.call(this),paper=new(n.inject(e.exports,{enumerable:!0,Base:e,Numerical:a,Key:W})),"function"==typeof define&&define.amd)define("paper",paper);else if("object"==typeof module&&module)module.exports=paper;return paper};